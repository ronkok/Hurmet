(function(){"use strict";function e(e){this.content=e}e.prototype={constructor:e,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?undefined:this.content[t+1]},update:function(t,r,n){var o=n&&n!=t?this.remove(n):this;var i=o.find(t),a=o.content.slice();if(i==-1){a.push(n||t,r)}else{a[i+1]=r;if(n)a[i]=n}return new e(a)},remove:function(t){var r=this.find(t);if(r==-1)return this;var n=this.content.slice();n.splice(r,2);return new e(n)},addToStart:function(t,r){return new e([t,r].concat(this.remove(t).content))},addToEnd:function(t,r){var n=this.remove(t).content.slice();n.push(t,r);return new e(n)},addBefore:function(t,r,n){var o=this.remove(r),i=o.content.slice();var a=o.find(t);i.splice(a==-1?i.length:a,0,r,n);return new e(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(t){t=e.from(t);if(!t.size)return this;return new e(t.content.concat(this.subtract(t).content))},append:function(t){t=e.from(t);if(!t.size)return this;return new e(this.subtract(t).content.concat(t.content))},subtract:function(t){var r=this;t=e.from(t);for(var n=0;n<t.content.length;n+=2)r=r.remove(t.content[n]);return r},get size(){return this.content.length>>1}};e.from=function(t){if(t instanceof e)return t;var r=[];if(t)for(var n in t)r.push(n,t[n]);return new e(r)};var t=e;function r(e,t,n){for(var o=0;;o++){if(o==e.childCount||o==t.childCount){return e.childCount==t.childCount?null:n}var i=e.child(o),a=t.child(o);if(i==a){n+=i.nodeSize;continue}if(!i.sameMarkup(a)){return n}if(i.isText&&i.text!=a.text){for(var s=0;i.text[s]==a.text[s];s++){n++}return n}if(i.content.size||a.content.size){var l=r(i.content,a.content,n+1);if(l!=null){return l}}n+=i.nodeSize}}function n(e,t,r,o){for(var i=e.childCount,a=t.childCount;;){if(i==0||a==0){return i==a?null:{a:r,b:o}}var s=e.child(--i),l=t.child(--a),c=s.nodeSize;if(s==l){r-=c;o-=c;continue}if(!s.sameMarkup(l)){return{a:r,b:o}}if(s.isText&&s.text!=l.text){var f=0,u=Math.min(s.text.length,l.text.length);while(f<u&&s.text[s.text.length-f-1]==l.text[l.text.length-f-1]){f++;r--;o--}return{a:r,b:o}}if(s.content.size||l.content.size){var h=n(s.content,l.content,r-1,o-1);if(h){return h}}r-=c;o-=c}}var o=function e(t,r){this.content=t;this.size=r||0;if(r==null){for(var n=0;n<t.length;n++){this.size+=t[n].nodeSize}}};var i={firstChild:{configurable:true},lastChild:{configurable:true},childCount:{configurable:true}};o.prototype.nodesBetween=function e(t,r,n,o,i){if(o===void 0)o=0;for(var a=0,s=0;s<r;a++){var l=this.content[a],c=s+l.nodeSize;if(c>t&&n(l,o+s,i,a)!==false&&l.content.size){var f=s+1;l.nodesBetween(Math.max(0,t-f),Math.min(l.content.size,r-f),n,o+f)}s=c}};o.prototype.descendants=function e(t){this.nodesBetween(0,this.size,t)};o.prototype.textBetween=function e(t,r,n,o){var i="",a=true;this.nodesBetween(t,r,function(e,s){if(e.isText){i+=e.text.slice(Math.max(t,s)-s,r-s);a=!n}else if(e.isLeaf&&o){i+=o;a=!n}else if(!a&&e.isBlock){i+=n;a=true}},0);return i};o.prototype.append=function e(t){if(!t.size){return this}if(!this.size){return t}var r=this.lastChild,n=t.firstChild,i=this.content.slice(),a=0;if(r.isText&&r.sameMarkup(n)){i[i.length-1]=r.withText(r.text+n.text);a=1}for(;a<t.content.length;a++){i.push(t.content[a])}return new o(i,this.size+t.size)};o.prototype.cut=function e(t,r){if(r==null){r=this.size}if(t==0&&r==this.size){return this}var n=[],i=0;if(r>t){for(var a=0,s=0;s<r;a++){var l=this.content[a],c=s+l.nodeSize;if(c>t){if(s<t||c>r){if(l.isText){l=l.cut(Math.max(0,t-s),Math.min(l.text.length,r-s))}else{l=l.cut(Math.max(0,t-s-1),Math.min(l.content.size,r-s-1))}}n.push(l);i+=l.nodeSize}s=c}}return new o(n,i)};o.prototype.cutByIndex=function e(t,r){if(t==r){return o.empty}if(t==0&&r==this.content.length){return this}return new o(this.content.slice(t,r))};o.prototype.replaceChild=function e(t,r){var n=this.content[t];if(n==r){return this}var i=this.content.slice();var a=this.size+r.nodeSize-n.nodeSize;i[t]=r;return new o(i,a)};o.prototype.addToStart=function e(t){return new o([t].concat(this.content),this.size+t.nodeSize)};o.prototype.addToEnd=function e(t){return new o(this.content.concat(t),this.size+t.nodeSize)};o.prototype.eq=function e(t){if(this.content.length!=t.content.length){return false}for(var r=0;r<this.content.length;r++){if(!this.content[r].eq(t.content[r])){return false}}return true};i.firstChild.get=function(){return this.content.length?this.content[0]:null};i.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};i.childCount.get=function(){return this.content.length};o.prototype.child=function e(t){var r=this.content[t];if(!r){throw new RangeError("Index "+t+" out of range for "+this)}return r};o.prototype.maybeChild=function e(t){return this.content[t]};o.prototype.forEach=function e(t){for(var r=0,n=0;r<this.content.length;r++){var o=this.content[r];t(o,n,r);n+=o.nodeSize}};o.prototype.findDiffStart=function e(t,n){if(n===void 0)n=0;return r(this,t,n)};o.prototype.findDiffEnd=function e(t,r,o){if(r===void 0)r=this.size;if(o===void 0)o=t.size;return n(this,t,r,o)};o.prototype.findIndex=function e(t,r){if(r===void 0)r=-1;if(t==0){return s(0,t)}if(t==this.size){return s(this.content.length,t)}if(t>this.size||t<0){throw new RangeError("Position "+t+" outside of fragment ("+this+")")}for(var n=0,o=0;;n++){var i=this.child(n),a=o+i.nodeSize;if(a>=t){if(a==t||r>0){return s(n+1,a)}return s(n,o)}o=a}};o.prototype.toString=function e(){return"<"+this.toStringInner()+">"};o.prototype.toStringInner=function e(){return this.content.join(", ")};o.prototype.toJSON=function e(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};o.fromJSON=function e(t,r){if(!r){return o.empty}if(!Array.isArray(r)){throw new RangeError("Invalid input for Fragment.fromJSON")}return new o(r.map(t.nodeFromJSON))};o.fromArray=function e(t){if(!t.length){return o.empty}var r,n=0;for(var i=0;i<t.length;i++){var a=t[i];n+=a.nodeSize;if(i&&a.isText&&t[i-1].sameMarkup(a)){if(!r){r=t.slice(0,i)}r[r.length-1]=a.withText(r[r.length-1].text+a.text)}else if(r){r.push(a)}}return new o(r||t,n)};o.from=function e(t){if(!t){return o.empty}if(t instanceof o){return t}if(Array.isArray(t)){return this.fromArray(t)}if(t.attrs){return new o([t],t.nodeSize)}throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(o.prototype,i);var a={index:0,offset:0};function s(e,t){a.index=e;a.offset=t;return a}o.empty=new o([],0);function l(e,t){if(e===t){return true}if(!(e&&typeof e=="object")||!(t&&typeof t=="object")){return false}var r=Array.isArray(e);if(Array.isArray(t)!=r){return false}if(r){if(e.length!=t.length){return false}for(var n=0;n<e.length;n++){if(!l(e[n],t[n])){return false}}}else{for(var o in e){if(!(o in t)||!l(e[o],t[o])){return false}}for(var i in t){if(!(i in e)){return false}}}return true}var c=function e(t,r){this.type=t;this.attrs=r};c.prototype.addToSet=function e(t){var r,n=false;for(var o=0;o<t.length;o++){var i=t[o];if(this.eq(i)){return t}if(this.type.excludes(i.type)){if(!r){r=t.slice(0,o)}}else if(i.type.excludes(this.type)){return t}else{if(!n&&i.type.rank>this.type.rank){if(!r){r=t.slice(0,o)}r.push(this);n=true}if(r){r.push(i)}}}if(!r){r=t.slice()}if(!n){r.push(this)}return r};c.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return t.slice(0,r).concat(t.slice(r+1))}}return t};c.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return true}}return false};c.prototype.eq=function e(t){return this==t||this.type==t.type&&l(this.attrs,t.attrs)};c.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}return t};c.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Mark.fromJSON")}var n=t.marks[r.type];if(!n){throw new RangeError("There is no mark type "+r.type+" in this schema")}return n.create(r.attrs)};c.sameSet=function e(t,r){if(t==r){return true}if(t.length!=r.length){return false}for(var n=0;n<t.length;n++){if(!t[n].eq(r[n])){return false}}return true};c.setFrom=function e(t){if(!t||t.length==0){return c.none}if(t instanceof c){return[t]}var r=t.slice();r.sort(function(e,t){return e.type.rank-t.type.rank});return r};c.none=[];function f(e){var t=Error.call(this,e);t.__proto__=f.prototype;return t}f.prototype=Object.create(Error.prototype);f.prototype.constructor=f;f.prototype.name="ReplaceError";var u=function e(t,r,n){this.content=t;this.openStart=r;this.openEnd=n};var h={size:{configurable:true}};h.size.get=function(){return this.content.size-this.openStart-this.openEnd};u.prototype.insertAt=function e(t,r){var n=d(this.content,t+this.openStart,r,null);return n&&new u(n,this.openStart,this.openEnd)};u.prototype.removeBetween=function e(t,r){return new u(p(this.content,t+this.openStart,r+this.openStart),this.openStart,this.openEnd)};u.prototype.eq=function e(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};u.prototype.toString=function e(){return this.content+"("+this.openStart+","+this.openEnd+")"};u.prototype.toJSON=function e(){if(!this.content.size){return null}var t={content:this.content.toJSON()};if(this.openStart>0){t.openStart=this.openStart}if(this.openEnd>0){t.openEnd=this.openEnd}return t};u.fromJSON=function e(t,r){if(!r){return u.empty}var n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number"){throw new RangeError("Invalid input for Slice.fromJSON")}return new u(o.fromJSON(t,r.content),r.openStart||0,r.openEnd||0)};u.maxOpen=function e(t,r){if(r===void 0)r=true;var n=0,o=0;for(var i=t.firstChild;i&&!i.isLeaf&&(r||!i.type.spec.isolating);i=i.firstChild){n++}for(var a=t.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild){o++}return new u(t,n,o)};Object.defineProperties(u.prototype,h);function p(e,t,r){var n=e.findIndex(t);var o=n.index;var i=n.offset;var a=e.maybeChild(o);var s=e.findIndex(r);var l=s.index;var c=s.offset;if(i==t||a.isText){if(c!=r&&!e.child(l).isText){throw new RangeError("Removing non-flat range")}return e.cut(0,t).append(e.cut(r))}if(o!=l){throw new RangeError("Removing non-flat range")}return e.replaceChild(o,a.copy(p(a.content,t-i-1,r-i-1)))}function d(e,t,r,n){var o=e.findIndex(t);var i=o.index;var a=o.offset;var s=e.maybeChild(i);if(a==t||s.isText){if(n&&!n.canReplace(i,i,r)){return null}return e.cut(0,t).append(r).append(e.cut(t))}var l=d(s.content,t-a-1,r);return l&&e.replaceChild(i,s.copy(l))}u.empty=new u(o.empty,0,0);function v(e,t,r){if(r.openStart>e.depth){throw new f("Inserted content deeper than insertion position")}if(e.depth-r.openStart!=t.depth-r.openEnd){throw new f("Inconsistent open depths")}return m(e,t,r,0)}function m(e,t,r,n){var o=e.index(n),i=e.node(n);if(o==t.index(n)&&n<e.depth-r.openStart){var a=m(e,t,r,n+1);return i.copy(i.content.replaceChild(o,a))}else if(!r.content.size){return C(i,x(e,t,n))}else if(!r.openStart&&!r.openEnd&&e.depth==n&&t.depth==n){var s=e.parent,l=s.content;return C(s,l.cut(0,e.parentOffset).append(r.content).append(l.cut(t.parentOffset)))}else{var c=k(r,e);var f=c.start;var u=c.end;return C(i,M(e,f,u,t,n))}}function g(e,t){if(!t.type.compatibleContent(e.type)){throw new f("Cannot join "+t.type.name+" onto "+e.type.name)}}function y(e,t,r){var n=e.node(r);g(n,t.node(r));return n}function w(e,t){var r=t.length-1;if(r>=0&&e.isText&&e.sameMarkup(t[r])){t[r]=e.withText(t[r].text+e.text)}else{t.push(e)}}function b(e,t,r,n){var o=(t||e).node(r);var i=0,a=t?t.index(r):o.childCount;if(e){i=e.index(r);if(e.depth>r){i++}else if(e.textOffset){w(e.nodeAfter,n);i++}}for(var s=i;s<a;s++){w(o.child(s),n)}if(t&&t.depth==r&&t.textOffset){w(t.nodeBefore,n)}}function C(e,t){if(!e.type.validContent(t)){throw new f("Invalid content for node "+e.type.name)}return e.copy(t)}function M(e,t,r,n,i){var a=e.depth>i&&y(e,t,i+1);var s=n.depth>i&&y(r,n,i+1);var l=[];b(null,e,i,l);if(a&&s&&t.index(i)==r.index(i)){g(a,s);w(C(a,M(e,t,r,n,i+1)),l)}else{if(a){w(C(a,x(e,t,i+1)),l)}b(t,r,i,l);if(s){w(C(s,x(r,n,i+1)),l)}}b(n,null,i,l);return new o(l)}function x(e,t,r){var n=[];b(null,e,r,n);if(e.depth>r){var i=y(e,t,r+1);w(C(i,x(e,t,r+1)),n)}b(t,null,r,n);return new o(n)}function k(e,t){var r=t.depth-e.openStart,n=t.node(r);var i=n.copy(e.content);for(var a=r-1;a>=0;a--){i=t.node(a).copy(o.from(i))}return{start:i.resolveNoCache(e.openStart+r),end:i.resolveNoCache(i.content.size-e.openEnd-r)}}var S=function e(t,r,n){this.pos=t;this.path=r;this.depth=r.length/3-1;this.parentOffset=n};var O={parent:{configurable:true},doc:{configurable:true},textOffset:{configurable:true},nodeAfter:{configurable:true},nodeBefore:{configurable:true}};S.prototype.resolveDepth=function e(t){if(t==null){return this.depth}if(t<0){return this.depth+t}return t};O.parent.get=function(){return this.node(this.depth)};O.doc.get=function(){return this.node(0)};S.prototype.node=function e(t){return this.path[this.resolveDepth(t)*3]};S.prototype.index=function e(t){return this.path[this.resolveDepth(t)*3+1]};S.prototype.indexAfter=function e(t){t=this.resolveDepth(t);return this.index(t)+(t==this.depth&&!this.textOffset?0:1)};S.prototype.start=function e(t){t=this.resolveDepth(t);return t==0?0:this.path[t*3-1]+1};S.prototype.end=function e(t){t=this.resolveDepth(t);return this.start(t)+this.node(t).content.size};S.prototype.before=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position before the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]};S.prototype.after=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position after the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};O.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};O.nodeAfter.get=function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount){return null}var r=this.pos-this.path[this.path.length-1],n=e.child(t);return r?e.child(t).cut(r):n};O.nodeBefore.get=function(){var e=this.index(this.depth);var t=this.pos-this.path[this.path.length-1];if(t){return this.parent.child(e).cut(0,t)}return e==0?null:this.parent.child(e-1)};S.prototype.marks=function e(){var t=this.parent,r=this.index();if(t.content.size==0){return c.none}if(this.textOffset){return t.child(r).marks}var n=t.maybeChild(r-1),o=t.maybeChild(r);if(!n){var i=n;n=o;o=i}var e=n.marks;for(var a=0;a<e.length;a++){if(e[a].type.spec.inclusive===false&&(!o||!e[a].isInSet(o.marks))){e=e[a--].removeFromSet(e)}}return e};S.prototype.marksAcross=function e(t){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline){return null}var n=r.marks,o=t.parent.maybeChild(t.index());for(var i=0;i<n.length;i++){if(n[i].type.spec.inclusive===false&&(!o||!n[i].isInSet(o.marks))){n=n[i--].removeFromSet(n)}}return n};S.prototype.sharedDepth=function e(t){for(var r=this.depth;r>0;r--){if(this.start(r)<=t&&this.end(r)>=t){return r}}return 0};S.prototype.blockRange=function e(t,r){if(t===void 0)t=this;if(t.pos<this.pos){return t.blockRange(this)}for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--){if(t.pos<=this.end(n)&&(!r||r(this.node(n)))){return new T(this,t,n)}}};S.prototype.sameParent=function e(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};S.prototype.max=function e(t){return t.pos>this.pos?t:this};S.prototype.min=function e(t){return t.pos<this.pos?t:this};S.prototype.toString=function e(){var t="";for(var r=1;r<=this.depth;r++){t+=(t?"/":"")+this.node(r).type.name+"_"+this.index(r-1)}return t+":"+this.parentOffset};S.resolve=function e(t,r){if(!(r>=0&&r<=t.content.size)){throw new RangeError("Position "+r+" out of range")}var n=[];var o=0,i=r;for(var a=t;;){var s=a.content.findIndex(i);var l=s.index;var c=s.offset;var f=i-c;n.push(a,l,o+c);if(!f){break}a=a.child(l);if(a.isText){break}i=f-1;o+=c+1}return new S(r,n,i)};S.resolveCached=function e(t,r){for(var n=0;n<N.length;n++){var o=N[n];if(o.pos==r&&o.doc==t){return o}}var i=N[A]=S.resolve(t,r);A=(A+1)%D;return i};Object.defineProperties(S.prototype,O);var N=[],A=0,D=12;var T=function e(t,r,n){this.$from=t;this.$to=r;this.depth=n};var E={start:{configurable:true},end:{configurable:true},parent:{configurable:true},startIndex:{configurable:true},endIndex:{configurable:true}};E.start.get=function(){return this.$from.before(this.depth+1)};E.end.get=function(){return this.$to.after(this.depth+1)};E.parent.get=function(){return this.$from.node(this.depth)};E.startIndex.get=function(){return this.$from.index(this.depth)};E.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(T.prototype,E);var z=Object.create(null);var R=function e(t,r,n,i){this.type=t;this.attrs=r;this.content=n||o.empty;this.marks=i||c.none};var L={nodeSize:{configurable:true},childCount:{configurable:true},textContent:{configurable:true},firstChild:{configurable:true},lastChild:{configurable:true},isBlock:{configurable:true},isTextblock:{configurable:true},inlineContent:{configurable:true},isInline:{configurable:true},isText:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};L.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};L.childCount.get=function(){return this.content.childCount};R.prototype.child=function e(t){return this.content.child(t)};R.prototype.maybeChild=function e(t){return this.content.maybeChild(t)};R.prototype.forEach=function e(t){this.content.forEach(t)};R.prototype.nodesBetween=function e(t,r,n,o){if(o===void 0)o=0;this.content.nodesBetween(t,r,n,o,this)};R.prototype.descendants=function e(t){this.nodesBetween(0,this.content.size,t)};L.textContent.get=function(){return this.textBetween(0,this.content.size,"")};R.prototype.textBetween=function e(t,r,n,o){return this.content.textBetween(t,r,n,o)};L.firstChild.get=function(){return this.content.firstChild};L.lastChild.get=function(){return this.content.lastChild};R.prototype.eq=function e(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};R.prototype.sameMarkup=function e(t){return this.hasMarkup(t.type,t.attrs,t.marks)};R.prototype.hasMarkup=function e(t,r,n){return this.type==t&&l(this.attrs,r||t.defaultAttrs||z)&&c.sameSet(this.marks,n||c.none)};R.prototype.copy=function e(t){if(t===void 0)t=null;if(t==this.content){return this}return new this.constructor(this.type,this.attrs,t,this.marks)};R.prototype.mark=function e(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};R.prototype.cut=function e(t,r){if(t==0&&r==this.content.size){return this}return this.copy(this.content.cut(t,r))};R.prototype.slice=function e(t,r,n){if(r===void 0)r=this.content.size;if(n===void 0)n=false;if(t==r){return u.empty}var o=this.resolve(t),i=this.resolve(r);var a=n?0:o.sharedDepth(r);var s=o.start(a),l=o.node(a);var c=l.content.cut(o.pos-s,i.pos-s);return new u(c,o.depth-a,i.depth-a)};R.prototype.replace=function e(t,r,n){return v(this.resolve(t),this.resolve(r),n)};R.prototype.nodeAt=function e(t){for(var r=this;;){var n=r.content.findIndex(t);var o=n.index;var i=n.offset;r=r.maybeChild(o);if(!r){return null}if(i==t||r.isText){return r}t-=i+1}};R.prototype.childAfter=function e(t){var r=this.content.findIndex(t);var n=r.index;var o=r.offset;return{node:this.content.maybeChild(n),index:n,offset:o}};R.prototype.childBefore=function e(t){if(t==0){return{node:null,index:0,offset:0}}var r=this.content.findIndex(t);var n=r.index;var o=r.offset;if(o<t){return{node:this.content.child(n),index:n,offset:o}}var i=this.content.child(n-1);return{node:i,index:n-1,offset:o-i.nodeSize}};R.prototype.resolve=function e(t){return S.resolveCached(this,t)};R.prototype.resolveNoCache=function e(t){return S.resolve(this,t)};R.prototype.rangeHasMark=function e(t,r,n){var o=false;if(r>t){this.nodesBetween(t,r,function(e){if(n.isInSet(e.marks)){o=true}return!o})}return o};L.isBlock.get=function(){return this.type.isBlock};L.isTextblock.get=function(){return this.type.isTextblock};L.inlineContent.get=function(){return this.type.inlineContent};L.isInline.get=function(){return this.type.isInline};L.isText.get=function(){return this.type.isText};L.isLeaf.get=function(){return this.type.isLeaf};L.isAtom.get=function(){return this.type.isAtom};R.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}var t=this.type.name;if(this.content.size){t+="("+this.content.toStringInner()+")"}return $(this.marks,t)};R.prototype.contentMatchAt=function e(t){var r=this.type.contentMatch.matchFragment(this.content,0,t);if(!r){throw new Error("Called contentMatchAt on a node with invalid content")}return r};R.prototype.canReplace=function e(t,r,n,i,a){if(n===void 0)n=o.empty;if(i===void 0)i=0;if(a===void 0)a=n.childCount;var s=this.contentMatchAt(t).matchFragment(n,i,a);var l=s&&s.matchFragment(this.content,r);if(!l||!l.validEnd){return false}for(var c=i;c<a;c++){if(!this.type.allowsMarks(n.child(c).marks)){return false}}return true};R.prototype.canReplaceWith=function e(t,r,n,o){if(o&&!this.type.allowsMarks(o)){return false}var i=this.contentMatchAt(t).matchType(n);var a=i&&i.matchFragment(this.content,r);return a?a.validEnd:false};R.prototype.canAppend=function e(t){if(t.content.size){return this.canReplace(this.childCount,this.childCount,t.content)}else{return this.type.compatibleContent(t.type)}};R.prototype.check=function e(){if(!this.type.validContent(this.content)){throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50))}this.content.forEach(function(e){return e.check()})};R.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}if(this.content.size){t.content=this.content.toJSON()}if(this.marks.length){t.marks=this.marks.map(function(e){return e.toJSON()})}return t};R.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Node.fromJSON")}var n=null;if(r.marks){if(!Array.isArray(r.marks)){throw new RangeError("Invalid mark data for Node.fromJSON")}n=r.marks.map(t.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string"){throw new RangeError("Invalid text node in JSON")}return t.text(r.text,n)}var i=o.fromJSON(t,r.content);return t.nodeType(r.type).create(r.attrs,i,n)};Object.defineProperties(R.prototype,L);var I=function(e){function t(t,r,n,o){e.call(this,t,r,null,o);if(!n){throw new RangeError("Empty text nodes are not allowed")}this.text=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={textContent:{configurable:true},nodeSize:{configurable:true}};t.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}return $(this.marks,JSON.stringify(this.text))};r.textContent.get=function(){return this.text};t.prototype.textBetween=function e(t,r){return this.text.slice(t,r)};r.nodeSize.get=function(){return this.text.length};t.prototype.mark=function e(r){return r==this.marks?this:new t(this.type,this.attrs,this.text,r)};t.prototype.withText=function e(r){if(r==this.text){return this}return new t(this.type,this.attrs,r,this.marks)};t.prototype.cut=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.text.length;if(t==0&&r==this.text.length){return this}return this.withText(this.text.slice(t,r))};t.prototype.eq=function e(t){return this.sameMarkup(t)&&this.text==t.text};t.prototype.toJSON=function t(){var r=e.prototype.toJSON.call(this);r.text=this.text;return r};Object.defineProperties(t.prototype,r);return t}(R);function $(e,t){for(var r=e.length-1;r>=0;r--){t=e[r].type.name+"("+t+")"}return t}var B=function e(t){this.validEnd=t;this.next=[];this.wrapCache=[]};var F={inlineContent:{configurable:true},defaultType:{configurable:true},edgeCount:{configurable:true}};B.parse=function e(t,r){var n=new P(t,r);if(n.next==null){return B.empty}var o=V(n);if(n.next){n.err("Unexpected trailing text")}var i=X(Z(o));Y(i,n);return i};B.prototype.matchType=function e(t){for(var r=0;r<this.next.length;r+=2){if(this.next[r]==t){return this.next[r+1]}}return null};B.prototype.matchFragment=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=t.childCount;var o=this;for(var i=r;o&&i<n;i++){o=o.matchType(t.child(i).type)}return o};F.inlineContent.get=function(){var e=this.next[0];return e?e.isInline:false};F.defaultType.get=function(){for(var e=0;e<this.next.length;e+=2){var t=this.next[e];if(!(t.isText||t.hasRequiredAttrs())){return t}}};B.prototype.compatible=function e(t){for(var r=0;r<this.next.length;r+=2){for(var n=0;n<t.next.length;n+=2){if(this.next[r]==t.next[n]){return true}}}return false};B.prototype.fillBefore=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=0;var i=[this];function a(e,s){var l=e.matchFragment(t,n);if(l&&(!r||l.validEnd)){return o.from(s.map(function(e){return e.createAndFill()}))}for(var c=0;c<e.next.length;c+=2){var f=e.next[c],u=e.next[c+1];if(!(f.isText||f.hasRequiredAttrs())&&i.indexOf(u)==-1){i.push(u);var h=a(u,s.concat(f));if(h){return h}}}}return a(this,[])};B.prototype.findWrapping=function e(t){for(var r=0;r<this.wrapCache.length;r+=2){if(this.wrapCache[r]==t){return this.wrapCache[r+1]}}var n=this.computeWrapping(t);this.wrapCache.push(t,n);return n};B.prototype.computeWrapping=function e(t){var r=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var o=n.shift(),i=o.match;if(i.matchType(t)){var a=[];for(var s=o;s.type;s=s.via){a.push(s.type)}return a.reverse()}for(var l=0;l<i.next.length;l+=2){var c=i.next[l];if(!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in r)&&(!o.type||i.next[l+1].validEnd)){n.push({match:c.contentMatch,type:c,via:o});r[c.name]=true}}}};F.edgeCount.get=function(){return this.next.length>>1};B.prototype.edge=function e(t){var r=t<<1;if(r>=this.next.length){throw new RangeError("There's no "+t+"th edge in this content match")}return{type:this.next[r],next:this.next[r+1]}};B.prototype.toString=function e(){var t=[];function r(e){t.push(e);for(var n=1;n<e.next.length;n+=2){if(t.indexOf(e.next[n])==-1){r(e.next[n])}}}r(this);return t.map(function(e,r){var n=r+(e.validEnd?"*":" ")+" ";for(var o=0;o<e.next.length;o+=2){n+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1])}return n}).join("\n")};Object.defineProperties(B.prototype,F);B.empty=new B(true);var P=function e(t,r){this.string=t;this.nodeTypes=r;this.inline=null;this.pos=0;this.tokens=t.split(/\s*(?=\b|\W|$)/);if(this.tokens[this.tokens.length-1]==""){this.tokens.pop()}if(this.tokens[0]==""){this.tokens.unshift()}};var _={next:{configurable:true}};_.next.get=function(){return this.tokens[this.pos]};P.prototype.eat=function e(t){return this.next==t&&(this.pos++||true)};P.prototype.err=function e(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(P.prototype,_);function V(e){var t=[];do{t.push(q(e))}while(e.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function q(e){var t=[];do{t.push(j(e))}while(e.next&&e.next!=")"&&e.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function j(e){var t=K(e);for(;;){if(e.eat("+")){t={type:"plus",expr:t}}else if(e.eat("*")){t={type:"star",expr:t}}else if(e.eat("?")){t={type:"opt",expr:t}}else if(e.eat("{")){t=H(e,t)}else{break}}return t}function W(e){if(/\D/.test(e.next)){e.err("Expected number, got '"+e.next+"'")}var t=Number(e.next);e.pos++;return t}function H(e,t){var r=W(e),n=r;if(e.eat(",")){if(e.next!="}"){n=W(e)}else{n=-1}}if(!e.eat("}")){e.err("Unclosed braced range")}return{type:"range",min:r,max:n,expr:t}}function J(e,t){var r=e.nodeTypes,n=r[t];if(n){return[n]}var o=[];for(var i in r){var a=r[i];if(a.groups.indexOf(t)>-1){o.push(a)}}if(o.length==0){e.err("No node type or group '"+t+"' found")}return o}function K(e){if(e.eat("(")){var t=V(e);if(!e.eat(")")){e.err("Missing closing paren")}return t}else if(!/\W/.test(e.next)){var r=J(e,e.next).map(function(t){if(e.inline==null){e.inline=t.isInline}else if(e.inline!=t.isInline){e.err("Mixing inline and block content")}return{type:"name",value:t}});e.pos++;return r.length==1?r[0]:{type:"choice",exprs:r}}else{e.err("Unexpected token '"+e.next+"'")}}function Z(e){var t=[[]];o(i(e,0),r());return t;function r(){return t.push([])-1}function n(e,r,n){var o={term:n,to:r};t[e].push(o);return o}function o(e,t){e.forEach(function(e){return e.to=t})}function i(e,t){if(e.type=="choice"){return e.exprs.reduce(function(e,r){return e.concat(i(r,t))},[])}else if(e.type=="seq"){for(var a=0;;a++){var s=i(e.exprs[a],t);if(a==e.exprs.length-1){return s}o(s,t=r())}}else if(e.type=="star"){var l=r();n(t,l);o(i(e.expr,l),l);return[n(l)]}else if(e.type=="plus"){var c=r();o(i(e.expr,t),c);o(i(e.expr,c),c);return[n(c)]}else if(e.type=="opt"){return[n(t)].concat(i(e.expr,t))}else if(e.type=="range"){var f=t;for(var u=0;u<e.min;u++){var h=r();o(i(e.expr,f),h);f=h}if(e.max==-1){o(i(e.expr,f),f)}else{for(var p=e.min;p<e.max;p++){var d=r();n(f,d);o(i(e.expr,f),d);f=d}}return[n(f)]}else if(e.type=="name"){return[n(t,null,e.value)]}}}function U(e,t){return t-e}function G(e,t){var r=[];n(t);return r.sort(U);function n(t){var o=e[t];if(o.length==1&&!o[0].term){return n(o[0].to)}r.push(t);for(var i=0;i<o.length;i++){var a=o[i];var s=a.term;var l=a.to;if(!s&&r.indexOf(l)==-1){n(l)}}}}function X(e){var t=Object.create(null);return r(G(e,0));function r(n){var o=[];n.forEach(function(t){e[t].forEach(function(t){var r=t.term;var n=t.to;if(!r){return}var i=o.indexOf(r),a=i>-1&&o[i+1];G(e,n).forEach(function(e){if(!a){o.push(r,a=[])}if(a.indexOf(e)==-1){a.push(e)}})})});var i=t[n.join(",")]=new B(n.indexOf(e.length-1)>-1);for(var a=0;a<o.length;a+=2){var s=o[a+1].sort(U);i.next.push(o[a],t[s.join(",")]||r(s))}return i}}function Y(e,t){for(var r=0,n=[e];r<n.length;r++){var o=n[r],i=!o.validEnd,a=[];for(var s=0;s<o.next.length;s+=2){var l=o.next[s],c=o.next[s+1];a.push(l.name);if(i&&!(l.isText||l.hasRequiredAttrs())){i=false}if(n.indexOf(c)==-1){n.push(c)}}if(i){t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}}function Q(e){var t=Object.create(null);for(var r in e){var n=e[r];if(!n.hasDefault){return null}t[r]=n.default}return t}function ee(e,t){var r=Object.create(null);for(var n in e){var o=t&&t[n];if(o===undefined){var i=e[n];if(i.hasDefault){o=i.default}else{throw new RangeError("No value supplied for attribute "+n)}}r[n]=o}return r}function te(e){var t=Object.create(null);if(e){for(var r in e){t[r]=new oe(e[r])}}return t}var re=function e(t,r,n){this.name=t;this.schema=r;this.spec=n;this.groups=n.group?n.group.split(" "):[];this.attrs=te(n.attrs);this.defaultAttrs=Q(this.attrs);this.contentMatch=null;this.markSet=null;this.inlineContent=null;this.isBlock=!(n.inline||t=="text");this.isText=t=="text"};var ne={isInline:{configurable:true},isTextblock:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};ne.isInline.get=function(){return!this.isBlock};ne.isTextblock.get=function(){return this.isBlock&&this.inlineContent};ne.isLeaf.get=function(){return this.contentMatch==B.empty};ne.isAtom.get=function(){return this.isLeaf||this.spec.atom};re.prototype.hasRequiredAttrs=function e(){for(var t in this.attrs){if(this.attrs[t].isRequired){return true}}return false};re.prototype.compatibleContent=function e(t){return this==t||this.contentMatch.compatible(t.contentMatch)};re.prototype.computeAttrs=function e(t){if(!t&&this.defaultAttrs){return this.defaultAttrs}else{return ee(this.attrs,t)}};re.prototype.create=function e(t,r,n){if(this.isText){throw new Error("NodeType.create can't construct text nodes")}return new R(this,this.computeAttrs(t),o.from(r),c.setFrom(n))};re.prototype.createChecked=function e(t,r,n){r=o.from(r);if(!this.validContent(r)){throw new RangeError("Invalid content for node "+this.name)}return new R(this,this.computeAttrs(t),r,c.setFrom(n))};re.prototype.createAndFill=function e(t,r,n){t=this.computeAttrs(t);r=o.from(r);if(r.size){var i=this.contentMatch.fillBefore(r);if(!i){return null}r=i.append(r)}var a=this.contentMatch.matchFragment(r).fillBefore(o.empty,true);if(!a){return null}return new R(this,t,r.append(a),c.setFrom(n))};re.prototype.validContent=function e(t){var r=this.contentMatch.matchFragment(t);if(!r||!r.validEnd){return false}for(var n=0;n<t.childCount;n++){if(!this.allowsMarks(t.child(n).marks)){return false}}return true};re.prototype.allowsMarkType=function e(t){return this.markSet==null||this.markSet.indexOf(t)>-1};re.prototype.allowsMarks=function e(t){if(this.markSet==null){return true}for(var r=0;r<t.length;r++){if(!this.allowsMarkType(t[r].type)){return false}}return true};re.prototype.allowedMarks=function e(t){if(this.markSet==null){return t}var r;for(var n=0;n<t.length;n++){if(!this.allowsMarkType(t[n].type)){if(!r){r=t.slice(0,n)}}else if(r){r.push(t[n])}}return!r?t:r.length?r:c.empty};re.compile=function e(t,r){var n=Object.create(null);t.forEach(function(e,t){return n[e]=new re(e,r,t)});var o=r.spec.topNode||"doc";if(!n[o]){throw new RangeError("Schema is missing its top node type ('"+o+"')")}if(!n.text){throw new RangeError("Every schema needs a 'text' type")}for(var i in n.text.attrs){throw new RangeError("The text node type should not have attributes")}return n};Object.defineProperties(re.prototype,ne);var oe=function e(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default");this.default=t.default};var ie={isRequired:{configurable:true}};ie.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(oe.prototype,ie);var ae=function e(t,r,n,o){this.name=t;this.schema=n;this.spec=o;this.attrs=te(o.attrs);this.rank=r;this.excluded=null;var i=Q(this.attrs);this.instance=i&&new c(this,i)};ae.prototype.create=function e(t){if(!t&&this.instance){return this.instance}return new c(this,ee(this.attrs,t))};ae.compile=function e(t,r){var n=Object.create(null),o=0;t.forEach(function(e,t){return n[e]=new ae(e,o++,r,t)});return n};ae.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t.slice(0,r).concat(t.slice(r+1))}}return t};ae.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t[r]}}};ae.prototype.excludes=function e(t){return this.excluded.indexOf(t)>-1};var se=function e(r){this.spec={};for(var n in r){this.spec[n]=r[n]}this.spec.nodes=t.from(r.nodes);this.spec.marks=t.from(r.marks);this.nodes=re.compile(this.spec.nodes,this);this.marks=ae.compile(this.spec.marks,this);var o=Object.create(null);for(var i in this.nodes){if(i in this.marks){throw new RangeError(i+" can not be both a node and a mark")}var a=this.nodes[i],s=a.spec.content||"",l=a.spec.marks;a.contentMatch=o[s]||(o[s]=B.parse(s,this.nodes));a.inlineContent=a.contentMatch.inlineContent;a.markSet=l=="_"?null:l?le(this,l.split(" ")):l==""||!a.inlineContent?[]:null}for(var c in this.marks){var f=this.marks[c],u=f.spec.excludes;f.excluded=u==null?[f]:u==""?[]:le(this,u.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this);this.markFromJSON=this.markFromJSON.bind(this);this.topNodeType=this.nodes[this.spec.topNode||"doc"];this.cached=Object.create(null);this.cached.wrappings=Object.create(null)};se.prototype.node=function e(t,r,n,o){if(typeof t=="string"){t=this.nodeType(t)}else if(!(t instanceof re)){throw new RangeError("Invalid node type: "+t)}else if(t.schema!=this){throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(r,n,o)};se.prototype.text=function e(t,r){var n=this.nodes.text;return new I(n,n.defaultAttrs,t,c.setFrom(r))};se.prototype.mark=function e(t,r){if(typeof t=="string"){t=this.marks[t]}return t.create(r)};se.prototype.nodeFromJSON=function e(t){return R.fromJSON(this,t)};se.prototype.markFromJSON=function e(t){return c.fromJSON(this,t)};se.prototype.nodeType=function e(t){var r=this.nodes[t];if(!r){throw new RangeError("Unknown node type: "+t)}return r};function le(e,t){var r=[];for(var n=0;n<t.length;n++){var o=t[n],i=e.marks[o],a=i;if(i){r.push(i)}else{for(var s in e.marks){var l=e.marks[s];if(o=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(o)>-1){r.push(a=l)}}}if(!a){throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}}return r}var ce=function e(t,r){var n=this;this.schema=t;this.rules=r;this.tags=[];this.styles=[];r.forEach(function(e){if(e.tag){n.tags.push(e)}else if(e.style){n.styles.push(e)}});this.normalizeLists=!this.tags.some(function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node){return false}var r=t.nodes[e.node];return r.contentMatch.matchType(r)})};ce.prototype.parse=function e(t,r){if(r===void 0)r={};var n=new ye(this,r,false);n.addAll(t,null,r.from,r.to);return n.finish()};ce.prototype.parseSlice=function e(t,r){if(r===void 0)r={};var n=new ye(this,r,true);n.addAll(t,null,r.from,r.to);return u.maxOpen(n.finish())};ce.prototype.matchTag=function e(t,r){for(var n=0;n<this.tags.length;n++){var o=this.tags[n];if(Ce(t,o.tag)&&(o.namespace===undefined||t.namespaceURI==o.namespace)&&(!o.context||r.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(i===false){continue}o.attrs=i}return o}}};ce.prototype.matchStyle=function e(t,r,n){for(var o=0;o<this.styles.length;o++){var i=this.styles[o];if(i.style.indexOf(t)!=0||i.context&&!n.matchesContext(i.context)||i.style.length>t.length&&(i.style.charCodeAt(t.length)!=61||i.style.slice(t.length+1)!=r)){continue}if(i.getAttrs){var a=i.getAttrs(r);if(a===false){continue}i.attrs=a}return i}};ce.schemaRules=function e(t){var r=[];function n(e){var t=e.priority==null?50:e.priority,n=0;for(;n<r.length;n++){var o=r[n],i=o.priority==null?50:o.priority;if(i<t){break}}r.splice(n,0,e)}var o=function(e){var r=t.marks[e].spec.parseDOM;if(r){r.forEach(function(t){n(t=xe(t));t.mark=e})}};for(var i in t.marks)o(i);var a=function(e){var r=t.nodes[s].spec.parseDOM;if(r){r.forEach(function(e){n(e=xe(e));e.node=s})}};for(var s in t.nodes)a();return r};ce.fromSchema=function e(t){return t.cached.domParser||(t.cached.domParser=new ce(t,ce.schemaRules(t)))};var fe={address:true,article:true,aside:true,blockquote:true,canvas:true,dd:true,div:true,dl:true,fieldset:true,figcaption:true,figure:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,li:true,noscript:true,ol:true,output:true,p:true,pre:true,section:true,table:true,tfoot:true,ul:true};var ue={head:true,noscript:true,object:true,script:true,style:true,title:true};var he={ol:true,ul:true};var pe=1,de=2,ve=4;function me(e){return(e?pe:0)|(e==="full"?de:0)}var ge=function e(t,r,n,o,i,a,s){this.type=t;this.attrs=r;this.solid=i;this.match=a||(s&ve?null:t.contentMatch);this.options=s;this.content=[];this.marks=n;this.activeMarks=c.none;this.pendingMarks=o};ge.prototype.findWrapping=function e(t){if(!this.match){if(!this.type){return[]}var r=this.type.contentMatch.fillBefore(o.from(t));if(r){this.match=this.type.contentMatch.matchFragment(r)}else{var n=this.type.contentMatch,i;if(i=n.findWrapping(t.type)){this.match=n;return i}else{return null}}}return this.match.findWrapping(t.type)};ge.prototype.finish=function e(t){if(!(this.options&pe)){var r=this.content[this.content.length-1],n;if(r&&r.isText&&(n=/[ \t\r\n\u000c]+$/.exec(r.text))){if(r.text.length==n[0].length){this.content.pop()}else{this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-n[0].length))}}}var i=o.from(this.content);if(!t&&this.match){i=i.append(this.match.fillBefore(o.empty,true))}return this.type?this.type.create(this.attrs,i,this.marks):i};ge.prototype.applyPending=function e(t){for(var r=0,n=this.pendingMarks;r<n.length;r++){var o=n[r];if((this.type?this.type.allowsMarkType(o.type):ke(o.type,t))&&!o.isInSet(this.activeMarks)){this.activeMarks=o.addToSet(this.activeMarks);this.pendingMarks=o.removeFromSet(this.pendingMarks)}}};var ye=function e(t,r,n){this.parser=t;this.options=r;this.isOpen=n;var o=r.topNode,i;var a=me(r.preserveWhitespace)|(n?ve:0);if(o){i=new ge(o.type,o.attrs,c.none,c.none,true,r.topMatch||o.type.contentMatch,a)}else if(n){i=new ge(null,null,c.none,c.none,true,null,a)}else{i=new ge(t.schema.topNodeType,null,c.none,c.none,true,null,a)}this.nodes=[i];this.open=0;this.find=r.findPositions;this.needsBlock=false};var we={top:{configurable:true},currentPos:{configurable:true}};we.top.get=function(){return this.nodes[this.open]};ye.prototype.addDOM=function e(t){if(t.nodeType==3){this.addTextNode(t)}else if(t.nodeType==1){var r=t.getAttribute("style");var n=r?this.readStyles(Me(r)):null,o=this.top;if(n!=null){for(var i=0;i<n.length;i++){this.addPendingMark(n[i])}}this.addElement(t);if(n!=null){for(var a=0;a<n.length;a++){this.removePendingMark(n[a],o)}}}};ye.prototype.addTextNode=function e(t){var r=t.nodeValue;var n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(r)){if(!(n.options&pe)){r=r.replace(/[ \t\r\n\u000c]+/g," ");if(/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var o=n.content[n.content.length-1];var i=t.previousSibling;if(!o||i&&i.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text)){r=r.slice(1)}}}else if(!(n.options&de)){r=r.replace(/\r?\n|\r/g," ")}if(r){this.insertNode(this.parser.schema.text(r))}this.findInText(t)}else{this.findInside(t)}};ye.prototype.addElement=function e(t){var r=t.nodeName.toLowerCase();if(he.hasOwnProperty(r)&&this.normalizeLists){be(t)}var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:ue.hasOwnProperty(r)){this.findInside(t)}else if(!n||n.skip||n.closeParent){if(n&&n.closeParent){this.open=Math.max(0,this.open-1)}else if(n&&n.skip.nodeType){t=n.skip}var o,i=this.top,a=this.needsBlock;if(fe.hasOwnProperty(r)){o=true;if(!i.type){this.needsBlock=true}}else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t);if(o){this.sync(i)}this.needsBlock=a}else{this.addElementByRule(t,n)}};ye.prototype.leafFallback=function e(t){if(t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent){this.addTextNode(t.ownerDocument.createTextNode("\n"))}};ye.prototype.readStyles=function e(t){var r=c.none;for(var n=0;n<t.length;n+=2){var o=this.parser.matchStyle(t[n],t[n+1],this);if(!o){continue}if(o.ignore){return null}r=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(r)}return r};ye.prototype.addElementByRule=function e(t,r){var n=this;var o,i,a,s;if(r.node){i=this.parser.schema.nodes[r.node];if(!i.isLeaf){o=this.enter(i,r.attrs,r.preserveWhitespace)}else if(!this.insertNode(i.create(r.attrs))){this.leafFallback(t)}}else{a=this.parser.schema.marks[r.mark];s=a.create(r.attrs);this.addPendingMark(s)}var l=this.top;if(i&&i.isLeaf){this.findInside(t)}else if(r.getContent){this.findInside(t);r.getContent(t,this.parser.schema).forEach(function(e){return n.insertNode(e)})}else{var c=r.contentElement;if(typeof c=="string"){c=t.querySelector(c)}else if(typeof c=="function"){c=c(t)}if(!c){c=t}this.findAround(t,c,true);this.addAll(c,o)}if(o){this.sync(l);this.open--}if(s){this.removePendingMark(s,l)}};ye.prototype.addAll=function e(t,r,n,o){var i=n||0;for(var a=n?t.childNodes[n]:t.firstChild,s=o==null?null:t.childNodes[o];a!=s;a=a.nextSibling,++i){this.findAtPoint(t,i);this.addDOM(a);if(r&&fe.hasOwnProperty(a.nodeName.toLowerCase())){this.sync(r)}}this.findAtPoint(t,i)};ye.prototype.findPlace=function e(t){var r,n;for(var o=this.open;o>=0;o--){var i=this.nodes[o];var a=i.findWrapping(t);if(a&&(!r||r.length>a.length)){r=a;n=i;if(!a.length){break}}if(i.solid){break}}if(!r){return false}this.sync(n);for(var s=0;s<r.length;s++){this.enterInner(r[s],null,false)}return true};ye.prototype.insertNode=function e(t){if(t.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();if(r){this.enterInner(r)}}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type);if(n.match){n.match=n.match.matchType(t.type)}var o=n.activeMarks;for(var i=0;i<t.marks.length;i++){if(!n.type||n.type.allowsMarkType(t.marks[i].type)){o=t.marks[i].addToSet(o)}}n.content.push(t.mark(o));return true}return false};ye.prototype.enter=function e(t,r,n){var o=this.findPlace(t.create(r));if(o){this.enterInner(t,r,true,n)}return o};ye.prototype.enterInner=function e(t,r,n,o){this.closeExtra();var i=this.top;i.applyPending(t);i.match=i.match&&i.match.matchType(t,r);var a=o==null?i.options&~ve:me(o);if(i.options&ve&&i.content.length==0){a|=ve}this.nodes.push(new ge(t,r,i.activeMarks,i.pendingMarks,n,null,a));this.open++};ye.prototype.closeExtra=function e(t){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--){this.nodes[r-1].content.push(this.nodes[r].finish(t))}this.nodes.length=this.open+1}};ye.prototype.finish=function e(){this.open=0;this.closeExtra(this.isOpen);return this.nodes[0].finish(this.isOpen||this.options.topOpen)};ye.prototype.sync=function e(t){for(var r=this.open;r>=0;r--){if(this.nodes[r]==t){this.open=r;return}}};we.currentPos.get=function(){this.closeExtra();var e=0;for(var t=this.open;t>=0;t--){var r=this.nodes[t].content;for(var n=r.length-1;n>=0;n--){e+=r[n].nodeSize}if(t){e++}}return e};ye.prototype.findAtPoint=function e(t,r){if(this.find){for(var n=0;n<this.find.length;n++){if(this.find[n].node==t&&this.find[n].offset==r){this.find[n].pos=this.currentPos}}}};ye.prototype.findInside=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)){this.find[r].pos=this.currentPos}}}};ye.prototype.findAround=function e(t,r,n){if(t!=r&&this.find){for(var o=0;o<this.find.length;o++){if(this.find[o].pos==null&&t.nodeType==1&&t.contains(this.find[o].node)){var i=r.compareDocumentPosition(this.find[o].node);if(i&(n?2:4)){this.find[o].pos=this.currentPos}}}}};ye.prototype.findInText=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].node==t){this.find[r].pos=this.currentPos-(t.nodeValue.length-this.find[r].offset)}}}};ye.prototype.matchesContext=function e(t){var r=this;if(t.indexOf("|")>-1){return t.split(/\s*\|\s*/).some(this.matchesContext,this)}var n=t.split("/");var o=this.options.context;var i=!this.isOpen&&(!o||o.parent.type==this.nodes[0].type);var a=-(o?o.depth+1:0)+(i?0:1);var s=function(e,t){for(;e>=0;e--){var l=n[e];if(l==""){if(e==n.length-1||e==0){continue}for(;t>=a;t--){if(s(e-1,t)){return true}}return false}else{var c=t>0||t==0&&i?r.nodes[t].type:o&&t>=a?o.node(t-a).type:null;if(!c||c.name!=l&&c.groups.indexOf(l)==-1){return false}t--}}return true};return s(n.length-1,this.open)};ye.prototype.textblockFromContext=function e(){var t=this.options.context;if(t){for(var r=t.depth;r>=0;r--){var n=t.node(r).contentMatchAt(t.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs){return n}}}for(var o in this.parser.schema.nodes){var i=this.parser.schema.nodes[o];if(i.isTextblock&&i.defaultAttrs){return i}}};ye.prototype.addPendingMark=function e(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};ye.prototype.removePendingMark=function e(t,r){for(var n=this.open;n>=0;n--){var o=this.nodes[n];var i=o.pendingMarks.lastIndexOf(t);if(i>-1){o.pendingMarks=t.removeFromSet(o.pendingMarks)}else{o.activeMarks=t.removeFromSet(o.activeMarks)}if(o==r){break}}};Object.defineProperties(ye.prototype,we);function be(e){for(var t=e.firstChild,r=null;t;t=t.nextSibling){var n=t.nodeType==1?t.nodeName.toLowerCase():null;if(n&&he.hasOwnProperty(n)&&r){r.appendChild(t);t=r}else if(n=="li"){r=t}else if(n){r=null}}}function Ce(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Me(e){var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,n=[];while(r=t.exec(e)){n.push(r[1],r[2].trim())}return n}function xe(e){var t={};for(var r in e){t[r]=e[r]}return t}function ke(e,t){var r=t.schema.nodes;var n=function(n){var o=r[n];if(!o.allowsMarkType(e)){return}var i=[],a=function(e){i.push(e);for(var r=0;r<e.edgeCount;r++){var n=e.edge(r);var o=n.type;var s=n.next;if(o==t){return true}if(i.indexOf(s)<0&&a(s)){return true}}};if(a(o.contentMatch)){return{v:true}}};for(var o in r){var i=n(o);if(i)return i.v}}var Se=function e(t,r){this.nodes=t||{};this.marks=r||{}};Se.prototype.serializeFragment=function e(t,r,n){var o=this;if(r===void 0)r={};if(!n){n=Ne(r).createDocumentFragment()}var i=n,a=null;t.forEach(function(e){if(a||e.marks.length){if(!a){a=[]}var t=0,n=0;while(t<a.length&&n<e.marks.length){var s=e.marks[n];if(!o.marks[s.type.name]){n++;continue}if(!s.eq(a[t])||s.type.spec.spanning===false){break}t+=2;n++}while(t<a.length){i=a.pop();a.pop()}while(n<e.marks.length){var l=e.marks[n++];var c=o.serializeMark(l,e.isInline,r);if(c){a.push(l,i);i.appendChild(c.dom);i=c.contentDOM||c.dom}}}i.appendChild(o.serializeNode(e,r))});return n};Se.prototype.serializeNode=function e(t,r){if(r===void 0)r={};var n=Se.renderSpec(Ne(r),this.nodes[t.type.name](t));var o=n.dom;var i=n.contentDOM;if(i){if(t.isLeaf){throw new RangeError("Content hole not allowed in a leaf node spec")}if(r.onContent){r.onContent(t,i,r)}else{this.serializeFragment(t.content,r,i)}}return o};Se.prototype.serializeNodeAndMarks=function e(t,r){if(r===void 0)r={};var n=this.serializeNode(t,r);for(var o=t.marks.length-1;o>=0;o--){var i=this.serializeMark(t.marks[o],t.isInline,r);if(i){(i.contentDOM||i.dom).appendChild(n);n=i.dom}}return n};Se.prototype.serializeMark=function e(t,r,n){if(n===void 0)n={};var o=this.marks[t.type.name];return o&&Se.renderSpec(Ne(n),o(t,r))};Se.renderSpec=function e(t,r,n){if(n===void 0)n=null;if(typeof r=="string"){return{dom:t.createTextNode(r)}}if(r.nodeType!=null){return{dom:r}}var o=r[0],i=o.indexOf(" ");if(i>0){n=o.slice(0,i);o=o.slice(i+1)}var a=null,s=n?t.createElementNS(n,o):t.createElement(o);var l=r[1],c=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){c=2;for(var f in l){if(l[f]!=null){var u=f.indexOf(" ");if(u>0){s.setAttributeNS(f.slice(0,u),f.slice(u+1),l[f])}else{s.setAttribute(f,l[f])}}}}for(var h=c;h<r.length;h++){var p=r[h];if(p===0){if(h<r.length-1||h>c){throw new RangeError("Content hole must be the only child of its parent node")}return{dom:s,contentDOM:s}}else{var d=Se.renderSpec(t,p,n);var v=d.dom;var m=d.contentDOM;s.appendChild(v);if(m){if(a){throw new RangeError("Multiple content holes")}a=m}}}return{dom:s,contentDOM:a}};Se.fromSchema=function e(t){return t.cached.domSerializer||(t.cached.domSerializer=new Se(this.nodesFromSchema(t),this.marksFromSchema(t)))};Se.nodesFromSchema=function e(t){var r=Oe(t.nodes);if(!r.text){r.text=function(e){return e.text}}return r};Se.marksFromSchema=function e(t){return Oe(t.marks)};function Oe(e){var t={};for(var r in e){var n=e[r].spec.toDOM;if(n){t[r]=n}}return t}function Ne(e){return e.document||window.document}var Ae=65535;var De=Math.pow(2,16);function Te(e,t){return e+t*De}function Ee(e){return e&Ae}function ze(e){return(e-(e&Ae))/De}var Re=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=null;this.pos=t;this.deleted=r;this.recover=n};var Le=function e(t,r){if(r===void 0)r=false;this.ranges=t;this.inverted=r};Le.prototype.recover=function e(t){var r=0,n=Ee(t);if(!this.inverted){for(var o=0;o<n;o++){r+=this.ranges[o*3+2]-this.ranges[o*3+1]}}return this.ranges[n*3]+r+ze(t)};Le.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};Le.prototype.map=function e(t,r){if(r===void 0)r=1;return this._map(t,r,true)};Le.prototype._map=function e(t,r,n){var o=0,i=this.inverted?2:1,a=this.inverted?1:2;for(var s=0;s<this.ranges.length;s+=3){var l=this.ranges[s]-(this.inverted?o:0);if(l>t){break}var c=this.ranges[s+i],f=this.ranges[s+a],u=l+c;if(t<=u){var h=!c?r:t==l?-1:t==u?1:r;var p=l+o+(h<0?0:f);if(n){return p}var d=t==(r<0?l:u)?null:Te(s/3,t-l);return new Re(p,r<0?t!=l:t!=u,d)}o+=f-c}return n?t+o:new Re(t+o)};Le.prototype.touches=function e(t,r){var n=0,o=Ee(r);var i=this.inverted?2:1,a=this.inverted?1:2;for(var s=0;s<this.ranges.length;s+=3){var l=this.ranges[s]-(this.inverted?n:0);if(l>t){break}var c=this.ranges[s+i],f=l+c;if(t<=f&&s==o*3){return true}n+=this.ranges[s+a]-c}return false};Le.prototype.forEach=function e(t){var r=this.inverted?2:1,n=this.inverted?1:2;for(var o=0,i=0;o<this.ranges.length;o+=3){var a=this.ranges[o],s=a-(this.inverted?i:0),l=a+(this.inverted?0:i);var c=this.ranges[o+r],f=this.ranges[o+n];t(s,s+c,l,l+f);i+=f-c}};Le.prototype.invert=function e(){return new Le(this.ranges,!this.inverted)};Le.prototype.toString=function e(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};Le.offset=function e(t){return t==0?Le.empty:new Le(t<0?[0,-t,0]:[0,0,t])};Le.empty=new Le([]);var Ie=function e(t,r,n,o){this.maps=t||[];this.from=n||0;this.to=o==null?this.maps.length:o;this.mirror=r};Ie.prototype.slice=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.maps.length;return new Ie(this.maps,this.mirror,t,r)};Ie.prototype.copy=function e(){return new Ie(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Ie.prototype.appendMap=function e(t,r){this.to=this.maps.push(t);if(r!=null){this.setMirror(this.maps.length-1,r)}};Ie.prototype.appendMapping=function e(t){for(var r=0,n=this.maps.length;r<t.maps.length;r++){var o=t.getMirror(r);this.appendMap(t.maps[r],o!=null&&o<r?n+o:null)}};Ie.prototype.getMirror=function e(t){if(this.mirror){for(var r=0;r<this.mirror.length;r++){if(this.mirror[r]==t){return this.mirror[r+(r%2?-1:1)]}}}};Ie.prototype.setMirror=function e(t,r){if(!this.mirror){this.mirror=[]}this.mirror.push(t,r)};Ie.prototype.appendMappingInverted=function e(t){for(var r=t.maps.length-1,n=this.maps.length+t.maps.length;r>=0;r--){var o=t.getMirror(r);this.appendMap(t.maps[r].invert(),o!=null&&o>r?n-o-1:null)}};Ie.prototype.invert=function e(){var t=new Ie;t.appendMappingInverted(this);return t};Ie.prototype.map=function e(t,r){if(r===void 0)r=1;if(this.mirror){return this._map(t,r,true)}for(var n=this.from;n<this.to;n++){t=this.maps[n].map(t,r)}return t};Ie.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};Ie.prototype._map=function e(t,r,n){var o=false;for(var i=this.from;i<this.to;i++){var a=this.maps[i],s=a.mapResult(t,r);if(s.recover!=null){var l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l;t=this.maps[l].recover(s.recover);continue}}if(s.deleted){o=true}t=s.pos}return n?t:new Re(t,o)};function $e(e){var t=Error.call(this,e);t.__proto__=$e.prototype;return t}$e.prototype=Object.create(Error.prototype);$e.prototype.constructor=$e;$e.prototype.name="TransformError";var Be=function e(t){this.doc=t;this.steps=[];this.docs=[];this.mapping=new Ie};var Fe={before:{configurable:true},docChanged:{configurable:true}};Fe.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Be.prototype.step=function e(t){var r=this.maybeStep(t);if(r.failed){throw new $e(r.failed)}return this};Be.prototype.maybeStep=function e(t){var r=t.apply(this.doc);if(!r.failed){this.addStep(t,r.doc)}return r};Fe.docChanged.get=function(){return this.steps.length>0};Be.prototype.addStep=function e(t,r){this.docs.push(this.doc);this.steps.push(t);this.mapping.appendMap(t.getMap());this.doc=r};Object.defineProperties(Be.prototype,Fe);function Pe(){throw new Error("Override me")}var _e=Object.create(null);var Ve=function e(){};Ve.prototype.apply=function e(t){return Pe()};Ve.prototype.getMap=function e(){return Le.empty};Ve.prototype.invert=function e(t){return Pe()};Ve.prototype.map=function e(t){return Pe()};Ve.prototype.merge=function e(t){return null};Ve.prototype.toJSON=function e(){return Pe()};Ve.fromJSON=function e(t,r){if(!r||!r.stepType){throw new RangeError("Invalid input for Step.fromJSON")}var n=_e[r.stepType];if(!n){throw new RangeError("No step type "+r.stepType+" defined")}return n.fromJSON(t,r)};Ve.jsonID=function e(t,r){if(t in _e){throw new RangeError("Duplicate use of step JSON ID "+t)}_e[t]=r;r.prototype.jsonID=t;return r};var qe=function e(t,r){this.doc=t;this.failed=r};qe.ok=function e(t){return new qe(t,null)};qe.fail=function e(t){return new qe(null,t)};qe.fromReplace=function e(t,r,n,o){try{return qe.ok(t.replace(r,n,o))}catch(e){if(e instanceof f){return qe.fail(e.message)}throw e}};var je=function(e){function t(t,r,n,o){e.call(this);this.from=t;this.to=r;this.slice=n;this.structure=!!o}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&He(t,this.from,this.to)){return qe.fail("Structure replace would overwrite content")}return qe.fromReplace(t,this.from,this.to,this.slice)};t.prototype.getMap=function e(){return new Le([this.from,this.to-this.from,this.slice.size])};t.prototype.invert=function e(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);if(n.deleted&&o.deleted){return null}return new t(n.pos,Math.max(n.pos,o.pos),this.slice)};t.prototype.merge=function e(r){if(!(r instanceof t)||r.structure!=this.structure){return null}if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var n=this.slice.size+r.slice.size==0?u.empty:new u(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),n,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var o=this.slice.size+r.slice.size==0?u.empty:new u(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}else{return null}};t.prototype.toJSON=function e(){var t={stepType:"replace",from:this.from,to:this.to};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for ReplaceStep.fromJSON")}return new t(n.from,n.to,u.fromJSON(r,n.slice),!!n.structure)};return t}(Ve);Ve.jsonID("replace",je);var We=function(e){function t(t,r,n,o,i,a,s){e.call(this);this.from=t;this.to=r;this.gapFrom=n;this.gapTo=o;this.slice=i;this.insert=a;this.structure=!!s}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&(He(t,this.from,this.gapFrom)||He(t,this.gapTo,this.to))){return qe.fail("Structure gap-replace would overwrite content")}var r=t.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd){return qe.fail("Gap is not a flat range")}var n=this.slice.insertAt(this.insert,r.content);if(!n){return qe.fail("Content does not fit in gap")}return qe.fromReplace(t,this.from,this.to,n)};t.prototype.getMap=function e(){return new Le([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])};t.prototype.invert=function e(r){var n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);var i=r.map(this.gapFrom,-1),a=r.map(this.gapTo,1);if(n.deleted&&o.deleted||i<n.pos||a>o.pos){return null}return new t(n.pos,o.pos,i,a,this.slice,this.insert,this.structure)};t.prototype.toJSON=function e(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number"){throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON")}return new t(n.from,n.to,n.gapFrom,n.gapTo,u.fromJSON(r,n.slice),n.insert,!!n.structure)};return t}(Ve);Ve.jsonID("replaceAround",We);function He(e,t,r){var n=e.resolve(t),o=r-t,i=n.depth;while(o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount){i--;o--}if(o>0){var a=n.node(i).maybeChild(n.indexAfter(i));while(o>0){if(!a||a.isLeaf){return true}a=a.firstChild;o--}}return false}function Je(e,t,r){return(t==0||e.canReplace(t,e.childCount))&&(r==e.childCount||e.canReplace(0,r))}function Ke(e){var t=e.parent;var r=t.content.cutByIndex(e.startIndex,e.endIndex);for(var n=e.depth;;--n){var o=e.$from.node(n);var i=e.$from.index(n),a=e.$to.indexAfter(n);if(n<e.depth&&o.canReplace(i,a,r)){return n}if(n==0||o.type.spec.isolating||!Je(o,i,a)){break}}}Be.prototype.lift=function(e,t){var r=e.$from;var n=e.$to;var i=e.depth;var a=r.before(i+1),s=n.after(i+1);var l=a,c=s;var f=o.empty,h=0;for(var p=i,d=false;p>t;p--){if(d||r.index(p)>0){d=true;f=o.from(r.node(p).copy(f));h++}else{l--}}var v=o.empty,m=0;for(var g=i,y=false;g>t;g--){if(y||n.after(g+1)<n.end(g)){y=true;v=o.from(n.node(g).copy(v));m++}else{c++}}return this.step(new We(l,c,a,s,new u(f.append(v),h,m),f.size-h,true))};function Ze(e,t,r,n){if(n===void 0)n=e;var o=Ge(e,t);var i=o&&Xe(n,t);if(!i){return null}return o.map(Ue).concat({type:t,attrs:r}).concat(i.map(Ue))}function Ue(e){return{type:e,attrs:null}}function Ge(e,t){var r=e.parent;var n=e.startIndex;var o=e.endIndex;var i=r.contentMatchAt(n).findWrapping(t);if(!i){return null}var a=i.length?i[0]:t;return r.canReplaceWith(n,o,a)?i:null}function Xe(e,t){var r=e.parent;var n=e.startIndex;var o=e.endIndex;var i=r.child(n);var a=t.contentMatch.findWrapping(i.type);if(!a){return null}var s=a.length?a[a.length-1]:t;var l=s.contentMatch;for(var c=n;l&&c<o;c++){l=l.matchType(r.child(c).type)}if(!l||!l.validEnd){return null}return a}Be.prototype.wrap=function(e,t){var r=o.empty;for(var n=t.length-1;n>=0;n--){r=o.from(t[n].type.create(t[n].attrs,r))}var i=e.start,a=e.end;return this.step(new We(i,a,i,a,new u(r,0,0),t.length,true))};Be.prototype.setBlockType=function(e,t,r,n){var i=this;if(t===void 0)t=e;if(!r.isTextblock){throw new RangeError("Type given to setBlockType should be a textblock")}var a=this.steps.length;this.doc.nodesBetween(e,t,function(e,t){if(e.isTextblock&&!e.hasMarkup(r,n)&&Ye(i.doc,i.mapping.slice(a).map(t),r)){i.clearIncompatible(i.mapping.slice(a).map(t,1),r);var s=i.mapping.slice(a);var l=s.map(t,1),c=s.map(t+e.nodeSize,1);i.step(new We(l,c,l+1,c-1,new u(o.from(r.create(n,null,e.marks)),0,0),1,true));return false}});return this};function Ye(e,t,r){var n=e.resolve(t),o=n.index();return n.parent.canReplaceWith(o,o+1,r)}Be.prototype.setNodeMarkup=function(e,t,r,n){var i=this.doc.nodeAt(e);if(!i){throw new RangeError("No node at given position")}if(!t){t=i.type}var a=t.create(r,null,n||i.marks);if(i.isLeaf){return this.replaceWith(e,e+i.nodeSize,a)}if(!t.validContent(i.content)){throw new RangeError("Invalid content for node type "+t.name)}return this.step(new We(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new u(o.from(a),0,0),1,true))};function Qe(e,t,r,n){if(r===void 0)r=1;var o=e.resolve(t),i=o.depth-r;var a=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!a.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount))){return false}for(var s=o.depth-1,l=r-2;s>i;s--,l--){var c=o.node(s),f=o.index(s);if(c.type.spec.isolating){return false}var u=c.content.cutByIndex(f,c.childCount);var h=n&&n[l]||c;if(h!=c){u=u.replaceChild(0,h.type.create(h.attrs))}if(!c.canReplace(f+1,c.childCount)||!h.type.validContent(u)){return false}}var p=o.indexAfter(i);var d=n&&n[0];return o.node(i).canReplaceWith(p,p,d?d.type:o.node(i+1).type)}Be.prototype.split=function(e,t,r){if(t===void 0)t=1;var n=this.doc.resolve(e),i=o.empty,a=o.empty;for(var s=n.depth,l=n.depth-t,c=t-1;s>l;s--,c--){i=o.from(n.node(s).copy(i));var f=r&&r[c];a=o.from(f?f.type.create(f.attrs,a):n.node(s).copy(a))}return this.step(new je(e,e,new u(i.append(a),t,t),true))};function et(e,t){var r=e.resolve(t),n=r.index();return tt(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function tt(e,t){return e&&t&&!e.isLeaf&&e.canAppend(t)}function rt(e,t,r){if(r===void 0)r=-1;var n=e.resolve(t);for(var o=n.depth;;o--){var i=void 0,a=void 0,s=n.index(o);if(o==n.depth){i=n.nodeBefore;a=n.nodeAfter}else if(r>0){i=n.node(o+1);s++;a=n.node(o).maybeChild(s)}else{i=n.node(o).maybeChild(s-1);a=n.node(o+1)}if(i&&!i.isTextblock&&tt(i,a)&&n.node(o).canReplace(s,s+1)){return t}if(o==0){break}t=r<0?n.before(o):n.after(o)}}Be.prototype.join=function(e,t){if(t===void 0)t=1;var r=new je(e-t,e+t,u.empty,true);return this.step(r)};function nt(e,t,r){var n=e.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),r)){return t}if(n.parentOffset==0){for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,r)){return n.before(o+1)}if(i>0){return null}}}if(n.parentOffset==n.parent.content.size){for(var a=n.depth-1;a>=0;a--){var s=n.indexAfter(a);if(n.node(a).canReplaceWith(s,s,r)){return n.after(a+1)}if(s<n.node(a).childCount){return null}}}}function ot(e,t,r){var n=e.resolve(t);if(!r.content.size){return t}var o=r.content;for(var i=0;i<r.openStart;i++){o=o.firstChild.content}for(var a=1;a<=(r.openStart==0&&r.size?2:1);a++){for(var s=n.depth;s>=0;s--){var l=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1;var c=n.index(s)+(l>0?1:0);if(a==1?n.node(s).canReplace(c,c,o):n.node(s).contentMatchAt(c).findWrapping(o.firstChild.type)){return l==0?n.pos:l<0?n.before(s+1):n.after(s+1)}}}return null}function it(e,t,r){var n=[];for(var i=0;i<e.childCount;i++){var a=e.child(i);if(a.content.size){a=a.copy(it(a.content,t,a))}if(a.isInline){a=t(a,r,i)}n.push(a)}return o.fromArray(n)}var at=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var n=t.slice(this.from,this.to),o=t.resolve(this.from);var i=o.node(o.sharedDepth(this.to));var a=new u(it(n.content,function(e,t){if(!t.type.allowsMarkType(r.mark.type)){return e}return e.mark(r.mark.addToSet(e.marks))},i),n.openStart,n.openEnd);return qe.fromReplace(t,this.from,this.to,a)};t.prototype.invert=function e(){return new st(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);if(n.deleted&&o.deleted||n.pos>=o.pos){return null}return new t(n.pos,o.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for AddMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(Ve);Ve.jsonID("addMark",at);var st=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var n=t.slice(this.from,this.to);var o=new u(it(n.content,function(e){return e.mark(r.mark.removeFromSet(e.marks))}),n.openStart,n.openEnd);return qe.fromReplace(t,this.from,this.to,o)};t.prototype.invert=function e(){return new at(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);if(n.deleted&&o.deleted||n.pos>=o.pos){return null}return new t(n.pos,o.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for RemoveMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(Ve);Ve.jsonID("removeMark",st);Be.prototype.addMark=function(e,t,r){var n=this;var o=[],i=[],a=null,s=null;this.doc.nodesBetween(e,t,function(n,l,c){if(!n.isInline){return}var f=n.marks;if(!r.isInSet(f)&&c.type.allowsMarkType(r.type)){var u=Math.max(l,e),h=Math.min(l+n.nodeSize,t);var p=r.addToSet(f);for(var d=0;d<f.length;d++){if(!f[d].isInSet(p)){if(a&&a.to==u&&a.mark.eq(f[d])){a.to=h}else{o.push(a=new st(u,h,f[d]))}}}if(s&&s.to==u){s.to=h}else{i.push(s=new at(u,h,r))}}});o.forEach(function(e){return n.step(e)});i.forEach(function(e){return n.step(e)});return this};Be.prototype.removeMark=function(e,t,r){var n=this;if(r===void 0)r=null;var o=[],i=0;this.doc.nodesBetween(e,t,function(n,a){if(!n.isInline){return}i++;var s=null;if(r instanceof ae){var l=r.isInSet(n.marks);if(l){s=[l]}}else if(r){if(r.isInSet(n.marks)){s=[r]}}else{s=n.marks}if(s&&s.length){var c=Math.min(a+n.nodeSize,t);for(var f=0;f<s.length;f++){var u=s[f],h=void 0;for(var p=0;p<o.length;p++){var d=o[p];if(d.step==i-1&&u.eq(o[p].style)){h=d}}if(h){h.to=c;h.step=i}else{o.push({style:u,from:Math.max(a,e),to:c,step:i})}}}});o.forEach(function(e){return n.step(new st(e.from,e.to,e.style))});return this};Be.prototype.clearIncompatible=function(e,t,r){if(r===void 0)r=t.contentMatch;var n=this.doc.nodeAt(e);var i=[],a=e+1;for(var s=0;s<n.childCount;s++){var l=n.child(s),c=a+l.nodeSize;var f=r.matchType(l.type,l.attrs);if(!f){i.push(new je(a,c,u.empty))}else{r=f;for(var h=0;h<l.marks.length;h++){if(!t.allowsMarkType(l.marks[h].type)){this.step(new st(a,c,l.marks[h]))}}}a=c}if(!r.validEnd){var p=r.fillBefore(o.empty,true);this.replace(a,a,new u(p,0,0))}for(var d=i.length-1;d>=0;d--){this.step(i[d])}return this};function lt(e,t,r,n){if(r===void 0)r=t;if(n===void 0)n=u.empty;if(t==r&&!n.size){return null}var o=e.resolve(t),i=e.resolve(r);if(ct(o,i,n)){return new je(t,r,n)}return new ft(o,i,n).fit()}Be.prototype.replace=function(e,t,r){if(t===void 0)t=e;if(r===void 0)r=u.empty;var n=lt(this.doc,e,t,r);if(n){this.step(n)}return this};Be.prototype.replaceWith=function(e,t,r){return this.replace(e,t,new u(o.from(r),0,0))};Be.prototype.delete=function(e,t){return this.replace(e,t,u.empty)};Be.prototype.insert=function(e,t){return this.replaceWith(e,e,t)};function ct(e,t,r){return!r.openStart&&!r.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),r.content)}var ft=function e(t,r,n){this.$to=r;this.$from=t;this.unplaced=n;this.frontier=[];for(var i=0;i<=t.depth;i++){var a=t.node(i);this.frontier.push({type:a.type,match:a.contentMatchAt(t.indexAfter(i))})}this.placed=o.empty;for(var s=t.depth;s>0;s--){this.placed=o.from(t.node(s).copy(this.placed))}};var ut={depth:{configurable:true}};ut.depth.get=function(){return this.frontier.length-1};ft.prototype.fit=function e(){while(this.unplaced.size){var e=this.findFittable();if(e){this.placeNodes(e)}else{this.openMore()||this.dropNode()}}var t=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth;var n=this.$from,o=this.close(t<0?this.$to:n.doc.resolve(t));if(!o){return null}var i=this.placed,a=n.depth,s=o.depth;while(a&&s&&i.childCount==1){i=i.firstChild.content;a--;s--}var l=new u(i,a,s);if(t>-1){return new We(n.pos,t,this.$to.pos,this.$to.end(),l,r)}if(l.size||n.pos!=this.$to.pos){return new je(n.pos,o.pos,l)}};ft.prototype.findFittable=function e(){for(var t=1;t<=2;t++){for(var r=this.unplaced.openStart;r>=0;r--){var n=void 0,i=void 0;if(r){i=dt(this.unplaced.content,r-1).firstChild;n=i.content}else{n=this.unplaced.content}var a=n.firstChild;for(var s=this.depth;s>=0;s--){var l=this.frontier[s];var c=l.type;var f=l.match;var u=void 0,h=void 0;if(t==1&&(a?f.matchType(a.type)||(h=f.fillBefore(o.from(a),false)):c.compatibleContent(i.type))){return{sliceDepth:r,frontierDepth:s,parent:i,inject:h}}else if(t==2&&a&&(u=f.findWrapping(a.type))){return{sliceDepth:r,frontierDepth:s,parent:i,wrap:u}}if(i&&f.matchType(i.type)){break}}}}};ft.prototype.openMore=function e(){var t=this.unplaced;var r=t.content;var n=t.openStart;var o=t.openEnd;var i=dt(r,n);if(!i.childCount||i.firstChild.isLeaf){return false}this.unplaced=new u(r,n+1,Math.max(o,i.size+n>=r.size-o?n+1:0));return true};ft.prototype.dropNode=function e(){var t=this.unplaced;var r=t.content;var n=t.openStart;var o=t.openEnd;var i=dt(r,n);if(i.childCount<=1&&n>0){var a=r.size-n<=n+i.size;this.unplaced=new u(ht(r,n-1,1),n-1,a?n-1:o)}else{this.unplaced=new u(ht(r,n,1),n,o)}};ft.prototype.placeNodes=function e(t){var r=t.sliceDepth;var n=t.frontierDepth;var i=t.parent;var a=t.inject;var s=t.wrap;while(this.depth>n){this.closeFrontierNode()}if(s){for(var l=0;l<s.length;l++){this.openFrontierNode(s[l])}}var c=this.unplaced,f=i?i.content:c.content;var h=c.openStart-r;var p=0,d=[];var v=this.frontier[n];var m=v.match;var g=v.type;if(a){for(var y=0;y<a.childCount;y++){d.push(a.child(y))}m=m.matchFragment(a)}var w=f.size+r-(c.content.size-c.openEnd);while(p<f.childCount){var b=f.child(p),C=m.matchType(b.type);if(!C){break}p++;if(p>1||h==0||b.content.size){m=C;d.push(vt(b.mark(g.allowedMarks(b.marks)),p==1?h:0,p==f.childCount?w:-1))}}var M=p==f.childCount;if(!M){w=-1}if(M&&w<0&&i&&i.type==this.frontier[this.depth].type){this.closeFrontierNode()}else{this.frontier[n].match=m}for(var x=0,k=f;x<w;x++){var S=k.lastChild;this.frontier.push({type:S.type,match:S.contentMatchAt(S.childCount)});k=S.content}this.unplaced=!M?new u(ht(c.content,r,p),c.openStart,c.openEnd):r==0?u.empty:new u(ht(c.content,r-1,1),r-1,w<0?c.openEnd:r-1);this.placed=pt(this.placed,n,o.from(d))};ft.prototype.mustMoveInline=function e(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos){return-1}var t=this.frontier[this.depth],r;if(!t.type.isTextblock||!mt(this.$to,this.$to.depth,t.type,t.match,false)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth){return-1}var n=this.$to;var o=n.depth;var i=this.$to.after(o);while(o>1&&i==this.$to.end(--o)){++i}return i};ft.prototype.findCloseLevel=function e(t){e:for(var r=Math.min(this.depth,t.depth);r>=0;r--){var n=this.frontier[r];var o=n.match;var i=n.type;var a=r<t.depth&&t.end(r+1)==t.pos+(t.depth-(r+1));var s=mt(t,r,i,o,a);if(!s){continue}for(var l=r-1;l>=0;l--){var c=this.frontier[l];var f=c.match;var u=c.type;var h=mt(t,l,u,f,true);if(!h||h.childCount){continue e}}return{depth:r,fit:s,move:a?t.doc.resolve(t.after(r+1)):t}}};ft.prototype.close=function e(t){var e=this.findCloseLevel(t);if(!e){return null}while(this.depth>e.depth){this.closeFrontierNode()}if(e.fit.childCount){this.placed=pt(this.placed,e.depth,e.fit)}t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),o=n.type.contentMatch.fillBefore(n.content,true,t.index(r));this.openFrontierNode(n.type,n.attrs,o)}return t};ft.prototype.openFrontierNode=function e(t,r,n){var i=this.frontier[this.depth];i.match=i.match.matchType(t);this.placed=pt(this.placed,this.depth,o.from(t.create(r,n)));this.frontier.push({type:t,match:t.contentMatch})};ft.prototype.closeFrontierNode=function e(){var t=this.frontier.pop();var r=t.match.fillBefore(o.empty,true);if(r.childCount){this.placed=pt(this.placed,this.frontier.length,r)}};Object.defineProperties(ft.prototype,ut);function ht(e,t,r){if(t==0){return e.cutByIndex(r)}return e.replaceChild(0,e.firstChild.copy(ht(e.firstChild.content,t-1,r)))}function pt(e,t,r){if(t==0){return e.append(r)}return e.replaceChild(e.childCount-1,e.lastChild.copy(pt(e.lastChild.content,t-1,r)))}function dt(e,t){for(var r=0;r<t;r++){e=e.firstChild.content}return e}function vt(e,t,r){if(t<=0){return e}var n=e.content;if(t>1){n=n.replaceChild(0,vt(n.firstChild,t-1,n.childCount==1?r-1:0))}if(t>0){n=e.type.contentMatch.fillBefore(n).append(n);if(r<=0){n=n.append(e.type.contentMatch.matchFragment(n).fillBefore(o.empty,true))}}return e.copy(n)}function mt(e,t,r,n,o){var i=e.node(t),a=o?e.indexAfter(t):e.index(t);if(a==i.childCount&&!r.compatibleContent(i.type)){return null}var s=n.fillBefore(i.content,true,a);return s&&!gt(r,i.content,a)?s:null}function gt(e,t,r){for(var n=r;n<t.childCount;n++){if(!e.allowsMarks(t.child(n).marks)){return true}}return false}Be.prototype.replaceRange=function(e,t,r){if(!r.size){return this.deleteRange(e,t)}var n=this.doc.resolve(e),o=this.doc.resolve(t);if(ct(n,o,r)){return this.step(new je(e,t,r))}var i=wt(n,this.doc.resolve(t));if(i[i.length-1]==0){i.pop()}var a=-(n.depth+1);i.unshift(a);for(var s=n.depth,l=n.pos-1;s>0;s--,l--){var c=n.node(s).type.spec;if(c.defining||c.isolating){break}if(i.indexOf(s)>-1){a=s}else if(n.before(s)==l){i.splice(1,0,-s)}}var f=i.indexOf(a);var h=[],p=r.openStart;for(var d=r.content,v=0;;v++){var m=d.firstChild;h.push(m);if(v==r.openStart){break}d=m.content}if(p>0&&h[p-1].type.spec.defining&&n.node(f).type!=h[p-1].type){p-=1}else if(p>=2&&h[p-1].isTextblock&&h[p-2].type.spec.defining&&n.node(f).type!=h[p-2].type){p-=2}for(var g=r.openStart;g>=0;g--){var y=(g+p+1)%(r.openStart+1);var w=h[y];if(!w){continue}for(var b=0;b<i.length;b++){var C=i[(b+f)%i.length],M=true;if(C<0){M=false;C=-C}var x=n.node(C-1),k=n.index(C-1);if(x.canReplaceWith(k,k,w.type,w.marks)){return this.replace(n.before(C),M?o.after(C):t,new u(yt(r.content,0,r.openStart,y),y,r.openEnd))}}}var S=this.steps.length;for(var O=i.length-1;O>=0;O--){this.replace(e,t,r);if(this.steps.length>S){break}var N=i[O];if(O<0){continue}e=n.before(N);t=o.after(N)}return this};function yt(e,t,r,n,i){if(t<r){var a=e.firstChild;e=e.replaceChild(0,a.copy(yt(a.content,t+1,r,n,a)))}if(t>n){var s=i.contentMatchAt(0);var l=s.fillBefore(e).append(e);e=l.append(s.matchFragment(l).fillBefore(o.empty,true))}return e}Be.prototype.replaceRangeWith=function(e,t,r){if(!r.isInline&&e==t&&this.doc.resolve(e).parent.content.size){var n=nt(this.doc,e,r.type);if(n!=null){e=t=n}}return this.replaceRange(e,t,new u(o.from(r),0,0))};Be.prototype.deleteRange=function(e,t){var r=this.doc.resolve(e),n=this.doc.resolve(t);var o=wt(r,n);for(var i=0;i<o.length;i++){var a=o[i],s=i==o.length-1;if(s&&a==0||r.node(a).type.contentMatch.validEnd){return this.delete(r.start(a),n.end(a))}if(a>0&&(s||r.node(a-1).canReplace(r.index(a-1),n.indexAfter(a-1)))){return this.delete(r.before(a),n.after(a))}}for(var l=1;l<=r.depth&&l<=n.depth;l++){if(e-r.start(l)==r.depth-l&&t>r.end(l)&&n.end(l)-t!=n.depth-l){return this.delete(r.before(l),t)}}return this.delete(e,t)};function wt(e,t){var r=[],n=Math.min(e.depth,t.depth);for(var o=n;o>=0;o--){var i=e.start(o);if(i<e.pos-(e.depth-o)||t.end(o)>t.pos+(t.depth-o)||e.node(o).type.spec.isolating||t.node(o).type.spec.isolating){break}if(i==t.start(o)){r.push(o)}}return r}var bt=Object.create(null);var Ct=function e(t,r,n){this.ranges=n||[new xt(t.min(r),t.max(r))];this.$anchor=t;this.$head=r};var Mt={anchor:{configurable:true},head:{configurable:true},from:{configurable:true},to:{configurable:true},$from:{configurable:true},$to:{configurable:true},empty:{configurable:true}};Mt.anchor.get=function(){return this.$anchor.pos};Mt.head.get=function(){return this.$head.pos};Mt.from.get=function(){return this.$from.pos};Mt.to.get=function(){return this.$to.pos};Mt.$from.get=function(){return this.ranges[0].$from};Mt.$to.get=function(){return this.ranges[0].$to};Mt.empty.get=function(){var e=this.ranges;for(var t=0;t<e.length;t++){if(e[t].$from.pos!=e[t].$to.pos){return false}}return true};Ct.prototype.content=function e(){return this.$from.node(0).slice(this.from,this.to,true)};Ct.prototype.replace=function e(t,r){if(r===void 0)r=u.empty;var n=r.content.lastChild,o=null;for(var i=0;i<r.openEnd;i++){o=n;n=n.lastChild}var a=t.steps.length,s=this.ranges;for(var l=0;l<s.length;l++){var c=s[l];var f=c.$from;var h=c.$to;var p=t.mapping.slice(a);t.replaceRange(p.map(f.pos),p.map(h.pos),l?u.empty:r);if(l==0){Et(t,a,(n?n.isInline:o&&o.isTextblock)?-1:1)}}};Ct.prototype.replaceWith=function e(t,r){var n=t.steps.length,o=this.ranges;for(var i=0;i<o.length;i++){var a=o[i];var s=a.$from;var l=a.$to;var c=t.mapping.slice(n);var f=c.map(s.pos),u=c.map(l.pos);if(i){t.deleteRange(f,u)}else{t.replaceRangeWith(f,u,r);Et(t,n,r.isInline?-1:1)}}};Ct.findFrom=function e(t,r,n){var o=t.parent.inlineContent?new kt(t):Tt(t.node(0),t.parent,t.pos,t.index(),r,n);if(o){return o}for(var i=t.depth-1;i>=0;i--){var a=r<0?Tt(t.node(0),t.node(i),t.before(i+1),t.index(i),r,n):Tt(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,r,n);if(a){return a}}};Ct.near=function e(t,r){if(r===void 0)r=1;return this.findFrom(t,r)||this.findFrom(t,-r)||new At(t.node(0))};Ct.atStart=function e(t){return Tt(t,t,0,0,1)||new At(t)};Ct.atEnd=function e(t){return Tt(t,t,t.content.size,t.childCount,-1)||new At(t)};Ct.fromJSON=function e(t,r){if(!r||!r.type){throw new RangeError("Invalid input for Selection.fromJSON")}var n=bt[r.type];if(!n){throw new RangeError("No selection type "+r.type+" defined")}return n.fromJSON(t,r)};Ct.jsonID=function e(t,r){if(t in bt){throw new RangeError("Duplicate use of selection JSON ID "+t)}bt[t]=r;r.prototype.jsonID=t;return r};Ct.prototype.getBookmark=function e(){return kt.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(Ct.prototype,Mt);Ct.prototype.visible=true;var xt=function e(t,r){this.$from=t;this.$to=r};var kt=function(e){function t(t,r){if(r===void 0)r=t;e.call(this,t,r)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={$cursor:{configurable:true}};r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null};t.prototype.map=function r(n,o){var i=n.resolve(o.map(this.head));if(!i.parent.inlineContent){return e.near(i)}var a=n.resolve(o.map(this.anchor));return new t(a.parent.inlineContent?a:i,i)};t.prototype.replace=function t(r,n){if(n===void 0)n=u.empty;e.prototype.replace.call(this,r,n);if(n==u.empty){var o=this.$from.marksAcross(this.$to);if(o){r.ensureMarks(o)}}};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor&&r.head==this.head};t.prototype.getBookmark=function e(){return new St(this.anchor,this.head)};t.prototype.toJSON=function e(){return{type:"text",anchor:this.anchor,head:this.head}};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"||typeof n.head!="number"){throw new RangeError("Invalid input for TextSelection.fromJSON")}return new t(r.resolve(n.anchor),r.resolve(n.head))};t.create=function e(t,r,n){if(n===void 0)n=r;var o=t.resolve(r);return new this(o,n==r?o:t.resolve(n))};t.between=function r(n,o,i){var a=n.pos-o.pos;if(!i||a){i=a>=0?1:-1}if(!o.parent.inlineContent){var s=e.findFrom(o,i,true)||e.findFrom(o,-i,true);if(s){o=s.$head}else{return e.near(o,i)}}if(!n.parent.inlineContent){if(a==0){n=o}else{n=(e.findFrom(n,-i,true)||e.findFrom(n,i,true)).$anchor;if(n.pos<o.pos!=a<0){n=o}}}return new t(n,o)};Object.defineProperties(t.prototype,r);return t}(Ct);Ct.jsonID("text",kt);var St=function e(t,r){this.anchor=t;this.head=r};St.prototype.map=function e(t){return new St(t.map(this.anchor),t.map(this.head))};St.prototype.resolve=function e(t){return kt.between(t.resolve(this.anchor),t.resolve(this.head))};var Ot=function(e){function t(t){var r=t.nodeAfter;var n=t.node(0).resolve(t.pos+r.nodeSize);e.call(this,t,n);this.node=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function r(n,o){var i=o.mapResult(this.anchor);var a=i.deleted;var s=i.pos;var l=n.resolve(s);if(a){return e.near(l)}return new t(l)};t.prototype.content=function e(){return new u(o.from(this.node),0,0)};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor};t.prototype.toJSON=function e(){return{type:"node",anchor:this.anchor}};t.prototype.getBookmark=function e(){return new Nt(this.anchor)};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"){throw new RangeError("Invalid input for NodeSelection.fromJSON")}return new t(r.resolve(n.anchor))};t.create=function e(t,r){return new this(t.resolve(r))};t.isSelectable=function e(t){return!t.isText&&t.type.spec.selectable!==false};return t}(Ct);Ot.prototype.visible=false;Ct.jsonID("node",Ot);var Nt=function e(t){this.anchor=t};Nt.prototype.map=function e(t){var r=t.mapResult(this.anchor);var n=r.deleted;var o=r.pos;return n?new St(o,o):new Nt(o)};Nt.prototype.resolve=function e(t){var r=t.resolve(this.anchor),n=r.nodeAfter;if(n&&Ot.isSelectable(n)){return new Ot(r)}return Ct.near(r)};var At=function(e){function t(t){e.call(this,t.resolve(0),t.resolve(t.content.size))}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.replace=function t(r,n){if(n===void 0)n=u.empty;if(n==u.empty){r.delete(0,r.doc.content.size);var o=e.atStart(r.doc);if(!o.eq(r.selection)){r.setSelection(o)}}else{e.prototype.replace.call(this,r,n)}};t.prototype.toJSON=function e(){return{type:"all"}};t.fromJSON=function e(r){return new t(r)};t.prototype.map=function e(r){return new t(r)};t.prototype.eq=function e(r){return r instanceof t};t.prototype.getBookmark=function e(){return Dt};return t}(Ct);Ct.jsonID("all",At);var Dt={map:function e(){return this},resolve:function e(t){return new At(t)}};function Tt(e,t,r,n,o,i){if(t.inlineContent){return kt.create(e,r)}for(var a=n-(o>0?0:1);o>0?a<t.childCount:a>=0;a+=o){var s=t.child(a);if(!s.isAtom){var l=Tt(e,s,r+o,o<0?s.childCount:0,o,i);if(l){return l}}else if(!i&&Ot.isSelectable(s)){return Ot.create(e,r-(o<0?s.nodeSize:0))}r+=s.nodeSize*o}}function Et(e,t,r){var n=e.steps.length-1;if(n<t){return}var o=e.steps[n];if(!(o instanceof je||o instanceof We)){return}var i=e.mapping.maps[n],a;i.forEach(function(e,t,r,n){if(a==null){a=n}});e.setSelection(Ct.near(e.doc.resolve(a),r))}var zt=1,Rt=2,Lt=4;var It=function(e){function t(t){e.call(this,t.doc);this.time=Date.now();this.curSelection=t.selection;this.curSelectionFor=0;this.storedMarks=t.storedMarks;this.updated=0;this.meta=Object.create(null)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={selection:{configurable:true},selectionSet:{configurable:true},storedMarksSet:{configurable:true},isGeneric:{configurable:true},scrolledIntoView:{configurable:true}};r.selection.get=function(){if(this.curSelectionFor<this.steps.length){this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor));this.curSelectionFor=this.steps.length}return this.curSelection};t.prototype.setSelection=function e(t){if(t.$from.doc!=this.doc){throw new RangeError("Selection passed to setSelection must point at the current document")}this.curSelection=t;this.curSelectionFor=this.steps.length;this.updated=(this.updated|zt)&~Rt;this.storedMarks=null;return this};r.selectionSet.get=function(){return(this.updated&zt)>0};t.prototype.setStoredMarks=function e(t){this.storedMarks=t;this.updated|=Rt;return this};t.prototype.ensureMarks=function e(t){if(!c.sameSet(this.storedMarks||this.selection.$from.marks(),t)){this.setStoredMarks(t)}return this};t.prototype.addStoredMark=function e(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))};t.prototype.removeStoredMark=function e(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))};r.storedMarksSet.get=function(){return(this.updated&Rt)>0};t.prototype.addStep=function t(r,n){e.prototype.addStep.call(this,r,n);this.updated=this.updated&~Rt;this.storedMarks=null};t.prototype.setTime=function e(t){this.time=t;return this};t.prototype.replaceSelection=function e(t){this.selection.replace(this,t);return this};t.prototype.replaceSelectionWith=function e(t,r){var n=this.selection;if(r!==false){t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||c.none))}n.replaceWith(this,t);return this};t.prototype.deleteSelection=function e(){this.selection.replace(this);return this};t.prototype.insertText=function e(t,r,n){if(n===void 0)n=r;var o=this.doc.type.schema;if(r==null){if(!t){return this.deleteSelection()}return this.replaceSelectionWith(o.text(t),true)}else{if(!t){return this.deleteRange(r,n)}var i=this.storedMarks;if(!i){var a=this.doc.resolve(r);i=n==r?a.marks():a.marksAcross(this.doc.resolve(n))}this.replaceRangeWith(r,n,o.text(t,i));if(!this.selection.empty){this.setSelection(Ct.near(this.selection.$to))}return this}};t.prototype.setMeta=function e(t,r){this.meta[typeof t=="string"?t:t.key]=r;return this};t.prototype.getMeta=function e(t){return this.meta[typeof t=="string"?t:t.key]};r.isGeneric.get=function(){for(var e in this.meta){return false}return true};t.prototype.scrollIntoView=function e(){this.updated|=Lt;return this};r.scrolledIntoView.get=function(){return(this.updated&Lt)>0};Object.defineProperties(t.prototype,r);return t}(Be);function $t(e,t){return!t||!e?e:e.bind(t)}var Bt=function e(t,r,n){this.name=t;this.init=$t(r.init,n);this.apply=$t(r.apply,n)};var Ft=[new Bt("doc",{init:function e(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function e(t){return t.doc}}),new Bt("selection",{init:function e(t,r){return t.selection||Ct.atStart(r.doc)},apply:function e(t){return t.selection}}),new Bt("storedMarks",{init:function e(t){return t.storedMarks||null},apply:function e(t,r,n,o){return o.selection.$cursor?t.storedMarks:null}}),new Bt("scrollToSelection",{init:function e(){return 0},apply:function e(t,r){return t.scrolledIntoView?r+1:r}})];var Pt=function e(t,r){var n=this;this.schema=t;this.fields=Ft.concat();this.plugins=[];this.pluginsByKey=Object.create(null);if(r){r.forEach(function(e){if(n.pluginsByKey[e.key]){throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")")}n.plugins.push(e);n.pluginsByKey[e.key]=e;if(e.spec.state){n.fields.push(new Bt(e.key,e.spec.state,e))}})}};var _t=function e(t){this.config=t};var Vt={schema:{configurable:true},plugins:{configurable:true},tr:{configurable:true}};Vt.schema.get=function(){return this.config.schema};Vt.plugins.get=function(){return this.config.plugins};_t.prototype.apply=function e(t){return this.applyTransaction(t).state};_t.prototype.filterTransaction=function e(t,r){if(r===void 0)r=-1;for(var n=0;n<this.config.plugins.length;n++){if(n!=r){var o=this.config.plugins[n];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,t,this)){return false}}}return true};_t.prototype.applyTransaction=function e(t){if(!this.filterTransaction(t)){return{state:this,transactions:[]}}var r=[t],n=this.applyInner(t),o=null;for(;;){var i=false;for(var a=0;a<this.config.plugins.length;a++){var s=this.config.plugins[a];if(s.spec.appendTransaction){var l=o?o[a].n:0,c=o?o[a].state:this;var f=l<r.length&&s.spec.appendTransaction.call(s,l?r.slice(l):r,c,n);if(f&&n.filterTransaction(f,a)){f.setMeta("appendedTransaction",t);if(!o){o=[];for(var u=0;u<this.config.plugins.length;u++){o.push(u<a?{state:n,n:r.length}:{state:this,n:0})}}r.push(f);n=n.applyInner(f);i=true}if(o){o[a]={state:n,n:r.length}}}}if(!i){return{state:n,transactions:r}}}};_t.prototype.applyInner=function e(t){if(!t.before.eq(this.doc)){throw new RangeError("Applying a mismatched transaction")}var r=new _t(this.config),n=this.config.fields;for(var o=0;o<n.length;o++){var i=n[o];r[i.name]=i.apply(t,this[i.name],this,r)}for(var a=0;a<qt.length;a++){qt[a](this,t,r)}return r};Vt.tr.get=function(){return new It(this)};_t.create=function e(t){var r=new Pt(t.schema||t.doc.type.schema,t.plugins);var n=new _t(r);for(var o=0;o<r.fields.length;o++){n[r.fields[o].name]=r.fields[o].init(t,n)}return n};_t.prototype.reconfigure=function e(t){var r=new Pt(t.schema||this.schema,t.plugins);var n=r.fields,o=new _t(r);for(var i=0;i<n.length;i++){var a=n[i].name;o[a]=this.hasOwnProperty(a)?this[a]:n[i].init(t,o)}return o};_t.prototype.toJSON=function e(t){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks){r.storedMarks=this.storedMarks.map(function(e){return e.toJSON()})}if(t&&typeof t=="object"){for(var n in t){if(n=="doc"||n=="selection"){throw new RangeError("The JSON fields `doc` and `selection` are reserved")}var o=t[n],i=o.spec.state;if(i&&i.toJSON){r[n]=i.toJSON.call(o,this[o.key])}}}return r};_t.fromJSON=function e(t,r,n){if(!r){throw new RangeError("Invalid input for EditorState.fromJSON")}if(!t.schema){throw new RangeError("Required config field 'schema' missing")}var o=new Pt(t.schema,t.plugins);var i=new _t(o);o.fields.forEach(function(e){if(e.name=="doc"){i.doc=R.fromJSON(t.schema,r.doc)}else if(e.name=="selection"){i.selection=Ct.fromJSON(i.doc,r.selection)}else if(e.name=="storedMarks"){if(r.storedMarks){i.storedMarks=r.storedMarks.map(t.schema.markFromJSON)}}else{if(n){for(var o in n){var a=n[o],s=a.spec.state;if(a.key==e.name&&s&&s.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){i[e.name]=s.fromJSON.call(a,t,r[o],i);return}}}i[e.name]=e.init(t,i)}});return i};_t.addApplyListener=function e(t){qt.push(t)};_t.removeApplyListener=function e(t){var r=qt.indexOf(t);if(r>-1){qt.splice(r,1)}};Object.defineProperties(_t.prototype,Vt);var qt=[];function jt(e,t,r){for(var n in e){var o=e[n];if(o instanceof Function){o=o.bind(t)}else if(n=="handleDOMEvents"){o=jt(o,t,{})}r[n]=o}return r}var Wt=function e(t){this.props={};if(t.props){jt(t.props,this,this.props)}this.spec=t;this.key=t.key?t.key.key:Jt("plugin")};Wt.prototype.getState=function e(t){return t[this.key]};var Ht=Object.create(null);function Jt(e){if(e in Ht){return e+"$"+ ++Ht[e]}Ht[e]=0;return e+"$"}var Kt=function e(t){if(t===void 0)t="key";this.key=Jt(t)};Kt.prototype.get=function e(t){return t.config.pluginsByKey[this.key]};Kt.prototype.getState=function e(t){return t[this.key]};var Zt={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var Ut=/Edge\/(\d+)/.exec(navigator.userAgent);var Gt=/MSIE \d/.test(navigator.userAgent);var Xt=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);Zt.mac=/Mac/.test(navigator.platform);var Yt=Zt.ie=!!(Gt||Xt||Ut);Zt.ie_version=Gt?document.documentMode||6:Xt?+Xt[1]:Ut?+Ut[1]:null;Zt.gecko=!Yt&&/gecko\/(\d+)/i.test(navigator.userAgent);Zt.gecko_version=Zt.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var Qt=!Yt&&/Chrome\/(\d+)/.exec(navigator.userAgent);Zt.chrome=!!Qt;Zt.chrome_version=Qt&&+Qt[1];Zt.ios=!Yt&&/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent);Zt.android=/Android \d/.test(navigator.userAgent);Zt.webkit="webkitFontSmoothing"in document.documentElement.style;Zt.safari=/Apple Computer/.test(navigator.vendor);Zt.webkit_version=Zt.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var er=function(e){for(var t=0;;t++){e=e.previousSibling;if(!e){return t}}};var tr=function(e){var t=e.parentNode;return t&&t.nodeType==11?t.host:t};var rr=function(e,t,r){var n=document.createRange();n.setEnd(e,r==null?e.nodeValue.length:r);n.setStart(e,t||0);return n};var nr=function(e,t,r,n){return r&&(ir(e,t,r,n,-1)||ir(e,t,r,n,1))};var or=/^(img|br|input|textarea|hr)$/i;function ir(e,t,r,n,o){for(;;){if(e==r&&t==n){return true}if(t==(o<0?0:ar(e))){var i=e.parentNode;if(i.nodeType!=1||lr(e)||or.test(e.nodeName)||e.contentEditable=="false"){return false}t=er(e)+(o<0?0:1);e=i}else if(e.nodeType==1){e=e.childNodes[t+(o<0?-1:0)];if(e.contentEditable=="false"){return false}t=o<0?ar(e):0}else{return false}}}function ar(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function sr(e,t,r){for(var n=t==0,o=t==ar(e);n||o;){if(e==r){return true}var i=er(e);e=e.parentNode;if(!e){return false}n=n&&i==0;o=o&&i==ar(e)}}function lr(e){var t;for(var r=e;r;r=r.parentNode){if(t=r.pmViewDesc){break}}return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}var cr=function(e){var t=e.isCollapsed;if(t&&Zt.chrome&&e.rangeCount&&!e.getRangeAt(0).collapsed){t=false}return t};function fr(e,t){var r=document.createEvent("Event");r.initEvent("keydown",true,true);r.keyCode=e;r.key=r.code=t;return r}function ur(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function hr(e,t){return typeof e=="number"?e:e[t]}function pr(e){var t=e.getBoundingClientRect();return{left:t.left,right:t.left+e.clientWidth,top:t.top,bottom:t.top+e.clientHeight}}function dr(e,t,r){var n=e.someProp("scrollThreshold")||0,o=e.someProp("scrollMargin")||5;var i=e.dom.ownerDocument;for(var a=r||e.dom;;a=tr(a)){if(!a){break}if(a.nodeType!=1){continue}var s=a==i.body||a.nodeType!=1;var l=s?ur(i):pr(a);var c=0,f=0;if(t.top<l.top+hr(n,"top")){f=-(l.top-t.top+hr(o,"top"))}else if(t.bottom>l.bottom-hr(n,"bottom")){f=t.bottom-l.bottom+hr(o,"bottom")}if(t.left<l.left+hr(n,"left")){c=-(l.left-t.left+hr(o,"left"))}else if(t.right>l.right-hr(n,"right")){c=t.right-l.right+hr(o,"right")}if(c||f){if(s){i.defaultView.scrollBy(c,f)}else{var u=a.scrollLeft,h=a.scrollTop;if(f){a.scrollTop+=f}if(c){a.scrollLeft+=c}var p=a.scrollLeft-u,d=a.scrollTop-h;t={left:t.left-p,top:t.top-d,right:t.right-p,bottom:t.bottom-d}}}if(s){break}}}function vr(e){var t=e.dom.getBoundingClientRect(),r=Math.max(0,t.top);var n,o;for(var i=(t.left+t.right)/2,a=r+1;a<Math.min(innerHeight,t.bottom);a+=5){var s=e.root.elementFromPoint(i,a);if(s==e.dom||!e.dom.contains(s)){continue}var l=s.getBoundingClientRect();if(l.top>=r-20){n=s;o=l.top;break}}return{refDOM:n,refTop:o,stack:mr(e.dom)}}function mr(e){var t=[],r=e.ownerDocument;for(;e;e=tr(e)){t.push({dom:e,top:e.scrollTop,left:e.scrollLeft});if(e==r){break}}return t}function gr(e){var t=e.refDOM;var r=e.refTop;var n=e.stack;var o=t?t.getBoundingClientRect().top:0;yr(n,o==0?0:o-r)}function yr(e,t){for(var r=0;r<e.length;r++){var n=e[r];var o=n.dom;var i=n.top;var a=n.left;if(o.scrollTop!=i+t){o.scrollTop=i+t}if(o.scrollLeft!=a){o.scrollLeft=a}}}var wr=null;function br(e){if(e.setActive){return e.setActive()}if(wr){return e.focus(wr)}var t=mr(e);e.focus(wr==null?{get preventScroll(){wr={preventScroll:true};return true}}:undefined);if(!wr){wr=false;yr(t,0)}}function Cr(e,t){var r,n=2e8,o,i=0;var a=t.top,s=t.top;for(var l=e.firstChild,c=0;l;l=l.nextSibling,c++){var f=void 0;if(l.nodeType==1){f=l.getClientRects()}else if(l.nodeType==3){f=rr(l).getClientRects()}else{continue}for(var u=0;u<f.length;u++){var h=f[u];if(h.top<=a&&h.bottom>=s){a=Math.max(h.bottom,a);s=Math.min(h.top,s);var p=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(p<n){r=l;n=p;o=p&&r.nodeType==3?{left:h.right<t.left?h.right:h.left,top:t.top}:t;if(l.nodeType==1&&p){i=c+(t.left>=(h.left+h.right)/2?1:0)}continue}}if(!r&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)){i=c+1}}}if(r&&r.nodeType==3){return Mr(r,o)}if(!r||n&&r.nodeType==1){return{node:e,offset:i}}return Cr(r,o)}function Mr(e,t){var r=e.nodeValue.length;var n=document.createRange();for(var o=0;o<r;o++){n.setEnd(e,o+1);n.setStart(e,o);var i=Dr(n,1);if(i.top==i.bottom){continue}if(xr(t,i)){return{node:e,offset:o+(t.left>=(i.left+i.right)/2?1:0)}}}return{node:e,offset:0}}function xr(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function kr(e,t){var r=e.parentNode;if(r&&/^li$/i.test(r.nodeName)&&t.left<e.getBoundingClientRect().left){return r}return e}function Sr(e,t,r){var n=Cr(t,r);var o=n.node;var i=n.offset;var a=-1;if(o.nodeType==1&&!o.firstChild){var s=o.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return e.docView.posFromDOM(o,i,a)}function Or(e,t,r,n){var o=-1;for(var i=t;;){if(i==e.dom){break}var a=e.docView.nearestDesc(i,true);if(!a){return null}if(a.node.isBlock&&a.parent){var s=a.dom.getBoundingClientRect();if(s.left>n.left||s.top>n.top){o=a.posBefore}else if(s.right<n.left||s.bottom<n.top){o=a.posAfter}else{break}}i=a.dom.parentNode}return o>-1?o:e.docView.posFromDOM(t,r)}function Nr(e,t,r){var n=e.childNodes.length;if(n&&r.top<r.bottom){for(var o=Math.max(0,Math.min(n-1,Math.floor(n*(t.top-r.top)/(r.bottom-r.top))-2)),i=o;;){var a=e.childNodes[i];if(a.nodeType==1){var s=a.getClientRects();for(var l=0;l<s.length;l++){var c=s[l];if(xr(t,c)){return Nr(a,t,c)}}}if((i=(i+1)%n)==o){break}}}return e}function Ar(e,t){var r,n;var o=e.root,i,a;if(o.caretPositionFromPoint){try{var s=o.caretPositionFromPoint(t.left,t.top);if(s){r=s,i=r.offsetNode,a=r.offset}}catch(e){}}if(!i&&o.caretRangeFromPoint){var l=o.caretRangeFromPoint(t.left,t.top);if(l){n=l,i=n.startContainer,a=n.startOffset}}var c=o.elementFromPoint(t.left,t.top+1),f;if(!c||!e.dom.contains(c.nodeType!=1?c.parentNode:c)){var u=e.dom.getBoundingClientRect();if(!xr(t,u)){return null}c=Nr(e.dom,t,u);if(!c){return null}}if(Zt.safari&&c.draggable){i=a=null}c=kr(c,t);if(i){if(Zt.gecko&&i.nodeType==1){a=Math.min(a,i.childNodes.length);if(a<i.childNodes.length){var h=i.childNodes[a],p;if(h.nodeName=="IMG"&&(p=h.getBoundingClientRect()).right<=t.left&&p.bottom>t.top){a++}}}if(i==e.dom&&a==i.childNodes.length-1&&i.lastChild.nodeType==1&&t.top>i.lastChild.getBoundingClientRect().bottom){f=e.state.doc.content.size}else if(a==0||i.nodeType!=1||i.childNodes[a-1].nodeName!="BR"){f=Or(e,i,a,t)}}if(f==null){f=Sr(e,c,t)}var d=e.docView.nearestDesc(c,true);return{pos:f,inside:d?d.posAtStart-d.border:-1}}function Dr(e,t){var r=e.getClientRects();return!r.length?e.getBoundingClientRect():r[t<0?0:r.length-1]}function Tr(e,t){var r=e.docView.domFromPos(t);var n=r.node;var o=r.offset;if(n.nodeType==3&&(Zt.webkit||Zt.gecko)){var i=Dr(rr(n,o,o),0);if(Zt.gecko&&o&&/\s/.test(n.nodeValue[o-1])&&o<n.nodeValue.length){var a=Dr(rr(n,o-1,o-1),-1);if(a.top==i.top){var s=Dr(rr(n,o,o+1),-1);if(s.top!=i.top){return Er(s,s.left<a.left)}}}return i}if(n.nodeType==1&&!e.state.doc.resolve(t).parent.inlineContent){var l=true,c;if(o<n.childNodes.length){var f=n.childNodes[o];if(f.nodeType==1){c=f.getBoundingClientRect()}}if(!c&&o){var u=n.childNodes[o-1];if(u.nodeType==1){c=u.getBoundingClientRect();l=false}}return zr(c||n.getBoundingClientRect(),l)}for(var h=-1;h<2;h+=2){if(h<0&&o){var p=void 0,d=n.nodeType==3?rr(n,o-1,o):(p=n.childNodes[o-1]).nodeType==3?rr(p):p.nodeType==1&&p.nodeName!="BR"?p:null;if(d){var v=Dr(d,1);if(v.top<v.bottom){return Er(v,false)}}}else if(h>0&&o<ar(n)){var m=void 0,g=n.nodeType==3?rr(n,o,o+1):(m=n.childNodes[o]).nodeType==3?rr(m):m.nodeType==1?m:null;if(g){var y=Dr(g,-1);if(y.top<y.bottom){return Er(y,true)}}}}return Er(Dr(n.nodeType==3?rr(n):n,0),false)}function Er(e,t){if(e.width==0){return e}var r=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:r,right:r}}function zr(e,t){if(e.height==0){return e}var r=t?e.top:e.bottom;return{top:r,bottom:r,left:e.left,right:e.right}}function Rr(e,t,r){var n=e.state,o=e.root.activeElement;if(n!=t){e.updateState(t)}if(o!=e.dom){e.focus()}try{return r()}finally{if(n!=t){e.updateState(n)}if(o!=e.dom&&o){o.focus()}}}function Lr(e,t,r){var n=t.selection;var o=r=="up"?n.$anchor.min(n.$head):n.$anchor.max(n.$head);return Rr(e,t,function(){var t=e.docView.domFromPos(o.pos);var n=t.node;for(;;){var i=e.docView.nearestDesc(n,true);if(!i){break}if(i.node.isBlock){n=i.dom;break}n=i.dom.parentNode}var a=Tr(e,o.pos);for(var s=n.firstChild;s;s=s.nextSibling){var l=void 0;if(s.nodeType==1){l=s.getClientRects()}else if(s.nodeType==3){l=rr(s,0,s.nodeValue.length).getClientRects()}else{continue}for(var c=0;c<l.length;c++){var f=l[c];if(f.bottom>f.top&&(r=="up"?f.bottom<a.top+1:f.top>a.bottom-1)){return false}}}return true})}var Ir=/[\u0590-\u08ac]/;function $r(e,t,r){var n=t.selection;var o=n.$head;if(!o.parent.isTextblock){return false}var i=o.parentOffset,a=!i,s=i==o.parent.content.size;var l=getSelection();if(!Ir.test(o.parent.textContent)||!l.modify){return r=="left"||r=="backward"?a:s}return Rr(e,t,function(){var t=l.getRangeAt(0),n=l.focusNode,i=l.focusOffset;var a=l.caretBidiLevel;l.modify("move",r,"character");var s=o.depth?e.docView.domAfterPos(o.before()):e.dom;var c=!s.contains(l.focusNode.nodeType==1?l.focusNode:l.focusNode.parentNode)||n==l.focusNode&&i==l.focusOffset;l.removeAllRanges();l.addRange(t);if(a!=null){l.caretBidiLevel=a}return c})}var Br=null,Fr=null,Pr=false;function _r(e,t,r){if(Br==t&&Fr==r){return Pr}Br=t;Fr=r;return Pr=r=="up"||r=="down"?Lr(e,t,r):$r(e,t,r)}var Vr=0,qr=1,jr=2,Wr=3;var Hr=function e(t,r,n,o){this.parent=t;this.children=r;this.dom=n;n.pmViewDesc=this;this.contentDOM=o;this.dirty=Vr};var Jr={beforePosition:{configurable:true},size:{configurable:true},border:{configurable:true},posBefore:{configurable:true},posAtStart:{configurable:true},posAfter:{configurable:true},posAtEnd:{configurable:true},contentLost:{configurable:true}};Hr.prototype.matchesWidget=function e(){return false};Hr.prototype.matchesMark=function e(){return false};Hr.prototype.matchesNode=function e(){return false};Hr.prototype.matchesHack=function e(){return false};Jr.beforePosition.get=function(){return false};Hr.prototype.parseRule=function e(){return null};Hr.prototype.stopEvent=function e(){return false};Jr.size.get=function(){var e=0;for(var t=0;t<this.children.length;t++){e+=this.children[t].size}return e};Jr.border.get=function(){return 0};Hr.prototype.destroy=function e(){this.parent=null;if(this.dom.pmViewDesc==this){this.dom.pmViewDesc=null}for(var t=0;t<this.children.length;t++){this.children[t].destroy()}};Hr.prototype.posBeforeChild=function e(t){for(var r=0,n=this.posAtStart;r<this.children.length;r++){var o=this.children[r];if(o==t){return n}n+=o.size}};Jr.posBefore.get=function(){return this.parent.posBeforeChild(this)};Jr.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Jr.posAfter.get=function(){return this.posBefore+this.size};Jr.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};Hr.prototype.localPosFromDOM=function e(t,r,n){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode)){if(n<0){var o,i;if(t==this.contentDOM){o=t.childNodes[r-1]}else{while(t.parentNode!=this.contentDOM){t=t.parentNode}o=t.previousSibling}while(o&&!((i=o.pmViewDesc)&&i.parent==this)){o=o.previousSibling}return o?this.posBeforeChild(i)+i.size:this.posAtStart}else{var a,s;if(t==this.contentDOM){a=t.childNodes[r]}else{while(t.parentNode!=this.contentDOM){t=t.parentNode}a=t.nextSibling}while(a&&!((s=a.pmViewDesc)&&s.parent==this)){a=a.nextSibling}return a?this.posBeforeChild(s):this.posAtEnd}}var l;if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM)){l=t.compareDocumentPosition(this.contentDOM)&2}else if(this.dom.firstChild){if(r==0){for(var c=t;;c=c.parentNode){if(c==this.dom){l=false;break}if(c.parentNode.firstChild!=c){break}}}if(l==null&&r==t.childNodes.length){for(var f=t;;f=f.parentNode){if(f==this.dom){l=true;break}if(f.parentNode.lastChild!=f){break}}}}return(l==null?n>0:l)?this.posAtEnd:this.posAtStart};Hr.prototype.nearestDesc=function e(t,r){for(var n=true,o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i&&(!r||i.node)){if(n&&i.nodeDOM&&!(i.nodeDOM.nodeType==1?i.nodeDOM.contains(t.nodeType==1?t:t.parentNode):i.nodeDOM==t)){n=false}else{return i}}}};Hr.prototype.getDesc=function e(t){var r=t.pmViewDesc;for(var n=r;n;n=n.parent){if(n==this){return r}}};Hr.prototype.posFromDOM=function e(t,r,n){for(var o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i){return i.localPosFromDOM(t,r,n)}}return-1};Hr.prototype.descAt=function e(t){for(var r=0,n=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==t&&i!=n){while(!o.border&&o.children.length){o=o.children[0]}return o}if(t<i){return o.descAt(t-n-o.border)}n=i}};Hr.prototype.domFromPos=function e(t){if(!this.contentDOM){return{node:this.dom,offset:0}}for(var r=0,n=0;;n++){if(r==t){while(n<this.children.length&&(this.children[n].beforePosition||this.children[n].dom.parentNode!=this.contentDOM)){n++}return{node:this.contentDOM,offset:n==this.children.length?this.contentDOM.childNodes.length:er(this.children[n].dom)}}if(n==this.children.length){throw new Error("Invalid position "+t)}var o=this.children[n],i=r+o.size;if(t<i){return o.domFromPos(t-r-o.border)}r=i}};Hr.prototype.parseRange=function e(t,r,n){if(n===void 0)n=0;if(this.children.length==0){return{node:this.contentDOM,from:t,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length}}var o=-1,i=-1;for(var a=n,s=0;;s++){var l=this.children[s],c=a+l.size;if(o==-1&&t<=c){var f=a+l.border;if(t>=f&&r<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM)){return l.parseRange(t,r,f)}t=a;for(var u=s;u>0;u--){var h=this.children[u-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){o=er(h.dom)+1;break}t-=h.size}if(o==-1){o=0}}if(o>-1&&r<=c){r=c;for(var p=s+1;p<this.children.length;p++){var d=this.children[p];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){i=er(d.dom);break}r+=d.size}if(i==-1){i=this.contentDOM.childNodes.length}break}a=c}return{node:this.contentDOM,from:t,to:r,fromOffset:o,toOffset:i}};Hr.prototype.emptyChildAt=function e(t){if(this.border||!this.contentDOM||!this.children.length){return false}var r=this.children[t<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(t)};Hr.prototype.domAfterPos=function e(t){var r=this.domFromPos(t);var n=r.node;var o=r.offset;if(n.nodeType!=1||o==n.childNodes.length){throw new RangeError("No node after pos "+t)}return n.childNodes[o]};Hr.prototype.setSelection=function e(t,r,n,o){var i=Math.min(t,r),a=Math.max(t,r);for(var s=0,l=0;s<this.children.length;s++){var c=this.children[s],f=l+c.size;if(i>l&&a<f){return c.setSelection(t-l-c.border,r-l-c.border,n,o)}l=f}var u=this.domFromPos(t),h=this.domFromPos(r);var p=n.getSelection();if(!o&&nr(u.node,u.offset,p.anchorNode,p.anchorOffset)&&nr(h.node,h.offset,p.focusNode,p.focusOffset)){return}var d=false;if(p.extend||t==r){p.collapse(u.node,u.offset);try{if(t!=r){p.extend(h.node,h.offset)}d=true}catch(e){if(!(e instanceof DOMException)){throw e}}}if(!d){if(t>r){var v=u;u=h;h=v}var m=document.createRange();m.setEnd(h.node,h.offset);m.setStart(u.node,u.offset);p.removeAllRanges();p.addRange(m)}};Hr.prototype.ignoreMutation=function e(t){return!this.contentDOM&&t.type!="selection"};Jr.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};Hr.prototype.markDirty=function e(t,r){for(var n=0,o=0;o<this.children.length;o++){var i=this.children[o],a=n+i.size;if(n==a?t<=a&&r>=n:t<a&&r>n){var s=n+i.border,l=a-i.border;if(t>=s&&r<=l){this.dirty=t==n||r==a?jr:qr;if(t==s&&r==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)){i.dirty=Wr}else{i.markDirty(t-s,r-s)}return}else{i.dirty=Wr}}n=a}this.dirty=jr};Hr.prototype.markParentsDirty=function e(){var t=1;for(var r=this.parent;r;r=r.parent,t++){var n=t==1?jr:qr;if(r.dirty<n){r.dirty=n}}};Object.defineProperties(Hr.prototype,Jr);var Kr=[];var Zr=function(e){function t(t,r,n,o){var i,a=r.type.toDOM;if(typeof a=="function"){a=a(n,function(){if(!i){return o}if(i.parent){return i.parent.posBeforeChild(i)}})}if(!r.type.spec.raw){if(a.nodeType!=1){var s=document.createElement("span");s.appendChild(a);a=s}a.contentEditable=false;a.classList.add("ProseMirror-widget")}e.call(this,t,Kr,a,null);this.widget=r;i=this}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={beforePosition:{configurable:true}};r.beforePosition.get=function(){return this.widget.type.side<0};t.prototype.matchesWidget=function e(t){return this.dirty==Vr&&t.type.eq(this.widget.type)};t.prototype.parseRule=function e(){return{ignore:true}};t.prototype.stopEvent=function e(t){var r=this.widget.spec.stopEvent;return r?r(t):false};t.prototype.ignoreMutation=function e(t){return t.type!="selection"||this.widget.spec.ignoreSelection};Object.defineProperties(t.prototype,r);return t}(Hr);var Ur=function(e){function t(t,r,n,o){e.call(this,t,Kr,r,null);this.textDOM=n;this.text=o}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={size:{configurable:true}};r.size.get=function(){return this.text.length};t.prototype.localPosFromDOM=function e(t,r){if(t!=this.textDOM){return this.posAtStart+(r?this.size:0)}return this.posAtStart+r};t.prototype.domFromPos=function e(t){return{node:this.textDOM,offset:t}};t.prototype.ignoreMutation=function e(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue};Object.defineProperties(t.prototype,r);return t}(Hr);var Gr=function(e){function t(t,r,n,o){e.call(this,t,[],n,o);this.mark=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.create=function e(r,n,o,i){var a=i.nodeViews[n.type.name];var s=a&&a(n,i,o);if(!s||!s.dom){s=Se.renderSpec(document,n.type.spec.toDOM(n,o))}return new t(r,n,s.dom,s.contentDOM||s.dom)};t.prototype.parseRule=function e(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}};t.prototype.matchesMark=function e(t){return this.dirty!=Wr&&this.mark.eq(t)};t.prototype.markDirty=function t(r,n){e.prototype.markDirty.call(this,r,n);if(this.dirty!=Vr){var o=this.parent;while(!o.node){o=o.parent}if(o.dirty<this.dirty){o.dirty=this.dirty}this.dirty=Vr}};t.prototype.slice=function e(r,n,o){var i=t.create(this.parent,this.mark,true,o);var a=this.children,s=this.size;if(n<s){a=wn(a,n,s,o)}if(r>0){a=wn(a,0,r,o)}for(var l=0;l<a.length;l++){a[l].parent=i}i.children=a;return i};return t}(Hr);var Xr=function(e){function t(t,r,n,o,i,a,s,l,c){e.call(this,t,r.isLeaf?Kr:[],i,a);this.nodeDOM=s;this.node=r;this.outerDeco=n;this.innerDeco=o;if(a){this.updateChildren(l,c)}}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={size:{configurable:true},border:{configurable:true}};t.create=function e(r,n,o,i,a,s){var l;var c=a.nodeViews[n.type.name],f;var u=c&&c(n,a,function(){if(!f){return s}if(f.parent){return f.parent.posBeforeChild(f)}},o);var h=u&&u.dom,p=u&&u.contentDOM;if(n.isText){if(!h){h=document.createTextNode(n.text)}else if(h.nodeType!=3){throw new RangeError("Text must be rendered as a DOM text node")}}else if(!h){l=Se.renderSpec(document,n.type.spec.toDOM(n)),h=l.dom,p=l.contentDOM}if(!p&&!n.isText&&h.nodeName!="BR"){if(!h.hasAttribute("contenteditable")){h.contentEditable=false}if(n.type.spec.draggable){h.draggable=true}}var d=h;h=cn(h,o,n);if(u){return f=new tn(r,n,o,i,h,p,d,u,a,s+1)}else if(n.isText){return new Qr(r,n,o,i,h,d,a)}else{return new t(r,n,o,i,h,p,d,a,s+1)}};t.prototype.parseRule=function e(){var t=this;if(this.node.type.spec.reparseInView){return null}var r={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.spec.code){r.preserveWhitespace="full"}if(this.contentDOM&&!this.contentLost){r.contentElement=this.contentDOM}else{r.getContent=function(){return t.contentDOM?o.empty:t.node.content}}return r};t.prototype.matchesNode=function e(t,r,n){return this.dirty==Vr&&t.eq(this.node)&&fn(r,this.outerDeco)&&n.eq(this.innerDeco)};r.size.get=function(){return this.node.nodeSize};r.border.get=function(){return this.node.isLeaf?0:1};t.prototype.updateChildren=function e(t,r){var n=this;var o=this.node.inlineContent,i=r;var a=o&&t.composing&&this.localCompositionNode(t,r);var s=new hn(this,a&&a.node);vn(this.node,this.innerDeco,function(e,r,a){if(e.spec.marks){s.syncToMarks(e.spec.marks,o,t)}else if(e.type.side>=0&&!a){s.syncToMarks(r==n.node.childCount?c.none:n.node.child(r).marks,o,t)}s.placeWidget(e,t,i)},function(e,r,n,a){s.syncToMarks(e.marks,o,t);s.findNodeMatch(e,r,n,a)||s.updateNextNode(e,r,n,t,a)||s.addNode(e,r,n,t,i);i+=e.nodeSize});s.syncToMarks(Kr,o,t);if(this.node.isTextblock){s.addTextblockHacks()}s.destroyRest();if(s.changed||this.dirty==jr){if(a){this.protectLocalComposition(t,a)}this.renderChildren()}};t.prototype.renderChildren=function e(){rn(this.contentDOM,this.children);if(Zt.ios){mn(this.dom)}};t.prototype.localCompositionNode=function e(t,r){var n=t.state.selection;var o=n.from;var i=n.to;if(!(t.state.selection instanceof kt)||o<r||i>r+this.node.content.size){return}var a=t.root.getSelection();var s=gn(a.focusNode,a.focusOffset);if(!s||!this.dom.contains(s.parentNode)){return}var l=s.nodeValue;var c=yn(this.node.content,l,o-r,i-r);return c<0?null:{node:s,pos:c,text:l}};t.prototype.protectLocalComposition=function e(t,r){var n=r.node;var o=r.pos;var i=r.text;if(this.getDesc(n)){return}var a=n;for(;;a=a.parentNode){if(a.parentNode==this.contentDOM){break}while(a.previousSibling){a.parentNode.removeChild(a.previousSibling)}while(a.nextSibling){a.parentNode.removeChild(a.nextSibling)}if(a.pmViewDesc){a.pmViewDesc=null}}var s=new Ur(this,a,n,i);t.compositionNodes.push(s);this.children=wn(this.children,o,o+i.length,t,s)};t.prototype.update=function e(t,r,n,o){if(this.dirty==Wr||!t.sameMarkup(this.node)){return false}this.updateInner(t,r,n,o);return true};t.prototype.updateInner=function e(t,r,n,o){this.updateOuterDeco(r);this.node=t;this.innerDeco=n;if(this.contentDOM){this.updateChildren(o,this.posAtStart)}this.dirty=Vr};t.prototype.updateOuterDeco=function e(t){if(fn(t,this.outerDeco)){return}var r=this.nodeDOM.nodeType!=1;var n=this.dom;this.dom=sn(this.dom,this.nodeDOM,an(this.outerDeco,this.node,r),an(t,this.node,r));if(this.dom!=n){n.pmViewDesc=null;this.dom.pmViewDesc=this}this.outerDeco=t};t.prototype.selectNode=function e(){this.nodeDOM.classList.add("ProseMirror-selectednode");if(this.contentDOM||!this.node.type.spec.draggable){this.dom.draggable=true}};t.prototype.deselectNode=function e(){this.nodeDOM.classList.remove("ProseMirror-selectednode");if(this.contentDOM||!this.node.type.spec.draggable){this.dom.removeAttribute("draggable")}};Object.defineProperties(t.prototype,r);return t}(Hr);function Yr(e,t,r,n,o){cn(n,t,e);return new Xr(null,e,t,r,n,n,n,o,0)}var Qr=function(e){function t(t,r,n,o,i,a,s){e.call(this,t,r,n,o,i,null,a,s)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.parseRule=function e(){var t=this.nodeDOM.parentNode;while(t&&t!=this.dom&&!t.pmIsDeco){t=t.parentNode}return{skip:t||true}};t.prototype.update=function e(t,r){if(this.dirty==Wr||this.dirty!=Vr&&!this.inParent()||!t.sameMarkup(this.node)){return false}this.updateOuterDeco(r);if((this.dirty!=Vr||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue){this.nodeDOM.nodeValue=t.text}this.node=t;this.dirty=Vr;return true};t.prototype.inParent=function e(){var t=this.parent.contentDOM;for(var r=this.nodeDOM;r;r=r.parentNode){if(r==t){return true}}return false};t.prototype.domFromPos=function e(t){return{node:this.nodeDOM,offset:t}};t.prototype.localPosFromDOM=function t(r,n,o){if(r==this.nodeDOM){return this.posAtStart+Math.min(n,this.node.text.length)}return e.prototype.localPosFromDOM.call(this,r,n,o)};t.prototype.ignoreMutation=function e(t){return t.type!="characterData"&&t.type!="selection"};t.prototype.slice=function e(r,n,o){var i=this.node.cut(r,n),a=document.createTextNode(i.text);return new t(this.parent,i,this.outerDeco,this.innerDeco,a,a,o)};return t}(Xr);var en=function(e){function t(){e.apply(this,arguments)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.parseRule=function e(){return{ignore:true}};t.prototype.matchesHack=function e(){return this.dirty==Vr};return t}(Hr);var tn=function(e){function t(t,r,n,o,i,a,s,l,c,f){e.call(this,t,r,n,o,i,a,s,c,f);this.spec=l}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.update=function t(r,n,o,i){if(this.dirty==Wr){return false}if(this.spec.update){var a=this.spec.update(r,n);if(a){this.updateInner(r,n,o,i)}return a}else if(!this.contentDOM&&!r.isLeaf){return false}else{return e.prototype.update.call(this,r,n,o,i)}};t.prototype.selectNode=function t(){this.spec.selectNode?this.spec.selectNode():e.prototype.selectNode.call(this)};t.prototype.deselectNode=function t(){this.spec.deselectNode?this.spec.deselectNode():e.prototype.deselectNode.call(this)};t.prototype.setSelection=function t(r,n,o,i){this.spec.setSelection?this.spec.setSelection(r,n,o):e.prototype.setSelection.call(this,r,n,o,i)};t.prototype.destroy=function t(){if(this.spec.destroy){this.spec.destroy()}e.prototype.destroy.call(this)};t.prototype.stopEvent=function e(t){return this.spec.stopEvent?this.spec.stopEvent(t):false};t.prototype.ignoreMutation=function t(r){return this.spec.ignoreMutation?this.spec.ignoreMutation(r):e.prototype.ignoreMutation.call(this,r)};return t}(Xr);function rn(e,t){var r=e.firstChild;for(var n=0;n<t.length;n++){var o=t[n],i=o.dom;if(i.parentNode==e){while(i!=r){r=un(r)}r=r.nextSibling}else{e.insertBefore(i,r)}if(o instanceof Gr){var a=r?r.previousSibling:e.lastChild;rn(o.contentDOM,o.children);r=a?a.nextSibling:e.firstChild}}while(r){r=un(r)}}function nn(e){if(e){this.nodeName=e}}nn.prototype=Object.create(null);var on=[new nn];function an(e,t,r){if(e.length==0){return on}var n=r?on[0]:new nn,o=[n];for(var i=0;i<e.length;i++){var a=e[i].type.attrs,s=n;if(!a){continue}if(a.nodeName){o.push(s=new nn(a.nodeName))}for(var l in a){var c=a[l];if(c==null){continue}if(r&&o.length==1){o.push(s=n=new nn(t.isInline?"span":"div"))}if(l=="class"){s.class=(s.class?s.class+" ":"")+c}else if(l=="style"){s.style=(s.style?s.style+";":"")+c}else if(l!="nodeName"){s[l]=c}}}return o}function sn(e,t,r,n){if(r==on&&n==on){return t}var o=t;for(var i=0;i<n.length;i++){var a=n[i],s=r[i];if(i){var l=void 0;if(s&&s.nodeName==a.nodeName&&o!=e&&(l=o.parentNode)&&l.tagName.toLowerCase()==a.nodeName){o=l}else{l=document.createElement(a.nodeName);l.pmIsDeco=true;l.appendChild(o);s=on[0];o=l}}ln(o,s||on[0],a)}return o}function ln(e,t,r){for(var n in t){if(n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)){e.removeAttribute(n)}}for(var o in r){if(o!="class"&&o!="style"&&o!="nodeName"&&r[o]!=t[o]){e.setAttribute(o,r[o])}}if(t.class!=r.class){var i=t.class?t.class.split(" "):Kr;var a=r.class?r.class.split(" "):Kr;for(var s=0;s<i.length;s++){if(a.indexOf(i[s])==-1){e.classList.remove(i[s])}}for(var l=0;l<a.length;l++){if(i.indexOf(a[l])==-1){e.classList.add(a[l])}}}if(t.style!=r.style){if(t.style){var c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,f;while(f=c.exec(t.style)){e.style.removeProperty(f[1])}}if(r.style){e.style.cssText+=r.style}}}function cn(e,t,r){return sn(e,e,on,an(t,r,e.nodeType!=1))}function fn(e,t){if(e.length!=t.length){return false}for(var r=0;r<e.length;r++){if(!e[r].type.eq(t[r].type)){return false}}return true}function un(e){var t=e.nextSibling;e.parentNode.removeChild(e);return t}var hn=function e(t,r){this.top=t;this.lock=r;this.index=0;this.stack=[];this.changed=false;var n=pn(t.node.content,t.children);this.preMatched=n.nodes;this.preMatchOffset=n.offset};hn.prototype.getPreMatch=function e(t){return t>=this.preMatchOffset?this.preMatched[t-this.preMatchOffset]:null};hn.prototype.destroyBetween=function e(t,r){if(t==r){return}for(var n=t;n<r;n++){this.top.children[n].destroy()}this.top.children.splice(t,r-t);this.changed=true};hn.prototype.destroyRest=function e(){this.destroyBetween(this.index,this.top.children.length)};hn.prototype.syncToMarks=function e(t,r,n){var o=0,i=this.stack.length>>1;var a=Math.min(i,t.length);while(o<a&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&t[o].type.spec.spanning!==false){o++}while(o<i){this.destroyRest();this.top.dirty=Vr;this.index=this.stack.pop();this.top=this.stack.pop();i--}while(i<t.length){this.stack.push(this.top,this.index+1);var s=-1;for(var l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){if(this.top.children[l].matchesMark(t[i])){s=l;break}}if(s>-1){if(s>this.index){this.changed=true;this.destroyBetween(this.index,s)}this.top=this.top.children[this.index]}else{var c=Gr.create(this.top,t[i],r,n);this.top.children.splice(this.index,0,c);this.top=c;this.changed=true}this.index=0;i++}};hn.prototype.findNodeMatch=function e(t,r,n,o){var i=-1,a=o<0?undefined:this.getPreMatch(o),s=this.top.children;if(a&&a.matchesNode(t,r,n)){i=s.indexOf(a)}else{for(var l=this.index,c=Math.min(s.length,l+5);l<c;l++){var f=s[l];if(f.matchesNode(t,r,n)&&this.preMatched.indexOf(f)<0){i=l;break}}}if(i<0){return false}this.destroyBetween(this.index,i);this.index++;return true};hn.prototype.updateNextNode=function e(t,r,n,o,i){for(var a=this.index;a<this.top.children.length;a++){var s=this.top.children[a];if(s instanceof Xr){var l=this.preMatched.indexOf(s);if(l>-1&&l+this.preMatchOffset!=i){return false}var c=s.dom;var f=this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(t.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==t.text&&s.dirty!=Wr&&fn(r,s.outerDeco));if(!f&&s.update(t,r,n,o)){this.destroyBetween(this.index,a);if(s.dom!=c){this.changed=true}this.index++;return true}break}}return false};hn.prototype.addNode=function e(t,r,n,o,i){this.top.children.splice(this.index++,0,Xr.create(this.top,t,r,n,o,i));this.changed=true};hn.prototype.placeWidget=function e(t,r,n){var o=this.index<this.top.children.length?this.top.children[this.index]:null;if(o&&o.matchesWidget(t)&&(t==o.widget||!o.widget.type.toDOM.parentNode)){this.index++}else{var i=new Zr(this.top,t,r,n);this.top.children.splice(this.index++,0,i);this.changed=true}};hn.prototype.addTextblockHacks=function e(){var t=this.top.children[this.index-1];while(t instanceof Gr){t=t.children[t.children.length-1]}if(!t||!(t instanceof Qr)||/\n$/.test(t.node.text)){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack()){this.index++}else{var r=document.createElement("br");this.top.children.splice(this.index++,0,new en(this.top,Kr,r,null));this.changed=true}}};function pn(e,t){var r=[],n=e.childCount;for(var o=t.length-1;n>0&&o>=0;o--){var i=t[o],a=i.node;if(!a){continue}if(a!=e.child(n-1)){break}r.push(i);--n}return{nodes:r.reverse(),offset:n}}function dn(e,t){return e.type.side-t.type.side}function vn(e,t,r,n){var o=t.locals(e),i=0;if(o.length==0){for(var a=0;a<e.childCount;a++){var s=e.child(a);n(s,o,t.forChild(i,s),a);i+=s.nodeSize}return}var l=0,c=[],f=null;for(var u=0;;){if(l<o.length&&o[l].to==i){var h=o[l++],p=void 0;while(l<o.length&&o[l].to==i){(p||(p=[h])).push(o[l++])}if(p){p.sort(dn);for(var d=0;d<p.length;d++){r(p[d],u,!!f)}}else{r(h,u,!!f)}}var v=void 0,m=void 0;if(f){m=-1;v=f;f=null}else if(u<e.childCount){m=u;v=e.child(u++)}else{break}for(var g=0;g<c.length;g++){if(c[g].to<=i){c.splice(g--,1)}}while(l<o.length&&o[l].from<=i&&o[l].to>i){c.push(o[l++])}var y=i+v.nodeSize;if(v.isText){var w=y;if(l<o.length&&o[l].from<w){w=o[l].from}for(var b=0;b<c.length;b++){if(c[b].to<w){w=c[b].to}}if(w<y){f=v.cut(w-i);v=v.cut(0,w-i);y=w;m=-1}}n(v,c.length?c.slice():Kr,t.forChild(i,v),m);i=y}}function mn(e){if(e.nodeName=="UL"||e.nodeName=="OL"){var t=e.style.cssText;e.style.cssText=t+"; list-style: square !important";window.getComputedStyle(e).listStyle;e.style.cssText=t}}function gn(e,t){for(;;){if(e.nodeType==3){return e}if(e.nodeType==1&&t>0){if(e.childNodes.length>t&&e.childNodes[t].nodeType==3){return e.childNodes[t]}e=e.childNodes[t-1];t=ar(e)}else if(e.nodeType==1&&t<e.childNodes.length){e=e.childNodes[t];t=0}else{return null}}}function yn(e,t,r,n){for(var o=0,i=0;o<e.childCount&&i<=n;){var a=e.child(o++),s=i;i+=a.nodeSize;if(!a.isText){continue}var l=a.text;while(o<e.childCount){var c=e.child(o++);i+=c.nodeSize;if(!c.isText){break}l+=c.text}if(i>=r){var f=l.lastIndexOf(t,n-s);if(f>=0&&f+t.length+s>=r){return s+f}}}return-1}function wn(e,t,r,n,o){var i=[];for(var a=0,s=0;a<e.length;a++){var l=e[a],c=s,f=s+=l.size;if(c>=r||f<=t){i.push(l)}else{if(c<t){i.push(l.slice(0,t-c,n))}if(o){i.push(o);o=null}if(f>r){i.push(l.slice(r-c,l.size,n))}}}return i}function bn(e,t){var r=e.selection;var n=r.$anchor;var o=r.$head;var i=t>0?n.max(o):n.min(o);var a=!i.parent.inlineContent?i:i.depth?e.doc.resolve(t>0?i.after():i.before()):null;return a&&Ct.findFrom(a,t)}function Cn(e,t){e.dispatch(e.state.tr.setSelection(t).scrollIntoView());return true}function Mn(e,t,r){var n=e.state.selection;if(n instanceof kt){if(!n.empty||r.indexOf("s")>-1){return false}else if(e.endOfTextblock(t>0?"right":"left")){var o=bn(e.state,t);if(o&&o instanceof Ot){return Cn(e,o)}return false}else if(!(Zt.mac&&r.indexOf("m")>-1)){var i=n.$head,a=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText){return false}var l=t<0?i.pos-a.nodeSize:i.pos;if(!(a.isAtom||(s=e.docView.descAt(l))&&!s.contentDOM)){return false}if(Ot.isSelectable(a)){return Cn(e,new Ot(t<0?e.state.doc.resolve(i.pos-a.nodeSize):i))}else if(Zt.webkit){return Cn(e,new kt(e.state.doc.resolve(t<0?l:l+a.nodeSize)))}else{return false}}}else if(n instanceof Ot&&n.node.isInline){return Cn(e,new kt(t>0?n.$to:n.$from))}else{var c=bn(e.state,t);if(c){return Cn(e,c)}return false}}function xn(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function kn(e){var t=e.pmViewDesc;return t&&t.size==0&&(e.nextSibling||e.nodeName!="BR")}function Sn(e){var t=e.root.getSelection();var r=t.focusNode,n=t.focusOffset;if(!r){return}var o,i,a=false;if(Zt.gecko&&r.nodeType==1&&n<xn(r)&&kn(r.childNodes[n])){a=true}for(;;){if(n>0){if(r.nodeType!=1){break}else{var s=r.childNodes[n-1];if(kn(s)){o=r;i=--n}else if(s.nodeType==3){r=s;n=r.nodeValue.length}else{break}}}else if(Nn(r)){break}else{var l=r.previousSibling;while(l&&kn(l)){o=r.parentNode;i=er(l);l=l.previousSibling}if(!l){r=r.parentNode;if(r==e.dom){break}n=0}else{r=l;n=xn(r)}}}if(a){An(e,t,r,n)}else if(o){An(e,t,o,i)}}function On(e){var t=e.root.getSelection();var r=t.focusNode,n=t.focusOffset;if(!r){return}var o=xn(r);var i,a;for(;;){if(n<o){if(r.nodeType!=1){break}var s=r.childNodes[n];if(kn(s)){i=r;a=++n}else{break}}else if(Nn(r)){break}else{var l=r.nextSibling;while(l&&kn(l)){i=l.parentNode;a=er(l)+1;l=l.nextSibling}if(!l){r=r.parentNode;if(r==e.dom){break}n=o=0}else{r=l;n=0;o=xn(r)}}}if(i){An(e,t,i,a)}}function Nn(e){var t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function An(e,t,r,n){if(cr(t)){var o=document.createRange();o.setEnd(r,n);o.setStart(r,n);t.removeAllRanges();t.addRange(o)}else if(t.extend){t.extend(r,n)}e.domObserver.setCurSelection()}function Dn(e,t,r){var n=e.state.selection;if(n instanceof kt&&!n.empty||r.indexOf("s")>-1){return false}if(Zt.mac&&r.indexOf("m")>-1){return false}var o=n.$from;var i=n.$to;if(!o.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){var a=bn(e.state,t);if(a&&a instanceof Ot){return Cn(e,a)}}if(!o.parent.inlineContent){var s=Ct.findFrom(t<0?o:i,t);return s?Cn(e,s):true}return false}function Tn(e,t){if(!(e.state.selection instanceof kt)){return true}var r=e.state.selection;var n=r.$head;var o=r.$anchor;var i=r.empty;if(!n.sameParent(o)){return true}if(!i){return false}if(e.endOfTextblock(t>0?"forward":"backward")){return true}var a=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){var s=e.state.tr;if(t<0){s.delete(n.pos-a.nodeSize,n.pos)}else{s.delete(n.pos,n.pos+a.nodeSize)}e.dispatch(s);return true}return false}function En(e,t,r){e.domObserver.stop();t.contentEditable=r;e.domObserver.start()}function zn(e){if(!Zt.chrome||e.state.selection.$head.parentOffset>0){return}var t=e.root.getSelection();var r=t.focusNode;var n=t.focusOffset;if(r&&r.nodeType==1&&n==0&&r.firstChild&&r.firstChild.contentEditable=="false"){var o=r.firstChild;En(e,o,true);setTimeout(function(){return En(e,o,false)},20)}}function Rn(e){var t="";if(e.ctrlKey){t+="c"}if(e.metaKey){t+="m"}if(e.altKey){t+="a"}if(e.shiftKey){t+="s"}return t}function Ln(e,t){var r=t.keyCode,n=Rn(t);if(r==8||Zt.mac&&r==72&&n=="c"){return Tn(e,-1)||Sn(e)}else if(r==46||Zt.mac&&r==68&&n=="c"){return Tn(e,1)||On(e)}else if(r==13||r==27){return true}else if(r==37){return Mn(e,-1,n)||Sn(e)}else if(r==39){return Mn(e,1,n)||On(e)}else if(r==38){return Dn(e,-1,n)||Sn(e)}else if(r==40){return zn(e)||Dn(e,1,n)||On(e)}else if(n==(Zt.mac?"m":"c")&&(r==66||r==73||r==89||r==90)){return true}return false}function In(e,t){var r=e.root.getSelection(),n=e.state.doc;if(!r.focusNode){return null}var o=e.docView.nearestDesc(r.focusNode),i=o&&o.size==0;var a=e.docView.posFromDOM(r.focusNode,r.focusOffset);if(a<0){return null}var s=n.resolve(a),l,c;if(cr(r)){l=s;while(o&&!o.node){o=o.parent}if(o&&o.node.isAtom&&Ot.isSelectable(o.node)&&o.parent&&!(o.node.isInline&&sr(r.focusNode,r.focusOffset,o.dom))){var f=o.posBefore;c=new Ot(a==f?s:n.resolve(f))}}else{var u=e.docView.posFromDOM(r.anchorNode,r.anchorOffset);if(u<0){return null}l=n.resolve(u)}if(!c){var h=t=="pointer"||e.state.selection.head<s.pos&&!i?1:-1;c=Hn(e,l,s,h)}return c}function $n(e,t){var r=e.state.selection;jn(e,r);if(e.editable?!e.hasFocus():!(Kn(e)&&document.activeElement&&document.activeElement.contains(e.dom))){return}e.domObserver.disconnectSelection();if(e.cursorWrapper){qn(e)}else{var n=r.anchor;var o=r.head;var i,a;if(Bn&&!(r instanceof kt)){if(!r.$from.parent.inlineContent){i=Fn(e,r.from)}if(!r.empty&&!r.$from.parent.inlineContent){a=Fn(e,r.to)}}e.docView.setSelection(n,o,e.root,t);if(Bn){if(i){_n(i)}if(a){_n(a)}}if(r.visible){e.dom.classList.remove("ProseMirror-hideselection")}else{e.dom.classList.add("ProseMirror-hideselection");if("onselectionchange"in document){Vn(e)}}}e.domObserver.setCurSelection();e.domObserver.connectSelection()}var Bn=Zt.safari||Zt.chrome&&Zt.chrome_version<63;function Fn(e,t){var r=e.docView.domFromPos(t);var n=r.node;var o=r.offset;var i=o<n.childNodes.length?n.childNodes[o]:null;var a=o?n.childNodes[o-1]:null;if(Zt.safari&&i&&i.contentEditable=="false"){return Pn(i)}if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i){return Pn(i)}else if(a){return Pn(a)}}}function Pn(e){e.contentEditable="true";if(Zt.safari&&e.draggable){e.draggable=false;e.wasDraggable=true}return e}function _n(e){e.contentEditable="false";if(e.wasDraggable){e.draggable=true;e.wasDraggable=null}}function Vn(e){var t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.hideSelectionGuard);var r=e.root.getSelection();var n=r.anchorNode,o=r.anchorOffset;t.addEventListener("selectionchange",e.hideSelectionGuard=function(){if(r.anchorNode!=n||r.anchorOffset!=o){t.removeEventListener("selectionchange",e.hideSelectionGuard);e.dom.classList.remove("ProseMirror-hideselection")}})}function qn(e){var t=e.root.getSelection(),r=document.createRange();var n=e.cursorWrapper.dom,o=n.nodeName=="IMG";if(o){r.setEnd(n.parentNode,er(n)+1)}else{r.setEnd(n,0)}r.collapse(false);t.removeAllRanges();t.addRange(r);if(!o&&!e.state.selection.visible&&Zt.ie&&Zt.ie_version<=11){n.disabled=true;n.disabled=false}}function jn(e,t){if(t instanceof Ot){var r=e.docView.descAt(t.from);if(r!=e.lastSelectedViewDesc){Wn(e);if(r){r.selectNode()}e.lastSelectedViewDesc=r}}else{Wn(e)}}function Wn(e){if(e.lastSelectedViewDesc){if(e.lastSelectedViewDesc.parent){e.lastSelectedViewDesc.deselectNode()}e.lastSelectedViewDesc=null}}function Hn(e,t,r,n){return e.someProp("createSelectionBetween",function(n){return n(e,t,r)})||kt.between(t,r,n)}function Jn(e){if(e.editable&&e.root.activeElement!=e.dom){return false}return Kn(e)}function Kn(e){var t=e.root.getSelection();if(!t.anchorNode){return false}try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch(e){return false}}function Zn(e){var t=e.docView.domFromPos(e.state.selection.anchor);var r=e.root.getSelection();return nr(t.node,t.offset,r.anchorNode,r.anchorOffset)}function Un(e,t,r){var n=e.docView.parseRange(t,r);var o=n.node;var i=n.fromOffset;var a=n.toOffset;var s=n.from;var l=n.to;var c=e.root.getSelection(),f=null,u=c.anchorNode;if(u&&e.dom.contains(u.nodeType==1?u:u.parentNode)){f=[{node:u,offset:c.anchorOffset}];if(!cr(c)){f.push({node:c.focusNode,offset:c.focusOffset})}}if(Zt.chrome&&e.lastKeyCode===8){for(var h=a;h>i;h--){var p=o.childNodes[h-1],d=p.pmViewDesc;if(p.nodeType=="BR"&&!d){a=h;break}if(!d||d.size){break}}}var v=e.state.doc;var m=e.someProp("domParser")||ce.fromSchema(e.state.schema);var g=v.resolve(s);var y=null,w=m.parse(o,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:true,from:i,to:a,preserveWhitespace:g.parent.type.spec.code?"full":true,editableContent:true,findPositions:f,ruleFromNode:Gn,context:g});if(f&&f[0].pos!=null){var b=f[0].pos,C=f[1]&&f[1].pos;if(C==null){C=b}y={anchor:b+s,head:C+s}}return{doc:w,sel:y,from:s,to:l}}function Gn(e){var t=e.pmViewDesc;if(t){return t.parseRule()}else if(e.nodeName=="BR"&&e.parentNode){if(Zt.safari&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){var r=document.createElement("div");r.appendChild(document.createElement("li"));return{skip:r}}else if(e.parentNode.lastChild==e||Zt.safari&&/^(tr|table)$/i.test(e.parentNode.nodeName)){return{ignore:true}}}else if(e.nodeName=="IMG"&&e.getAttribute("mark-placeholder")){return{ignore:true}}}function Xn(e,t,r,n,o){if(t<0){var i=e.lastSelectionTime>Date.now()-50?e.lastSelectionOrigin:null;var a=In(e,i);if(a&&!e.state.selection.eq(a)){var s=e.state.tr.setSelection(a);if(i=="pointer"){s.setMeta("pointer",true)}else if(i=="key"){s.scrollIntoView()}e.dispatch(s)}return}var l=e.state.doc.resolve(t);var c=l.sharedDepth(r);t=l.before(c+1);r=e.state.doc.resolve(r).after(c+1);var f=e.state.selection;var u=Un(e,t,r);var h=e.state.doc,p=h.slice(u.from,u.to);var d,v;if(e.lastKeyCode===8&&Date.now()-100<e.lastKeyCodeTime){d=e.state.selection.to;v="end"}else{d=e.state.selection.from;v="start"}e.lastKeyCode=null;var m=ro(p.content,u.doc.content,u.from,d,v);if(!m){if(n&&f instanceof kt&&!f.empty&&f.$head.sameParent(f.$anchor)&&!e.composing&&!(u.sel&&u.sel.anchor!=u.sel.head)){m={start:f.from,endA:f.to,endB:f.to}}else{if(u.sel){var g=Yn(e,e.state.doc,u.sel);if(g&&!g.eq(e.state.selection)){e.dispatch(e.state.tr.setSelection(g))}}return}}e.domChangeCount++;if(e.state.selection.from<e.state.selection.to&&m.start==m.endB&&e.state.selection instanceof kt){if(m.start>e.state.selection.from&&m.start<=e.state.selection.from+2){m.start=e.state.selection.from}else if(m.endA<e.state.selection.to&&m.endA>=e.state.selection.to-2){m.endB+=e.state.selection.to-m.endA;m.endA=e.state.selection.to}}if(Zt.ie&&Zt.ie_version<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)==" "){m.start--;m.endA--;m.endB--}var y=u.doc.resolveNoCache(m.start-u.from);var w=u.doc.resolveNoCache(m.endB-u.from);var b=y.sameParent(w)&&y.parent.inlineContent;var C;if((Zt.ios&&e.lastIOSEnter>Date.now()-100&&(!b||o.some(function(e){return e.nodeName=="DIV"||e.nodeName=="P"}))||!b&&y.pos<u.doc.content.size&&(C=Ct.findFrom(u.doc.resolve(y.pos+1),1,true))&&C.head==w.pos)&&e.someProp("handleKeyDown",function(t){return t(e,fr(13,"Enter"))})){e.lastIOSEnter=0;return}if(e.state.selection.anchor>m.start&&eo(h,m.start,m.endA,y,w)&&e.someProp("handleKeyDown",function(t){return t(e,fr(8,"Backspace"))})){if(Zt.android&&Zt.chrome){e.domObserver.suppressSelectionUpdates()}return}if(Zt.android&&!b&&y.start()!=w.start()&&w.parentOffset==0&&y.depth==w.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA){m.endB-=2;w=u.doc.resolveNoCache(m.endB-u.from);setTimeout(function(){e.someProp("handleKeyDown",function(t){return t(e,fr(13,"Enter"))})},20)}var M=m.start,x=m.endA;var k,S,O,N;if(b){if(y.pos==w.pos){if(Zt.ie&&Zt.ie_version<=11&&y.parentOffset==0){e.domObserver.suppressSelectionUpdates();setTimeout(function(){return $n(e)},20)}k=e.state.tr.delete(M,x);S=h.resolve(m.start).marksAcross(h.resolve(m.endA))}else if(m.endA==m.endB&&(N=h.resolve(m.start))&&(O=Qn(y.parent.content.cut(y.parentOffset,w.parentOffset),N.parent.content.cut(N.parentOffset,m.endA-N.start())))){k=e.state.tr;if(O.type=="add"){k.addMark(M,x,O.mark)}else{k.removeMark(M,x,O.mark)}}else if(y.parent.child(y.index()).isText&&y.index()==w.index()-(w.textOffset?0:1)){var A=y.parent.textBetween(y.parentOffset,w.parentOffset);if(e.someProp("handleTextInput",function(t){return t(e,M,x,A)})){return}k=e.state.tr.insertText(A,M,x)}}if(!k){k=e.state.tr.replace(M,x,u.doc.slice(m.start-u.from,m.endB-u.from))}if(u.sel){var D=Yn(e,k.doc,u.sel);if(D&&!(Zt.chrome&&Zt.android&&e.composing&&D.empty&&(D.head==M||D.head==k.mapping.map(x)-1)||Zt.ie&&D.empty&&D.head==M)){k.setSelection(D)}}if(S){k.ensureMarks(S)}e.dispatch(k.scrollIntoView())}function Yn(e,t,r){if(Math.max(r.anchor,r.head)>t.content.size){return null}return Hn(e,t.resolve(r.anchor),t.resolve(r.head))}function Qn(e,t){var r=e.firstChild.marks,n=t.firstChild.marks;var i=r,a=n,s,l,c;for(var f=0;f<n.length;f++){i=n[f].removeFromSet(i)}for(var u=0;u<r.length;u++){a=r[u].removeFromSet(a)}if(i.length==1&&a.length==0){l=i[0];s="add";c=function(e){return e.mark(l.addToSet(e.marks))}}else if(i.length==0&&a.length==1){l=a[0];s="remove";c=function(e){return e.mark(l.removeFromSet(e.marks))}}else{return null}var h=[];for(var p=0;p<t.childCount;p++){h.push(c(t.child(p)))}if(o.from(h).eq(e)){return{mark:l,type:s}}}function eo(e,t,r,n,o){if(!n.parent.isTextblock||r-t<=o.pos-n.pos||to(n,true,false)<o.pos){return false}var i=e.resolve(t);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock){return false}var a=e.resolve(to(i,true,true));if(!a.parent.isTextblock||a.pos>r||to(a,true,false)<r){return false}return n.parent.content.cut(n.parentOffset).eq(a.parent.content)}function to(e,t,r){var n=e.depth,o=t?e.end():e.pos;while(n>0&&(t||e.indexAfter(n)==e.node(n).childCount)){n--;o++;t=false}if(r){var i=e.node(n).maybeChild(e.indexAfter(n));while(i&&!i.isLeaf){i=i.firstChild;o++}}return o}function ro(e,t,r,n,o){var i=e.findDiffStart(t,r);if(i==null){return null}var a=e.findDiffEnd(t,r+e.size,r+t.size);var s=a.a;var l=a.b;if(o=="end"){var c=Math.max(0,i-Math.min(s,l));n-=s+c-i}if(s<i&&e.size<t.size){var f=n<=i&&n>=s?i-n:0;i-=f;l=i+(l-s);s=i}else if(l<i){var u=n<=i&&n>=l?i-n:0;i-=u;s=i+(s-l);l=i}return{start:i,endA:s,endB:l}}function no(e,t){var r=[];var n=t.content;var o=t.openStart;var i=t.openEnd;while(o>1&&i>1&&n.childCount==1&&n.firstChild.childCount==1){o--;i--;var a=n.firstChild;r.push(a.type.name,a.type.hasRequiredAttrs()?a.attrs:null);n=a.content}var s=e.someProp("clipboardSerializer")||Se.fromSchema(e.state.schema);var l=po(),c=l.createElement("div");c.appendChild(s.serializeFragment(n,{document:l}));var f=c.firstChild,u;while(f&&f.nodeType==1&&(u=uo[f.nodeName.toLowerCase()])){for(var h=u.length-1;h>=0;h--){var p=l.createElement(u[h]);while(c.firstChild){p.appendChild(c.firstChild)}c.appendChild(p)}f=c.firstChild}if(f&&f.nodeType==1){f.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(r))}var d=e.someProp("clipboardTextSerializer",function(e){return e(t)})||t.content.textBetween(0,t.content.size,"\n\n");return{dom:c,text:d}}function oo(e,t,r,n,i){var a,s=i.parent.type.spec.code,l;if(!r&&!t){return null}var c=t&&(n||s||!r);if(c){e.someProp("transformPastedText",function(e){t=e(t)});if(s){return new u(o.from(e.state.schema.text(t)),0,0)}var f=e.someProp("clipboardTextParser",function(e){return e(t,i)});if(f){l=f}else{a=document.createElement("div");t.trim().split(/(?:\r\n?|\n)+/).forEach(function(e){a.appendChild(document.createElement("p")).textContent=e})}}else{e.someProp("transformPastedHTML",function(e){r=e(r)});a=vo(r)}var h=a&&a.querySelector("[data-pm-slice]");var p=h&&/^(\d+) (\d+) (.*)/.exec(h.getAttribute("data-pm-slice"));if(!l){var d=e.someProp("clipboardParser")||e.someProp("domParser")||ce.fromSchema(e.state.schema);l=d.parseSlice(a,{preserveWhitespace:!!(c||p),context:i})}if(p){l=mo(fo(l,+p[1],+p[2]),p[3])}else{l=u.maxOpen(io(l.content,i),false)}e.someProp("transformPasted",function(e){l=e(l)});return l}function io(e,t){if(e.childCount<2){return e}var r=function(r){var n=t.node(r);var i=n.contentMatchAt(t.index(r));var a=void 0,s=[];e.forEach(function(e){if(!s){return}var t=i.findWrapping(e.type),r;if(!t){return s=null}if(r=s.length&&a.length&&so(t,a,e,s[s.length-1],0)){s[s.length-1]=r}else{if(s.length){s[s.length-1]=lo(s[s.length-1],a.length)}var n=ao(e,t);s.push(n);i=i.matchType(n.type,n.attrs);a=t}});if(s){return{v:o.from(s)}}};for(var n=t.depth;n>=0;n--){var i=r(n);if(i)return i.v}return e}function ao(e,t,r){if(r===void 0)r=0;for(var n=t.length-1;n>=r;n--){e=t[n].create(null,o.from(e))}return e}function so(e,t,r,n,i){if(i<e.length&&i<t.length&&e[i]==t[i]){var a=so(e,t,r,n.lastChild,i+1);if(a){return n.copy(n.content.replaceChild(n.childCount-1,a))}var s=n.contentMatchAt(n.childCount);if(s.matchType(i==e.length-1?r.type:e[i+1])){return n.copy(n.content.append(o.from(ao(r,e,i+1))))}}}function lo(e,t){if(t==0){return e}var r=e.content.replaceChild(e.childCount-1,lo(e.lastChild,t-1));var n=e.contentMatchAt(e.childCount).fillBefore(o.empty,true);return e.copy(r.append(n))}function co(e,t,r,n,i,a){var s=t<0?e.firstChild:e.lastChild,l=s.content;if(i<n-1){l=co(l,t,r,n,i+1,a)}if(i>=r){l=t<0?s.contentMatchAt(0).fillBefore(l,e.childCount>1||a<=i).append(l):l.append(s.contentMatchAt(s.childCount).fillBefore(o.empty,true))}return e.replaceChild(t<0?0:e.childCount-1,s.copy(l))}function fo(e,t,r){if(t<e.openStart){e=new u(co(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)}if(r<e.openEnd){e=new u(co(e.content,1,r,e.openEnd,0,0),e.openStart,r)}return e}var uo={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};var ho=null;function po(){return ho||(ho=document.implementation.createHTMLDocument("title"))}function vo(e){var t=/(\s*<meta [^>]*>)*/.exec(e);if(t){e=e.slice(t[0].length)}var r=po().createElement("div");var n=/(?:<meta [^>]*>)*<([a-z][^>\s]+)/i.exec(e),o,i=0;if(o=n&&uo[n[1].toLowerCase()]){e=o.map(function(e){return"<"+e+">"}).join("")+e+o.map(function(e){return"</"+e+">"}).reverse().join("");i=o.length}r.innerHTML=e;for(var a=0;a<i;a++){r=r.firstChild}return r}function mo(e,t){if(!e.size){return e}var r=e.content.firstChild.type.schema,n;try{n=JSON.parse(t)}catch(t){return e}var i=e.content;var a=e.openStart;var s=e.openEnd;for(var l=n.length-2;l>=0;l-=2){var c=r.nodes[n[l]];if(!c||c.hasRequiredAttrs()){break}i=o.from(c.create(n[l+1],i));a++;s++}return new u(i,a,s)}var go={childList:true,characterData:true,characterDataOldValue:true,attributes:true,attributeOldValue:true,subtree:true};var yo=Zt.ie&&Zt.ie_version<=11;var wo=function e(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};wo.prototype.set=function e(t){this.anchorNode=t.anchorNode;this.anchorOffset=t.anchorOffset;this.focusNode=t.focusNode;this.focusOffset=t.focusOffset};wo.prototype.eq=function e(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var bo=function e(t,r){var n=this;this.view=t;this.handleDOMChange=r;this.queue=[];this.flushingSoon=-1;this.observer=window.MutationObserver&&new window.MutationObserver(function(e){for(var t=0;t<e.length;t++){n.queue.push(e[t])}if(Zt.ie&&Zt.ie_version<=11&&e.some(function(e){return e.type=="childList"&&e.removedNodes.length||e.type=="characterData"&&e.oldValue.length>e.target.nodeValue.length})){n.flushSoon()}else{n.flush()}});this.currentSelection=new wo;if(yo){this.onCharData=function(e){n.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue});n.flushSoon()}}this.onSelectionChange=this.onSelectionChange.bind(this);this.suppressingSelectionUpdates=false};bo.prototype.flushSoon=function e(){var t=this;if(this.flushingSoon<0){this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1;t.flush()},20)}};bo.prototype.forceFlush=function e(){if(this.flushingSoon>-1){window.clearTimeout(this.flushingSoon);this.flushingSoon=-1;this.flush()}};bo.prototype.start=function e(){if(this.observer){this.observer.observe(this.view.dom,go)}if(yo){this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData)}this.connectSelection()};bo.prototype.stop=function e(){var t=this;if(this.observer){var r=this.observer.takeRecords();if(r.length){for(var n=0;n<r.length;n++){this.queue.push(r[n])}window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}if(yo){this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)}this.disconnectSelection()};bo.prototype.connectSelection=function e(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};bo.prototype.disconnectSelection=function e(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};bo.prototype.suppressSelectionUpdates=function e(){var t=this;this.suppressingSelectionUpdates=true;setTimeout(function(){return t.suppressingSelectionUpdates=false},50)};bo.prototype.onSelectionChange=function e(){if(!Jn(this.view)){return}if(this.suppressingSelectionUpdates){return $n(this.view)}if(Zt.ie&&Zt.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&nr(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)){return this.flushSoon()}}this.flush()};bo.prototype.setCurSelection=function e(){this.currentSelection.set(this.view.root.getSelection())};bo.prototype.ignoreSelectionChange=function e(t){if(t.rangeCount==0){return true}var r=t.getRangeAt(0).commonAncestorContainer;var n=this.view.docView.nearestDesc(r);if(n&&n.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r})){this.setCurSelection();return true}};bo.prototype.flush=function e(){if(!this.view.docView||this.flushingSoon>-1){return}var t=this.observer?this.observer.takeRecords():[];if(this.queue.length){t=this.queue.concat(t);this.queue.length=0}var r=this.view.root.getSelection();var n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Kn(this.view);var o=-1,i=-1,a=false,s=[];if(this.view.editable){for(var l=0;l<t.length;l++){var c=this.registerMutation(t[l],s);if(c){o=o<0?c.from:Math.min(c.from,o);i=i<0?c.to:Math.max(c.to,i);if(c.typeOver){a=true}}}}if(Zt.gecko&&s.length>1){var f=s.filter(function(e){return e.nodeName=="BR"});if(f.length==2){var u=f[0];var h=f[1];if(u.parentNode&&u.parentNode.parentNode==h.parentNode){h.remove()}else{u.remove()}}}if(o>-1||n){if(o>-1){this.view.docView.markDirty(o,i);Mo(this.view)}this.handleDOMChange(o,i,a,s);if(this.view.docView.dirty){this.view.updateState(this.view.state)}else if(!this.currentSelection.eq(r)){$n(this.view)}}};bo.prototype.registerMutation=function e(t,r){if(r.indexOf(t.target)>-1){return null}var n=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(n==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))){return null}if(!n||n.ignoreMutation(t)){return null}if(t.type=="childList"){var o=t.previousSibling,i=t.nextSibling;if(Zt.ie&&Zt.ie_version<=11&&t.addedNodes.length){for(var a=0;a<t.addedNodes.length;a++){var s=t.addedNodes[a];var l=s.previousSibling;var c=s.nextSibling;if(!l||Array.prototype.indexOf.call(t.addedNodes,l)<0){o=l}if(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0){i=c}}}var f=o&&o.parentNode==t.target?er(o)+1:0;var u=n.localPosFromDOM(t.target,f,-1);var h=i&&i.parentNode==t.target?er(i):t.target.childNodes.length;for(var p=0;p<t.addedNodes.length;p++){r.push(t.addedNodes[p])}var d=n.localPosFromDOM(t.target,h,1);return{from:u,to:d}}else if(t.type=="attributes"){return{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}}else{return{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}}};var Co=false;function Mo(e){if(Co){return}Co=true;if(getComputedStyle(e.dom).whiteSpace=="normal"){console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package.")}}var xo={},ko={};function So(e){e.shiftKey=false;e.mouseDown=null;e.lastKeyCode=null;e.lastKeyCodeTime=0;e.lastClick={time:0,x:0,y:0,type:""};e.lastSelectionOrigin=null;e.lastSelectionTime=0;e.lastIOSEnter=0;e.composing=false;e.composingTimeout=null;e.compositionNodes=[];e.compositionEndedAt=-2e8;e.domObserver=new bo(e,function(t,r,n,o){return Xn(e,t,r,n,o)});e.domObserver.start();e.domChangeCount=0;e.eventHandlers=Object.create(null);var t=function(t){var r=xo[t];e.dom.addEventListener(t,e.eventHandlers[t]=function(t){if(To(e,t)&&!Do(e,t)&&(e.editable||!(t.type in ko))){r(e,t)}})};for(var r in xo)t(r);if(Zt.safari){e.dom.addEventListener("input",function(){return null})}Ao(e)}function Oo(e,t){e.lastSelectionOrigin=t;e.lastSelectionTime=Date.now()}function No(e){e.domObserver.stop();for(var t in e.eventHandlers){e.dom.removeEventListener(t,e.eventHandlers[t])}clearTimeout(e.composingTimeout)}function Ao(e){e.someProp("handleDOMEvents",function(t){for(var r in t){if(!e.eventHandlers[r]){e.dom.addEventListener(r,e.eventHandlers[r]=function(t){return Do(e,t)})}}})}function Do(e,t){return e.someProp("handleDOMEvents",function(r){var n=r[t.type];return n?n(e,t)||t.defaultPrevented:false})}function To(e,t){if(!t.bubbles){return true}if(t.defaultPrevented){return false}for(var r=t.target;r!=e.dom;r=r.parentNode){if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(t)){return false}}return true}function Eo(e,t){if(!Do(e,t)&&xo[t.type]&&(e.editable||!(t.type in ko))){xo[t.type](e,t)}}ko.keydown=function(e,t){e.shiftKey=t.keyCode==16||t.shiftKey;if(Ho(e,t)){return}e.domObserver.forceFlush();e.lastKeyCode=t.keyCode;e.lastKeyCodeTime=Date.now();if(Zt.ios&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var r=Date.now();e.lastIOSEnter=r;setTimeout(function(){if(e.lastIOSEnter==r){e.someProp("handleKeyDown",function(t){return t(e,fr(13,"Enter"))});e.lastIOSEnter=0}},50)}else if(e.someProp("handleKeyDown",function(r){return r(e,t)})||Ln(e,t)){t.preventDefault()}else{Oo(e,"key")}};ko.keyup=function(e,t){if(t.keyCode==16){e.shiftKey=false}};ko.keypress=function(e,t){if(Ho(e,t)||!t.charCode||t.ctrlKey&&!t.altKey||Zt.mac&&t.metaKey){return}if(e.someProp("handleKeyPress",function(r){return r(e,t)})){t.preventDefault();return}var r=e.state.selection;if(!(r instanceof kt)||!r.$from.sameParent(r.$to)){var n=String.fromCharCode(t.charCode);if(!e.someProp("handleTextInput",function(t){return t(e,r.$from.pos,r.$to.pos,n)})){e.dispatch(e.state.tr.insertText(n).scrollIntoView())}t.preventDefault()}};function zo(e){return{left:e.clientX,top:e.clientY}}function Ro(e,t){var r=t.x-e.clientX,n=t.y-e.clientY;return r*r+n*n<100}function Lo(e,t,r,n,o){if(n==-1){return false}var i=e.state.doc.resolve(n);var a=function(n){if(e.someProp(t,function(t){return n>i.depth?t(e,r,i.nodeAfter,i.before(n),o,true):t(e,r,i.node(n),i.before(n),o,false)})){return{v:true}}};for(var s=i.depth+1;s>0;s--){var l=a(s);if(l)return l.v}return false}function Io(e,t,r){if(!e.focused){e.focus()}var n=e.state.tr.setSelection(t);if(r=="pointer"){n.setMeta("pointer",true)}e.dispatch(n)}function $o(e,t){if(t==-1){return false}var r=e.state.doc.resolve(t),n=r.nodeAfter;if(n&&n.isAtom&&Ot.isSelectable(n)){Io(e,new Ot(r),"pointer");return true}return false}function Bo(e,t){if(t==-1){return false}var r=e.state.selection,n,o;if(r instanceof Ot){n=r.node}var i=e.state.doc.resolve(t);for(var a=i.depth+1;a>0;a--){var s=a>i.depth?i.nodeAfter:i.node(a);if(Ot.isSelectable(s)){if(n&&r.$from.depth>0&&a>=r.$from.depth&&i.before(r.$from.depth+1)==r.$from.pos){o=i.before(r.$from.depth)}else{o=i.before(a)}break}}if(o!=null){Io(e,Ot.create(e.state.doc,o),"pointer");return true}else{return false}}function Fo(e,t,r,n,o){return Lo(e,"handleClickOn",t,r,n)||e.someProp("handleClick",function(r){return r(e,t,n)})||(o?Bo(e,r):$o(e,r))}function Po(e,t,r,n){return Lo(e,"handleDoubleClickOn",t,r,n)||e.someProp("handleDoubleClick",function(r){return r(e,t,n)})}function _o(e,t,r,n){return Lo(e,"handleTripleClickOn",t,r,n)||e.someProp("handleTripleClick",function(r){return r(e,t,n)})||Vo(e,r)}function Vo(e,t){var r=e.state.doc;if(t==-1){if(r.inlineContent){Io(e,kt.create(r,0,r.content.size),"pointer");return true}return false}var n=r.resolve(t);for(var o=n.depth+1;o>0;o--){var i=o>n.depth?n.nodeAfter:n.node(o);var a=n.before(o);if(i.inlineContent){Io(e,kt.create(r,a+1,a+1+i.content.size),"pointer")}else if(Ot.isSelectable(i)){Io(e,Ot.create(r,a),"pointer")}else{continue}return true}}function qo(e){return Zo(e)}var jo=Zt.mac?"metaKey":"ctrlKey";xo.mousedown=function(e,t){e.shiftKey=t.shiftKey;var r=qo(e);var n=Date.now(),o="singleClick";if(n-e.lastClick.time<500&&Ro(t,e.lastClick)&&!t[jo]){if(e.lastClick.type=="singleClick"){o="doubleClick"}else if(e.lastClick.type=="doubleClick"){o="tripleClick"}}e.lastClick={time:n,x:t.clientX,y:t.clientY,type:o};var i=e.posAtCoords(zo(t));if(!i){return}if(o=="singleClick"){e.mouseDown=new Wo(e,i,t,r)}else if((o=="doubleClick"?Po:_o)(e,i.pos,i.inside,t)){t.preventDefault()}else{Oo(e,"pointer")}};var Wo=function e(t,r,n,o){var i=this;this.view=t;this.startDoc=t.state.doc;this.pos=r;this.event=n;this.flushed=o;this.selectNode=n[jo];this.allowDefault=n.shiftKey;var a,s;if(r.inside>-1){a=t.state.doc.nodeAt(r.inside);s=r.inside}else{var l=t.state.doc.resolve(r.pos);a=l.parent;s=l.depth?l.before():0}this.mightDrag=null;var c=o?null:n.target;var f=c?t.docView.nearestDesc(c,true):null;this.target=f?f.dom:null;if(a.type.spec.draggable&&a.type.spec.selectable!==false||t.state.selection instanceof Ot&&s==t.state.selection.from){this.mightDrag={node:a,pos:s,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&Zt.gecko&&!this.target.hasAttribute("contentEditable")}}if(this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)){this.view.domObserver.stop();if(this.mightDrag.addAttr){this.target.draggable=true}if(this.mightDrag.setUneditable){setTimeout(function(){return i.target.setAttribute("contentEditable","false")},20)}this.view.domObserver.start()}t.root.addEventListener("mouseup",this.up=this.up.bind(this));t.root.addEventListener("mousemove",this.move=this.move.bind(this));Oo(t,"pointer")};Wo.prototype.done=function e(){this.view.root.removeEventListener("mouseup",this.up);this.view.root.removeEventListener("mousemove",this.move);if(this.mightDrag&&this.target){this.view.domObserver.stop();if(this.mightDrag.addAttr){this.target.removeAttribute("draggable")}if(this.mightDrag.setUneditable){this.target.removeAttribute("contentEditable")}this.view.domObserver.start()}this.view.mouseDown=null};Wo.prototype.up=function e(t){this.done();if(!this.view.dom.contains(t.target.nodeType==3?t.target.parentNode:t.target)){return}var r=this.pos;if(this.view.state.doc!=this.startDoc){r=this.view.posAtCoords(zo(t))}if(this.allowDefault||!r){Oo(this.view,"pointer")}else if(Fo(this.view,r.pos,r.inside,t,this.selectNode)){t.preventDefault()}else if(this.flushed||Zt.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||Zt.chrome&&!(this.view.state.selection instanceof kt)&&(r.pos==this.view.state.selection.from||r.pos==this.view.state.selection.to)){Io(this.view,Ct.near(this.view.state.doc.resolve(r.pos)),"pointer");t.preventDefault()}else{Oo(this.view,"pointer")}};Wo.prototype.move=function e(t){if(!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)){this.allowDefault=true}Oo(this.view,"pointer")};xo.touchdown=function(e){qo(e);Oo(e,"pointer")};xo.contextmenu=function(e){return qo(e)};function Ho(e,t){if(e.composing){return true}if(Zt.safari&&Math.abs(t.timeStamp-e.compositionEndedAt)<500){e.compositionEndedAt=-2e8;return true}return false}var Jo=Zt.android?5e3:-1;ko.compositionstart=ko.compositionupdate=function(e){if(!e.composing){e.domObserver.flush();var t=e.state;var r=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(function(e){return e.type.spec.inclusive===false}))){e.markCursor=e.state.storedMarks||r.marks();Zo(e,true);e.markCursor=null}else{Zo(e);if(Zt.gecko&&t.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){var n=e.root.getSelection();for(var o=n.focusNode,i=n.focusOffset;o&&o.nodeType==1&&i!=0;){var a=i<0?o.lastChild:o.childNodes[i-1];if(!a){break}if(a.nodeType==3){n.collapse(a,a.nodeValue.length);break}else{o=a;i=-1}}}}e.composing=true}Ko(e,Jo)};ko.compositionend=function(e,t){if(e.composing){e.composing=false;e.compositionEndedAt=t.timeStamp;Ko(e,20)}};function Ko(e,t){clearTimeout(e.composingTimeout);if(t>-1){e.composingTimeout=setTimeout(function(){return Zo(e)},t)}}function Zo(e,t){e.domObserver.forceFlush();e.composing=false;while(e.compositionNodes.length>0){e.compositionNodes.pop().markParentsDirty()}if(t||e.docView.dirty){var r=In(e);if(r&&!r.eq(e.state.selection)){e.dispatch(e.state.tr.setSelection(r))}else{e.updateState(e.state)}return true}return false}function Uo(e,t){if(!e.dom.parentNode){return}var r=e.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(t);r.style.cssText="position: fixed; left: -10000px; top: 10px";var n=getSelection(),o=document.createRange();o.selectNodeContents(t);e.dom.blur();n.removeAllRanges();n.addRange(o);setTimeout(function(){if(r.parentNode){r.parentNode.removeChild(r)}e.focus()},50)}var Go=Zt.ie&&Zt.ie_version<15||Zt.ios&&Zt.webkit_version<604;xo.copy=ko.cut=function(e,t){var r=e.state.selection,n=t.type=="cut";if(r.empty){return}var o=Go?null:t.clipboardData;var i=r.content();var a=no(e,i);var s=a.dom;var l=a.text;if(o){t.preventDefault();o.clearData();o.setData("text/html",s.innerHTML);o.setData("text/plain",l)}else{Uo(e,s)}if(n){e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function Xo(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function Yo(e,t){if(!e.dom.parentNode){return}var r=e.shiftKey||e.state.selection.$from.parent.type.spec.code;var n=e.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));if(!r){n.contentEditable="true"}n.style.cssText="position: fixed; left: -10000px; top: 10px";n.focus();setTimeout(function(){e.focus();if(n.parentNode){n.parentNode.removeChild(n)}if(r){Qo(e,n.value,null,t)}else{Qo(e,n.textContent,n.innerHTML,t)}},50)}function Qo(e,t,r,n){var o=oo(e,t,r,e.shiftKey,e.state.selection.$from);if(e.someProp("handlePaste",function(t){return t(e,n,o||u.empty)})||!o){return}var i=Xo(o);var a=i?e.state.tr.replaceSelectionWith(i,e.shiftKey):e.state.tr.replaceSelection(o);e.dispatch(a.scrollIntoView().setMeta("paste",true).setMeta("uiEvent","paste"))}ko.paste=function(e,t){var r=Go?null:t.clipboardData;var n=r&&r.getData("text/html"),o=r&&r.getData("text/plain");if(r&&(n||o||r.files.length)){Qo(e,o,n,t);t.preventDefault()}else{Yo(e,t)}};var ei=function e(t,r){this.slice=t;this.move=r};var ti=Zt.mac?"altKey":"ctrlKey";xo.dragstart=function(e,t){var r=e.mouseDown;if(r){r.done()}if(!t.dataTransfer){return}var n=e.state.selection;var o=n.empty?null:e.posAtCoords(zo(t));if(o&&o.pos>=n.from&&o.pos<=(n instanceof Ot?n.to-1:n.to));else if(r&&r.mightDrag){e.dispatch(e.state.tr.setSelection(Ot.create(e.state.doc,r.mightDrag.pos)))}else if(t.target&&t.target.nodeType==1){var i=e.docView.nearestDesc(t.target,true);if(!i||!i.node.type.spec.draggable||i==e.docView){return}e.dispatch(e.state.tr.setSelection(Ot.create(e.state.doc,i.posBefore)))}var a=e.state.selection.content();var s=no(e,a);var l=s.dom;var c=s.text;t.dataTransfer.clearData();t.dataTransfer.setData(Go?"Text":"text/html",l.innerHTML);if(!Go){t.dataTransfer.setData("text/plain",c)}e.dragging=new ei(a,!t[ti])};xo.dragend=function(e){window.setTimeout(function(){return e.dragging=null},50)};ko.dragover=ko.dragenter=function(e,t){return t.preventDefault()};ko.drop=function(e,t){var r=e.dragging;e.dragging=null;if(!t.dataTransfer){return}var n=e.posAtCoords(zo(t));if(!n){return}var o=e.state.doc.resolve(n.pos);if(!o){return}var i=r&&r.slice||oo(e,t.dataTransfer.getData(Go?"Text":"text/plain"),Go?null:t.dataTransfer.getData("text/html"),false,o);if(e.someProp("handleDrop",function(n){return n(e,t,i||u.empty,r&&r.move)})){t.preventDefault();return}if(!i){return}t.preventDefault();var a=i?ot(e.state.doc,o.pos,i):o.pos;if(a==null){a=o.pos}var s=e.state.tr;if(r&&r.move){s.deleteSelection()}var l=s.mapping.map(a);var c=i.openStart==0&&i.openEnd==0&&i.content.childCount==1;var f=s.doc;if(c){s.replaceRangeWith(l,l,i.content.firstChild)}else{s.replaceRange(l,l,i)}if(s.doc.eq(f)){return}var h=s.doc.resolve(l);if(c&&Ot.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild)){s.setSelection(new Ot(h))}else{s.setSelection(Hn(e,h,s.doc.resolve(s.mapping.map(a))))}e.focus();e.dispatch(s.setMeta("uiEvent","drop"))};xo.focus=function(e){if(!e.focused){e.domObserver.stop();e.dom.classList.add("ProseMirror-focused");e.domObserver.start();e.focused=true;setTimeout(function(){if(e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.root.getSelection())){$n(e)}},20)}};xo.blur=function(e){if(e.focused){e.domObserver.stop();e.dom.classList.remove("ProseMirror-focused");e.domObserver.start();e.domObserver.currentSelection.set({});e.focused=false}};xo.beforeinput=function(e,t){if(Zt.chrome&&Zt.android&&t.inputType=="deleteContentBackward"){var r=e.domChangeCount;setTimeout(function(){if(e.domChangeCount!=r){return}e.dom.blur();e.focus();if(e.someProp("handleKeyDown",function(t){return t(e,fr(8,"Backspace"))})){return}var t=e.state.selection;var n=t.$cursor;if(n&&n.pos>0){e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}},50)}};for(var ri in ko){xo[ri]=ko[ri]}function ni(e,t){if(e==t){return true}for(var r in e){if(e[r]!==t[r]){return false}}for(var n in t){if(!(n in e)){return false}}return true}var oi=function e(t,r){this.spec=r||fi;this.side=this.spec.side||0;this.toDOM=t};oi.prototype.map=function e(t,r,n,o){var i=t.mapResult(r.from+o,this.side<0?-1:1);var a=i.pos;var s=i.deleted;return s?null:new si(a-n,a-n,this)};oi.prototype.valid=function e(){return true};oi.prototype.eq=function e(t){return this==t||t instanceof oi&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&ni(this.spec,t.spec))};var ii=function e(t,r){this.spec=r||fi;this.attrs=t};ii.prototype.map=function e(t,r,n,o){var i=t.map(r.from+o,this.spec.inclusiveStart?-1:1)-n;var a=t.map(r.to+o,this.spec.inclusiveEnd?1:-1)-n;return i>=a?null:new si(i,a,this)};ii.prototype.valid=function e(t,r){return r.from<r.to};ii.prototype.eq=function e(t){return this==t||t instanceof ii&&ni(this.attrs,t.attrs)&&ni(this.spec,t.spec)};ii.is=function e(t){return t.type instanceof ii};var ai=function e(t,r){this.spec=r||fi;this.attrs=t};ai.prototype.map=function e(t,r,n,o){var i=t.mapResult(r.from+o,1);if(i.deleted){return null}var a=t.mapResult(r.to+o,-1);if(a.deleted||a.pos<=i.pos){return null}return new si(i.pos-n,a.pos-n,this)};ai.prototype.valid=function e(t,r){var n=t.content.findIndex(r.from);var o=n.index;var i=n.offset;return i==r.from&&i+t.child(o).nodeSize==r.to};ai.prototype.eq=function e(t){return this==t||t instanceof ai&&ni(this.attrs,t.attrs)&&ni(this.spec,t.spec)};var si=function e(t,r,n){this.from=t;this.to=r;this.type=n};var li={spec:{configurable:true}};si.prototype.copy=function e(t,r){return new si(t,r,this.type)};si.prototype.eq=function e(t,r){if(r===void 0)r=0;return this.type.eq(t.type)&&this.from+r==t.from&&this.to+r==t.to};si.prototype.map=function e(t,r,n){return this.type.map(t,this,r,n)};si.widget=function e(t,r,n){return new si(t,t,new oi(r,n))};si.inline=function e(t,r,n,o){return new si(t,r,new ii(n,o))};si.node=function e(t,r,n,o){return new si(t,r,new ai(n,o))};li.spec.get=function(){return this.type.spec};Object.defineProperties(si.prototype,li);var ci=[],fi={};var ui=function e(t,r){this.local=t&&t.length?t:ci;this.children=r&&r.length?r:ci};ui.create=function e(t,r){return r.length?wi(r,t,0,fi):hi};ui.prototype.find=function e(t,r,n){var o=[];this.findInner(t==null?0:t,r==null?1e9:r,o,0,n);return o};ui.prototype.findInner=function e(t,r,n,o,i){for(var a=0;a<this.local.length;a++){var s=this.local[a];if(s.from<=r&&s.to>=t&&(!i||i(s.spec))){n.push(s.copy(s.from+o,s.to+o))}}for(var l=0;l<this.children.length;l+=3){if(this.children[l]<r&&this.children[l+1]>t){var c=this.children[l]+1;this.children[l+2].findInner(t-c,r-c,n,o+c,i)}}};ui.prototype.map=function e(t,r,n){if(this==hi||t.maps.length==0){return this}return this.mapInner(t,r,0,0,n||fi)};ui.prototype.mapInner=function e(t,r,n,o,i){var a;for(var s=0;s<this.local.length;s++){var l=this.local[s].map(t,n,o);if(l&&l.type.valid(r,l)){(a||(a=[])).push(l)}else if(i.onRemove){i.onRemove(this.local[s].spec)}}if(this.children.length){return di(this.children,a,t,r,n,o,i)}else{return a?new ui(a.sort(bi)):hi}};ui.prototype.add=function e(t,r){if(!r.length){return this}if(this==hi){return ui.create(t,r)}return this.addInner(t,r,0)};ui.prototype.addInner=function e(t,r,n){var o=this;var i,a=0;t.forEach(function(e,t){var s=t+n,l;if(!(l=gi(r,e,s))){return}if(!i){i=o.children.slice()}while(a<i.length&&i[a]<t){a+=3}if(i[a]==t){i[a+2]=i[a+2].addInner(e,l,s+1)}else{i.splice(a,0,t,t+e.nodeSize,wi(l,e,s+1,fi))}a+=3});var s=vi(a?yi(r):r,-n);return new ui(s.length?this.local.concat(s).sort(bi):this.local,i||this.children)};ui.prototype.remove=function e(t){if(t.length==0||this==hi){return this}return this.removeInner(t,0)};ui.prototype.removeInner=function e(t,r){var n=this.children,o=this.local;for(var i=0;i<n.length;i+=3){var a=void 0,s=n[i]+r,l=n[i+1]+r;for(var c=0,f=void 0;c<t.length;c++){if(f=t[c]){if(f.from>s&&f.to<l){t[c]=null;(a||(a=[])).push(f)}}}if(!a){continue}if(n==this.children){n=this.children.slice()}var u=n[i+2].removeInner(a,s+1);if(u!=hi){n[i+2]=u}else{n.splice(i,3);i-=3}}if(o.length){for(var h=0,p=void 0;h<t.length;h++){if(p=t[h]){for(var d=0;d<o.length;d++){if(o[d].eq(p,r)){if(o==this.local){o=this.local.slice()}o.splice(d--,1)}}}}}if(n==this.children&&o==this.local){return this}return o.length||n.length?new ui(o,n):hi};ui.prototype.forChild=function e(t,r){if(this==hi){return this}if(r.isLeaf){return ui.empty}var n,o;for(var i=0;i<this.children.length;i+=3){if(this.children[i]>=t){if(this.children[i]==t){n=this.children[i+2]}break}}var a=t+1,s=a+r.content.size;for(var l=0;l<this.local.length;l++){var c=this.local[l];if(c.from<s&&c.to>a&&c.type instanceof ii){var f=Math.max(a,c.from)-a,u=Math.min(s,c.to)-a;if(f<u){(o||(o=[])).push(c.copy(f,u))}}}if(o){var h=new ui(o.sort(bi));return n?new pi([h,n]):h}return n||hi};ui.prototype.eq=function e(t){if(this==t){return true}if(!(t instanceof ui)||this.local.length!=t.local.length||this.children.length!=t.children.length){return false}for(var r=0;r<this.local.length;r++){if(!this.local[r].eq(t.local[r])){return false}}for(var n=0;n<this.children.length;n+=3){if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2])){return false}}return true};ui.prototype.locals=function e(t){return Ci(this.localsInner(t))};ui.prototype.localsInner=function e(t){if(this==hi){return ci}if(t.inlineContent||!this.local.some(ii.is)){return this.local}var r=[];for(var n=0;n<this.local.length;n++){if(!(this.local[n].type instanceof ii)){r.push(this.local[n])}}return r};var hi=new ui;ui.empty=hi;ui.removeOverlap=Ci;var pi=function e(t){this.members=t};pi.prototype.forChild=function e(t,r){if(r.isLeaf){return ui.empty}var n=[];for(var o=0;o<this.members.length;o++){var i=this.members[o].forChild(t,r);if(i==hi){continue}if(i instanceof pi){n=n.concat(i.members)}else{n.push(i)}}return pi.from(n)};pi.prototype.eq=function e(t){if(!(t instanceof pi)||t.members.length!=this.members.length){return false}for(var r=0;r<this.members.length;r++){if(!this.members[r].eq(t.members[r])){return false}}return true};pi.prototype.locals=function e(t){var r,n=true;for(var o=0;o<this.members.length;o++){var e=this.members[o].localsInner(t);if(!e.length){continue}if(!r){r=e}else{if(n){r=r.slice();n=false}for(var i=0;i<e.length;i++){r.push(e[i])}}}return r?Ci(n?r:r.sort(bi)):ci};pi.from=function e(t){switch(t.length){case 0:return hi;case 1:return t[0];default:return new pi(t)}};function di(e,t,r,n,o,i,a){var s=e.slice();var l=function(e,t,r,n){for(var a=0;a<s.length;a+=3){var l=s[a+1],c=void 0;if(l==-1||e>l+i){continue}if(t>=s[a]+i){s[a+1]=-1}else if(r>=o&&(c=n-r-(t-e))){s[a]+=c;s[a+1]+=c}}};for(var c=0;c<r.maps.length;c++){r.maps[c].forEach(l)}var f=false;for(var u=0;u<s.length;u+=3){if(s[u+1]==-1){var h=r.map(s[u]+i),p=h-o;if(p<0||p>=n.content.size){f=true;continue}var d=r.map(e[u+1]+i,-1),v=d-o;var m=n.content.findIndex(p);var g=m.index;var y=m.offset;var w=n.maybeChild(g);if(w&&y==p&&y+w.nodeSize==v){var b=s[u+2].mapInner(r,w,h+1,s[u]+i+1,a);if(b!=hi){s[u]=p;s[u+1]=v;s[u+2]=b}else{s[u+1]=-2;f=true}}else{f=true}}}if(f){var C=mi(s,e,t||[],r,o,i,a);var M=wi(C,n,0,a);t=M.local;for(var x=0;x<s.length;x+=3){if(s[x+1]<0){s.splice(x,3);x-=3}}for(var k=0,S=0;k<M.children.length;k+=3){var O=M.children[k];while(S<s.length&&s[S]<O){S+=3}s.splice(S,0,M.children[k],M.children[k+1],M.children[k+2])}}return new ui(t&&t.sort(bi),s)}function vi(e,t){if(!t||!e.length){return e}var r=[];for(var n=0;n<e.length;n++){var o=e[n];r.push(new si(o.from+t,o.to+t,o.type))}return r}function mi(e,t,r,n,o,i,a){function s(e,t){for(var i=0;i<e.local.length;i++){var l=e.local[i].map(n,o,t);if(l){r.push(l)}else if(a.onRemove){a.onRemove(e.local[i].spec)}}for(var c=0;c<e.children.length;c+=3){s(e.children[c+2],e.children[c]+t+1)}}for(var l=0;l<e.length;l+=3){if(e[l+1]==-1){s(e[l+2],t[l]+i+1)}}return r}function gi(e,t,r){if(t.isLeaf){return null}var n=r+t.nodeSize,o=null;for(var i=0,a=void 0;i<e.length;i++){if((a=e[i])&&a.from>r&&a.to<n){(o||(o=[])).push(a);e[i]=null}}return o}function yi(e){var t=[];for(var r=0;r<e.length;r++){if(e[r]!=null){t.push(e[r])}}return t}function wi(e,t,r,n){var o=[],i=false;t.forEach(function(t,a){var s=gi(e,t,a+r);if(s){i=true;var l=wi(s,t,r+a+1,n);if(l!=hi){o.push(a,a+t.nodeSize,l)}}});var a=vi(i?yi(e):e,-r).sort(bi);for(var s=0;s<a.length;s++){if(!a[s].type.valid(t,a[s])){if(n.onRemove){n.onRemove(a[s].spec)}a.splice(s--,1)}}return a.length||o.length?new ui(a,o):hi}function bi(e,t){return e.from-t.from||e.to-t.to}function Ci(e){var t=e;for(var r=0;r<t.length-1;r++){var n=t[r];if(n.from!=n.to){for(var o=r+1;o<t.length;o++){var i=t[o];if(i.from==n.from){if(i.to!=n.to){if(t==e){t=e.slice()}t[o]=i.copy(i.from,n.to);Mi(t,o+1,i.copy(n.to,i.to))}continue}else{if(i.from<n.to){if(t==e){t=e.slice()}t[r]=n.copy(n.from,i.from);Mi(t,o,n.copy(i.from,n.to))}break}}}}return t}function Mi(e,t,r){while(t<e.length&&bi(r,e[t])>0){t++}e.splice(t,0,r)}function xi(e){var t=[];e.someProp("decorations",function(r){var n=r(e.state);if(n&&n!=hi){t.push(n)}});if(e.cursorWrapper){t.push(ui.create(e.state.doc,[e.cursorWrapper.deco]))}return pi.from(t)}var ki=function e(t,r){this._props=r;this.state=r.state;this.dispatch=this.dispatch.bind(this);this._root=null;this.focused=false;this.dom=t&&t.mount||document.createElement("div");if(t){if(t.appendChild){t.appendChild(this.dom)}else if(t.apply){t(this.dom)}else if(t.mount){this.mounted=true}}this.editable=Ai(this);this.markCursor=null;this.cursorWrapper=null;Ni(this);this.nodeViews=Ti(this);this.docView=Yr(this.state.doc,Oi(this),xi(this),this.dom,this);this.lastSelectedViewDesc=null;this.dragging=null;So(this);this.pluginViews=[];this.updatePluginViews()};var Si={props:{configurable:true},root:{configurable:true}};Si.props.get=function(){if(this._props.state!=this.state){var e=this._props;this._props={};for(var t in e){this._props[t]=e[t]}this._props.state=this.state}return this._props};ki.prototype.update=function e(t){if(t.handleDOMEvents!=this._props.handleDOMEvents){Ao(this)}this._props=t;this.updateStateInner(t.state,true)};ki.prototype.setProps=function e(t){var r={};for(var n in this._props){r[n]=this._props[n]}r.state=this.state;for(var o in t){r[o]=t[o]}this.update(r)};ki.prototype.updateState=function e(t){this.updateStateInner(t,this.state.plugins!=t.plugins)};ki.prototype.updateStateInner=function e(t,r){var n=this;var o=this.state,i=false;this.state=t;if(r){var a=Ti(this);if(Ei(a,this.nodeViews)){this.nodeViews=a;i=true}Ao(this)}this.editable=Ai(this);Ni(this);var s=xi(this),l=Oi(this);var c=r?"reset":t.scrollToSelection>o.scrollToSelection?"to selection":"preserve";var f=i||!this.docView.matchesNode(t.doc,l,s);var u=f||!t.selection.eq(o.selection);var h=c=="preserve"&&u&&this.dom.style.overflowAnchor==null&&vr(this);if(u){this.domObserver.stop();var p=f&&(Zt.ie||Zt.chrome)&&!this.composing&&!o.selection.empty&&!t.selection.empty&&Di(o.selection,t.selection);if(f){var d=Zt.chrome&&zi(this.root);if(i||!this.docView.update(t.doc,l,s,this)){this.docView.updateOuterDeco([]);this.docView.destroy();this.docView=Yr(t.doc,l,s,this.dom,this)}if(d&&Ri(d,this.root)){p=true}}if(p||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&Zn(this))){$n(this,p)}else{jn(this,t.selection);this.domObserver.setCurSelection()}this.domObserver.start()}this.updatePluginViews(o);if(c=="reset"){this.dom.scrollTop=0}else if(c=="to selection"){var v=this.root.getSelection().focusNode;if(this.someProp("handleScrollToSelection",function(e){return e(n)}));else if(t.selection instanceof Ot){dr(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect(),v)}else{dr(this,this.coordsAtPos(t.selection.head),v)}}else if(h){gr(h)}};ki.prototype.destroyPluginViews=function e(){var t;while(t=this.pluginViews.pop()){if(t.destroy){t.destroy()}}};ki.prototype.updatePluginViews=function e(t){if(!t||t.plugins!=this.state.plugins){this.destroyPluginViews();for(var r=0;r<this.state.plugins.length;r++){var n=this.state.plugins[r];if(n.spec.view){this.pluginViews.push(n.spec.view(this))}}}else{for(var o=0;o<this.pluginViews.length;o++){var i=this.pluginViews[o];if(i.update){i.update(this,t)}}}};ki.prototype.someProp=function e(t,r){var n=this._props&&this._props[t],o;if(n!=null&&(o=r?r(n):n)){return o}var i=this.state.plugins;if(i){for(var a=0;a<i.length;a++){var s=i[a].props[t];if(s!=null&&(o=r?r(s):s)){return o}}}};ki.prototype.hasFocus=function e(){return this.root.activeElement==this.dom};ki.prototype.focus=function e(){this.domObserver.stop();if(this.editable){br(this.dom)}$n(this);this.domObserver.start()};Si.root.get=function(){var e=this._root;if(e==null){for(var t=this.dom.parentNode;t;t=t.parentNode){if(t.nodeType==9||t.nodeType==11&&t.host){if(!t.getSelection){Object.getPrototypeOf(t).getSelection=function(){return document.getSelection()}}return this._root=t}}}return e||document};ki.prototype.posAtCoords=function e(t){return Ar(this,t)};ki.prototype.coordsAtPos=function e(t){return Tr(this,t)};ki.prototype.domAtPos=function e(t){return this.docView.domFromPos(t)};ki.prototype.nodeDOM=function e(t){var r=this.docView.descAt(t);return r?r.nodeDOM:null};ki.prototype.posAtDOM=function e(t,r,n){if(n===void 0)n=-1;var o=this.docView.posFromDOM(t,r,n);if(o==null){throw new RangeError("DOM position not inside the editor")}return o};ki.prototype.endOfTextblock=function e(t,r){return _r(this,r||this.state,t)};ki.prototype.destroy=function e(){if(!this.docView){return}No(this);this.destroyPluginViews();if(this.mounted){this.docView.update(this.state.doc,[],xi(this),this);this.dom.textContent=""}else if(this.dom.parentNode){this.dom.parentNode.removeChild(this.dom)}this.docView.destroy();this.docView=null};ki.prototype.dispatchEvent=function e(t){return Eo(this,t)};ki.prototype.dispatch=function e(t){var r=this._props.dispatchTransaction;if(r){r.call(this,t)}else{this.updateState(this.state.apply(t))}};Object.defineProperties(ki.prototype,Si);function Oi(e){var t=Object.create(null);t.class="ProseMirror";t.contenteditable=String(e.editable);e.someProp("attributes",function(r){if(typeof r=="function"){r=r(e.state)}if(r){for(var n in r){if(n=="class"){t.class+=" "+r[n]}else if(!t[n]&&n!="contenteditable"&&n!="nodeName"){t[n]=String(r[n])}}}});return[si.node(0,e.state.doc.content.size,t)]}function Ni(e){if(e.markCursor){var t=document.createElement("img");t.setAttribute("mark-placeholder","true");e.cursorWrapper={dom:t,deco:si.widget(e.state.selection.head,t,{raw:true,marks:e.markCursor})}}else{e.cursorWrapper=null}}function Ai(e){return!e.someProp("editable",function(t){return t(e.state)===false})}function Di(e,t){var r=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(r)!=t.$anchor.start(r)}function Ti(e){var t={};e.someProp("nodeViews",function(e){for(var r in e){if(!Object.prototype.hasOwnProperty.call(t,r)){t[r]=e[r]}}});return t}function Ei(e,t){var r=0,n=0;for(var o in e){if(e[o]!=t[o]){return true}r++}for(var i in t){n++}return r!=n}function zi(e){var t=e.getSelection();var r=t.focusOffset;var n=t.focusNode;return n&&n.nodeType==1?[n,r,n.childNodes[r-1],n.childNodes[r]]:null}function Ri(e,t){var r=zi(t);if(!r||r[0].nodeType==3){return false}for(var n=0;n<e.length;n++){if(r[n]!=e[n]){return true}}return false}var Li=200;var Ii=function e(){};Ii.prototype.append=function e(t){if(!t.length){return this}t=Ii.from(t);return!this.length&&t||t.length<Li&&this.leafAppend(t)||this.length<Li&&t.leafPrepend(this)||this.appendInner(t)};Ii.prototype.prepend=function e(t){if(!t.length){return this}return Ii.from(t).append(this)};Ii.prototype.appendInner=function e(t){return new Bi(this,t)};Ii.prototype.slice=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.length;if(t>=r){return Ii.empty}return this.sliceInner(Math.max(0,t),Math.min(this.length,r))};Ii.prototype.get=function e(t){if(t<0||t>=this.length){return undefined}return this.getInner(t)};Ii.prototype.forEach=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=this.length;if(r<=n){this.forEachInner(t,r,n,0)}else{this.forEachInvertedInner(t,r,n,0)}};Ii.prototype.map=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=this.length;var o=[];this.forEach(function(e,r){return o.push(t(e,r))},r,n);return o};Ii.from=function e(t){if(t instanceof Ii){return t}return t&&t.length?new $i(t):Ii.empty};var $i=function(e){function t(t){e.call(this);this.values=t}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={length:{configurable:true},depth:{configurable:true}};t.prototype.flatten=function e(){return this.values};t.prototype.sliceInner=function e(r,n){if(r==0&&n==this.length){return this}return new t(this.values.slice(r,n))};t.prototype.getInner=function e(t){return this.values[t]};t.prototype.forEachInner=function e(t,r,n,o){for(var i=r;i<n;i++){if(t(this.values[i],o+i)===false){return false}}};t.prototype.forEachInvertedInner=function e(t,r,n,o){for(var i=r-1;i>=n;i--){if(t(this.values[i],o+i)===false){return false}}};t.prototype.leafAppend=function e(r){if(this.length+r.length<=Li){return new t(this.values.concat(r.flatten()))}};t.prototype.leafPrepend=function e(r){if(this.length+r.length<=Li){return new t(r.flatten().concat(this.values))}};r.length.get=function(){return this.values.length};r.depth.get=function(){return 0};Object.defineProperties(t.prototype,r);return t}(Ii);Ii.empty=new $i([]);var Bi=function(e){function t(t,r){e.call(this);this.left=t;this.right=r;this.length=t.length+r.length;this.depth=Math.max(t.depth,r.depth)+1}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.flatten=function e(){return this.left.flatten().concat(this.right.flatten())};t.prototype.getInner=function e(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)};t.prototype.forEachInner=function e(t,r,n,o){var i=this.left.length;if(r<i&&this.left.forEachInner(t,r,Math.min(n,i),o)===false){return false}if(n>i&&this.right.forEachInner(t,Math.max(r-i,0),Math.min(this.length,n)-i,o+i)===false){return false}};t.prototype.forEachInvertedInner=function e(t,r,n,o){var i=this.left.length;if(r>i&&this.right.forEachInvertedInner(t,r-i,Math.max(n,i)-i,o+i)===false){return false}if(n<i&&this.left.forEachInvertedInner(t,Math.min(r,i),n,o)===false){return false}};t.prototype.sliceInner=function e(t,r){if(t==0&&r==this.length){return this}var n=this.left.length;if(r<=n){return this.left.slice(t,r)}if(t>=n){return this.right.slice(t-n,r-n)}return this.left.slice(t,n).append(this.right.slice(0,r-n))};t.prototype.leafAppend=function e(r){var n=this.right.leafAppend(r);if(n){return new t(this.left,n)}};t.prototype.leafPrepend=function e(r){var n=this.left.leafPrepend(r);if(n){return new t(n,this.right)}};t.prototype.appendInner=function e(r){if(this.left.depth>=Math.max(this.right.depth,r.depth)+1){return new t(this.left,new t(this.right,r))}return new t(this,r)};return t}(Ii);var Fi=Ii;var Pi=500;var _i=function e(t,r){this.items=t;this.eventCount=r};_i.prototype.popEvent=function e(t,r){var n=this;if(this.eventCount==0){return null}var o=this.items.length;for(;;o--){var i=this.items.get(o-1);if(i.selection){--o;break}}var a,s;if(r){a=this.remapping(o,this.items.length);s=a.maps.length}var l=t.tr;var c,f;var u=[],h=[];this.items.forEach(function(e,t){if(!e.step){if(!a){a=n.remapping(o,t+1);s=a.maps.length}s--;h.push(e);return}if(a){h.push(new qi(e.map));var r=e.step.map(a.slice(s)),i;if(r&&l.maybeStep(r).doc){i=l.mapping.maps[l.mapping.maps.length-1];u.push(new qi(i,null,null,u.length+h.length))}s--;if(i){a.appendMap(i,s)}}else{l.maybeStep(e.step)}if(e.selection){c=a?e.selection.map(a.slice(s)):e.selection;f=new _i(n.items.slice(0,o).append(h.reverse().concat(u)),n.eventCount-1);return false}},this.items.length,0);return{remaining:f,transform:l,selection:c}};_i.prototype.addTransform=function e(t,r,n,o){var i=[],a=this.eventCount;var s=this.items,l=!o&&s.length?s.get(s.length-1):null;for(var c=0;c<t.steps.length;c++){var f=t.steps[c].invert(t.docs[c]);var u=new qi(t.mapping.maps[c],f,r),h=void 0;if(h=l&&l.merge(u)){u=h;if(c){i.pop()}else{s=s.slice(0,s.length-1)}}i.push(u);if(r){a++;r=null}if(!o){l=u}}var p=a-n.depth;if(p>Wi){s=Vi(s,p);a-=p}return new _i(s.append(i),a)};_i.prototype.remapping=function e(t,r){var n=new Ie;this.items.forEach(function(e,r){var o=e.mirrorOffset!=null&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:null;n.appendMap(e.map,o)},t,r);return n};_i.prototype.addMaps=function e(t){if(this.eventCount==0){return this}return new _i(this.items.append(t.map(function(e){return new qi(e)})),this.eventCount)};_i.prototype.rebased=function e(t,r){if(!this.eventCount){return this}var n=[],o=Math.max(0,this.items.length-r);var i=t.mapping;var a=t.steps.length;var s=this.eventCount;this.items.forEach(function(e){if(e.selection){s--}},o);var l=r;this.items.forEach(function(e){var r=i.getMirror(--l);if(r==null){return}a=Math.min(a,r);var o=i.maps[r];if(e.step){var c=t.steps[r].invert(t.docs[r]);var f=e.selection&&e.selection.map(i.slice(l+1,r));if(f){s++}n.push(new qi(o,c,f))}else{n.push(new qi(o))}},o);var c=[];for(var f=r;f<a;f++){c.push(new qi(i.maps[f]))}var u=this.items.slice(0,o).append(c).append(n);var h=new _i(u,s);if(h.emptyItemCount()>Pi){h=h.compress(this.items.length-n.length)}return h};_i.prototype.emptyItemCount=function e(){var t=0;this.items.forEach(function(e){if(!e.step){t++}});return t};_i.prototype.compress=function e(t){if(t===void 0)t=this.items.length;var r=this.remapping(0,t),n=r.maps.length;var o=[],i=0;this.items.forEach(function(e,a){if(a>=t){o.push(e);if(e.selection){i++}}else if(e.step){var s=e.step.map(r.slice(n)),l=s&&s.getMap();n--;if(l){r.appendMap(l,n)}if(s){var c=e.selection&&e.selection.map(r.slice(n));if(c){i++}var f=new qi(l.invert(),s,c),u,h=o.length-1;if(u=o.length&&o[h].merge(f)){o[h]=u}else{o.push(f)}}}else if(e.map){n--}},this.items.length,0);return new _i(Fi.from(o.reverse()),i)};_i.empty=new _i(Fi.empty,0);function Vi(e,t){var r;e.forEach(function(e,n){if(e.selection&&t--==0){r=n;return false}});return e.slice(r)}var qi=function e(t,r,n,o){this.map=t;this.step=r;this.selection=n;this.mirrorOffset=o};qi.prototype.merge=function e(t){if(this.step&&t.step&&!t.selection){var r=t.step.merge(this.step);if(r){return new qi(r.getMap().invert(),r,this.selection)}}};var ji=function e(t,r,n,o){this.done=t;this.undone=r;this.prevRanges=n;this.prevTime=o};var Wi=20;function Hi(e,t,r,n){var o=r.getMeta(Qi),i;if(o){return o.historyState}if(r.getMeta(ea)){e=new ji(e.done,e.undone,null,0)}var a=r.getMeta("appendedTransaction");if(r.steps.length==0){return e}else if(a&&a.getMeta(Qi)){if(a.getMeta(Qi).redo){return new ji(e.done.addTransform(r,null,n,Yi(t)),e.undone,Ki(r.mapping.maps[r.steps.length-1]),e.prevTime)}else{return new ji(e.done,e.undone.addTransform(r,null,n,Yi(t)),null,e.prevTime)}}else if(r.getMeta("addToHistory")!==false&&!(a&&a.getMeta("addToHistory")===false)){var s=e.prevTime==0||!a&&(e.prevTime<(r.time||0)-n.newGroupDelay||!Ji(r,e.prevRanges));var l=a?Zi(e.prevRanges,r.mapping):Ki(r.mapping.maps[r.steps.length-1]);return new ji(e.done.addTransform(r,s?t.selection.getBookmark():null,n,Yi(t)),_i.empty,l,r.time)}else if(i=r.getMeta("rebased")){return new ji(e.done.rebased(r,i),e.undone.rebased(r,i),Zi(e.prevRanges,r.mapping),e.prevTime)}else{return new ji(e.done.addMaps(r.mapping.maps),e.undone.addMaps(r.mapping.maps),Zi(e.prevRanges,r.mapping),e.prevTime)}}function Ji(e,t){if(!t){return false}if(!e.docChanged){return true}var r=false;e.mapping.maps[0].forEach(function(e,n){for(var o=0;o<t.length;o+=2){if(e<=t[o+1]&&n>=t[o]){r=true}}});return r}function Ki(e){var t=[];e.forEach(function(e,r,n,o){return t.push(n,o)});return t}function Zi(e,t){if(!e){return null}var r=[];for(var n=0;n<e.length;n+=2){var o=t.map(e[n],1),i=t.map(e[n+1],-1);if(o<=i){r.push(o,i)}}return r}function Ui(e,t,r,n){var o=Yi(t),i=Qi.get(t).spec.config;var a=(n?e.undone:e.done).popEvent(t,o);if(!a){return}var s=a.selection.resolve(a.transform.doc);var l=(n?e.done:e.undone).addTransform(a.transform,t.selection.getBookmark(),i,o);var c=new ji(n?l:a.remaining,n?a.remaining:l,null,0);r(a.transform.setSelection(s).setMeta(Qi,{redo:n,historyState:c}).scrollIntoView())}var Gi=false,Xi=null;function Yi(e){var t=e.plugins;if(Xi!=t){Gi=false;Xi=t;for(var r=0;r<t.length;r++){if(t[r].spec.historyPreserveItems){Gi=true;break}}}return Gi}var Qi=new Kt("history");var ea=new Kt("closeHistory");function ta(e){e={depth:e&&e.depth||100,newGroupDelay:e&&e.newGroupDelay||500};return new Wt({key:Qi,state:{init:function e(){return new ji(_i.empty,_i.empty,null,0)},apply:function t(r,n,o){return Hi(n,o,r,e)}},config:e})}function ra(e,t){var r=Qi.getState(e);if(!r||r.done.eventCount==0){return false}if(t){Ui(r,e,t,false)}return true}function na(e,t){var r=Qi.getState(e);if(!r||r.undone.eventCount==0){return false}if(t){Ui(r,e,t,true)}return true}function oa(e,t){if(e.selection.empty){return false}if(t){t(e.tr.deleteSelection().scrollIntoView())}return true}function ia(e,t,r){var n=e.selection;var o=n.$cursor;if(!o||(r?!r.endOfTextblock("backward",e):o.parentOffset>0)){return false}var i=la(o);if(!i){var a=o.blockRange(),s=a&&Ke(a);if(s==null){return false}if(t){t(e.tr.lift(a,s).scrollIntoView())}return true}var l=i.nodeBefore;if(!l.type.spec.isolating&&ka(e,i,t)){return true}if(o.parent.content.size==0&&(aa(l,"end")||Ot.isSelectable(l))){if(t){var c=e.tr.deleteRange(o.before(),o.after());c.setSelection(aa(l,"end")?Ct.findFrom(c.doc.resolve(c.mapping.map(i.pos,-1)),-1):Ot.create(c.doc,i.pos-l.nodeSize));t(c.scrollIntoView())}return true}if(l.isAtom&&i.depth==o.depth-1){if(t){t(e.tr.delete(i.pos-l.nodeSize,i.pos).scrollIntoView())}return true}return false}function aa(e,t){for(;e;e=t=="start"?e.firstChild:e.lastChild){if(e.isTextblock){return true}}return false}function sa(e,t,r){var n=e.selection;var o=n.$head;var i=n.empty;var a=o;if(!i){return false}if(o.parent.isTextblock){if(r?!r.endOfTextblock("backward",e):o.parentOffset>0){return false}a=la(o)}var s=a&&a.nodeBefore;if(!s||!Ot.isSelectable(s)){return false}if(t){t(e.tr.setSelection(Ot.create(e.doc,a.pos-s.nodeSize)).scrollIntoView())}return true}function la(e){if(!e.parent.type.spec.isolating){for(var t=e.depth-1;t>=0;t--){if(e.index(t)>0){return e.doc.resolve(e.before(t+1))}if(e.node(t).type.spec.isolating){break}}}return null}function ca(e,t,r){var n=e.selection;var o=n.$cursor;if(!o||(r?!r.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)){return false}var i=ua(o);if(!i){return false}var a=i.nodeAfter;if(ka(e,i,t)){return true}if(o.parent.content.size==0&&(aa(a,"start")||Ot.isSelectable(a))){if(t){var s=e.tr.deleteRange(o.before(),o.after());s.setSelection(aa(a,"start")?Ct.findFrom(s.doc.resolve(s.mapping.map(i.pos)),1):Ot.create(s.doc,s.mapping.map(i.pos)));t(s.scrollIntoView())}return true}if(a.isAtom&&i.depth==o.depth-1){if(t){t(e.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView())}return true}return false}function fa(e,t,r){var n=e.selection;var o=n.$head;var i=n.empty;var a=o;if(!i){return false}if(o.parent.isTextblock){if(r?!r.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size){return false}a=ua(o)}var s=a&&a.nodeAfter;if(!s||!Ot.isSelectable(s)){return false}if(t){t(e.tr.setSelection(Ot.create(e.doc,a.pos)).scrollIntoView())}return true}function ua(e){if(!e.parent.type.spec.isolating){for(var t=e.depth-1;t>=0;t--){var r=e.node(t);if(e.index(t)+1<r.childCount){return e.doc.resolve(e.after(t+1))}if(r.type.spec.isolating){break}}}return null}function ha(e,t){var r=e.selection,n=r instanceof Ot,o;if(n){if(r.node.isTextblock||!et(e.doc,r.from)){return false}o=r.from}else{o=rt(e.doc,r.from,-1);if(o==null){return false}}if(t){var i=e.tr.join(o);if(n){i.setSelection(Ot.create(i.doc,o-e.doc.resolve(o).nodeBefore.nodeSize))}t(i.scrollIntoView())}return true}function pa(e,t){var r=e.selection,n;if(r instanceof Ot){if(r.node.isTextblock||!et(e.doc,r.to)){return false}n=r.to}else{n=rt(e.doc,r.to,1);if(n==null){return false}}if(t){t(e.tr.join(n).scrollIntoView())}return true}function da(e,t){var r=e.selection;var n=r.$from;var o=r.$to;var i=n.blockRange(o),a=i&&Ke(i);if(a==null){return false}if(t){t(e.tr.lift(i,a).scrollIntoView())}return true}function va(e,t){var r=e.selection;var n=r.$head;var o=r.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o)){return false}if(t){t(e.tr.insertText("\n").scrollIntoView())}return true}function ma(e){for(var t=0;t<e.edgeCount;t++){var r=e.edge(t);var n=r.type;if(n.isTextblock&&!n.hasRequiredAttrs()){return n}}return null}function ga(e,t){var r=e.selection;var n=r.$head;var o=r.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o)){return false}var i=n.node(-1),a=n.indexAfter(-1),s=ma(i.contentMatchAt(a));if(!i.canReplaceWith(a,a,s)){return false}if(t){var l=n.after(),c=e.tr.replaceWith(l,l,s.createAndFill());c.setSelection(Ct.near(c.doc.resolve(l),1));t(c.scrollIntoView())}return true}function ya(e,t){var r=e.selection;var n=r.$from;var o=r.$to;if(n.parent.inlineContent||o.parent.inlineContent){return false}var i=ma(n.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock){return false}if(t){var a=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos;var s=e.tr.insert(a,i.createAndFill());s.setSelection(kt.create(s.doc,a+1));t(s.scrollIntoView())}return true}function wa(e,t){var r=e.selection;var n=r.$cursor;if(!n||n.parent.content.size){return false}if(n.depth>1&&n.after()!=n.end(-1)){var o=n.before();if(Qe(e.doc,o)){if(t){t(e.tr.split(o).scrollIntoView())}return true}}var i=n.blockRange(),a=i&&Ke(i);if(a==null){return false}if(t){t(e.tr.lift(i,a).scrollIntoView())}return true}function ba(e,t){var r=e.selection;var n=r.$from;var i=r.$to;if(e.selection instanceof Ot&&e.selection.node.isBlock){if(!n.parentOffset||!Qe(e.doc,n.pos)){return false}if(t){t(e.tr.split(n.pos).scrollIntoView())}return true}if(!n.parent.isBlock){return false}if(t){var a=i.parentOffset==i.parent.content.size;var s=e.tr;if(e.selection instanceof kt){s.deleteSelection()}var l=n.depth==0?null:ma(n.node(-1).contentMatchAt(n.indexAfter(-1)));var c=a&&l?[{type:l}]:null;var f=Qe(s.doc,s.mapping.map(n.pos),1,c);if(!c&&!f&&Qe(s.doc,s.mapping.map(n.pos),1,l&&[{type:l}])){c=[{type:l}];f=true}if(f){s.split(s.mapping.map(n.pos),1,c);if(!a&&!n.parentOffset&&n.parent.type!=l&&n.node(-1).canReplace(n.index(-1),n.indexAfter(-1),o.from(l.create(),n.parent))){s.setNodeMarkup(s.mapping.map(n.before()),l)}}t(s.scrollIntoView())}return true}function Ca(e,t){var r=e.selection;var n=r.$from;var o=r.to;var i;var a=n.sharedDepth(o);if(a==0){return false}i=n.before(a);if(t){t(e.tr.setSelection(Ot.create(e.doc,i)))}return true}function Ma(e,t){if(t){t(e.tr.setSelection(new At(e.doc)))}return true}function xa(e,t,r){var n=t.nodeBefore,o=t.nodeAfter,i=t.index();if(!n||!o||!n.type.compatibleContent(o.type)){return false}if(!n.content.size&&t.parent.canReplace(i-1,i)){if(r){r(e.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView())}return true}if(!t.parent.canReplace(i,i+1)||!(o.isTextblock||et(e.doc,t.pos))){return false}if(r){r(e.tr.clearIncompatible(t.pos,n.type,n.contentMatchAt(n.childCount)).join(t.pos).scrollIntoView())}return true}function ka(e,t,r){var n=t.nodeBefore,i=t.nodeAfter,a,s;if(n.type.spec.isolating||i.type.spec.isolating){return false}if(xa(e,t,r)){return true}if(t.parent.canReplace(t.index(),t.index()+1)&&(a=(s=n.contentMatchAt(n.childCount)).findWrapping(i.type))&&s.matchType(a[0]||i.type).validEnd){if(r){var l=t.pos+i.nodeSize,c=o.empty;for(var f=a.length-1;f>=0;f--){c=o.from(a[f].create(null,c))}c=o.from(n.copy(c));var h=e.tr.step(new We(t.pos-1,l,t.pos,l,new u(c,1,0),a.length,true));var p=l+2*a.length;if(et(h.doc,p)){h.join(p)}r(h.scrollIntoView())}return true}var d=Ct.findFrom(t,1);var v=d&&d.$from.blockRange(d.$to),m=v&&Ke(v);if(m!=null&&m>=t.depth){if(r){r(e.tr.lift(v,m).scrollIntoView())}return true}return false}function Sa(e,t){return function(r,n){var o=r.selection;var i=o.$from;var a=o.$to;var s=i.blockRange(a),l=s&&Ze(s,e,t);if(!l){return false}if(n){n(r.tr.wrap(s,l).scrollIntoView())}return true}}function Oa(e,t){return function(r,n){var o=r.selection;var i=o.from;var a=o.to;var s=false;r.doc.nodesBetween(i,a,function(n,o){if(s){return false}if(!n.isTextblock||n.hasMarkup(e,t)){return}if(n.type==e){s=true}else{var i=r.doc.resolve(o),a=i.index();s=i.parent.canReplaceWith(a,a+1,e)}});if(!s){return false}if(n){n(r.tr.setBlockType(i,a,e,t).scrollIntoView())}return true}}function Na(e,t,r){var n=function(n){var o=t[n];var i=o.$from;var a=o.$to;var s=i.depth==0?e.type.allowsMarkType(r):false;e.nodesBetween(i.pos,a.pos,function(e){if(s){return false}s=e.inlineContent&&e.type.allowsMarkType(r)});if(s){return{v:true}}};for(var o=0;o<t.length;o++){var i=n(o);if(i)return i.v}return false}function Aa(e,t){return function(r,n){var o=r.selection;var i=o.empty;var a=o.$cursor;var s=o.ranges;if(i&&!a||!Na(r.doc,s,e)){return false}if(n){if(a){if(e.isInSet(r.storedMarks||a.marks())){n(r.tr.removeStoredMark(e))}else{n(r.tr.addStoredMark(e.create(t)))}}else{var l=false,c=r.tr;for(var f=0;!l&&f<s.length;f++){var u=s[f];var h=u.$from;var p=u.$to;l=r.doc.rangeHasMark(h.pos,p.pos,e)}for(var d=0;d<s.length;d++){var v=s[d];var m=v.$from;var g=v.$to;if(l){c.removeMark(m.pos,g.pos,e)}else{c.addMark(m.pos,g.pos,e.create(t))}}n(c.scrollIntoView())}}return true}}function Da(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return function(t,r,n){for(var o=0;o<e.length;o++){if(e[o](t,r,n)){return true}}return false}}var Ta=Da(oa,ia,sa);var Ea=Da(oa,ca,fa);var za={Enter:Da(va,ya,wa,ba),"Mod-Enter":ga,Backspace:Ta,"Mod-Backspace":Ta,Delete:Ea,"Mod-Delete":Ea,"Mod-a":Ma};var Ra={"Ctrl-h":za["Backspace"],"Alt-Backspace":za["Mod-Backspace"],"Ctrl-d":za["Delete"],"Ctrl-Alt-Backspace":za["Mod-Delete"],"Alt-Delete":za["Mod-Delete"],"Alt-d":za["Mod-Delete"]};for(var La in za){Ra[La]=za[La]}var Ia=typeof navigator!="undefined"?/Mac/.test(navigator.platform):typeof os!="undefined"?os.platform()=="darwin":false;var $a=Ia?Ra:za;var Ba={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"};var Fa={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};var Pa=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);var _a=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor);var Va=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var qa=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ja=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);var Wa=Pa&&(qa||+Pa[1]<57)||Va&&qa;for(var Ha=0;Ha<10;Ha++)Ba[48+Ha]=Ba[96+Ha]=String(Ha);for(var Ha=1;Ha<=24;Ha++)Ba[Ha+111]="F"+Ha;for(var Ha=65;Ha<=90;Ha++){Ba[Ha]=String.fromCharCode(Ha+32);Fa[Ha]=String.fromCharCode(Ha)}for(var Ja in Ba)if(!Fa.hasOwnProperty(Ja))Fa[Ja]=Ba[Ja];function Ka(e){var t=Wa&&(e.ctrlKey||e.altKey||e.metaKey)||(_a||ja)&&e.shiftKey&&e.key&&e.key.length==1;var r=!t&&e.key||(e.shiftKey?Fa:Ba)[e.keyCode]||e.key||"Unidentified";if(r=="Esc")r="Escape";if(r=="Del")r="Delete";if(r=="Left")r="ArrowLeft";if(r=="Up")r="ArrowUp";if(r=="Right")r="ArrowRight";if(r=="Down")r="ArrowDown";return r}var Za=typeof navigator!="undefined"?/Mac/.test(navigator.platform):false;function Ua(e){var t=e.split(/-(?!$)/),r=t[t.length-1];if(r=="Space"){r=" "}var n,o,i,a;for(var s=0;s<t.length-1;s++){var l=t[s];if(/^(cmd|meta|m)$/i.test(l)){a=true}else if(/^a(lt)?$/i.test(l)){n=true}else if(/^(c|ctrl|control)$/i.test(l)){o=true}else if(/^s(hift)?$/i.test(l)){i=true}else if(/^mod$/i.test(l)){if(Za){a=true}else{o=true}}else{throw new Error("Unrecognized modifier name: "+l)}}if(n){r="Alt-"+r}if(o){r="Ctrl-"+r}if(a){r="Meta-"+r}if(i){r="Shift-"+r}return r}function Ga(e){var t=Object.create(null);for(var r in e){t[Ua(r)]=e[r]}return t}function Xa(e,t,r){if(t.altKey){e="Alt-"+e}if(t.ctrlKey){e="Ctrl-"+e}if(t.metaKey){e="Meta-"+e}if(r!==false&&t.shiftKey){e="Shift-"+e}return e}function Ya(e){return new Wt({props:{handleKeyDown:Qa(e)}})}function Qa(e){var t=Ga(e);return function(e,r){var n=Ka(r),o=n.length==1&&n!=" ",i;var a=t[Xa(n,r,!o)];if(a&&a(e.state,e.dispatch,e)){return true}if(o&&(r.shiftKey||r.altKey||r.metaKey||n.charCodeAt(0)>127)&&(i=Ba[r.keyCode])&&i!=n){var s=t[Xa(i,r,true)];if(s&&s(e.state,e.dispatch,e)){return true}}else if(o&&r.shiftKey){var l=t[Xa(n,r,true)];if(l&&l(e.state,e.dispatch,e)){return true}}return false}}var es,ts;if(typeof WeakMap!="undefined"){var rs=new WeakMap;es=function(e){return rs.get(e)};ts=function(e,t){rs.set(e,t);return t}}else{var ns=[],is=10,as=0;es=function(e){for(var t=0;t<ns.length;t+=2){if(ns[t]==e){return ns[t+1]}}};ts=function(e,t){if(as==is){as=0}ns[as++]=e;return ns[as++]=t}}var ss=function e(t,r,n,o){this.left=t;this.top=r;this.right=n;this.bottom=o};var ls=function e(t,r,n,o){this.width=t;this.height=r;this.map=n;this.problems=o};ls.prototype.findCell=function e(t){for(var r=0;r<this.map.length;r++){var n=this.map[r];if(n!=t){continue}var o=r%this.width,i=r/this.width|0;var a=o+1,s=i+1;for(var l=1;a<this.width&&this.map[r+l]==n;l++){a++}for(var c=1;s<this.height&&this.map[r+this.width*c]==n;c++){s++}return new ss(o,i,a,s)}throw new RangeError("No cell with offset "+t+" found")};ls.prototype.colCount=function e(t){for(var r=0;r<this.map.length;r++){if(this.map[r]==t){return r%this.width}}throw new RangeError("No cell with offset "+t+" found")};ls.prototype.nextCell=function e(t,r,n){var o=this.findCell(t);var i=o.left;var a=o.right;var s=o.top;var l=o.bottom;if(r=="horiz"){if(n<0?i==0:a==this.width){return null}return this.map[s*this.width+(n<0?i-1:a)]}else{if(n<0?s==0:l==this.height){return null}return this.map[i+this.width*(n<0?s-1:l)]}};ls.prototype.rectBetween=function e(t,r){var n=this.findCell(t);var o=n.left;var i=n.right;var a=n.top;var s=n.bottom;var l=this.findCell(r);var c=l.left;var f=l.right;var u=l.top;var h=l.bottom;return new ss(Math.min(o,c),Math.min(a,u),Math.max(i,f),Math.max(s,h))};ls.prototype.cellsInRect=function e(t){var r=[],n={};for(var o=t.top;o<t.bottom;o++){for(var i=t.left;i<t.right;i++){var a=o*this.width+i,s=this.map[a];if(n[s]){continue}n[s]=true;if((i!=t.left||!i||this.map[a-1]!=s)&&(o!=t.top||!o||this.map[a-this.width]!=s)){r.push(s)}}}return r};ls.prototype.positionAt=function e(t,r,n){for(var o=0,i=0;;o++){var a=i+n.child(o).nodeSize;if(o==t){var s=r+t*this.width,l=(t+1)*this.width;while(s<l&&this.map[s]<i){s++}return s==l?a-1:this.map[s]}i=a}};ls.get=function e(t){return es(t)||ts(t,cs(t))};function cs(e){if(e.type.spec.tableRole!="table"){throw new RangeError("Not a table node: "+e.type.name)}var t=fs(e),r=e.childCount;var n=[],o=0,i=null,a=[];for(var s=0,l=t*r;s<l;s++){n[s]=0}for(var c=0,f=0;c<r;c++){var u=e.child(c);f++;for(var h=0;;h++){while(o<n.length&&n[o]!=0){o++}if(h==u.childCount){break}var p=u.child(h);var d=p.attrs;var v=d.colspan;var m=d.rowspan;var g=d.colwidth;for(var y=0;y<m;y++){if(y+c>=r){(i||(i=[])).push({type:"overlong_rowspan",pos:f,n:m-y});break}var w=o+y*t;for(var b=0;b<v;b++){if(n[w+b]==0){n[w+b]=f}else{(i||(i=[])).push({type:"collision",row:c,pos:f,n:v-b})}var C=g&&g[b];if(C){var M=(w+b)%t*2,x=a[M];if(x==null||x!=C&&a[M+1]==1){a[M]=C;a[M+1]=1}else if(x==C){a[M+1]++}}}}o+=v;f+=p.nodeSize}var k=(c+1)*t,S=0;while(o<k){if(n[o++]==0){S++}}if(S){(i||(i=[])).push({type:"missing",row:c,n:S})}f++}var O=new ls(t,r,n,i),N=false;for(var A=0;!N&&A<a.length;A+=2){if(a[A]!=null&&a[A+1]<r){N=true}}if(N){us(O,a,e)}return O}function fs(e){var t=-1,r=false;for(var n=0;n<e.childCount;n++){var o=e.child(n),i=0;if(r){for(var a=0;a<n;a++){var s=e.child(a);for(var l=0;l<s.childCount;l++){var c=s.child(l);if(a+c.attrs.rowspan>n){i+=c.attrs.colspan}}}}for(var f=0;f<o.childCount;f++){var u=o.child(f);i+=u.attrs.colspan;if(u.attrs.rowspan>1){r=true}}if(t==-1){t=i}else if(t!=i){t=Math.max(t,i)}}return t}function us(e,t,r){if(!e.problems){e.problems=[]}for(var n=0,o={};n<e.map.length;n++){var i=e.map[n];if(o[i]){continue}o[i]=true;var a=r.nodeAt(i),s=null;for(var l=0;l<a.attrs.colspan;l++){var c=(n+l)%e.width,f=t[c*2];if(f!=null&&(!a.attrs.colwidth||a.attrs.colwidth[l]!=f)){(s||(s=hs(a.attrs)))[l]=f}}if(s){e.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:s})}}}function hs(e){if(e.colwidth){return e.colwidth.slice()}var t=[];for(var r=0;r<e.colspan;r++){t.push(0)}return t}function ps(e){var t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(var r in e.nodes){var n=e.nodes[r],o=n.spec.tableRole;if(o){t[o]=n}}}return t}var ds=new Kt("selectingCells");function vs(e){for(var t=e.depth-1;t>0;t--){if(e.node(t).type.spec.tableRole=="row"){return e.node(0).resolve(e.before(t+1))}}return null}function ms(e){for(var t=e.depth;t>0;t--){var r=e.node(t).type.spec.tableRole;if(r==="cell"||r==="header_cell"){return e.node(t)}}return null}function gs(e){var t=e.selection.$head;for(var r=t.depth;r>0;r--){if(t.node(r).type.spec.tableRole=="row"){return true}}return false}function ys(e){var t=e.selection;if(t.$anchorCell){return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell}else if(t.node&&t.node.type.spec.tableRole=="cell"){return t.$anchor}return vs(t.$head)||ws(t.$head)}function ws(e){for(var t=e.nodeAfter,r=e.pos;t;t=t.firstChild,r++){var n=t.type.spec.tableRole;if(n=="cell"||n=="header_cell"){return e.doc.resolve(r)}}for(var o=e.nodeBefore,i=e.pos;o;o=o.lastChild,i--){var a=o.type.spec.tableRole;if(a=="cell"||a=="header_cell"){return e.doc.resolve(i-o.nodeSize)}}}function bs(e){return e.parent.type.spec.tableRole=="row"&&e.nodeAfter}function Cs(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function Ms(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function xs(e,t,r){var n=e.start(-1),o=ls.get(e.node(-1));var i=o.nextCell(e.pos-n,t,r);return i==null?null:e.node(0).resolve(n+i)}function ks(e,t,r){var n={};for(var o in e){n[o]=e[o]}n[t]=r;return n}function Ss(e,t,r){if(r===void 0)r=1;var n=ks(e,"colspan",e.colspan-r);if(n.colwidth){n.colwidth=n.colwidth.slice();n.colwidth.splice(t,r);if(!n.colwidth.some(function(e){return e>0})){n.colwidth=null}}return n}function Os(e,t,r){if(r===void 0)r=1;var n=ks(e,"colspan",e.colspan+r);if(n.colwidth){n.colwidth=n.colwidth.slice();for(var o=0;o<r;o++){n.colwidth.splice(t,0,0)}}return n}function Ns(e,t,r){var n=ps(t.type.schema).header_cell;for(var o=0;o<e.height;o++){if(t.nodeAt(e.map[r+o*e.width]).type!=n){return false}}return true}var As=function(e){function t(t,r){if(r===void 0)r=t;var n=t.node(-1),o=ls.get(n),i=t.start(-1);var a=o.rectBetween(t.pos-i,r.pos-i);var s=t.node(0);var l=o.cellsInRect(a).filter(function(e){return e!=r.pos-i});l.unshift(r.pos-i);var c=l.map(function(e){var t=n.nodeAt(e),r=e+i+1;return new xt(s.resolve(r),s.resolve(r+t.content.size))});e.call(this,c[0].$from,c[0].$to,c);this.$anchorCell=t;this.$headCell=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function e(r,n){var o=r.resolve(n.map(this.$anchorCell.pos));var i=r.resolve(n.map(this.$headCell.pos));if(bs(o)&&bs(i)&&Ms(o,i)){var a=this.$anchorCell.node(-1)!=o.node(-1);if(a&&this.isRowSelection()){return t.rowSelection(o,i)}else if(a&&this.isColSelection()){return t.colSelection(o,i)}else{return new t(o,i)}}return kt.between(o,i)};t.prototype.content=function e(){var t=this.$anchorCell.node(-1),r=ls.get(t),n=this.$anchorCell.start(-1);var i=r.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n);var a={},s=[];for(var l=i.top;l<i.bottom;l++){var c=[];for(var f=l*r.width+i.left,h=i.left;h<i.right;h++,f++){var p=r.map[f];if(!a[p]){a[p]=true;var d=r.findCell(p),v=t.nodeAt(p);var m=i.left-d.left,g=d.right-i.right;if(m>0||g>0){var y=v.attrs;if(m>0){y=Ss(y,0,m)}if(g>0){y=Ss(y,y.colspan-g,g)}if(d.left<i.left){v=v.type.createAndFill(y)}else{v=v.type.create(y,v.content)}}if(d.top<i.top||d.bottom>i.bottom){var w=ks(v.attrs,"rowspan",Math.min(d.bottom,i.bottom)-Math.max(d.top,i.top));if(d.top<i.top){v=v.type.createAndFill(w)}else{v=v.type.create(w,v.content)}}c.push(v)}}s.push(t.child(l).copy(o.from(c)))}var b=this.isColSelection()&&this.isRowSelection()?t:s;return new u(o.from(b),1,1)};t.prototype.replace=function t(r,n){if(n===void 0)n=u.empty;var o=r.steps.length,i=this.ranges;for(var a=0;a<i.length;a++){var s=i[a];var l=s.$from;var c=s.$to;var f=r.mapping.slice(o);r.replace(f.map(l.pos),f.map(c.pos),a?u.empty:n)}var h=e.findFrom(r.doc.resolve(r.mapping.slice(o).map(this.to)),-1);if(h){r.setSelection(h)}};t.prototype.replaceWith=function e(t,r){this.replace(t,new u(o.from(r),0,0))};t.prototype.forEachCell=function e(t){var r=this.$anchorCell.node(-1),n=ls.get(r),o=this.$anchorCell.start(-1);var i=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(var a=0;a<i.length;a++){t(r.nodeAt(i[a]),o+i[a])}};t.prototype.isColSelection=function e(){var t=this.$anchorCell.index(-1),r=this.$headCell.index(-1);if(Math.min(t,r)>0){return false}var n=t+this.$anchorCell.nodeAfter.attrs.rowspan,o=r+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,o)==this.$headCell.node(-1).childCount};t.colSelection=function e(r,n){if(n===void 0)n=r;var o=ls.get(r.node(-1)),i=r.start(-1);var a=o.findCell(r.pos-i),s=o.findCell(n.pos-i);var l=r.node(0);if(a.top<=s.top){if(a.top>0){r=l.resolve(i+o.map[a.left])}if(s.bottom<o.height){n=l.resolve(i+o.map[o.width*(o.height-1)+s.right-1])}}else{if(s.top>0){n=l.resolve(i+o.map[s.left])}if(a.bottom<o.height){r=l.resolve(i+o.map[o.width*(o.height-1)+a.right-1])}}return new t(r,n)};t.prototype.isRowSelection=function e(){var t=ls.get(this.$anchorCell.node(-1)),r=this.$anchorCell.start(-1);var n=t.colCount(this.$anchorCell.pos-r),o=t.colCount(this.$headCell.pos-r);if(Math.min(n,o)>0){return false}var i=n+this.$anchorCell.nodeAfter.attrs.colspan,a=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,a)==t.width};t.prototype.eq=function e(r){return r instanceof t&&r.$anchorCell.pos==this.$anchorCell.pos&&r.$headCell.pos==this.$headCell.pos};t.rowSelection=function e(r,n){if(n===void 0)n=r;var o=ls.get(r.node(-1)),i=r.start(-1);var a=o.findCell(r.pos-i),s=o.findCell(n.pos-i);var l=r.node(0);if(a.left<=s.left){if(a.left>0){r=l.resolve(i+o.map[a.top*o.width])}if(s.right<o.width){n=l.resolve(i+o.map[o.width*(s.top+1)-1])}}else{if(s.left>0){n=l.resolve(i+o.map[s.top*o.width])}if(a.right<o.width){r=l.resolve(i+o.map[o.width*(a.top+1)-1])}}return new t(r,n)};t.prototype.toJSON=function e(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}};t.fromJSON=function e(r,n){return new t(r.resolve(n.anchor),r.resolve(n.head))};t.create=function e(r,n,o){if(o===void 0)o=n;return new t(r.resolve(n),r.resolve(o))};t.prototype.getBookmark=function e(){return new Ds(this.$anchorCell.pos,this.$headCell.pos)};return t}(Ct);As.prototype.visible=false;Ct.jsonID("cell",As);var Ds=function e(t,r){this.anchor=t;this.head=r};Ds.prototype.map=function e(t){return new Ds(t.map(this.anchor),t.map(this.head))};Ds.prototype.resolve=function e(t){var r=t.resolve(this.anchor),n=t.resolve(this.head);if(r.parent.type.spec.tableRole=="row"&&n.parent.type.spec.tableRole=="row"&&r.index()<r.parent.childCount&&n.index()<n.parent.childCount&&Ms(r,n)){return new As(r,n)}else{return Ct.near(n,1)}};function Ts(e){if(!(e.selection instanceof As)){return null}var t=[];e.selection.forEachCell(function(e,r){t.push(si.node(r,r+e.nodeSize,{class:"selectedCell"}))});return ui.create(e.doc,t)}function Es(e){var t=e.$from;var r=e.$to;if(t.pos==r.pos||t.pos<t.pos-6){return false}var n=t.pos,o=r.pos,i=t.depth;for(;i>=0;i--,n++){if(t.after(i+1)<t.end(i)){break}}for(var a=r.depth;a>=0;a--,o--){if(r.before(a+1)>r.start(a)){break}}return n==o&&/row|table/.test(t.node(i).type.spec.tableRole)}function zs(e){var t=e.$from;var r=e.$to;var n;var o;for(var i=t.depth;i>0;i--){var a=t.node(i);if(a.type.spec.tableRole==="cell"||a.type.spec.tableRole==="header_cell"){n=a;break}}for(var s=r.depth;s>0;s--){var l=r.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){o=l;break}}return n!==o&&r.parentOffset===0}function Rs(e,t,r){var n=(t||e).selection,o=(t||e).doc,i,a;if(n instanceof Ot&&(a=n.node.type.spec.tableRole)){if(a=="cell"||a=="header_cell"){i=As.create(o,n.from)}else if(a=="row"){var s=o.resolve(n.from+1);i=As.rowSelection(s,s)}else if(!r){var l=ls.get(n.node),c=n.from+1;var f=c+l.map[l.width*l.height-1];i=As.create(o,c+1,f)}}else if(n instanceof kt&&Es(n)){i=kt.create(o,n.from)}else if(n instanceof kt&&zs(n)){i=kt.create(o,n.$from.start(),n.$from.end())}if(i){(t||(t=e.tr)).setSelection(i)}return t}function Ls(e){if(!e.size){return null}var t=e.content;var r=e.openStart;var n=e.openEnd;while(t.childCount==1&&(r>0&&n>0||t.firstChild.type.spec.tableRole=="table")){r--;n--;t=t.firstChild.content}var o=t.firstChild,i=o.type.spec.tableRole;var a=o.type.schema,s=[];if(i=="row"){for(var l=0;l<t.childCount;l++){var c=t.child(l).content;var f=l?0:Math.max(0,r-1);var h=l<t.childCount-1?0:Math.max(0,n-1);if(f||h){c=$s(ps(a).row,new u(c,f,h)).content}s.push(c)}}else if(i=="cell"||i=="header_cell"){s.push(r||n?$s(ps(a).row,new u(t,r,n)).content:t)}else{return null}return Is(a,s)}function Is(e,t){var r=[];for(var n=0;n<t.length;n++){var i=t[n];for(var a=i.childCount-1;a>=0;a--){var s=i.child(a).attrs;var l=s.rowspan;var c=s.colspan;for(var f=n;f<n+l;f++){r[f]=(r[f]||0)+c}}}var u=0;for(var h=0;h<r.length;h++){u=Math.max(u,r[h])}for(var p=0;p<r.length;p++){if(p>=t.length){t.push(o.empty)}if(r[p]<u){var d=ps(e).cell.createAndFill(),v=[];for(var m=r[p];m<u;m++){v.push(d)}t[p]=t[p].append(o.from(v))}}return{height:t.length,width:u,rows:t}}function $s(e,t){var r=e.createAndFill();var n=new Be(r).replace(0,r.content.size,t);return n.doc}function Bs(e,t,r){var n=e.width;var i=e.height;var a=e.rows;if(n!=t){var s=[],l=[];for(var c=0;c<a.length;c++){var f=a[c],u=[];for(var h=s[c]||0,p=0;h<t;p++){var d=f.child(p%f.childCount);if(h+d.attrs.colspan>t){d=d.type.create(Ss(d.attrs,d.attrs.colspan,h+d.attrs.colspan-t),d.content)}u.push(d);h+=d.attrs.colspan;for(var v=1;v<d.attrs.rowspan;v++){s[c+v]=(s[c+v]||0)+d.attrs.colspan}}l.push(o.from(u))}a=l;n=t}if(i!=r){var m=[];for(var g=0,y=0;g<r;g++,y++){var w=[],b=a[y%i];for(var C=0;C<b.childCount;C++){var M=b.child(C);if(g+M.attrs.rowspan>r){M=M.type.create(ks(M.attrs,"rowspan",r-M.attrs.rowspan),M.content)}w.push(M)}m.push(o.from(w))}a=m;i=r}return{width:n,height:i,rows:a}}function Fs(e,t,r,n,i,a,s){var l=e.doc.type.schema,c=ps(l),f,u;if(i>t.width){for(var h=0,p=0;h<t.height;h++){var d=r.child(h);p+=d.nodeSize;var v=[],m=void 0;if(d.lastChild==null||d.lastChild.type==c.cell){m=f||(f=c.cell.createAndFill())}else{m=u||(u=c.header_cell.createAndFill())}for(var g=t.width;g<i;g++){v.push(m)}e.insert(e.mapping.slice(s).map(p-1+n),v)}}if(a>t.height){var y=[];for(var w=0,b=(t.height-1)*t.width;w<Math.max(t.width,i);w++){var C=w>=t.width?false:r.nodeAt(t.map[b+w]).type==c.header_cell;y.push(C?u||(u=c.header_cell.createAndFill()):f||(f=c.cell.createAndFill()))}var M=c.row.create(null,o.from(y)),x=[];for(var k=t.height;k<a;k++){x.push(M)}e.insert(e.mapping.slice(s).map(n+r.nodeSize-2),x)}return!!(f||u)}function Ps(e,t,r,n,o,i,a,s){if(a==0||a==t.height){return false}var l=false;for(var c=o;c<i;c++){var f=a*t.width+c,u=t.map[f];if(t.map[f-t.width]==u){l=true;var h=r.nodeAt(u);var p=t.findCell(u);var d=p.top;var v=p.left;e.setNodeMarkup(e.mapping.slice(s).map(u+n),null,ks(h.attrs,"rowspan",a-d));e.insert(e.mapping.slice(s).map(t.positionAt(a,v,r)),h.type.createAndFill(ks(h.attrs,"rowspan",d+h.attrs.rowspan-a)));c+=h.attrs.colspan-1}}return l}function _s(e,t,r,n,o,i,a,s){if(a==0||a==t.width){return false}var l=false;for(var c=o;c<i;c++){var f=c*t.width+a,u=t.map[f];if(t.map[f-1]==u){l=true;var h=r.nodeAt(u),p=t.colCount(u);var d=e.mapping.slice(s).map(u+n);e.setNodeMarkup(d,null,Ss(h.attrs,a-p,h.attrs.colspan-(a-p)));e.insert(d+h.nodeSize,h.type.createAndFill(Ss(h.attrs,0,a-p)));c+=h.attrs.rowspan-1}}return l}function Vs(e,t,r,n,o){var i=r?e.doc.nodeAt(r-1):e.doc,a=ls.get(i);var s=n.top;var l=n.left;var c=l+o.width,f=s+o.height;var h=e.tr,p=0;function d(){i=r?h.doc.nodeAt(r-1):h.doc;a=ls.get(i);p=h.mapping.maps.length}if(Fs(h,a,i,r,c,f,p)){d()}if(Ps(h,a,i,r,l,c,s,p)){d()}if(Ps(h,a,i,r,l,c,f,p)){d()}if(_s(h,a,i,r,s,f,l,p)){d()}if(_s(h,a,i,r,s,f,c,p)){d()}for(var v=s;v<f;v++){var m=a.positionAt(v,l,i),g=a.positionAt(v,c,i);h.replace(h.mapping.slice(p).map(m+r),h.mapping.slice(p).map(g+r),new u(o.rows[v-s],0,0))}d();h.setSelection(new As(h.doc.resolve(r+a.positionAt(s,l,i)),h.doc.resolve(r+a.positionAt(f-1,c-1,i))));t(h)}var qs=Qa({ArrowLeft:Ws("horiz",-1),ArrowRight:Ws("horiz",1),ArrowUp:Ws("vert",-1),ArrowDown:Ws("vert",1),"Shift-ArrowLeft":Hs("horiz",-1),"Shift-ArrowRight":Hs("horiz",1),"Shift-ArrowUp":Hs("vert",-1),"Shift-ArrowDown":Hs("vert",1),Backspace:Js,"Mod-Backspace":Js,Delete:Js,"Mod-Delete":Js});function js(e,t,r){if(r.eq(e.selection)){return false}if(t){t(e.tr.setSelection(r).scrollIntoView())}return true}function Ws(e,t){return function(r,n,o){var i=r.selection;if(i instanceof As){return js(r,n,Ct.near(i.$headCell,t))}if(e!="horiz"&&!i.empty){return false}var a=Gs(o,e,t);if(a==null){return false}if(e=="horiz"){return js(r,n,Ct.near(r.doc.resolve(i.head+t),t))}else{var s=r.doc.resolve(a),l=xs(s,e,t),c;if(l){c=Ct.near(l,1)}else if(t<0){c=Ct.near(r.doc.resolve(s.before(-1)),-1)}else{c=Ct.near(r.doc.resolve(s.after(-1)),1)}return js(r,n,c)}}}function Hs(e,t){return function(r,n,o){var i=r.selection;if(!(i instanceof As)){var a=Gs(o,e,t);if(a==null){return false}i=new As(r.doc.resolve(a))}var s=xs(i.$headCell,e,t);if(!s){return false}return js(r,n,new As(i.$anchorCell,s))}}function Js(e,t){var r=e.selection;if(!(r instanceof As)){return false}if(t){var n=e.tr,o=ps(e.schema).cell.createAndFill().content;r.forEachCell(function(e,t){if(!e.content.eq(o)){n.replace(n.mapping.map(t+1),n.mapping.map(t+e.nodeSize-1),new u(o,0,0))}});if(n.docChanged){t(n)}}return true}function Ks(e,t){var r=e.state.doc,n=vs(r.resolve(t));if(!n){return false}e.dispatch(e.state.tr.setSelection(new As(n)));return true}function Zs(e,t,r){if(!gs(e.state)){return false}var n=Ls(r),i=e.state.selection;if(i instanceof As){if(!n){n={width:1,height:1,rows:[o.from($s(ps(e.state.schema).cell,r))]}}var a=i.$anchorCell.node(-1),s=i.$anchorCell.start(-1);var l=ls.get(a).rectBetween(i.$anchorCell.pos-s,i.$headCell.pos-s);n=Bs(n,l.right-l.left,l.bottom-l.top);Vs(e.state,e.dispatch,s,l,n);return true}else if(n){var c=ys(e.state),f=c.start(-1);Vs(e.state,e.dispatch,f,ls.get(c.node(-1)).findCell(c.pos-f),n);return true}else{return false}}function Us(e,t){if(t.ctrlKey||t.metaKey){return}var r=Xs(e,t.target),n;if(t.shiftKey&&e.state.selection instanceof As){o(e.state.selection.$anchorCell,t);t.preventDefault()}else if(t.shiftKey&&r&&(n=vs(e.state.selection.$anchor))!=null&&Ys(e,t).pos!=n.pos){o(n,t);t.preventDefault()}else if(!r){return}function o(t,r){var n=Ys(e,r);var o=ds.getState(e.state)==null;if(!n||!Ms(t,n)){if(o){n=t}else{return}}var i=new As(t,n);if(o||!e.state.selection.eq(i)){var a=e.state.tr.setSelection(i);if(o){a.setMeta(ds,t.pos)}e.dispatch(a)}}function i(){e.root.removeEventListener("mouseup",i);e.root.removeEventListener("dragstart",i);e.root.removeEventListener("mousemove",a);if(ds.getState(e.state)!=null){e.dispatch(e.state.tr.setMeta(ds,-1))}}function a(n){var a=ds.getState(e.state),s;if(a!=null){s=e.state.doc.resolve(a)}else if(Xs(e,n.target)!=r){s=Ys(e,t);if(!s){return i()}}if(s){o(s,n)}}e.root.addEventListener("mouseup",i);e.root.addEventListener("dragstart",i);e.root.addEventListener("mousemove",a)}function Gs(e,t,r){if(!(e.state.selection instanceof kt)){return null}var n=e.state.selection;var o=n.$head;for(var i=o.depth-1;i>=0;i--){var a=o.node(i),s=r<0?o.index(i):o.indexAfter(i);if(s!=(r<0?0:a.childCount)){return null}if(a.type.spec.tableRole=="cell"||a.type.spec.tableRole=="header_cell"){var l=o.before(i);var c=t=="vert"?r>0?"down":"up":r>0?"right":"left";return e.endOfTextblock(c)?l:null}}return null}function Xs(e,t){for(;t&&t!=e.dom;t=t.parentNode){if(t.nodeName=="TD"||t.nodeName=="TH"){return t}}}function Ys(e,t){var r=e.posAtCoords({left:t.clientX,top:t.clientY});if(!r){return null}return r?vs(e.state.doc.resolve(r.pos)):null}var Qs=new Kt("fix-tables");function el(e,t,r,n){var o=e.childCount,i=t.childCount;e:for(var a=0,s=0;a<i;a++){var l=t.child(a);for(var c=s,f=Math.min(o,a+3);c<f;c++){if(e.child(c)==l){s=c+1;r+=l.nodeSize;continue e}}n(l,r);if(s<o&&e.child(s).sameMarkup(l)){el(e.child(s),l,r+1,n)}else{l.nodesBetween(0,l.content.size,n,r+1)}r+=l.nodeSize}}function tl(e,t){var r,n=function(t,n){if(t.type.spec.tableRole=="table"){r=rl(e,t,n,r)}};if(!t){e.doc.descendants(n)}else if(t.doc!=e.doc){el(t.doc,e.doc,0,n)}return r}function rl(e,t,r,n){var o=ls.get(t);if(!o.problems){return n}if(!n){n=e.tr}var i=[];for(var a=0;a<o.height;a++){i.push(0)}for(var s=0;s<o.problems.length;s++){var l=o.problems[s];if(l.type=="collision"){var c=t.nodeAt(l.pos);for(var f=0;f<c.attrs.rowspan;f++){i[l.row+f]+=l.n}n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,Ss(c.attrs,c.attrs.colspan-l.n,l.n))}else if(l.type=="missing"){i[l.row]+=l.n}else if(l.type=="overlong_rowspan"){var u=t.nodeAt(l.pos);n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,ks(u.attrs,"rowspan",u.attrs.rowspan-l.n))}else if(l.type=="colwidth mismatch"){var h=t.nodeAt(l.pos);n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,ks(h.attrs,"colwidth",l.colwidth))}}var p,d;for(var v=0;v<i.length;v++){if(i[v]){if(p==null){p=v}d=v}}for(var m=0,g=r+1;m<o.height;m++){var y=t.child(m);var w=g+y.nodeSize;var b=i[m];if(b>0){var C="cell";if(y.firstChild){C=y.firstChild.type.spec.tableRole}var M=[];for(var x=0;x<b;x++){M.push(ps(e.schema)[C].createAndFill())}var k=(m==0||p==m-1)&&d==m?g+1:w-1;n.insert(n.mapping.map(k),M)}g=w}return n.setMeta(Qs,{fixTables:true})}function nl(e){var t=e.selection,r=ys(e);var n=r.node(-1),o=r.start(-1),i=ls.get(n);var a;if(t instanceof As){a=i.rectBetween(t.$anchorCell.pos-o,t.$headCell.pos-o)}else{a=i.findCell(r.pos-o)}a.tableStart=o;a.map=i;a.table=n;return a}function ol(e,t,r){var n=t.map;var o=t.tableStart;var i=t.table;var a=r>0?-1:0;if(Ns(n,i,r+a)){a=r==0||r==n.width?null:0}for(var s=0;s<n.height;s++){var l=s*n.width+r;if(r>0&&r<n.width&&n.map[l-1]==n.map[l]){var c=n.map[l],f=i.nodeAt(c);e.setNodeMarkup(e.mapping.map(o+c),null,Os(f.attrs,r-n.colCount(c)));s+=f.attrs.rowspan-1}else{var u=a==null?ps(i.type.schema).cell:i.nodeAt(n.map[l+a]).type;var h=n.positionAt(s,r,i);e.insert(e.mapping.map(o+h),u.createAndFill())}}return e}function il(e,t){if(!gs(e)){return false}if(t){var r=nl(e);t(ol(e.tr,r,r.left))}return true}function al(e,t,r){var n=t.map;var o=t.table;var i=t.tableStart;var a=e.mapping.maps.length;for(var s=0;s<n.height;){var l=s*n.width+r,c=n.map[l],f=o.nodeAt(c);if(r>0&&n.map[l-1]==c||r<n.width-1&&n.map[l+1]==c){e.setNodeMarkup(e.mapping.slice(a).map(i+c),null,Ss(f.attrs,r-n.colCount(c)))}else{var u=e.mapping.slice(a).map(i+c);e.delete(u,u+f.nodeSize)}s+=f.attrs.rowspan}}function sl(e,t){if(!gs(e)){return false}if(t){var r=nl(e),n=e.tr;if(r.left==0&&r.right==r.map.width){return false}for(var o=r.right-1;;o--){al(n,r,o);if(o==r.left){break}r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc;r.map=ls.get(r.table)}t(n)}return true}function ll(e,t,r){var n=ps(t.type.schema).header_cell;for(var o=0;o<e.width;o++){if(t.nodeAt(e.map[o+r*e.width]).type!=n){return false}}return true}function cl(e,t,r){var n=t.map;var o=t.tableStart;var i=t.table;var a=o;for(var s=0;s<r;s++){a+=i.child(s).nodeSize}var l=[],c=r>0?-1:0;if(ll(n,i,r+c)){c=r==0||r==n.height?null:0}for(var f=0,u=n.width*r;f<n.width;f++,u++){if(r>0&&r<n.height&&n.map[u]==n.map[u-n.width]){var h=n.map[u],p=i.nodeAt(h).attrs;e.setNodeMarkup(o+h,null,ks(p,"rowspan",p.rowspan+1));f+=p.colspan-1}else{var d=c==null?ps(i.type.schema).cell:i.nodeAt(n.map[u+c*n.width]).type;l.push(d.createAndFill())}}e.insert(a,ps(i.type.schema).row.create(null,l));return e}function fl(e,t){if(!gs(e)){return false}if(t){var r=nl(e);t(cl(e.tr,r,r.top))}return true}function ul(e,t,r){var n=t.map;var o=t.table;var i=t.tableStart;var a=0;for(var s=0;s<r;s++){a+=o.child(s).nodeSize}var l=a+o.child(r).nodeSize;var c=e.mapping.maps.length;e.delete(a+i,l+i);for(var f=0,u=r*n.width;f<n.width;f++,u++){var h=n.map[u];if(r>0&&h==n.map[u-n.width]){var p=o.nodeAt(h).attrs;e.setNodeMarkup(e.mapping.slice(c).map(h+i),null,ks(p,"rowspan",p.rowspan-1));f+=p.colspan-1}else if(r<n.width&&h==n.map[u+n.width]){var d=o.nodeAt(h);var v=d.type.create(ks(d.attrs,"rowspan",d.attrs.rowspan-1),d.content);var m=n.positionAt(r+1,f,o);e.insert(e.mapping.slice(c).map(i+m),v);f+=d.attrs.colspan-1}}}function hl(e,t){if(!gs(e)){return false}if(t){var r=nl(e),n=e.tr;if(r.top==0&&r.bottom==r.map.height){return false}for(var o=r.bottom-1;;o--){ul(n,r,o);if(o==r.top){break}r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc;r.map=ls.get(r.table)}t(n)}return true}function pl(e){var t=e.content;return t.childCount==1&&t.firstChild.isTextblock&&t.firstChild.childCount==0}function dl(e,t){var r=e.width;var n=e.height;var o=e.map;var i=t.top*r+t.left,a=i;var s=(t.bottom-1)*r+t.left,l=i+(t.right-t.left-1);for(var c=t.top;c<t.bottom;c++){if(t.left>0&&o[a]==o[a-1]||t.right<r&&o[l]==o[l+1]){return true}a+=r;l+=r}for(var f=t.left;f<t.right;f++){if(t.top>0&&o[i]==o[i-r]||t.bottom<n&&o[s]==o[s+r]){return true}i++;s++}return false}function vl(e,t){var r=e.selection;if(!(r instanceof As)||r.$anchorCell.pos==r.$headCell.pos){return false}var n=nl(e);var i=n.map;if(dl(i,n)){return false}if(t){var a=e.tr,s={},l=o.empty,c,f;for(var u=n.top;u<n.bottom;u++){for(var h=n.left;h<n.right;h++){var p=i.map[u*i.width+h],d=n.table.nodeAt(p);if(s[p]){continue}s[p]=true;if(c==null){c=p;f=d}else{if(!pl(d)){l=l.append(d.content)}var v=a.mapping.map(p+n.tableStart);a.delete(v,v+d.nodeSize)}}}a.setNodeMarkup(c+n.tableStart,null,ks(Os(f.attrs,f.attrs.colspan,n.right-n.left-f.attrs.colspan),"rowspan",n.bottom-n.top));if(l.size){var m=c+1+f.content.size;var g=pl(f)?c+1:m;a.replaceWith(g+n.tableStart,m+n.tableStart,l)}a.setSelection(new As(a.doc.resolve(c+n.tableStart)));t(a)}return true}function ml(e,t){var r=ps(e.schema);return gl(function(e){var t=e.node;return r[t.type.spec.tableRole]})(e,t)}function gl(e){return function(t,r){var n=t.selection;var o,i;if(!(n instanceof As)){o=ms(n.$from);if(!o){return false}i=vs(n.$from).pos}else{if(n.$anchorCell.pos!=n.$headCell.pos){return false}o=n.$anchorCell.nodeAfter;i=n.$anchorCell.pos}if(o.attrs.colspan==1&&o.attrs.rowspan==1){return false}if(r){var a=o.attrs,s=[],l=a.colwidth;if(a.rowspan>1){a=ks(a,"rowspan",1)}if(a.colspan>1){a=ks(a,"colspan",1)}var c=nl(t),f=t.tr;for(var u=0;u<c.right-c.left;u++){s.push(l?ks(a,"colwidth",l&&l[u]?[l[u]]:null):a)}var h;for(var p=c.top;p<c.bottom;p++){var d=c.map.positionAt(p,c.left,c.table);if(p==c.top){d+=o.nodeSize}for(var v=c.left,m=0;v<c.right;v++,m++){if(v==c.left&&p==c.top){continue}f.insert(h=f.mapping.map(d+c.tableStart,1),e({node:o,row:p,col:v}).createAndFill(s[m]))}}f.setNodeMarkup(i,e({node:o,row:c.top,col:c.left}),s[0]);if(n instanceof As){f.setSelection(new As(f.doc.resolve(n.$anchorCell.pos),h&&f.doc.resolve(h)))}r(f)}return true}}function yl(e){return function(t,r){if(!gs(t)){return false}if(r){var n=ps(t.schema);var o=nl(t),i=t.tr;var a=o.map.cellsInRect(e=="column"?new ss(o.left,0,o.right,o.map.height):e=="row"?new ss(0,o.top,o.map.width,o.bottom):o);var s=a.map(function(e){return o.table.nodeAt(e)});for(var l=0;l<a.length;l++){if(s[l].type==n.header_cell){i.setNodeMarkup(o.tableStart+a[l],n.cell,s[l].attrs)}}if(i.steps.length==0){for(var c=0;c<a.length;c++){i.setNodeMarkup(o.tableStart+a[c],n.header_cell,s[c].attrs)}}r(i)}return true}}function wl(e,t,r){var n=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(var o=0;o<n.length;o++){var i=t.table.nodeAt(n[o]);if(i&&i.type!==r.header_cell){return false}}return true}function bl(e,t){t=t||{useDeprecatedLogic:false};if(t.useDeprecatedLogic){return yl(e)}return function(t,r){if(!gs(t)){return false}if(r){var n=ps(t.schema);var o=nl(t),i=t.tr;var a=wl("row",o,n);var s=wl("column",o,n);var l=e==="column"?a:e==="row"?s:false;var c=l?1:0;var f=e=="column"?new ss(0,c,1,o.map.height):e=="row"?new ss(c,0,o.map.width,1):o;var u=e=="column"?s?n.cell:n.header_cell:e=="row"?a?n.cell:n.header_cell:n.cell;o.map.cellsInRect(f).forEach(function(e){var t=e+o.tableStart;var r=i.doc.nodeAt(t);if(r){i.setNodeMarkup(t,u,r.attrs)}});r(i)}return true}}var Cl=bl("row",{useDeprecatedLogic:true});var Ml=bl("column",{useDeprecatedLogic:true});var xl=bl("cell",{useDeprecatedLogic:true});function kl(e,t){if(t<0){var r=e.nodeBefore;if(r){return e.pos-r.nodeSize}for(var n=e.index(-1)-1,o=e.before();n>=0;n--){var i=e.node(-1).child(n);if(i.childCount){return o-1-i.lastChild.nodeSize}o-=i.nodeSize}}else{if(e.index()<e.parent.childCount-1){return e.pos+e.nodeAfter.nodeSize}var a=e.node(-1);for(var s=e.indexAfter(-1),l=e.after();s<a.childCount;s++){var c=a.child(s);if(c.childCount){return l+1}l+=c.nodeSize}}}function Sl(e){return function(t,r){if(!gs(t)){return false}var n=kl(ys(t),e);if(n==null){return}if(r){var o=t.doc.resolve(n);r(t.tr.setSelection(kt.between(o,Cs(o))).scrollIntoView())}return true}}function Ol(e,t){var r=e.selection.$anchor;for(var n=r.depth;n>0;n--){var o=r.node(n);if(o.type.spec.tableRole=="table"){if(t){t(e.tr.delete(r.before(n),r.after(n)).scrollIntoView())}return true}}return false}var Nl=function e(t,r){this.node=t;this.cellMinWidth=r;this.dom=document.createElement("div");this.dom.className="tableWrapper";this.table=this.dom.appendChild(document.createElement("table"));this.table.className=t.attrs.class;this.colgroup=this.table.appendChild(document.createElement("colgroup"));Al(t,this.colgroup,this.table,r);this.contentDOM=this.table.appendChild(document.createElement("tbody"))};Nl.prototype.update=function e(t){if(t.type!=this.node.type){return false}this.node=t;Al(t,this.colgroup,this.table,this.cellMinWidth);return true};Nl.prototype.ignoreMutation=function e(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))};function Al(e,t,r,n,o,i){var a=0,s=true;var l=t.firstChild,c=e.firstChild;for(var f=0,u=0;f<c.childCount;f++){var h=c.child(f).attrs;var p=h.colspan;var d=h.colwidth;for(var v=0;v<p;v++,u++){var m=o==u?i:d&&d[v];var g=m?m+"px":"";a+=m||n;if(!m){s=false}if(!l){t.appendChild(document.createElement("col")).style.width=g}else{if(l.style.width!=g){l.style.width=g}l=l.nextSibling}}}while(l){var y=l.nextSibling;l.parentNode.removeChild(l);l=y}if(s){r.style.width=a+"px";r.style.minWidth=""}else{r.style.width="";r.style.minWidth=a+"px"}r.className=e.attrs.class}var Dl=new Kt("tableColumnResizing");function Tl(e){if(e===void 0)e={};var t=e.handleWidth;if(t===void 0)t=5;var r=e.cellMinWidth;if(r===void 0)r=25;var n=e.View;if(n===void 0)n=Nl;var o=e.lastColumnResizable;if(o===void 0)o=true;var i=new Wt({key:Dl,state:{init:function e(t,o){this.spec.props.nodeViews[ps(o.schema).table.name]=function(e,t){return new n(e,r,t)};return new El(-1,false)},apply:function e(t,r){return r.apply(t)}},props:{attributes:function e(t){var r=Dl.getState(t);return r.activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function e(n,i){zl(n,i,t,r,o)},mouseleave:function e(t){Rl(t)},mousedown:function e(t,n){Ll(t,n,r)}},decorations:function e(t){var r=Dl.getState(t);if(r.activeHandle>-1){return jl(t,r.activeHandle)}},nodeViews:{}}});return i}var El=function e(t,r){this.activeHandle=t;this.dragging=r};El.prototype.apply=function e(t){var r=this,n=t.getMeta(Dl);if(n&&n.setHandle!=null){return new El(n.setHandle,null)}if(n&&n.setDragging!==undefined){return new El(r.activeHandle,n.setDragging)}if(r.activeHandle>-1&&t.docChanged){var o=t.mapping.map(r.activeHandle,-1);if(!bs(t.doc.resolve(o))){o=null}r=new El(o,r.dragging)}return r};function zl(e,t,r,n,o){var i=Dl.getState(e.state);if(!i.dragging){var a=$l(t.target),s=-1;if(a){var l=a.getBoundingClientRect();var c=l.left;var f=l.right;if(t.clientX-c<=r){s=Bl(e,t,"left")}else if(f-t.clientX<=r){s=Bl(e,t,"right")}}if(s!=i.activeHandle){if(!o&&s!==-1){var u=e.state.doc.resolve(s);var h=u.node(-1),p=ls.get(h),d=u.start(-1);var v=p.colCount(u.pos-d)+u.nodeAfter.attrs.colspan-1;if(v==p.width-1){return}}Pl(e,s)}}}function Rl(e){var t=Dl.getState(e.state);if(t.activeHandle>-1&&!t.dragging){Pl(e,-1)}}function Ll(e,t,r){var n=Dl.getState(e.state);if(n.activeHandle==-1||n.dragging){return false}var o=e.state.doc.nodeAt(n.activeHandle);var i=Il(e,n.activeHandle,o.attrs);e.dispatch(e.state.tr.setMeta(Dl,{setDragging:{startX:t.clientX,startWidth:i}}));function a(t){window.removeEventListener("mouseup",a);window.removeEventListener("mousemove",s);var n=Dl.getState(e.state);if(n.dragging){_l(e,n.activeHandle,Fl(n.dragging,t,r));e.dispatch(e.state.tr.setMeta(Dl,{setDragging:null}))}}function s(t){if(!t.which){return a(t)}var n=Dl.getState(e.state);var o=Fl(n.dragging,t,r);Vl(e,n.activeHandle,o,r)}window.addEventListener("mouseup",a);window.addEventListener("mousemove",s);t.preventDefault();return true}function Il(e,t,r){var n=r.colspan;var o=r.colwidth;var i=o&&o[o.length-1];if(i){return i}var a=e.domAtPos(t);var s=a.node.childNodes[a.offset];var l=s.offsetWidth,c=n;if(o){for(var f=0;f<n;f++){if(o[f]){l-=o[f];c--}}}return l/c}function $l(e){while(e&&e.nodeName!="TD"&&e.nodeName!="TH"){e=e.classList.contains("ProseMirror")?null:e.parentNode}return e}function Bl(e,t,r){var n=e.posAtCoords({left:t.clientX,top:t.clientY});var o=n.pos;var i=vs(e.state.doc.resolve(o));if(!i){return-1}if(r=="right"){return i.pos}var a=ls.get(i.node(-1)),s=i.start(-1);var l=a.map.indexOf(i.pos-s);return l%a.width==0?-1:s+a.map[l-1]}function Fl(e,t,r){var n=t.clientX-e.startX;return Math.max(r,e.startWidth+n)}function Pl(e,t){e.dispatch(e.state.tr.setMeta(Dl,{setHandle:t}))}function _l(e,t,r){var n=e.state.doc.resolve(t);var o=n.node(-1),i=ls.get(o),a=n.start(-1);var s=i.colCount(n.pos-a)+n.nodeAfter.attrs.colspan-1;var l=e.state.tr;for(var c=0;c<i.height;c++){var f=c*i.width+s;if(c&&i.map[f]==i.map[f-i.width]){continue}var u=i.map[f];var h=o.nodeAt(u);var p=h.attrs;var d=p.colspan==1?0:s-i.colCount(u);if(p.colwidth&&p.colwidth[d]==r){continue}var v=p.colwidth?p.colwidth.slice():ql(p.colspan);v[d]=r;l.setNodeMarkup(a+u,null,ks(p,"colwidth",v))}if(l.docChanged){e.dispatch(l)}}function Vl(e,t,r,n){var o=e.state.doc.resolve(t);var i=o.node(-1),a=o.start(-1);var s=ls.get(i).colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1;var l=e.domAtPos(o.start(-1)).node;while(l.nodeName!="TABLE"){l=l.parentNode}Al(i,l.firstChild,l,n,s,r)}function ql(e){var t=[];for(var r=0;r<e;r++){t.push(0)}return t}function jl(e,t){var r=[];var n=e.doc.resolve(t);var o=n.node(-1),i=ls.get(o),a=n.start(-1);var s=i.colCount(n.pos-a)+n.nodeAfter.attrs.colspan;for(var l=0;l<i.height;l++){var c=s+l*i.width-1;if((s==i.width||i.map[c]!=i.map[c+1])&&(l==0||i.map[c-1]!=i.map[c-1-i.width])){var f=i.map[c];var u=a+f+o.nodeAt(f).nodeSize-1;var h=document.createElement("div");h.className="column-resize-handle";r.push(si.widget(u,h))}}return ui.create(e.doc,r)}function Wl(e){if(e===void 0)e={};var t=e.allowTableNodeSelection;if(t===void 0)t=false;return new Wt({key:ds,state:{init:function e(){return null},apply:function e(t,r){var n=t.getMeta(ds);if(n!=null){return n==-1?null:n}if(r==null||!t.docChanged){return r}var o=t.mapping.mapResult(r);var i=o.deleted;var a=o.pos;return i?null:a}},props:{decorations:Ts,handleDOMEvents:{mousedown:Us},createSelectionBetween:function e(t){if(ds.getState(t.state)!=null){return t.state.selection}},handleTripleClick:Ks,handleKeyDown:qs,handlePaste:Zs},appendTransaction:function e(r,n,o){return Rs(o,tl(o,n),t)}})}function Hl(){var e=arguments[0];if(typeof e=="string")e=document.createElement(e);var t=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var o=r[n];if(typeof o=="string")e.setAttribute(n,o);else if(o!=null)e[n]=o}t++}for(;t<arguments.length;t++)Jl(e,arguments[t]);return e}function Jl(e,t){if(typeof t=="string"){e.appendChild(document.createTextNode(t))}else if(t==null);else if(t.nodeType!=null){e.appendChild(t)}else if(Array.isArray(t)){for(var r=0;r<t.length;r++)Jl(e,t[r])}else{throw new RangeError("Unsupported child node: "+t)}}var Kl="http://www.w3.org/2000/svg";var Zl="http://www.w3.org/1999/xlink";var Ul="ProseMirror-icon";function Gl(e){var t=0;for(var r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r)|0}return t}function Xl(e){var t=document.createElement("div");t.className=Ul;if(e.path){var r="pm-icon-"+Gl(e.path).toString(16);if(!document.getElementById(r)){Yl(r,e)}var n=t.appendChild(document.createElementNS(Kl,"svg"));n.style.width=e.width/e.height+"em";var o=n.appendChild(document.createElementNS(Kl,"use"));o.setAttributeNS(Zl,"href",/([^#]*)/.exec(document.location)[1]+"#"+r)}else if(e.dom){t.appendChild(e.dom.cloneNode(true))}else{t.appendChild(document.createElement("span")).textContent=e.text||"";if(e.css){t.firstChild.style.cssText=e.css}}return t}function Yl(e,t){var r=document.getElementById(Ul+"-collection");if(!r){r=document.createElementNS(Kl,"svg");r.id=Ul+"-collection";r.style.display="none";document.body.insertBefore(r,document.body.firstChild)}var n=document.createElementNS(Kl,"symbol");n.id=e;n.setAttribute("viewBox","0 0 "+t.width+" "+t.height);var o=n.appendChild(document.createElementNS(Kl,"path"));o.setAttribute("d",t.path);r.appendChild(n)}var Ql="ProseMirror-menu";var ec=function e(t){this.spec=t};ec.prototype.render=function e(t){var r=this.spec;var n=r.render?r.render(t):r.icon?Xl(r.icon):r.label?Hl("div",null,tc(t,r.label)):null;if(!n){throw new RangeError("MenuItem without icon or label property")}if(r.title){var o=typeof r.title==="function"?r.title(t.state):r.title;n.setAttribute("title",tc(t,o))}if(r.class){n.classList.add(r.class)}if(r.css){n.style.cssText+=r.css}n.addEventListener("mousedown",function(e){e.preventDefault();if(!n.classList.contains(Ql+"-disabled")){r.run(t.state,t.dispatch,t,e)}});function i(e){if(r.select){var t=r.select(e);n.style.display=t?"":"none";if(!t){return false}}var o=true;if(r.enable){o=r.enable(e)||false;yc(n,Ql+"-disabled",!o)}if(r.active){var i=o&&r.active(e)||false;yc(n,Ql+"-active",i)}return true}return{dom:n,update:i}};function tc(e,t){return e._props.translate?e._props.translate(t):t}var rc={time:0,node:null};function nc(e){rc.time=Date.now();rc.node=e.target}function oc(e){return Date.now()-100<rc.time&&rc.node&&e.contains(rc.node)}var ic=function e(t,r){this.options=r||{};this.content=Array.isArray(t)?t:[t]};ic.prototype.render=function e(t){var r=this;var n=ac(this.content,t);var o=Hl("div",{class:Ql+"-dropdown "+(this.options.class||""),style:this.options.css},tc(t,this.options.label));if(this.options.title){o.setAttribute("title",tc(t,this.options.title))}var i=Hl("div",{class:Ql+"-dropdown-wrap"},o);var a=null,s=null;var l=function(){if(a&&a.close()){a=null;window.removeEventListener("mousedown",s)}};o.addEventListener("mousedown",function(e){e.preventDefault();nc(e);if(a){l()}else{a=r.expand(i,n.dom);window.addEventListener("mousedown",s=function(){if(!oc(i)){l()}})}});function c(e){var t=n.update(e);i.style.display=t?"":"none";return t}return{dom:i,update:c}};ic.prototype.expand=function e(t,r){var n=Hl("div",{class:Ql+"-dropdown-menu "+(this.options.class||"")},r);var o=false;function i(){if(o){return}o=true;t.removeChild(n);return true}t.appendChild(n);return{close:i,node:n}};function ac(e,t){var r=[],n=[];for(var o=0;o<e.length;o++){var i=e[o].render(t);var a=i.dom;var s=i.update;r.push(Hl("div",{class:Ql+"-dropdown-item"},a));n.push(s)}return{dom:r,update:sc(n,r)}}function sc(e,t){return function(r){var n=false;for(var o=0;o<e.length;o++){var i=e[o](r);t[o].style.display=i?"":"none";if(i){n=true}}return n}}function lc(e,t){var r=document.createDocumentFragment();var n=[],o=[];for(var i=0;i<t.length;i++){var a=t[i],s=[],l=[];for(var c=0;c<a.length;c++){var f=a[c].render(e);var u=f.dom;var h=f.update;var p=Hl("span",{class:Ql+"item"},u);r.appendChild(p);l.push(p);s.push(h)}if(s.length){n.push(sc(s,l));if(i<t.length-1){o.push(r.appendChild(cc()))}}}function d(e){var t=false,r=false;for(var i=0;i<n.length;i++){var a=n[i](e);if(i){o[i-1].style.display=r&&a?"":"none"}r=a;if(a){t=true}}return t}return{dom:r,update:d}}function cc(){return Hl("span",{class:Ql+"separator"})}var fc={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}};var uc=new ec({title:"Join with above block",run:ha,select:function(e){return ha(e)},icon:fc.join});var hc=new ec({title:"Lift out of enclosing block",run:da,select:function(e){return da(e)},icon:fc.lift});var pc=new ec({title:"Select parent node",run:Ca,select:function(e){return Ca(e)},icon:fc.selectParentNode});var dc=new ec({title:"Undo last change",run:ra,enable:function(e){return ra(e)},icon:fc.undo});var vc=new ec({title:"Redo last undone change",run:na,enable:function(e){return na(e)},icon:fc.redo});function mc(e,t){var r={run:function r(n,o){return Sa(e,t.attrs)(n,o)},select:function r(n){return Sa(e,t.attrs instanceof Function?null:t.attrs)(n)}};for(var n in t){r[n]=t[n]}return new ec(r)}function gc(e,t){var r=Oa(e,t.attrs);var n={run:r,enable:function e(t){return r(t)},active:function r(n){var o=n.selection;var i=o.$from;var a=o.to;var s=o.node;if(s){return s.hasMarkup(e,t.attrs)}return a<=i.end()&&i.parent.hasMarkup(e,t.attrs)}};for(var o in t){n[o]=t[o]}return new ec(n)}function yc(e,t,r){if(r){e.classList.add(t)}else{e.classList.remove(t)}}var wc="ProseMirror-menubar";function bc(){if(typeof navigator=="undefined"){return false}var e=navigator.userAgent;return!/Edge\/\d/.test(e)&&/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e)}function Cc(e){return new Wt({view:function t(r){return new Mc(r,e)}})}var Mc=function e(t,r){var n=this;this.editorView=t;this.options=r;this.wrapper=Hl("div",{class:wc+"-wrapper"});this.menu=this.wrapper.appendChild(Hl("div",{class:wc}));this.menu.className=wc;this.spacer=null;t.dom.parentNode.replaceChild(this.wrapper,t.dom);this.wrapper.appendChild(t.dom);this.maxHeight=0;this.widthForMaxHeight=0;this.floating=false;var o=lc(this.editorView,this.options.content);var i=o.dom;var a=o.update;this.contentUpdate=a;this.menu.appendChild(i);this.update();if(r.floating&&!bc()){this.updateFloat();var s=Sc(this.wrapper);this.scrollFunc=function(e){var t=n.editorView.root;if(!(t.body||t).contains(n.wrapper)){s.forEach(function(e){return e.removeEventListener("scroll",n.scrollFunc)})}else{n.updateFloat(e.target.getBoundingClientRect&&e.target)}};s.forEach(function(e){return e.addEventListener("scroll",n.scrollFunc)})}};Mc.prototype.update=function e(){this.contentUpdate(this.editorView.state);if(this.floating){this.updateScrollCursor()}else{if(this.menu.offsetWidth!=this.widthForMaxHeight){this.widthForMaxHeight=this.menu.offsetWidth;this.maxHeight=0}if(this.menu.offsetHeight>this.maxHeight){this.maxHeight=this.menu.offsetHeight;this.menu.style.minHeight=this.maxHeight+"px"}}};Mc.prototype.updateScrollCursor=function e(){var t=this.editorView.root.getSelection();if(!t.focusNode){return}var r=t.getRangeAt(0).getClientRects();var n=r[xc(t)?0:r.length-1];if(!n){return}var o=this.menu.getBoundingClientRect();if(n.top<o.bottom&&n.bottom>o.top){var i=kc(this.wrapper);if(i){i.scrollTop-=o.bottom-n.top}}};Mc.prototype.updateFloat=function e(t){var r=this.wrapper,n=r.getBoundingClientRect(),o=t?Math.max(0,t.getBoundingClientRect().top):0;if(this.floating){if(n.top>=o||n.bottom<this.menu.offsetHeight+10){this.floating=false;this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="";this.menu.style.display="";this.spacer.parentNode.removeChild(this.spacer);this.spacer=null}else{var i=(r.offsetWidth-r.clientWidth)/2;this.menu.style.left=n.left+i+"px";this.menu.style.display=n.top>window.innerHeight?"none":"";if(t){this.menu.style.top=o+"px"}}}else{if(n.top<o&&n.bottom>=this.menu.offsetHeight+10){this.floating=true;var a=this.menu.getBoundingClientRect();this.menu.style.left=a.left+"px";this.menu.style.width=a.width+"px";if(t){this.menu.style.top=o+"px"}this.menu.style.position="fixed";this.spacer=Hl("div",{class:wc+"-spacer",style:"height: "+a.height+"px"});r.insertBefore(this.spacer,this.menu)}}};Mc.prototype.destroy=function e(){if(this.wrapper.parentNode){this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)}};function xc(e){if(e.anchorNode==e.focusNode){return e.anchorOffset>e.focusOffset}return e.anchorNode.compareDocumentPosition(e.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function kc(e){for(var t=e.parentNode;t;t=t.parentNode){if(t.scrollHeight>t.clientHeight){return t}}}function Sc(e){var t=[window];for(var r=e.parentNode;r;r=r.parentNode){t.push(r)}return t}const Oc=Object.freeze([0,0,0,0,0,0,0,0,0]);const Nc=Object.freeze({NULL:0,RATIONAL:1,COMPLEX:2,BOOLEAN:4,FROMCOMPARISON:8,BOOLEANFROMCOMPARISON:12,STRING:16,QUANTITY:32,DATE:64,RANGE:128,TUPLE:256,DICT:512,MAP:1024,ROWVECTOR:2048,COLUMNVECTOR:4096,MATRIX:8192,DATAFRAME:16384,MODULE:32768,ERROR:65536,UNIT:131072,IMAGE:262144});function Ac(e,t){let r=e.getAttribute("data-colwidth");let n=r&&/^\d+(,\d+)*$/.test(r)?r.split(",").map(e=>Number(e)):null;let o=Number(e.getAttribute("colspan")||1);let i={colspan:o,rowspan:Number(e.getAttribute("rowspan")||1),colwidth:n&&n.length==o?n:null};for(let r in t){let n=t[r].getFromDOM;let o=n&&n(e);if(o!=null)i[r]=o}return i}function Dc(e,t){let r={};if(e.attrs.colspan!=1)r.colspan=e.attrs.colspan;if(e.attrs.rowspan!=1)r.rowspan=e.attrs.rowspan;if(e.attrs.colwidth)r["data-colwidth"]=e.attrs.colwidth.join(",");for(let n in t){let o=t[n].setDOMAttr;if(o)o(e.attrs[n],r)}return r}const Tc=/= *fetch\(/;const Ec={doc:{content:"block+",attrs:{decimalFormat:{default:"1,000,000."},inDraftMode:{default:false}}},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},indented_paragraph:{group:"block",content:"inline*",toDOM(){return["p",{class:"indented"},0]},parseDOM:[{tag:"p.indented"}]},hidden_paragraph:{group:"block",content:"inline*",toDOM(){return["p",{class:"hidden"},0]},parseDOM:[{tag:"p.hidden"}]},blockquote:{content:"block+",group:"block",defining:true,parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:true,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:true,defining:true,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:true,attrs:{src:{},alt:{default:null},width:{default:"100"},class:{default:"inline"}},group:"inline",draggable:true,parseDOM:[{tag:"img[src]",getAttrs(e){return{src:e.getAttribute("src"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),class:e.getAttribute("class")}}}],toDOM(e){return["img",e.attrs]}},ordered_list:{attrs:{order:{default:1}},content:"list_item+",group:"block",parseDOM:[{tag:"ol",getAttrs(e){return{order:e.hasAttribute("start")?+e.getAttribute("start"):1}}}],toDOM(e){return e.attrs.order==1?["ol",0]:["ol",{start:e.attrs.order},0]}},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM(){return["ul",0]}},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM(){return["li",0]},defining:true},hard_break:{inline:true,group:"inline",selectable:false,parseDOM:[{tag:"br"}],toDOM(){return["br"]}},table:{content:"table_row+",tableRole:"table",group:"block",attrs:{class:{default:"grid"}},parseDOM:[{tag:"table",getAttrs(e){return{class:e.getAttribute("class")}}}],toDOM(e){return["table",{class:e.attrs.class},["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}},table_cell:{content:"block+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",isolating:true,parseDOM:[{tag:"td",getAttrs:e=>Ac(e,[])}],toDOM(e){return["td",Dc(e,[]),0]}},table_header:{content:"block+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:true,parseDOM:[{tag:"th",getAttrs:e=>Ac(e,[])}],toDOM(e){return["th",Dc(e,[]),0]}},header:{content:"table",group:"block",defining:true,parseDOM:[{tag:"header"}],toDOM(){return["header",0]}},calculation:{atom:true,defining:false,marks:"",group:"inline",inline:true,attrs:{entry:{default:""},name:{default:null},tex:{default:""},alt:{default:""},rpn:{default:null},inDraftMode:{default:false},resulttemplate:{default:null},altresulttemplate:{default:null},resultdisplay:{default:null},template:{default:null},altTemplate:{default:""},value:{default:null},unit:{default:null},factor:{default:null},gauge:{default:null},expos:{default:null},dtype:{default:0},isFetch:{default:false},error:{default:false}},parseDOM:[{tag:"span.hurmet-calc",getAttrs(e){return{entry:e.getAttribute("data-entry")}}}],toDOM(e){let t;if(e.attrs.dtype!==Nc.IMAGE){t=document.createElement("span");t.classList="hurmet-calc";if(e.attrs.dtype&&e.attrs.dtype===Nc.MODULE&&!Tc.test(e.attrs.entry)){t.appendChild(document.createElement("pre"));t.firstChild.appendChild(document.createElement("code"));t.firstChild.firstChild.textContent=e.attrs.entry}else if(e.attrs.inDraftMode||!e.attrs.tex){t.appendChild(document.createElement("code"));t.firstChild.textContent=e.attrs.alt?e.attrs.alt:e.attrs.entry}else{const r=e.attrs.tex;const n="MozAppearance"in document.documentElement.style;katex.render(r,t,{displayMode:false,strict:false,throwOnError:false,output:n?"mathml":"htmlAndMathml"})}t.dataset.entry=e.attrs.entry}else{t=document.createElement("canvas");t.classList="hurmet-calc";const r=e.attrs.value;const n=t.getContext("2d");const o=new Chart(n,r)}return t}},tex:{atom:true,marks:"",group:"inline",inline:true,attrs:{tex:{default:""},isSelected:{default:false}},parseDOM:[{tag:"span.hurmet-tex",getAttrs(e){return{tex:e.getAttribute("data-tex")}}}],toDOM(e){const t=document.createElement("span");t.classList="hurmet-tex";const r=e.attrs.tex;t.dataset.tex=r;if(e.attrs.isSelected){t.innerText=r}else{katex.render(r,t,{displayMode:false,strict:false,throwOnError:false})}return t}}};const zc={link:{attrs:{href:{},title:{default:null}},inclusive:false,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM(e){return["a",e.attrs]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!="normal"&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong"]}},code:{parseDOM:[{tag:"code"}],toDOM(){return["code"]}},subscript:{excludes:"superscript",parseDOM:[{tag:"sub"}],toDOM(){return["sub"]}},superscript:{excludes:"subscript",parseDOM:[{tag:"sup"}],toDOM(){return["sup"]}},strikethru:{parseDOM:[{tag:"s"}],toDOM(){return["s"]}},underline:{parseDOM:[{tag:"u"}],toDOM(){return["u"]}}};function Rc(e,t){return function(r,n){let{$from:o,$to:i}=r.selection;let a=o.blockRange(i),s=false,l=a;if(!a)return false;if(a.depth>=2&&o.node(a.depth-1).type.compatibleContent(e)&&a.startIndex==0){if(o.index(a.depth-1)==0)return false;let e=r.doc.resolve(a.start-2);l=new T(e,e,a.depth);if(a.endIndex<a.parent.childCount)a=new T(o,r.doc.resolve(i.end(a.depth)),a.depth);s=true}let c=Ze(l,e,t,a);if(!c)return false;if(n)n(Lc(r.tr,a,c,s,e).scrollIntoView());return true}}function Lc(e,t,r,n,i){let a=o.empty;for(let e=r.length-1;e>=0;e--)a=o.from(r[e].type.create(r[e].attrs,a));e.step(new We(t.start-(n?2:0),t.end,t.start,t.end,new u(a,0,0),r.length,true));let s=0;for(let e=0;e<r.length;e++)if(r[e].type==i)s=e+1;let l=r.length-s;let c=t.start+r.length-(n?2:0),f=t.parent;for(let r=t.startIndex,n=t.endIndex,o=true;r<n;r++,o=false){if(!o&&Qe(e.doc,c,l)){e.split(c,l);c+=2*l}c+=f.child(r).nodeSize}return e}const Ic=new se({nodes:Ec,marks:zc});const $c="ProseMirror-prompt";function Bc(e){const t=document.body.appendChild(document.createElement("div"));t.className=$c;const r=e=>{if(!t.contains(e.target)){n()}};setTimeout(()=>window.addEventListener("mousedown",r),50);const n=()=>{window.removeEventListener("mousedown",r);if(t.parentNode){t.parentNode.removeChild(t)}};const o=[];for(const t in e.fields){if(!(t==="src"&&e.fields.src.options.value)){o.push(e.fields[t].render())}}const i=document.createElement("button");i.type="submit";i.className=$c+"-submit";i.textContent="OK";const a=document.createElement("button");a.type="button";a.className=$c+"-cancel";a.textContent="Cancel";a.addEventListener("click",n);const s=t.appendChild(document.createElement("form"));if(e.title){s.appendChild(document.createElement("h5")).textContent=e.title}o.forEach(e=>{s.appendChild(document.createElement("div")).appendChild(e)});const l=s.appendChild(document.createElement("div"));l.className=$c+"-buttons";l.appendChild(i);l.appendChild(document.createTextNode(" "));l.appendChild(a);if(e.useOkButton){l.lastChild.style.float="right";l.style.display="block"}const c=t.getBoundingClientRect();t.style.top=(window.innerHeight-c.height)/2+"px";t.style.left=(window.innerWidth-c.width)/2+"px";const f=()=>{const t=Fc(e.fields,o);if(t){n();e.callback(t)}};s.addEventListener("submit",e=>{e.preventDefault();f()});s.addEventListener("keydown",r=>{if(r.keyCode===27){r.preventDefault();n()}else if(r.keyCode===13){const t=e.useOkButton&&r.shiftKey?true:!e.useOkButton&&!(r.ctrlKey||r.metaKey||r.shiftKey)?true:false;if(t){r.preventDefault();f()}}else if(r.keyCode===9){window.setTimeout(()=>{if(!t.contains(document.activeElement)){n()}},500)}});const u=s.elements[0];if(u){u.focus()}}function Fc(e,t){const r=Object.create(null);let n=0;for(const o in e){if(o==="src"&&e.src.options.value){r.src=e.src.options.value}else{const i=e[o];const a=t[n++];const s=i.read(a);const l=i.validate(s);if(l){Pc(a,l);return null}r[o]=i.clean(s)}}return r}function Pc(e,t){const r=e.parentNode;const n=r.appendChild(document.createElement("div"));n.style.left=e.offsetLeft+e.offsetWidth+2+"px";n.style.top=e.offsetTop-5+"px";n.className="ProseMirror-invalid";n.textContent=t;setTimeout(()=>r.removeChild(n),1500)}class _c{constructor(e){this.options=e}read(e){return e.value}validateType(e){}validate(e){if(!e&&this.options.required){return"Required field"}return this.validateType(e)||this.options.validate&&this.options.validate(e)}clean(e){return this.options.clean?this.options.clean(e):e}}class Vc extends _c{render(){const e=document.createElement("input");e.type="text";e.placeholder=this.options.label;e.value=this.options.value||"";e.autocomplete="off";return e}}const qc="ProseMirror-prompt";function jc(e){const t=document.body.appendChild(document.createElement("div"));t.className=qc;const r=e=>{if(!t.contains(e.target)){n()}};setTimeout(()=>window.addEventListener("mousedown",r),50);const n=()=>{window.removeEventListener("mousedown",r);if(t.parentNode){t.parentNode.removeChild(t)}};const o=t.appendChild(document.createElement("form"));o.appendChild(document.createElement("h5")).textContent="Scroll to";const i=document.createElement("button");i.type="button";i.className=qc+"-button";i.textContent="Top";i.onclick=function(){window.scrollTo(0,0);n()};o.appendChild(i);for(let t=0;t<e.buttons.length;t++){const r=document.createElement("button");r.type="button";r.className=qc+"-button";r.textContent=e.buttons[t].textContent;r.dataset.pos=e.buttons[t].pos;r.onclick=function(t){const r=t.target.dataset.pos;n();e.callback(r)};o.appendChild(r)}const a=document.createElement("button");a.type="button";a.className=qc+"-button";a.textContent="Bottom";a.onclick=function(){window.scrollTo(0,e.bottom);n()};o.appendChild(a);const s=t.getBoundingClientRect();t.style.top=(window.innerHeight-s.height)/2+"px";t.style.left=(window.innerWidth-s.width)/2+"px"}function Wc(e,t,r){const n=!e.doc.attrs.inDraftMode;e.doc.attrs.inDraftMode=n;const o=e.tr;e.doc.nodesBetween(0,e.doc.content.size,function(e,t){if(e.type.name==="calculation"){const i=Object.assign({},e.attrs);i.inDraftMode=n;o.replaceWith(t,t+1,r.createAndFill(i))}});t(o)}var Hc=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function Jc(e,t){return t={exports:{}},e(t,t.exports),t.exports}var Kc=Jc(function(e){var t=t||function(e){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var t=e.document,r=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,i=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),s=e.webkitRequestFileSystem,l=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},f="application/octet-stream",u=0,h=1e3*40,p=function(e){var t=function(){if(typeof e==="string"){r().revokeObjectURL(e)}else{e.remove()}};setTimeout(t,h)},d=function(e,t,r){t=[].concat(t);var n=t.length;while(n--){var o=e["on"+t[n]];if(typeof o==="function"){try{o.call(e,r||e)}catch(e){c(e)}}}},v=function(e){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)){return new Blob(["",e],{type:e.type})}return e},m=function(t,c,h){if(!h){t=v(t)}var m=this,g=t.type,y=false,w,b,C=function(){d(m,"writestart progress write writeend".split(" "))},M=function(){if(b&&a&&typeof FileReader!=="undefined"){var n=new FileReader;n.onloadend=function(){var e=n.result;b.location.href="data:attachment/file"+e.slice(e.search(/[,;]/));m.readyState=m.DONE;C()};n.readAsDataURL(t);m.readyState=m.INIT;return}if(y||!w){w=r().createObjectURL(t)}if(b){b.location.href=w}else{var o=e.open(w,"_blank");if(o===undefined&&a){e.location.href=w}}m.readyState=m.DONE;C();p(w)},x=function(e){return function(){if(m.readyState!==m.DONE){return e.apply(this,arguments)}}},k={create:true,exclusive:false},S;m.readyState=m.INIT;if(!c){c="download"}if(o){w=r().createObjectURL(t);setTimeout(function(){n.href=w;n.download=c;i(n);C();p(w);m.readyState=m.DONE});return}if(e.chrome&&g&&g!==f){S=t.slice||t.webkitSlice;t=S.call(t,0,t.size,f);y=true}if(s&&c!=="download"){c+=".download"}if(g===f||s){b=e}if(!l){M();return}u+=t.size;l(e.TEMPORARY,u,x(function(e){e.root.getDirectory("saved",k,x(function(e){var r=function(){e.getFile(c,k,x(function(e){e.createWriter(x(function(r){r.onwriteend=function(t){b.location.href=e.toURL();m.readyState=m.DONE;d(m,"writeend",t);p(e)};r.onerror=function(){var e=r.error;if(e.code!==e.ABORT_ERR){M()}};"writestart progress write abort".split(" ").forEach(function(e){r["on"+e]=m["on"+e]});r.write(t);m.abort=function(){r.abort();m.readyState=m.DONE};m.readyState=m.WRITING}),M)}),M)};e.getFile(c,{create:false},x(function(e){e.remove();r()}),x(function(e){if(e.code===e.NOT_FOUND_ERR){r()}else{M()}}))}),M)}),M)},g=m.prototype,y=function(e,t,r){return new m(e,t,r)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(e,t,r){if(!r){e=v(e)}return navigator.msSaveOrOpenBlob(e,t||"download")}}g.abort=function(){var e=this;e.readyState=e.DONE;d(e,"abort")};g.readyState=g.INIT=0;g.WRITING=1;g.DONE=2;g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null;return y}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||Hc.content);if(e.exports){e.exports.saveAs=t}});var Zc=Kc.saveAs;const Uc={navicon:{width:16,height:16,path:"M3 4h10v1.5h-20z M3 8h10v1.5h-20z M3 12h10v1.5h-20z"},"folder-open":{width:16,height:16,path:"M13 15l3-8h-13l-3 8zM2 6l-2 9v-13h4.5l2 2h6.5v2z"},save:{width:16,height:16,path:"M 8.5,5.5 v -5 h 2 v 5 h 2 l -3,3 -3,-3 z m 8,10 h -13 l -3,-6 h 3 v -6 h 4 v 1 h -3 v 5 h 9 l 2,4 v -9 h -4 v -1 h 5 z"},draft:{width:16,height:16,path:"M13.5 0h-12c-0.825 0-1.5 0.675-1.5 1.5v13c0 0.825 0.675 1.5 1.5 1.5h12c0.825 0 1.5-0.675 1.5-1.5v-13c0-0.825-0.675-1.5-1.5-1.5zM13.5 14.5h-12v-13h12v13zM6.1 9.736l-.386.42s-.358.39-.725.781c-.12.129-.226.24-.336.354l-.715-1.148-.848.529 1.237 1.984.353-.088c.135-.033.147-.06.172-.078a1.662 1.662 0 00.14-.117c.057-.053.122-.12.198-.197a52.59 52.59 0 00.875-.926l1.19 1.42 1.455-1.168 1.4.73 1.12-.58.267.213.62-.783-.775-.615-1.232.638-1.518-.793-1.2.965zM5.5 6.607l-1.14.963-.282-.799-.943.334.764 2.163 1.644-1.39.899.66 1.197-.544.654.344.465-.885-1.086-.57-1.111.502zM6.1 2.736l-.386.42s-.358.39-.725.781c-.12.129-.226.24-.336.354l-.715-1.148-.848.529 1.237 1.984.353-.088c.135-.033.147-.06.172-.078a1.662 1.662 0 00.14-.117c.057-.053.122-.12.198-.197a52.59 52.59 0 00.875-.926l1.19 1.42 1.455-1.168 1.4.73 1.12-.58.267.213.62-.783-.775-.615-1.232.638-1.518-.793-1.2.965z"},recalc:{width:16,height:16,path:"M0 9c0 2.389 1.048 4.534 2.709 6l1.323-1.5c-1.246-1.099-2.031-2.708-2.031-4.5 0-3.314 2.686-6 6-6 1.657 0 3.157 0.672 4.243 1.757l-2.243 2.243h6v-6l-2.343 2.343c-1.448-1.448-3.448-2.343-5.657-2.343-4.418 0-8 3.582-8 8z"},header:{width:16,height:16,path:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75zM2 5 v-1 h8 v0.5c0 0.276 0.224 0.5 0.5 0.5zM4 3v-1h4v1z"},subscript:{text:"X",css:"font-weight: bold"},superscript:{text:"X",css:"font-weight: bold"},strikethru:{width:1024,height:1024,path:"M1024 512v64h-234.506c27.504 38.51 42.506 82.692 42.506 128 0 70.878-36.66 139.026-100.58 186.964-59.358 44.518-137.284 69.036-219.42 69.036-82.138 0-160.062-24.518-219.42-69.036-63.92-47.938-100.58-116.086-100.58-186.964h128c0 69.382 87.926 128 192 128s192-58.618 192-128c0-69.382-87.926-128-192-128h-512v-64h299.518c-2.338-1.654-4.656-3.324-6.938-5.036-63.92-47.94-100.58-116.086-100.58-186.964s36.66-139.024 100.58-186.964c59.358-44.518 137.282-69.036 219.42-69.036 82.136 0 160.062 24.518 219.42 69.036 63.92 47.94 100.58 116.086 100.58 186.964h-128c0-69.382-87.926-128-192-128s-192 58.618-192 128c0 69.382 87.926 128 192 128 78.978 0 154.054 22.678 212.482 64h299.518z"},underline:{width:1024,height:1024,path:"M704 64h128v416c0 159.058-143.268 288-320 288-176.73 0-320-128.942-320-288v-416h128v416c0 40.166 18.238 78.704 51.354 108.506 36.896 33.204 86.846 51.494 140.646 51.494s103.75-18.29 140.646-51.494c33.116-29.802 51.354-68.34 51.354-108.506v-416zM192 832h640v128h-640z"},paragraph:{width:24,height:24,path:"M22.5.248H7.228a6.977,6.977,0,1,0,0,13.954H9.546a.25.25,0,0,1,.25.25V22.5a1.25,1.25,0,0,0,2.5,0V3a.25.25,0,0,1,.25-.25h3.682a.25.25,0,0,1,.25.25V22.5a1.25,1.25,0,0,0,2.5,0V3a.249.249,0,0,1,.25-.25H22.5a1.25,1.25,0,0,0,0-2.5ZM9.8,11.452a.25.25,0,0,1-.25.25H7.228a4.477,4.477,0,1,1,0-8.954H9.546A.25.25,0,0,1,9.8,3Z"},upload:{width:16,height:16,path:"M7 9h2v-4h3l-4-4-4 4h3zM10 6.75v1.542l4.579 1.708-6.579 2.453-6.579-2.453 4.579-1.708v-1.542l-6 2.25v4l8 3 8-3v-4z"},image:{width:16,height:16,path:"M14.998 2c0.001 0.001 0.001 0.001 0.002 0.002v11.996c-0.001 0.001-0.001 0.001-0.002 0.002h-13.996c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996zM15 1h-14c-0.55 0-1 0.45-1 1v12c0 0.55 0.45 1 1 1h14c0.55 0 1-0.45 1-1v-12c0-0.55-0.45-1-1-1v0z M13 4.5c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5 0.672-1.5 1.5-1.5 1.5 0.672 1.5 1.5z M14 13h-12v-2l3.5-6 4 5h1l3.5-3z"},indent:{width:16,height:16,path:"M0 1h16v2h-16zM6 4h10v2h-10zM6 7h10v2h-10zM6 10h10v2h-10zM0 13h16v2h-16zM0 11v-6l4 3z"},integral:{width:1024,height:1024,path:"M190.028 157.945c16.43-48.954 53.42-96.347 90.062-123.328C316.73 7.637 353.024 1.07 392.542.12c39.522-.949 82.27 3.72 102.958 14.197 20.684 10.476 19.31 26.758 5.604 40.3-13.708 13.542-39.744 24.341-62.734 28.375-22.99 4.033-42.932 1.3-60.886-3.427-17.952-4.726-33.92-11.446-46.358-12.602-12.436-1.154-21.346 3.255-28.362 9.272-7.016 6.016-12.136 13.64-12.326 32.56-.19 18.92 4.55 49.14 8.766 77.193 4.216 28.053 7.904 53.941 12.844 118.142 4.94 64.2 11.132 166.713 16.242 243.227 5.112 76.513 9.14 127.027-7.288 175.982-16.428 48.954-53.312 96.348-89.9 123.33-36.588 26.98-72.88 33.547-112.4 34.496-39.52.95-82.268-3.72-102.954-14.197-20.686-10.476-19.312-26.759-5.604-40.3 13.706-13.542 39.744-24.34 62.732-28.376 22.99-4.033 42.932-1.3 60.886 3.428 17.952 4.726 33.92 11.446 46.358 12.602 12.438 1.154 21.346-3.256 28.364-9.273 7.014-6.015 12.134-13.639 12.324-32.56.192-18.92-4.55-49.138-8.766-77.192-4.214-28.053-7.902-53.942-12.844-118.142-4.94-64.2-11.132-166.713-16.298-243.227-5.162-76.513-9.298-127.028 7.128-175.983z"},plus:{width:16,height:16,path:"M15.5 6h-5.5v-5.5c0-0.276-0.224-0.5-0.5-0.5h-3c-0.276 0-0.5 0.224-0.5 0.5v5.5h-5.5c-0.276 0-0.5 0.224-0.5 0.5v3c0 0.276 0.224 0.5 0.5 0.5h5.5v5.5c0 0.276 0.224 0.5 0.5 0.5h3c0.276 0 0.5-0.224 0.5-0.5v-5.5h5.5c0.276 0 0.5-0.224 0.5-0.5v-3c0-0.276-0.224-0.5-0.5-0.5z"},table:{width:24,height:24,path:"M17,17 L17,22 L19,22 C20.6568542,22 22,20.6568542 22,19 L22,17 L17,17 Z M15,17 L9,17 L9,22 L15,22 L15,17 Z M17,15 L22,15 L22,9 L17,9 L17,15 Z M15,15 L15,9 L9,9 L9,15 L15,15 Z M17,7 L22,7 L22,5 C22,3.34314575 20.6568542,2 19,2 L17,2 L17,7 Z M15,7 L15,2 L9,2 L9,7 L15,7 Z M24,16.1768671 L24,19 C24,21.7614237 21.7614237,24 19,24 L5,24 C2.23857625,24 2.11453371e-15,21.7614237 1.77635684e-15,19 L0,5 C-3.38176876e-16,2.23857625 2.23857625,2.28362215e-15 5,0 L19,0 C21.7614237,-5.07265313e-16 24,2.23857625 24,5 L24,7.82313285 C24.0122947,7.88054124 24.0187107,7.93964623 24.0187107,8 C24.0187107,8.06035377 24.0122947,8.11945876 24,8.17686715 L24,15.8231329 C24.0122947,15.8805412 24.0187107,15.9396462 24.0187107,16 C24.0187107,16.0603538 24.0122947,16.1194588 24,16.1768671 Z M7,2 L5,2 C3.34314575,2 2,3.34314575 2,5 L2,7 L7,7 L7,2 Z M2,9 L2,15 L7,15 L7,9 L2,9 Z M2,17 L2,19 C2,20.6568542 3.34314575,22 5,22 L7,22 L7,17 L2,17 Z"},delete_table:{width:24,height:24,path:"M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M16.5,19.9375 L21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 Z M12.2898787,17 L9,17 L9,22 L12.6736312,22 C13.0297295,22.7496048 13.515133,23.4258795 14.1010173,24 L5,24 C2.23857625,24 -1.43817996e-15,21.7614237 -1.77635684e-15,19 L-3.55271368e-15,5 C-3.89089055e-15,2.23857625 2.23857625,5.07265313e-16 5,-1.77635684e-15 L19,-1.77635684e-15 C21.7614237,-2.28362215e-15 24,2.23857625 24,5 L24,7.82313285 C24.0122947,7.88054124 24.0187107,7.93964623 24.0187107,8 C24.0187107,8.06035377 24.0122947,8.11945876 24,8.17686715 L24,14.1010173 C23.4258795,13.515133 22.7496048,13.0297295 22,12.6736312 L22,9 L17,9 L17,12.2898787 C16.2775651,12.5048858 15.6040072,12.8333806 15,13.2546893 L15,9 L9,9 L9,15 L13.2546893,15 C12.8333806,15.6040072 12.5048858,16.2775651 12.2898787,17 Z M17,7 L22,7 L22,5 C22,3.34314575 20.6568542,2 19,2 L17,2 L17,7 Z M15,7 L15,2 L9,2 L9,7 L15,7 Z M7,2 L5,2 C3.34314575,2 2,3.34314575 2,5 L2,7 L7,7 L7,2 Z M2,9 L2,15 L7,15 L7,9 L2,9 Z M2,17 L2,19 C2,20.6568542 3.34314575,22 5,22 L7,22 L7,17 L2,17 Z"},add_col_before:{width:24,height:24,path:"M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L20.25,18.0625 C20.077411,18.0625 19.9375,17.922589 19.9375,17.75 L19.9375,16.5 C19.9375,15.982233 19.517767,15.5625 19,15.5625 C18.482233,15.5625 18.0625,15.982233 18.0625,16.5 L18.0625,17.75 C18.0625,17.922589 17.922589,18.0625 17.75,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 L17.75,19.9375 C17.922589,19.9375 18.0625,20.077411 18.0625,20.25 L18.0625,21.5 C18.0625,22.017767 18.482233,22.4375 19,22.4375 C19.517767,22.4375 19.9375,22.017767 19.9375,21.5 L19.9375,20.25 C19.9375,20.077411 20.077411,19.9375 20.25,19.9375 L21.5,19.9375 Z M2,19 C2,20.6568542 3.34314575,22 5,22 C6.65685425,22 8,20.6568542 8,19 L8,5 C8,3.34314575 6.65685425,2 5,2 C3.34314575,2 2,3.34314575 2,5 L2,19 Z M-2.7585502e-16,19 L5.81397739e-16,5 C-1.37692243e-16,2.23857625 2.23857625,0 5,0 C7.76142375,0 10,2.23857625 10,5 L10,19 C10,21.7614237 7.76142375,24 5,24 C2.23857625,24 4.43234962e-16,21.7614237 -2.7585502e-16,19 Z"},add_col_after:{width:24,height:24,path:"M5,14 C7.76005315,14.0033061 9.99669388,16.2399468 10,19 C10,21.7614237 7.76142375,24 5,24 C2.23857625,24 1.77635684e-15,21.7614237 1.77635684e-15,19 C1.77635684e-15,16.2385763 2.23857625,14 5,14 Z M7.5,19.9375 C8.01776695,19.9375 8.4375,19.517767 8.4375,19 C8.4375,18.482233 8.01776695,18.0625 7.5,18.0625 L6.25,18.0625 C6.07741102,18.0625 5.9375,17.922589 5.9375,17.75 L5.9375,16.5 C5.9375,15.982233 5.51776695,15.5625 5,15.5625 C4.48223305,15.5625 4.0625,15.982233 4.0625,16.5 L4.0625,17.75 C4.0625,17.922589 3.92258898,18.0625 3.75,18.0625 L2.5,18.0625 C1.98223305,18.0625 1.5625,18.482233 1.5625,19 C1.5625,19.517767 1.98223305,19.9375 2.5,19.9375 L3.75,19.9375 C3.92258898,19.9375 4.0625,20.077411 4.0625,20.25 L4.0625,21.5 C4.0625,22.017767 4.48223305,22.4375 5,22.4375 C5.51776695,22.4375 5.9375,22.017767 5.9375,21.5 L5.9375,20.25 C5.9375,20.077411 6.07741102,19.9375 6.25,19.9375 L7.5,19.9375 Z M16,19 C16,20.6568542 17.3431458,22 19,22 C20.6568542,22 22,20.6568542 22,19 L22,5 C22,3.34314575 20.6568542,2 19,2 C17.3431458,2 16,3.34314575 16,5 L16,19 Z M14,19 L14,5 C14,2.23857625 16.2385763,0 19,0 C21.7614237,0 24,2.23857625 24,5 L24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 Z"},add_row_before:{width:24,height:24,path:"M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L20.25,18.0625 C20.077411,18.0625 19.9375,17.922589 19.9375,17.75 L19.9375,16.5 C19.9375,15.982233 19.517767,15.5625 19,15.5625 C18.482233,15.5625 18.0625,15.982233 18.0625,16.5 L18.0625,17.75 C18.0625,17.922589 17.922589,18.0625 17.75,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 L17.75,19.9375 C17.922589,19.9375 18.0625,20.077411 18.0625,20.25 L18.0625,21.5 C18.0625,22.017767 18.482233,22.4375 19,22.4375 C19.517767,22.4375 19.9375,22.017767 19.9375,21.5 L19.9375,20.25 C19.9375,20.077411 20.077411,19.9375 20.25,19.9375 L21.5,19.9375 Z M5,2 C3.34314575,2 2,3.34314575 2,5 C2,6.65685425 3.34314575,8 5,8 L19,8 C20.6568542,8 22,6.65685425 22,5 C22,3.34314575 20.6568542,2 19,2 L5,2 Z M5,0 L19,0 C21.7614237,-5.07265313e-16 24,2.23857625 24,5 C24,7.76142375 21.7614237,10 19,10 L5,10 C2.23857625,10 3.38176876e-16,7.76142375 0,5 C-1.2263553e-15,2.23857625 2.23857625,5.07265313e-16 5,0 Z"},add_row_after:{width:24,height:24,path:"M19,0 C21.7600532,0.00330611633 23.9966939,2.23994685 24,5 C24,7.76142375 21.7614237,10 19,10 C16.2385763,10 14,7.76142375 14,5 C14,2.23857625 16.2385763,0 19,0 Z M21.5,5.9375 C22.017767,5.9375 22.4375,5.51776695 22.4375,5 C22.4375,4.48223305 22.017767,4.0625 21.5,4.0625 L20.25,4.0625 C20.077411,4.0625 19.9375,3.92258898 19.9375,3.75 L19.9375,2.5 C19.9375,1.98223305 19.517767,1.5625 19,1.5625 C18.482233,1.5625 18.0625,1.98223305 18.0625,2.5 L18.0625,3.75 C18.0625,3.92258898 17.922589,4.0625 17.75,4.0625 L16.5,4.0625 C15.982233,4.0625 15.5625,4.48223305 15.5625,5 C15.5625,5.51776695 15.982233,5.9375 16.5,5.9375 L17.75,5.9375 C17.922589,5.9375 18.0625,6.07741102 18.0625,6.25 L18.0625,7.5 C18.0625,8.01776695 18.482233,8.4375 19,8.4375 C19.517767,8.4375 19.9375,8.01776695 19.9375,7.5 L19.9375,6.25 C19.9375,6.07741102 20.077411,5.9375 20.25,5.9375 L21.5,5.9375 Z M5,16 C3.34314575,16 2,17.3431458 2,19 C2,20.6568542 3.34314575,22 5,22 L19,22 C20.6568542,22 22,20.6568542 22,19 C22,17.3431458 20.6568542,16 19,16 L5,16 Z M5,14 L19,14 C21.7614237,14 24,16.2385763 24,19 C24,21.7614237 21.7614237,24 19,24 L5,24 C2.23857625,24 3.38176876e-16,21.7614237 0,19 C-1.2263553e-15,16.2385763 2.23857625,14 5,14 Z"},combine_cells:{width:24,height:24,path:"M2,19 C2,20.6568542 3.34314575,22 5,22 L19,22 C20.6568542,22 22,20.6568542 22,19 L22,5 C22,3.34314575 20.6568542,2 19,2 L5,2 C3.34314575,2 2,3.34314575 2,5 L2,19 Z M-1.16403344e-15,19 L-3.0678068e-16,5 C-6.44957556e-16,2.23857625 2.23857625,0 5,0 L19,0 C21.7614237,0 24,2.23857625 24,5 L24,19 C24,21.7614237 21.7614237,24 19,24 L5,24 C2.23857625,24 9.50500275e-16,21.7614237 -1.16403344e-15,19 Z M12,10 C12.5522847,10 13,10.4477153 13,11 L13,13 C13,13.5522847 12.5522847,14 12,14 C11.4477153,14 11,13.5522847 11,13 L11,11 C11,10.4477153 11.4477153,10 12,10 Z M12,16 C12.5522847,16 13,16.4477153 13,17 L13,20 C13,20.5522847 12.5522847,21 12,21 C11.4477153,21 11,20.5522847 11,20 L11,17 C11,16.4477153 11.4477153,16 12,16 Z M12,3 C12.5522847,3 13,3.44771525 13,4 L13,7 C13,7.55228475 12.5522847,8 12,8 C11.4477153,8 11,7.55228475 11,7 L11,4 C11,3.44771525 11.4477153,3 12,3 Z"},delete_col:{width:24,height:24,path:"M12.6414391,21.9312708 C12.9358807,22.5689168 13.3234155,23.1547532 13.7866134,23.6713497 C13.2317936,23.8836754 12.6294813,24 12,24 C9.23857625,24 7,21.7614237 7,19 L7,5 C7,2.23857625 9.23857625,0 12,0 C14.7614237,0 17,2.23857625 17,5 L17,12.2898787 C16.2775651,12.5048858 15.6040072,12.8333806 15,13.2546893 L15,5 C15,3.34314575 13.6568542,2 12,2 C10.3431458,2 9,3.34314575 9,5 L9,19 C9,20.6568542 10.3431458,22 12,22 C12.220157,22 12.4347751,21.9762852 12.6414391,21.9312708 Z M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M16.5,19.9375 L21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 Z"},delete_row:{width:24,height:24,path:"M13.2546893,15 C12.8333806,15.6040072 12.5048858,16.2775651 12.2898787,17 L5,17 C2.23857625,17 3.38176876e-16,14.7614237 0,12 C-1.2263553e-15,9.23857625 2.23857625,7 5,7 L19,7 C21.7614237,7 24,9.23857625 24,12 C24,12.6294813 23.8836754,13.2317936 23.6713497,13.7866134 C23.1547532,13.3234155 22.5689168,12.9358807 21.9312708,12.6414391 C21.9762852,12.4347751 22,12.220157 22,12 C22,10.3431458 20.6568542,9 19,9 L5,9 C3.34314575,9 2,10.3431458 2,12 C2,13.6568542 3.34314575,15 5,15 L13.2546893,15 Z M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M16.5,19.9375 L21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 Z"},grid:{width:16,height:16,path:"M0 1v13h16v-13h-16zM6 9v-3h4v3h-4zM10 10v3h-4v-3h4zM10 2v3h-4v-3h4zM5 2v3h-4v-3h4zM1 6h4v3h-4v-3zM11 6h4v3h-4v-3zM11 5v-3h4v3h-4zM1 10h4v3h-4v-3zM11 13v-3h4v3h-4z"},nogrid:{text:"",css:"font-weight: bold"},oneRule:{width:16,height:16,path:"M0 2h16v-1.5h-16z"},twoRules:{width:16,height:16,path:"M0 2h16v-1h-16zM0 14h16v-1h-16z"},threeRules:{width:16,height:16,path:"M0 2h16v-2h-16zM0 5h16v-1h-16zM0 16h16v-2h-16z"},fourRules:{width:16,height:16,path:"M0 2h16v-2h-16zM0 5h16v-1h-16zM0 12h16v-1h-16zM0 16h16v-2h-16z"},rules:{width:16,height:16,path:"M0 1h16v1h-16zM0 5h16v1h-16zM0 9h16v1h-16zM0 13h16v1h-16z"},striped:{width:16,height:16,path:"M0 1h16v3h-16zM0 9h16v3h-16z"},header:{width:16,height:16,path:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75zM2 5 v-1 h8 v0.5c0 0.276 0.224 0.5 0.5 0.5zM4 3v-1h4v1z"},printer:{width:16,height:16,path:"M4 1h8v2h-8v-2zM15 4h-14c-0.55 0-1 0.45-1 1v5c0 0.55 0.45 1 1 1h3v4h8v-4h3c0.55 0 1-0.45 1-1v-5c0-0.55-0.45-1-1-1zM2 7c-0.552 0-1-0.448-1-1s0.448-1 1-1 1 0.448 1 1-0.448 1-1 1zM11 14h-6v-5h6v5z"},noprint:{width:16,height:16,path:"M5.58 3.765h4.84v1.21H5.58zM12.235 5.58h-8.47a.607.607 0 00-.605.605V9.21c0 .333.272.605.605.605H5.58v2.42h4.84v-2.42h1.815a.607.607 0 00.605-.605V6.185a.607.607 0 00-.605-.605zM4.37 7.395a.605.605 0 110-1.21.605.605 0 010 1.21zm5.445 4.235h-3.63V8.605h3.63z M8 0C3.589 0 0 3.589 0 8s3.589 8 8 8 8-3.589 8-8-3.589-8-8-8zm0 1.193A6.798 6.798 0 0114.807 8 6.798 6.798 0 018 14.807 6.798 6.798 0 011.193 8 6.798 6.798 0 018 1.193z M3.354 2.646l-.708.708 10 10 .708-.708z"},cog:{width:16,height:16,path:"M14.59 9.535c-0.839-1.454-0.335-3.317 1.127-4.164l-1.572-2.723c-0.449 0.263-0.972 0.414-1.529 0.414-1.68 0-3.042-1.371-3.042-3.062h-3.145c0.004 0.522-0.126 1.051-0.406 1.535-0.839 1.454-2.706 1.948-4.17 1.106l-1.572 2.723c0.453 0.257 0.845 0.634 1.123 1.117 0.838 1.452 0.336 3.311-1.12 4.16l1.572 2.723c0.448-0.261 0.967-0.41 1.522-0.41 1.675 0 3.033 1.362 3.042 3.046h3.145c-0.001-0.517 0.129-1.040 0.406-1.519 0.838-1.452 2.7-1.947 4.163-1.11l1.572-2.723c-0.45-0.257-0.839-0.633-1.116-1.113zM8 11.24c-1.789 0-3.24-1.45-3.24-3.24s1.45-3.24 3.24-3.24c1.789 0 3.24 1.45 3.24 3.24s-1.45 3.24-3.24 3.24z"},"align-left":{width:16,height:16,path:"M0 1h16v2h-16zM0 4h10v2h-10zM0 10h10v2h-10zM0 7h16v2h-16zM0 13h16v2h-16"},"align-center":{width:16,height:16,path:"M0 1h16v2h-16zM3 4h10v2h-10zM3 10h10v2h-10zM0 7h16v2h-16zM0 13h16v2h-16z"},"align-right":{width:16,height:16,path:"M0 1h16v2h-16zM6 4h10v2h-10zM6 10h10v2h-10zM0 7h16v2h-16zM0 13h16v2h-16z"},info:{width:16,height:16,path:"M7 4.75c0-0.412 0.338-0.75 0.75-0.75h0.5c0.412 0 0.75 0.338 0.75 0.75v0.5c0 0.412-0.338 0.75-0.75 0.75h-0.5c-0.412 0-0.75-0.338-0.75-0.75v-0.5z M10 12h-4v-1h1v-3h-1v-1h3v4h1z M8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 14.5c-3.59 0-6.5-2.91-6.5-6.5s2.91-6.5 6.5-6.5 6.5 2.91 6.5 6.5-2.91 6.5-6.5 6.5z"}};function Gc(e,t){let r=e.selection.$from;for(let e=r.depth;e>=0;e--){let n=r.index(e);if(r.node(e).canReplaceWith(n,n,t))return true}return false}function Xc(e,t){return new ec({title:"Insert a print header",icon:Uc["header"],enable(){return true},run(e,t){window.scrollTo(0,0);if(e.doc.nodeAt(0).type.name==="header"){return}t(e.tr.insert(0,Ic.nodeFromJSON(JSON.parse(`{"type":"header","content":[{"type":"table","attrs":{"class":"one-rule c2c c3r"},\n"content":[{"type":"table_row","content":[{"type":"table_header","content":[\n{"type":"paragraph","content":[{"type":"text","text":"left"}]}]},\n{"type":"table_header","content":[{"type":"paragraph","content":[{"type":"text","text":"center"}]}]},\n{"type":"table_header","content":[{"type":"paragraph","content":[{"type":"text","text":"right"}]}]}]}]}]}`))))}})}const Yc=()=>{return new ec({title:"Navigate",icon:Uc.navicon,run(e,t,r){const n=[];const o=r.dom.getBoundingClientRect().bottom-320;e.doc.nodesBetween(0,e.doc.content.size,function(e,t){if(e.type.name==="heading"&&(e.attrs.level===1||e.attrs.level===2)){n.push({textContent:e.attrs.level===1?e.textContent:""+e.textContent,pos:t})}});jc({buttons:n,bottom:o,callback(e){const t=r.coordsAtPos(e).top;const n=r.dom.getBoundingClientRect().top;window.scrollTo(0,t-n+180)}})}})};const Qc=e=>t=>{const{$from:r}=t;for(let t=r.depth;t>0;t--){const n=r.node(t);if(e(n)){return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}};const ef=()=>{return new ec({title:"Print",icon:Uc.printer,run(e){const t=document.getElementById("wrap-table").children[0].children[0];if(e.doc.nodeAt(0).type.name==="header"){const e=document.getElementsByTagName("header")[0].children[0].children[0];const r=e.className;const n=e.getElementsByTagName("tr")[0];for(let e=0;e<3;e++){t.children[e].innerHTML=n.children[e].innerHTML;if(r.indexOf("one-rule")>-1){t.children[e].classList.add("header-rule")}else{t.children[e].classList.remove("header-rule")}}t.children[1].style.textAlign=r.indexOf("c2c")>-1?"center":"left";t.children[2].style.textAlign=r.indexOf("c3r")>-1?"right":"left"}else{for(let e=0;e<3;e++){t.children[e].innerHTML="";t.children[e].classList.remove("header-rule")}}window.print()}})};const tf=e=>Qc(e=>e.type.spec.tableRole&&e.type.spec.tableRole==="table")(e);const rf=e=>{return e instanceof As};const nf=e=>{if(!rf(e)){return}const t=e.$anchorCell.start(-1);const r=ls.get(e.$anchorCell.node(-1));return r.rectBetween(e.$anchorCell.pos-t,e.$headCell.pos-t)};const of=e=>{for(const t in e){let r=e[t];if(r!==null&&typeof r==="object"){if(Array.isArray(r)){for(let e=r.length-1;e>=0;e-=1){if(r[e].hasOwnProperty("type")&&(r[e].type==="calculation"||r[e].type==="tex")&&r[e].attrs.entry.length===0){if(e===r.length){r.pop()}else if(e===0){r.shift()}else{r=r.slice[1]}}}if(r.length>0){of(r)}}else if(r.type){if(r.type==="calculation"){r.attrs={entry:r.attrs.entry}}else if(r.type==="tex"){r.attrs={tex:r.attrs.tex}}else{of(r)}}else{of(r)}}}return e};function af(e){return new ec({title:"Save file...",icon:Uc["save"],enable(e){return true},run(e){const t=e.doc.toJSON();const r=JSON.stringify(of(t),null,2);const n=new Blob([r],{type:"text/plain;charset=utf-8"});Zc(n,"HurmetFile.hurmet")}})}function sf(){return new ec({title:"Open file...",icon:Uc["folder-open"],enable(){return true},run(e,t,r){hurmet.readHurmetFile(e,t,r,Ic)}})}function lf(e){return new ec({title:"Upload image file",icon:Uc.upload,enable(t){return Gc(t,e)},run(e,t,r){const n=document.createElement("input");n.type="file";n.accept=".gif,.jpg,.jpeg,.png,.svg";n.onchange=(e=>{const t=n.files[0];const o=new FileReader;o.onload=function(e){const t=e.target.result;const n=r.state.selection.from;r.dispatch(r.state.tr.replaceWith(n,n,Ic.nodes.image.create({src:t})))};o.readAsDataURL(t)});n.click()}})}function cf(e){return new ec({title:"Insert link to image or edit existing image",icon:Uc.image,enable(t){return Gc(t,e)},run(t,r,n){let{from:o,to:i}=t.selection,a=null;if(t.selection instanceof Ot&&t.selection.node.type==e)a=t.selection.node.attrs;Bc({title:"Insert image",fields:{src:new Vc({label:"Location",required:true,value:a&&a.src}),alt:new Vc({label:"Description",value:a?a.alt:t.doc.textBetween(o,i," ")}),width:new Vc({label:"Width",value:a&&a.width}),class:new Vc({label:"Class",value:a&&a.class})},callback(t){n.dispatch(n.state.tr.replaceSelectionWith(e.createAndFill(t)));n.focus()}})}})}function ff(e,t,r){const n=r==="calculation"?Ic.nodes.calculation:Ic.nodes.tex;let o=r==="calculation"?{entry:""}:{tex:""};if(e.selection instanceof Ot&&e.selection.node.type==n){o=e.selection.node.attrs}const i=t.state.tr;const a=i.selection.from;i.replaceSelectionWith(n.createAndFill(o));i.setSelection(Ot.create(i.doc,a));t.dispatch(i)}function uf(e,t){return new ec({title:"Insert "+(t==="calculation"?"a calculation cell  Alt-C":"a LaTeX cell"),icon:t==="calculation"?Uc.plus:Uc.integral,enable(t){return Gc(t,e)},run(e,r,n){ff(e,n,t)}})}const hf=(e,t=3,r=3,n=true)=>{const o=[];const i=[];for(let t=0;t<r;t++){o.push(e.nodes.table_cell.createAndFill());if(n){i.push(e.nodes.table_header.createAndFill())}}const a=[];for(let r=0;r<t;r++){a.push(e.nodes.table_row.createChecked(null,n&&r===0?i:o))}return e.nodes.table.create(null,a)};function pf(e,t){let r={label:t.title,run:e};for(let e in t)r[e]=t[e];if(!t.enable||t.enable===true)r["enable"]=(t=>e(t));return new ec(r)}function df(e,t){let{from:r,$from:n,to:o,empty:i}=e.selection;if(i)return t.isInSet(e.storedMarks||n.marks());else return e.doc.rangeHasMark(r,o,t)}function vf(e,t){let r={active(t){return df(t,e)},enable:true};for(let e in t)r[e]=t[e];return pf(Aa(e),r)}function mf(){return new ec({title:"Toggle draft mode",icon:Uc.draft,enable(){return true},active(e){return e.doc.attrs.inDraftMode},run(e,t){Wc(e,t,Ic.nodes.calculation)}})}function gf(e,t,r,n){return new ec({title:e,icon:Uc[t],select(e){return gs(e)},run(e,t){r(e,t)}})}function yf(){return new ec({title:"Recalculate all",icon:Uc.recalc,run(e,t,r){hurmet.updateCalculations(r,Ic.nodes.calculation,true)}})}function wf(e){return new ec({label:e,run(t,r){t.doc.attrs.decimalFormat=e;const n=hurmet.updateCalculations(t,Ic.nodes.calculation,true);r(n)}})}function bf(e,t,r){return new ec({title:e,icon:Uc[r],select(e){return gs(e)},run(e,r){const n=tf(e.selection);const o=n.node.attrs.class.split(" ");const i=e.tr;if(/^align/.test(t)){const r=t.slice(6,7);const n=nf(e.selection);if(n){for(let e=n.left+1;e<n.right+1;e++){let t=false;for(let n=0;n<o.length;n++){const i=o[n].slice(1,2);if(!isNaN(i)){if(Number(i)===e){t=true;o[n]=r==="l"?"":"c"+i+r}}}if(!t)o.push("c"+e+r)}}}else{o[0]=t}const a=o.join(" ").replace(/ {2,}/g," ");const s={class:a};i.setNodeMarkup(n.pos,undefined,s);r(i)}})}function Cf(e){return new ec({title:"Add or remove link",icon:fc.link,active(t){return df(t,e)},enable(e){return!e.selection.empty},run(t,r,n){if(df(t,e)){Aa(e)(t,r);return true}Bc({title:"Create a link",fields:{href:new Vc({label:"Link target",required:true}),title:new Vc({label:"Title"})},callback(t){Aa(e,t)(n.state,n.dispatch);n.focus()}})}})}function Mf(e,t){return pf(Rc(e,t.attrs),t)}function xf(e){const t={};let r;t.navigate=Yc();t.openFile=sf();t.saveFile=af();t.insertHeader=Xc();t.dot=wf("1000000.");t.commadot=wf("1,000,000.");t.lakh=wf("1,00,000.");t.cn=wf("1,0000,0000.");t.comma=wf("1000000,");t.spacecomma=wf("1 000 000,");t.apostrophecomma=wf("1000000,");t.dotcomma=wf("1.000.000,");t.toggleDraftMode=mf();t.recalcAll=yf();t.print=ef();if(r=e.marks.strong)t.toggleStrong=vf(r,{title:"Toggle strong style",icon:fc.strong});if(r=e.marks.em)t.toggleEm=vf(r,{title:"Toggle emphasis",icon:fc.em});if(r=e.marks.code)t.toggleCode=vf(r,{title:"Toggle code font  Ctrl-`",icon:fc.code});if(r=e.marks.subscript)t.toggleSubscript=vf(r,{title:"Toggle subscript  Ctrl-,",icon:Uc.subscript});if(r=e.marks.superscript)t.toggleSuperscript=vf(r,{title:"Toggle superscript  Ctrl-.",icon:Uc.superscript});if(r=e.marks.strikethru)t.toggleStrikethru=vf(r,{title:"Toggle strikethrough",icon:Uc.strikethru});if(r=e.marks.underline)t.toggleUnderline=vf(r,{title:"Toggle underline  Ctrl-u",icon:Uc.underline});if(r=e.marks.link)t.toggleLink=Cf(r);if(r=e.nodes.image)t.imageUpload=lf(r);if(r=e.nodes.image)t.imageLink=cf(r);if(r=e.nodes.calculation)t.insertCalclation=uf(r,"calculation");if(r=e.nodes.tex)t.insertTeX=uf(r,"tex");if(r=e.nodes.bullet_list)t.wrapBulletList=Mf(r,{title:"Wrap in bullet list",icon:fc.bulletList});if(r=e.nodes.ordered_list)t.wrapOrderedList=Mf(r,{title:"Wrap in ordered list",icon:fc.orderedList});if(r=e.nodes.blockquote)t.wrapBlockQuote=mc(r,{title:"Wrap in block quote",icon:fc.blockquote});if(r=e.nodes.indented_paragraph)t.wrapIndent=gc(r,{title:"Indent paragraph",icon:Uc.indent});if(r=e.nodes.hidden_paragraph)t.wrapHidden=gc(r,{title:"Unprinted paragraph",icon:Uc.noprint});if(r=e.nodes.paragraph)t.makeParagraph=gc(r,{title:"Change to plain paragraph",icon:Uc.paragraph});if(r=e.nodes.code_block)t.makeCodeBlock=gc(r,{title:"Change to code block",icon:fc.code});if(r=e.nodes.heading)for(let e=1;e<=6;e++)t["makeHead"+e]=gc(r,{title:"Change to heading "+e,label:"H"+e+"",attrs:{level:e}});if(r=e.nodes.horizontal_rule){let e=r;t.insertHorizontalRule=new ec({title:"Insert horizontal rule",label:"",enable(t){return Gc(t,e)},run(t,r){r(t.tr.replaceSelectionWith(e.create()))}})}if(r=e.nodes.table){let n=r;t.insertTable=new ec({title:"Insert Table",icon:Uc.table,enable(e){return Gc(e,n)},run(t,r){r(t.tr.replaceSelectionWith(hf(e,3,3,true)))}})}t.deleteTable=gf("Delete table","delete_table",Ol);t.addRowBefore=gf("Insert row before","add_row_before",fl);t.deleteRow=gf("Delete row","delete_row",hl);t.addColumnBefore=gf("Insert column before","add_col_before",il);t.deleteColumn=gf("Delete column","delete_col",sl);t.toggleCellMerge=new ec({title:"Toggle cell merge",icon:Uc.combine_cells,select(e){return gs(e)},run(e,t){if(vl(e,t)){return}ml(e,t)}});t.grid=bf("Grid","grid","grid");t.nogrid=bf("No borders","nogrid","nogrid");t.oneRule=bf("Border below header","one-rule","oneRule");t.twoRules=bf("Borders below header and above bottom line.","two-rules","twoRules");t.threeRules=bf("Three rules","three-rules","threeRules");t.fourRules=bf("Four rules","four-rules","fourRules");t.rules=bf("All rules","rules","rules");t.striped=bf("striped","striped","striped");t.alignColLeft=bf("Align Column Left","align-left","align-left");t.alignColCenter=bf("Align Column Center","align-center","align-center");t.alignColRight=bf("Align Column Right","align-right","align-right");t.help=gc(r,{title:"Help",icon:Uc.info,enable(){return true},run(){window.open("docs/en/manual.html")}});let n=e=>e.filter(e=>e);t.separators=new ic([t.dot,t.commadot,t.lakh,t.cn,t.comma,t.spacecomma,t.apostrophecomma,t.dotcomma],{title:"Set decimal format",label:""});t.fileMenu=[[t.navigate,t.openFile,t.saveFile,t.separators,t.toggleDraftMode,t.recalcAll,t.insertHeader,t.print]];t.inlineMenu=[[t.toggleStrong,t.toggleEm,t.toggleCode,t.toggleSubscript,t.toggleSuperscript,t.toggleStrikethru,t.toggleUnderline]];t.insertMenu=[[t.toggleLink,t.insertHorizontalRule,t.imageUpload,t.imageLink,t.insertCalclation,t.insertTeX]];t.typeMenu=[n([t.makeParagraph,t.makeCodeBlock,t.makeHead1,t.makeHead2,t.makeHead3,t.makeHead4,t.makeHead5,t.makeHead6,t.wrapIndent,t.wrapHidden])];t.blockMenu=[[t.wrapBulletList,t.wrapOrderedList,t.wrapBlockQuote,uc,hc,pc]];t.tableStyle=new ic([t.grid,t.nogrid,t.oneRule,t.twoRules,t.threeRules,t.fourRules,t.rules,t.striped],{label:"Tbl Style"});t.tableMenu=[n([t.insertTable,t.addRowBefore,t.addColumnBefore,t.deleteTable,t.deleteRow,t.deleteColumn,t.toggleCellMerge,t.alignColLeft,t.alignColCenter,t.alignColRight,t.tableStyle])];t.fullMenu=t.fileMenu.concat([[dc,vc]],t.inlineMenu,t.insertMenu,t.typeMenu,t.blockMenu,t.tableMenu,[[t.help]]);return t}function kf(e,t){return function(r,n){var o=r.selection;var i=o.$from;var a=o.$to;var s=i.blockRange(a),l=false,c=s;if(!s){return false}if(s.depth>=2&&i.node(s.depth-1).type.compatibleContent(e)&&s.startIndex==0){if(i.index(s.depth-1)==0){return false}var f=r.doc.resolve(s.start-2);c=new T(f,f,s.depth);if(s.endIndex<s.parent.childCount){s=new T(i,r.doc.resolve(a.end(s.depth)),s.depth)}l=true}var u=Ze(c,e,t,s);if(!u){return false}if(n){n(Sf(r.tr,s,u,l,e).scrollIntoView())}return true}}function Sf(e,t,r,n,i){var a=o.empty;for(var s=r.length-1;s>=0;s--){a=o.from(r[s].type.create(r[s].attrs,a))}e.step(new We(t.start-(n?2:0),t.end,t.start,t.end,new u(a,0,0),r.length,true));var l=0;for(var c=0;c<r.length;c++){if(r[c].type==i){l=c+1}}var f=r.length-l;var h=t.start+r.length-(n?2:0),p=t.parent;for(var d=t.startIndex,v=t.endIndex,m=true;d<v;d++,m=false){if(!m&&Qe(e.doc,h,f)){e.split(h,f);h+=2*f}h+=p.child(d).nodeSize}return e}function Of(e){return function(t,r){var n=t.selection;var i=n.$from;var a=n.$to;var s=n.node;if(s&&s.isBlock||i.depth<2||!i.sameParent(a)){return false}var l=i.node(-1);if(l.type!=e){return false}if(i.parent.content.size==0){if(i.depth==2||i.node(-3).type!=e||i.index(-2)!=i.node(-2).childCount-1){return false}if(r){var c=o.empty,f=i.index(-1)>0;for(var h=i.depth-(f?1:2);h>=i.depth-3;h--){c=o.from(i.node(h).copy(c))}c=c.append(o.from(e.createAndFill()));var p=t.tr.replace(i.before(f?null:-1),i.after(-3),new u(c,f?3:2,2));p.setSelection(t.selection.constructor.near(p.doc.resolve(i.pos+(f?3:2))));r(p.scrollIntoView())}return true}var d=a.pos==i.end()?l.contentMatchAt(0).defaultType:null;var v=t.tr.delete(i.pos,a.pos);var m=d&&[null,{type:d}];if(!Qe(v.doc,i.pos,2,m)){return false}if(r){r(v.split(i.pos,2,m).scrollIntoView())}return true}}function Nf(e){return function(t,r){var n=t.selection;var o=n.$from;var i=n.$to;var a=o.blockRange(i,function(t){return t.childCount&&t.firstChild.type==e});if(!a){return false}if(!r){return true}if(o.node(a.depth-1).type==e){return Af(t,r,e,a)}else{return Df(t,r,a)}}}function Af(e,t,r,n){var i=e.tr,a=n.end,s=n.$to.end(n.depth);if(a<s){i.step(new We(a-1,s,a,s,new u(o.from(r.create(null,n.parent.copy())),1,0),1,true));n=new T(i.doc.resolve(n.$from.pos),i.doc.resolve(s),n.depth)}t(i.lift(n,Ke(n)).scrollIntoView());return true}function Df(e,t,r){var n=e.tr,i=r.parent;for(var a=r.end,s=r.endIndex-1,l=r.startIndex;s>l;s--){a-=i.child(s).nodeSize;n.delete(a-1,a+1)}var c=n.doc.resolve(r.start),f=c.nodeAfter;var h=r.startIndex==0,p=r.endIndex==i.childCount;var d=c.node(-1),v=c.index(-1);if(!d.canReplace(v+(h?0:1),v+1,f.content.append(p?o.empty:o.from(i)))){return false}var m=c.pos,g=m+f.nodeSize;n.step(new We(m-(h?1:0),g+(p?1:0),m+1,g-1,new u((h?o.empty:o.from(i.copy(o.empty))).append(p?o.empty:o.from(i.copy(o.empty))),h?0:1,p?0:1),h?0:1));t(n.scrollIntoView());return true}function Tf(e){return function(t,r){var n=t.selection;var i=n.$from;var a=n.$to;var s=i.blockRange(a,function(t){return t.childCount&&t.firstChild.type==e});if(!s){return false}var l=s.startIndex;if(l==0){return false}var c=s.parent,f=c.child(l-1);if(f.type!=e){return false}if(r){var h=f.lastChild&&f.lastChild.type==c.type;var p=o.from(h?e.create():null);var d=new u(o.from(e.create(null,o.from(c.type.create(null,p)))),h?3:1,0);var v=s.start,m=s.end;r(t.tr.step(new We(v-(h?3:1),m,v,m,d,1,true)).scrollIntoView())}return true}}var Ef=function e(t,r){this.match=t;this.handler=typeof r=="string"?zf(r):r};function zf(e){return function(t,r,n,o){var i=e;if(r[1]){var a=r[0].lastIndexOf(r[1]);i+=r[0].slice(a+r[1].length);n+=a;var s=n-o;if(s>0){i=r[0].slice(a-s,a)+i;n=o}}return t.tr.insertText(i,n,o)}}var Rf=500;function Lf(e){var t=e.rules;var r=new Wt({state:{init:function e(){return null},apply:function e(t,r){var n=t.getMeta(this);if(n){return n}return t.selectionSet||t.docChanged?null:r}},props:{handleTextInput:function e(n,o,i,a){return If(n,o,i,a,t,r)},handleDOMEvents:{compositionend:function(e){setTimeout(function(){var n=e.state.selection;var o=n.$cursor;if(o){If(e,o.pos,o.pos,"",t,r)}})}}},isInputRules:true});return r}function If(e,t,r,n,o,i){if(e.composing){return false}var a=e.state,s=a.doc.resolve(t);if(s.parent.type.spec.code){return false}var l=s.parent.textBetween(Math.max(0,s.parentOffset-Rf),s.parentOffset,null,"")+n;for(var c=0;c<o.length;c++){var f=o[c].match.exec(l);var u=f&&o[c].handler(a,f,t-(f[0].length-n.length),r);if(!u){continue}e.dispatch(u.setMeta(i,{transform:u,from:t,to:r,text:n}));return true}return false}function $f(e,t){var r=e.plugins;for(var n=0;n<r.length;n++){var o=r[n],i=void 0;if(o.spec.isInputRules&&(i=o.getState(e))){if(t){var a=e.tr,s=i.transform;for(var l=s.steps.length-1;l>=0;l--){a.step(s.steps[l].invert(s.docs[l]))}var c=a.doc.resolve(i.from).marks();t(a.replaceWith(i.from,i.to,e.schema.text(i.text,c)))}return true}}return false}var Bf=new Ef(/--$/,"");var Ff=new Ef(/\.\.\.$/,"");var Pf=new Ef(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"");var _f=new Ef(/"$/,"");var Vf=new Ef(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"");var qf=new Ef(/'$/,"");var jf=[Pf,_f,Vf,qf];function Wf(e,t,r,n){return new Ef(e,function(e,o,i,a){var s=r instanceof Function?r(o):r;var l=e.tr.delete(i,a);var c=l.doc.resolve(i),f=c.blockRange(),u=f&&Ze(f,t,s);if(!u){return null}l.wrap(f,u);var h=l.doc.resolve(i-1).nodeBefore;if(h&&h.type==t&&et(l.doc,i-1)&&(!n||n(o,h))){l.join(i-1)}return l})}function Hf(e,t,r){return new Ef(e,function(e,n,o,i){var a=e.doc.resolve(o);var s=r instanceof Function?r(n):r;if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t)){return null}return e.tr.delete(o,i).setBlockType(o,o,t,s)})}const Jf=typeof navigator!="undefined"?/Mac/.test(navigator.platform):false;function Kf(e,t){let r={},n;function o(e,n){if(t){let r=t[e];if(r===false)return;if(r)e=r}r[e]=n}o("Mod-z",ra);o("Shift-Mod-z",na);o("Backspace",$f);if(!Jf)o("Mod-y",na);o("Tab",Sl(1));o("Shift-Tab",Sl(-1));o("Alt-ArrowUp",ha);o("Alt-ArrowDown",pa);o("Mod-BracketLeft",da);if(n=e.marks.strong)o("Mod-b",Aa(n));if(n=e.marks.em)o("Mod-i",Aa(n));if(n=e.marks.code)o("Mod-`",Aa(n));if(n=e.marks.subscript)o("Mod-,",Aa(n));if(n=e.marks.superscript)o("Mod-.",Aa(n));if(n=e.marks.underline)o("Mod-u",Aa(n));if(n=e.nodes.calculation){o("Alt-c",(e,t,r)=>{ff(e,r,"calculation");return true})}if(n=e.nodes.bullet_list)o("Shift-Ctrl-8",kf(n));if(n=e.nodes.ordered_list)o("Shift-Ctrl-9",kf(n));if(n=e.nodes.blockquote)o("Ctrl->",Sa(n));if(n=e.nodes.hard_break){let e=n,t=Da(ga,(t,r)=>{r(t.tr.replaceSelectionWith(e.create()).scrollIntoView());return true});o("Mod-Enter",t);o("Shift-Enter",t);if(Jf)o("Ctrl-Enter",t)}if(n=e.nodes.list_item){o("Enter",Of(n));o("Mod-[",Nf(n));o("Mod-]",Tf(n))}if(n=e.nodes.paragraph)o("Shift-Ctrl-0",Oa(n));if(n=e.nodes.code_block)o("Shift-Ctrl-\\",Oa(n));if(n=e.nodes.heading)for(let e=1;e<=6;e++)o("Shift-Ctrl-"+e,Oa(n,{level:e}));if(n=e.nodes.horizontal_rule){let e=n;o("Mod-_",(t,r)=>{r(t.tr.replaceSelectionWith(e.create()).scrollIntoView());return true})}return r}function Zf(e){return Wf(/^\s*>\s$/,e)}function Uf(e){return Wf(/^(\d+)\.\s$/,e,e=>({order:+e[1]}),(e,t)=>t.childCount+t.attrs.order==+e[1])}function Gf(e){return Wf(/^\s*([-+*])\s$/,e)}function Xf(e){return Hf(/^```$/,e)}function Yf(e,t){return Hf(new RegExp("^(#{1,"+t+"})\\s$"),e,e=>({level:e[1].length}))}function Qf(e){let t=jf.concat(Ff,Bf),r;if(r=e.nodes.blockquote)t.push(Zf(r));if(r=e.nodes.ordered_list)t.push(Uf(r));if(r=e.nodes.bullet_list)t.push(Gf(r));if(r=e.nodes.code_block)t.push(Xf(r));if(r=e.nodes.heading)t.push(Yf(r,6));return Lf({rules:t})}const eu=/"[^"]*"|[0-9]+,[0-9]+|[A-Za-z\u0391-\u03D5\uD835][A-Za-z0-9_\u0391-\u03D5\uD835\uDC00-\uDFFF]/;const tu=/"[^"]*"|[0-9]+\.[0-9]+|[A-Za-z\u0391-\u03D5\uD835][A-Za-z0-9_\u0391-\u03D5\uD835\uDC00-\uDFFF]/;const ru=/^(?:private +)?function (?:[A-Za-z\u0391-\u03C9\u03D5\u210B\u210F\u2110\u2112\u2113\u211B\u212C\u2130\u2131\u2133]|(?:\uD835[\uDC00-\udc33\udc9c-\udcb5]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]**\(/;const nu=e=>{let t;while(t=eu.exec(e)){if("0123456789".indexOf(t[0].charAt(0))>-1){const r=t.index+t[0].indexOf(",");e=e.slice(0,r)+"."+e.slice(r+1)}}return e};const ou=e=>{let t;while(t=tu.exec(e)){if("0123456789".indexOf(t[0].charAt(0))>-1){const r=t.index+t[0].indexOf(".");e=e.slice(0,r)+","+e.slice(r+1)}}return e};function iu(e){const t=e.dom.appendChild(document.createElement("div"));t.className="math-code";t.parentNode.firstChild.style.display="none";const r=e=>{const r=e.target;if(!t.contains(r)&&r.getAttribute("role")!=="presentation"){const e=r.getAttribute("class");if(!e||e.slice(0,2)!=="cm"){n()}}};setTimeout(()=>window.addEventListener("mousedown",r),500);const n=()=>{window.removeEventListener("mousedown",r);t.parentNode.firstChild.style.display="inline";if(t.parentNode){t.parentNode.removeChild(t)}};const o=e.encoding==="HurmetMath";const i=!o;const a=o?e.decimalFormat.slice(-1):"";const s=t.appendChild(document.createElement("form"));const l=new Vc({required:true,value:""}).render();s.appendChild(l);if(o){CodeMirror.defineSimpleMode("hurmet",{start:[{regex:/"[^"]*"|`[^`]*`/,token:"string"},{regex:/(function)(\s+)((?:[A-Za-z\u0391-\u03C9\u03D5\u212C\u2130\u2131\u210B\u2110\u2112\u2133\u211B\u212F\u210A\u2113\u2134]|(?:\uD835[\uDC00-\udc33\udc9c-\udccf]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]*)/,token:["keyword",null,"variable-2"]},{regex:/(')([$])?(-?(?:[0-9]+(?: [0-9]+\/[0-9]+|(?:\.[0-9]+)?(?:e[+-]?[0-9]+)?)?|0x[0-9A-Fa-f]+)) *([^']*)(')/,token:["attribute","attribute","number","attribute","attribute"]},{regex:/(?:function|export|return|if|for|in|while|else|otherwise|and|or|modulo|break|echo|raise)\b/,token:"keyword"},{regex:/||true|false/,token:"atom"},{regex:/(-?)(?:([0-9]+)(?: ([0-9]+)\/([0-9]+)|(?:\.([0-9]+))?(?:e([+-]?[0-9]+))?)|(0x[0-9A-Fa-f]+))/,token:"number"},{regex:/#.*/,token:"comment"},{regex:/\\[A-Za-z]+/,token:"variable-3"},{regex:/[-+/*^%&!|&=<>]+/,token:"operator"},{regex:/[{[(]/,indent:true},{regex:/[}\])]/,dedent:true},{regex:/(?:[A-Za-z\u0391-\u03C9\u03D5\u212C\u2130\u2131\u210B\u2110\u2112\u2133\u211B\u212F\u210A\u2113\u2134]|(?:\uD835[\uDC00-\udc33\udc9c-\udccf]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]**(?=\()/,token:"builtin"},{regex:/(?:[A-Za-z\u0391-\u03C9\u03D5\u212C\u2130\u2131\u210B\u2110\u2112\u2133\u211B\u212F\u210A\u2113\u2134]|(?:\uD835[\uDC00-\udc33\udc9c-\udccf]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]**/,token:"variable"}],meta:{dontIndentStates:["comment"],lineComment:"//"}})}const c=CodeMirror.fromTextArea(l,{mode:o?"hurmet":null,indentUnit:3,smartIndent:false,tabSize:3,autoCloseBrackets:true,autofocus:true,lineWrapping:true,electricChars:false,matchBrackets:true});const f=c.doc;if(e.attrs){if(o&&e.attrs.entry){let t=e.attrs.entry;if(a===","){t=ou(t)}f.setValue(t)}else if(e.attrs.tex){f.setValue(e.attrs.tex)}}f.setCursor(f.lineCount(),0);const u=s.appendChild(document.createElement("div"));u.setAttribute("class","math-display");const h=function(){let t="";let r=false;if(o){hurmet.autoCorrect(f);t=f.getValue();if(a===","){t=nu(t)}r=ru.test(t);if(!r){t=hurmet.parse(t,e.decimalFormat)}}else{t=f.getValue()}if(!r){try{const e="MozAppearance"in document.documentElement.style;katex.render(t,u,{displayMode:false,strict:false,output:e?"mathml":"htmlAndMathml"})}catch(e){while(u.lastChild){u.removeChild(u.lastChild)}u.textContent=t}}};if(f.getValue().length>0){h()}c.on("change",function(){h()});const p=t=>{let r=f.getValue();r=r.replace(/^[\s\u200b]+/,"");r=r.replace(/[\s\u200b]+$/,"");r=r.replace(/\r?\n/g,"\n");if(o&&a===","){r=nu(r)}const s=i?{tex:r}:hurmet.prepareStatement(r,e.decimalFormat);n();e.callback(s)};s.addEventListener("submit",e=>{e.preventDefault();p()});s.addEventListener("keydown",e=>{if(e.keyCode===27){e.preventDefault();n()}else if(e.keyCode===13&&e.shiftKey){e.preventDefault();p()}else if(e.keyCode===9){window.setTimeout(()=>{if(!t.contains(document.activeElement)){n()}},500)}});const d=s.elements[0];if(d){d.focus()}}class au{constructor(e,t){this.node=e;this.outerView=t;this.dom=Ic.nodes.calculation.spec.toDOM(e);this.decimalFormat=t.state.doc.attrs.decimalFormat}selectNode(){this.dom.classList.add("ProseMirror-selectednode");const e=this.node.attrs;const t=this.outerView.state.selection.from;iu({encoding:"HurmetMath",attrs:e,outerView:this.outerView,dom:this.dom,decimalFormat:this.decimalFormat,callback(e){hurmet.updateCalculations(this.outerView,Ic.nodes.calculation,false,e,t)}})}deselectNode(){this.dom.classList.remove("ProseMirror-selectednode")}stopEvent(){return true}}class su{constructor(e,t){this.node=e;this.outerView=t;this.dom=Ic.nodes.tex.spec.toDOM(e)}selectNode(){this.dom.classList.add("ProseMirror-selectednode");const e=this.node.attrs;iu({encoding:"TeX",attrs:e,outerView:this.outerView,dom:this.dom,callback(e){const t=this.outerView;t.dispatch(t.state.tr.replaceSelectionWith(Ic.nodes.tex.createAndFill(e)));t.focus()}})}deselectNode(){this.dom.classList.remove("ProseMirror-selectednode")}stopEvent(){return true}}function lu(e){return[Qf(e.schema),Ya(Kf(e.schema,e.mapKeys)),Ya($a),Cc({floating:true,content:xf(e.schema).fullMenu}),ta(),Tl(),Wl(),new Wt({props:{attributes:{class:"ProseMirror-example-setup-style"}}})]}window.view=new ki(document.querySelector("#editor"),{state:_t.create({doc:ce.fromSchema(Ic).parse(document.querySelector("#content")),plugins:lu({schema:Ic})}),nodeViews:{calculation(e,t){return new au(e,t)},tex(e,t){return new su(e,t)}}});const cu=tl(window.view.state);if(cu){window.view.state=window.view.state.apply(cu.setMeta("addToHistory",false))}hurmet.updateCalculations(window.view,Ic.nodes.calculation,true);document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false)})();