function OrderedMap(e){this.content=e}OrderedMap.prototype={constructor:OrderedMap,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?undefined:this.content[t+1]},update:function(e,t,r){var n=r&&r!=e?this.remove(r):this;var o=n.find(e),i=n.content.slice();if(o==-1){i.push(r||e,t)}else{i[o+1]=t;if(r)i[o]=r}return new OrderedMap(i)},remove:function(e){var t=this.find(e);if(t==-1)return this;var r=this.content.slice();r.splice(t,2);return new OrderedMap(r)},addToStart:function(e,t){return new OrderedMap([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var r=this.remove(e).content.slice();r.push(e,t);return new OrderedMap(r)},addBefore:function(e,t,r){var n=this.remove(t),o=n.content.slice();var i=n.find(e);o.splice(i==-1?o.length:i,0,t,r);return new OrderedMap(o)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){e=OrderedMap.from(e);if(!e.size)return this;return new OrderedMap(e.content.concat(this.subtract(e).content))},append:function(e){e=OrderedMap.from(e);if(!e.size)return this;return new OrderedMap(this.subtract(e).content.concat(e.content))},subtract:function(e){var t=this;e=OrderedMap.from(e);for(var r=0;r<e.content.length;r+=2)t=t.remove(e.content[r]);return t},get size(){return this.content.length>>1}};OrderedMap.from=function(e){if(e instanceof OrderedMap)return e;var t=[];if(e)for(var r in e)t.push(r,e[r]);return new OrderedMap(t)};var orderedmap=OrderedMap;function findDiffStart(e,t,r){for(var n=0;;n++){if(n==e.childCount||n==t.childCount){return e.childCount==t.childCount?null:r}var o=e.child(n),i=t.child(n);if(o==i){r+=o.nodeSize;continue}if(!o.sameMarkup(i)){return r}if(o.isText&&o.text!=i.text){for(var a=0;o.text[a]==i.text[a];a++){r++}return r}if(o.content.size||i.content.size){var s=findDiffStart(o.content,i.content,r+1);if(s!=null){return s}}r+=o.nodeSize}}function findDiffEnd(e,t,r,n){for(var o=e.childCount,i=t.childCount;;){if(o==0||i==0){return o==i?null:{a:r,b:n}}var a=e.child(--o),s=t.child(--i),l=a.nodeSize;if(a==s){r-=l;n-=l;continue}if(!a.sameMarkup(s)){return{a:r,b:n}}if(a.isText&&a.text!=s.text){var c=0,u=Math.min(a.text.length,s.text.length);while(c<u&&a.text[a.text.length-c-1]==s.text[s.text.length-c-1]){c++;r--;n--}return{a:r,b:n}}if(a.content.size||s.content.size){var p=findDiffEnd(a.content,s.content,r-1,n-1);if(p){return p}}r-=l;n-=l}}var Fragment=function e(t,r){this.content=t;this.size=r||0;if(r==null){for(var n=0;n<t.length;n++){this.size+=t[n].nodeSize}}};var prototypeAccessors={firstChild:{configurable:true},lastChild:{configurable:true},childCount:{configurable:true}};Fragment.prototype.nodesBetween=function e(t,r,n,o,i){if(o===void 0)o=0;for(var a=0,s=0;s<r;a++){var l=this.content[a],c=s+l.nodeSize;if(c>t&&n(l,o+s,i,a)!==false&&l.content.size){var u=s+1;l.nodesBetween(Math.max(0,t-u),Math.min(l.content.size,r-u),n,o+u)}s=c}};Fragment.prototype.descendants=function e(t){this.nodesBetween(0,this.size,t)};Fragment.prototype.textBetween=function e(t,r,n,o){var i="",a=true;this.nodesBetween(t,r,(function(e,s){if(e.isText){i+=e.text.slice(Math.max(t,s)-s,r-s);a=!n}else if(e.isLeaf&&o){i+=o;a=!n}else if(!a&&e.isBlock){i+=n;a=true}}),0);return i};Fragment.prototype.append=function e(t){if(!t.size){return this}if(!this.size){return t}var r=this.lastChild,n=t.firstChild,o=this.content.slice(),i=0;if(r.isText&&r.sameMarkup(n)){o[o.length-1]=r.withText(r.text+n.text);i=1}for(;i<t.content.length;i++){o.push(t.content[i])}return new Fragment(o,this.size+t.size)};Fragment.prototype.cut=function e(t,r){if(r==null){r=this.size}if(t==0&&r==this.size){return this}var n=[],o=0;if(r>t){for(var i=0,a=0;a<r;i++){var s=this.content[i],l=a+s.nodeSize;if(l>t){if(a<t||l>r){if(s.isText){s=s.cut(Math.max(0,t-a),Math.min(s.text.length,r-a))}else{s=s.cut(Math.max(0,t-a-1),Math.min(s.content.size,r-a-1))}}n.push(s);o+=s.nodeSize}a=l}}return new Fragment(n,o)};Fragment.prototype.cutByIndex=function e(t,r){if(t==r){return Fragment.empty}if(t==0&&r==this.content.length){return this}return new Fragment(this.content.slice(t,r))};Fragment.prototype.replaceChild=function e(t,r){var n=this.content[t];if(n==r){return this}var o=this.content.slice();var i=this.size+r.nodeSize-n.nodeSize;o[t]=r;return new Fragment(o,i)};Fragment.prototype.addToStart=function e(t){return new Fragment([t].concat(this.content),this.size+t.nodeSize)};Fragment.prototype.addToEnd=function e(t){return new Fragment(this.content.concat(t),this.size+t.nodeSize)};Fragment.prototype.eq=function e(t){if(this.content.length!=t.content.length){return false}for(var r=0;r<this.content.length;r++){if(!this.content[r].eq(t.content[r])){return false}}return true};prototypeAccessors.firstChild.get=function(){return this.content.length?this.content[0]:null};prototypeAccessors.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};prototypeAccessors.childCount.get=function(){return this.content.length};Fragment.prototype.child=function e(t){var r=this.content[t];if(!r){throw new RangeError("Index "+t+" out of range for "+this)}return r};Fragment.prototype.maybeChild=function e(t){return this.content[t]};Fragment.prototype.forEach=function e(t){for(var r=0,n=0;r<this.content.length;r++){var o=this.content[r];t(o,n,r);n+=o.nodeSize}};Fragment.prototype.findDiffStart=function e(t,r){if(r===void 0)r=0;return findDiffStart(this,t,r)};Fragment.prototype.findDiffEnd=function e(t,r,n){if(r===void 0)r=this.size;if(n===void 0)n=t.size;return findDiffEnd(this,t,r,n)};Fragment.prototype.findIndex=function e(t,r){if(r===void 0)r=-1;if(t==0){return retIndex(0,t)}if(t==this.size){return retIndex(this.content.length,t)}if(t>this.size||t<0){throw new RangeError("Position "+t+" outside of fragment ("+this+")")}for(var n=0,o=0;;n++){var i=this.child(n),a=o+i.nodeSize;if(a>=t){if(a==t||r>0){return retIndex(n+1,a)}return retIndex(n,o)}o=a}};Fragment.prototype.toString=function e(){return"<"+this.toStringInner()+">"};Fragment.prototype.toStringInner=function e(){return this.content.join(", ")};Fragment.prototype.toJSON=function e(){return this.content.length?this.content.map((function(e){return e.toJSON()})):null};Fragment.fromJSON=function e(t,r){if(!r){return Fragment.empty}if(!Array.isArray(r)){throw new RangeError("Invalid input for Fragment.fromJSON")}return new Fragment(r.map(t.nodeFromJSON))};Fragment.fromArray=function e(t){if(!t.length){return Fragment.empty}var r,n=0;for(var o=0;o<t.length;o++){var i=t[o];n+=i.nodeSize;if(o&&i.isText&&t[o-1].sameMarkup(i)){if(!r){r=t.slice(0,o)}r[r.length-1]=i.withText(r[r.length-1].text+i.text)}else if(r){r.push(i)}}return new Fragment(r||t,n)};Fragment.from=function e(t){if(!t){return Fragment.empty}if(t instanceof Fragment){return t}if(Array.isArray(t)){return this.fromArray(t)}if(t.attrs){return new Fragment([t],t.nodeSize)}throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(Fragment.prototype,prototypeAccessors);var found={index:0,offset:0};function retIndex(e,t){found.index=e;found.offset=t;return found}Fragment.empty=new Fragment([],0);function compareDeep(e,t){if(e===t){return true}if(!(e&&typeof e=="object")||!(t&&typeof t=="object")){return false}var r=Array.isArray(e);if(Array.isArray(t)!=r){return false}if(r){if(e.length!=t.length){return false}for(var n=0;n<e.length;n++){if(!compareDeep(e[n],t[n])){return false}}}else{for(var o in e){if(!(o in t)||!compareDeep(e[o],t[o])){return false}}for(var i in t){if(!(i in e)){return false}}}return true}var Mark=function e(t,r){this.type=t;this.attrs=r};Mark.prototype.addToSet=function e(t){var r,n=false;for(var o=0;o<t.length;o++){var i=t[o];if(this.eq(i)){return t}if(this.type.excludes(i.type)){if(!r){r=t.slice(0,o)}}else if(i.type.excludes(this.type)){return t}else{if(!n&&i.type.rank>this.type.rank){if(!r){r=t.slice(0,o)}r.push(this);n=true}if(r){r.push(i)}}}if(!r){r=t.slice()}if(!n){r.push(this)}return r};Mark.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return t.slice(0,r).concat(t.slice(r+1))}}return t};Mark.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return true}}return false};Mark.prototype.eq=function e(t){return this==t||this.type==t.type&&compareDeep(this.attrs,t.attrs)};Mark.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}return t};Mark.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Mark.fromJSON")}var n=t.marks[r.type];if(!n){throw new RangeError("There is no mark type "+r.type+" in this schema")}return n.create(r.attrs)};Mark.sameSet=function e(t,r){if(t==r){return true}if(t.length!=r.length){return false}for(var n=0;n<t.length;n++){if(!t[n].eq(r[n])){return false}}return true};Mark.setFrom=function e(t){if(!t||t.length==0){return Mark.none}if(t instanceof Mark){return[t]}var r=t.slice();r.sort((function(e,t){return e.type.rank-t.type.rank}));return r};Mark.none=[];function ReplaceError(e){var t=Error.call(this,e);t.__proto__=ReplaceError.prototype;return t}ReplaceError.prototype=Object.create(Error.prototype);ReplaceError.prototype.constructor=ReplaceError;ReplaceError.prototype.name="ReplaceError";var Slice=function e(t,r,n){this.content=t;this.openStart=r;this.openEnd=n};var prototypeAccessors$1={size:{configurable:true}};prototypeAccessors$1.size.get=function(){return this.content.size-this.openStart-this.openEnd};Slice.prototype.insertAt=function e(t,r){var n=insertInto(this.content,t+this.openStart,r,null);return n&&new Slice(n,this.openStart,this.openEnd)};Slice.prototype.removeBetween=function e(t,r){return new Slice(removeRange(this.content,t+this.openStart,r+this.openStart),this.openStart,this.openEnd)};Slice.prototype.eq=function e(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};Slice.prototype.toString=function e(){return this.content+"("+this.openStart+","+this.openEnd+")"};Slice.prototype.toJSON=function e(){if(!this.content.size){return null}var t={content:this.content.toJSON()};if(this.openStart>0){t.openStart=this.openStart}if(this.openEnd>0){t.openEnd=this.openEnd}return t};Slice.fromJSON=function e(t,r){if(!r){return Slice.empty}var n=r.openStart||0,o=r.openEnd||0;if(typeof n!="number"||typeof o!="number"){throw new RangeError("Invalid input for Slice.fromJSON")}return new Slice(Fragment.fromJSON(t,r.content),n,o)};Slice.maxOpen=function e(t,r){if(r===void 0)r=true;var n=0,o=0;for(var i=t.firstChild;i&&!i.isLeaf&&(r||!i.type.spec.isolating);i=i.firstChild){n++}for(var a=t.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild){o++}return new Slice(t,n,o)};Object.defineProperties(Slice.prototype,prototypeAccessors$1);function removeRange(e,t,r){var n=e.findIndex(t);var o=n.index;var i=n.offset;var a=e.maybeChild(o);var s=e.findIndex(r);var l=s.index;var c=s.offset;if(i==t||a.isText){if(c!=r&&!e.child(l).isText){throw new RangeError("Removing non-flat range")}return e.cut(0,t).append(e.cut(r))}if(o!=l){throw new RangeError("Removing non-flat range")}return e.replaceChild(o,a.copy(removeRange(a.content,t-i-1,r-i-1)))}function insertInto(e,t,r,n){var o=e.findIndex(t);var i=o.index;var a=o.offset;var s=e.maybeChild(i);if(a==t||s.isText){if(n&&!n.canReplace(i,i,r)){return null}return e.cut(0,t).append(r).append(e.cut(t))}var l=insertInto(s.content,t-a-1,r);return l&&e.replaceChild(i,s.copy(l))}Slice.empty=new Slice(Fragment.empty,0,0);function replace(e,t,r){if(r.openStart>e.depth){throw new ReplaceError("Inserted content deeper than insertion position")}if(e.depth-r.openStart!=t.depth-r.openEnd){throw new ReplaceError("Inconsistent open depths")}return replaceOuter(e,t,r,0)}function replaceOuter(e,t,r,n){var o=e.index(n),i=e.node(n);if(o==t.index(n)&&n<e.depth-r.openStart){var a=replaceOuter(e,t,r,n+1);return i.copy(i.content.replaceChild(o,a))}else if(!r.content.size){return close(i,replaceTwoWay(e,t,n))}else if(!r.openStart&&!r.openEnd&&e.depth==n&&t.depth==n){var s=e.parent,l=s.content;return close(s,l.cut(0,e.parentOffset).append(r.content).append(l.cut(t.parentOffset)))}else{var c=prepareSliceForReplace(r,e);var u=c.start;var p=c.end;return close(i,replaceThreeWay(e,u,p,t,n))}}function checkJoin(e,t){if(!t.type.compatibleContent(e.type)){throw new ReplaceError("Cannot join "+t.type.name+" onto "+e.type.name)}}function joinable(e,t,r){var n=e.node(r);checkJoin(n,t.node(r));return n}function addNode(e,t){var r=t.length-1;if(r>=0&&e.isText&&e.sameMarkup(t[r])){t[r]=e.withText(t[r].text+e.text)}else{t.push(e)}}function addRange(e,t,r,n){var o=(t||e).node(r);var i=0,a=t?t.index(r):o.childCount;if(e){i=e.index(r);if(e.depth>r){i++}else if(e.textOffset){addNode(e.nodeAfter,n);i++}}for(var s=i;s<a;s++){addNode(o.child(s),n)}if(t&&t.depth==r&&t.textOffset){addNode(t.nodeBefore,n)}}function close(e,t){if(!e.type.validContent(t)){throw new ReplaceError("Invalid content for node "+e.type.name)}return e.copy(t)}function replaceThreeWay(e,t,r,n,o){var i=e.depth>o&&joinable(e,t,o+1);var a=n.depth>o&&joinable(r,n,o+1);var s=[];addRange(null,e,o,s);if(i&&a&&t.index(o)==r.index(o)){checkJoin(i,a);addNode(close(i,replaceThreeWay(e,t,r,n,o+1)),s)}else{if(i){addNode(close(i,replaceTwoWay(e,t,o+1)),s)}addRange(t,r,o,s);if(a){addNode(close(a,replaceTwoWay(r,n,o+1)),s)}}addRange(n,null,o,s);return new Fragment(s)}function replaceTwoWay(e,t,r){var n=[];addRange(null,e,r,n);if(e.depth>r){var o=joinable(e,t,r+1);addNode(close(o,replaceTwoWay(e,t,r+1)),n)}addRange(t,null,r,n);return new Fragment(n)}function prepareSliceForReplace(e,t){var r=t.depth-e.openStart,n=t.node(r);var o=n.copy(e.content);for(var i=r-1;i>=0;i--){o=t.node(i).copy(Fragment.from(o))}return{start:o.resolveNoCache(e.openStart+r),end:o.resolveNoCache(o.content.size-e.openEnd-r)}}var ResolvedPos=function e(t,r,n){this.pos=t;this.path=r;this.depth=r.length/3-1;this.parentOffset=n};var prototypeAccessors$2={parent:{configurable:true},doc:{configurable:true},textOffset:{configurable:true},nodeAfter:{configurable:true},nodeBefore:{configurable:true}};ResolvedPos.prototype.resolveDepth=function e(t){if(t==null){return this.depth}if(t<0){return this.depth+t}return t};prototypeAccessors$2.parent.get=function(){return this.node(this.depth)};prototypeAccessors$2.doc.get=function(){return this.node(0)};ResolvedPos.prototype.node=function e(t){return this.path[this.resolveDepth(t)*3]};ResolvedPos.prototype.index=function e(t){return this.path[this.resolveDepth(t)*3+1]};ResolvedPos.prototype.indexAfter=function e(t){t=this.resolveDepth(t);return this.index(t)+(t==this.depth&&!this.textOffset?0:1)};ResolvedPos.prototype.start=function e(t){t=this.resolveDepth(t);return t==0?0:this.path[t*3-1]+1};ResolvedPos.prototype.end=function e(t){t=this.resolveDepth(t);return this.start(t)+this.node(t).content.size};ResolvedPos.prototype.before=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position before the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]};ResolvedPos.prototype.after=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position after the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};prototypeAccessors$2.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};prototypeAccessors$2.nodeAfter.get=function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount){return null}var r=this.pos-this.path[this.path.length-1],n=e.child(t);return r?e.child(t).cut(r):n};prototypeAccessors$2.nodeBefore.get=function(){var e=this.index(this.depth);var t=this.pos-this.path[this.path.length-1];if(t){return this.parent.child(e).cut(0,t)}return e==0?null:this.parent.child(e-1)};ResolvedPos.prototype.posAtIndex=function e(t,r){r=this.resolveDepth(r);var n=this.path[r*3],o=r==0?0:this.path[r*3-1]+1;for(var i=0;i<t;i++){o+=n.child(i).nodeSize}return o};ResolvedPos.prototype.marks=function e(){var t=this.parent,r=this.index();if(t.content.size==0){return Mark.none}if(this.textOffset){return t.child(r).marks}var n=t.maybeChild(r-1),o=t.maybeChild(r);if(!n){var i=n;n=o;o=i}var e=n.marks;for(var a=0;a<e.length;a++){if(e[a].type.spec.inclusive===false&&(!o||!e[a].isInSet(o.marks))){e=e[a--].removeFromSet(e)}}return e};ResolvedPos.prototype.marksAcross=function e(t){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline){return null}var n=r.marks,o=t.parent.maybeChild(t.index());for(var i=0;i<n.length;i++){if(n[i].type.spec.inclusive===false&&(!o||!n[i].isInSet(o.marks))){n=n[i--].removeFromSet(n)}}return n};ResolvedPos.prototype.sharedDepth=function e(t){for(var r=this.depth;r>0;r--){if(this.start(r)<=t&&this.end(r)>=t){return r}}return 0};ResolvedPos.prototype.blockRange=function e(t,r){if(t===void 0)t=this;if(t.pos<this.pos){return t.blockRange(this)}for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--){if(t.pos<=this.end(n)&&(!r||r(this.node(n)))){return new NodeRange(this,t,n)}}};ResolvedPos.prototype.sameParent=function e(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};ResolvedPos.prototype.max=function e(t){return t.pos>this.pos?t:this};ResolvedPos.prototype.min=function e(t){return t.pos<this.pos?t:this};ResolvedPos.prototype.toString=function e(){var t="";for(var r=1;r<=this.depth;r++){t+=(t?"/":"")+this.node(r).type.name+"_"+this.index(r-1)}return t+":"+this.parentOffset};ResolvedPos.resolve=function e(t,r){if(!(r>=0&&r<=t.content.size)){throw new RangeError("Position "+r+" out of range")}var n=[];var o=0,i=r;for(var a=t;;){var s=a.content.findIndex(i);var l=s.index;var c=s.offset;var u=i-c;n.push(a,l,o+c);if(!u){break}a=a.child(l);if(a.isText){break}i=u-1;o+=c+1}return new ResolvedPos(r,n,i)};ResolvedPos.resolveCached=function e(t,r){for(var n=0;n<resolveCache.length;n++){var o=resolveCache[n];if(o.pos==r&&o.doc==t){return o}}var i=resolveCache[resolveCachePos]=ResolvedPos.resolve(t,r);resolveCachePos=(resolveCachePos+1)%resolveCacheSize;return i};Object.defineProperties(ResolvedPos.prototype,prototypeAccessors$2);var resolveCache=[],resolveCachePos=0,resolveCacheSize=12;var NodeRange=function e(t,r,n){this.$from=t;this.$to=r;this.depth=n};var prototypeAccessors$1$1={start:{configurable:true},end:{configurable:true},parent:{configurable:true},startIndex:{configurable:true},endIndex:{configurable:true}};prototypeAccessors$1$1.start.get=function(){return this.$from.before(this.depth+1)};prototypeAccessors$1$1.end.get=function(){return this.$to.after(this.depth+1)};prototypeAccessors$1$1.parent.get=function(){return this.$from.node(this.depth)};prototypeAccessors$1$1.startIndex.get=function(){return this.$from.index(this.depth)};prototypeAccessors$1$1.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(NodeRange.prototype,prototypeAccessors$1$1);var emptyAttrs=Object.create(null);var Node$1=function e(t,r,n,o){this.type=t;this.attrs=r;this.content=n||Fragment.empty;this.marks=o||Mark.none};var prototypeAccessors$3={nodeSize:{configurable:true},childCount:{configurable:true},textContent:{configurable:true},firstChild:{configurable:true},lastChild:{configurable:true},isBlock:{configurable:true},isTextblock:{configurable:true},inlineContent:{configurable:true},isInline:{configurable:true},isText:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};prototypeAccessors$3.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};prototypeAccessors$3.childCount.get=function(){return this.content.childCount};Node$1.prototype.child=function e(t){return this.content.child(t)};Node$1.prototype.maybeChild=function e(t){return this.content.maybeChild(t)};Node$1.prototype.forEach=function e(t){this.content.forEach(t)};Node$1.prototype.nodesBetween=function e(t,r,n,o){if(o===void 0)o=0;this.content.nodesBetween(t,r,n,o,this)};Node$1.prototype.descendants=function e(t){this.nodesBetween(0,this.content.size,t)};prototypeAccessors$3.textContent.get=function(){return this.textBetween(0,this.content.size,"")};Node$1.prototype.textBetween=function e(t,r,n,o){return this.content.textBetween(t,r,n,o)};prototypeAccessors$3.firstChild.get=function(){return this.content.firstChild};prototypeAccessors$3.lastChild.get=function(){return this.content.lastChild};Node$1.prototype.eq=function e(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};Node$1.prototype.sameMarkup=function e(t){return this.hasMarkup(t.type,t.attrs,t.marks)};Node$1.prototype.hasMarkup=function e(t,r,n){return this.type==t&&compareDeep(this.attrs,r||t.defaultAttrs||emptyAttrs)&&Mark.sameSet(this.marks,n||Mark.none)};Node$1.prototype.copy=function e(t){if(t===void 0)t=null;if(t==this.content){return this}return new this.constructor(this.type,this.attrs,t,this.marks)};Node$1.prototype.mark=function e(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};Node$1.prototype.cut=function e(t,r){if(t==0&&r==this.content.size){return this}return this.copy(this.content.cut(t,r))};Node$1.prototype.slice=function e(t,r,n){if(r===void 0)r=this.content.size;if(n===void 0)n=false;if(t==r){return Slice.empty}var o=this.resolve(t),i=this.resolve(r);var a=n?0:o.sharedDepth(r);var s=o.start(a),l=o.node(a);var c=l.content.cut(o.pos-s,i.pos-s);return new Slice(c,o.depth-a,i.depth-a)};Node$1.prototype.replace=function e(t,r,n){return replace(this.resolve(t),this.resolve(r),n)};Node$1.prototype.nodeAt=function e(t){for(var r=this;;){var n=r.content.findIndex(t);var o=n.index;var i=n.offset;r=r.maybeChild(o);if(!r){return null}if(i==t||r.isText){return r}t-=i+1}};Node$1.prototype.childAfter=function e(t){var r=this.content.findIndex(t);var n=r.index;var o=r.offset;return{node:this.content.maybeChild(n),index:n,offset:o}};Node$1.prototype.childBefore=function e(t){if(t==0){return{node:null,index:0,offset:0}}var r=this.content.findIndex(t);var n=r.index;var o=r.offset;if(o<t){return{node:this.content.child(n),index:n,offset:o}}var i=this.content.child(n-1);return{node:i,index:n-1,offset:o-i.nodeSize}};Node$1.prototype.resolve=function e(t){return ResolvedPos.resolveCached(this,t)};Node$1.prototype.resolveNoCache=function e(t){return ResolvedPos.resolve(this,t)};Node$1.prototype.rangeHasMark=function e(t,r,n){var o=false;if(r>t){this.nodesBetween(t,r,(function(e){if(n.isInSet(e.marks)){o=true}return!o}))}return o};prototypeAccessors$3.isBlock.get=function(){return this.type.isBlock};prototypeAccessors$3.isTextblock.get=function(){return this.type.isTextblock};prototypeAccessors$3.inlineContent.get=function(){return this.type.inlineContent};prototypeAccessors$3.isInline.get=function(){return this.type.isInline};prototypeAccessors$3.isText.get=function(){return this.type.isText};prototypeAccessors$3.isLeaf.get=function(){return this.type.isLeaf};prototypeAccessors$3.isAtom.get=function(){return this.type.isAtom};Node$1.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}var t=this.type.name;if(this.content.size){t+="("+this.content.toStringInner()+")"}return wrapMarks(this.marks,t)};Node$1.prototype.contentMatchAt=function e(t){var r=this.type.contentMatch.matchFragment(this.content,0,t);if(!r){throw new Error("Called contentMatchAt on a node with invalid content")}return r};Node$1.prototype.canReplace=function e(t,r,n,o,i){if(n===void 0)n=Fragment.empty;if(o===void 0)o=0;if(i===void 0)i=n.childCount;var a=this.contentMatchAt(t).matchFragment(n,o,i);var s=a&&a.matchFragment(this.content,r);if(!s||!s.validEnd){return false}for(var l=o;l<i;l++){if(!this.type.allowsMarks(n.child(l).marks)){return false}}return true};Node$1.prototype.canReplaceWith=function e(t,r,n,o){if(o&&!this.type.allowsMarks(o)){return false}var i=this.contentMatchAt(t).matchType(n);var a=i&&i.matchFragment(this.content,r);return a?a.validEnd:false};Node$1.prototype.canAppend=function e(t){if(t.content.size){return this.canReplace(this.childCount,this.childCount,t.content)}else{return this.type.compatibleContent(t.type)}};Node$1.prototype.check=function e(){if(!this.type.validContent(this.content)){throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50))}this.content.forEach((function(e){return e.check()}))};Node$1.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}if(this.content.size){t.content=this.content.toJSON()}if(this.marks.length){t.marks=this.marks.map((function(e){return e.toJSON()}))}return t};Node$1.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Node.fromJSON")}var n=null;if(r.marks){if(!Array.isArray(r.marks)){throw new RangeError("Invalid mark data for Node.fromJSON")}n=r.marks.map(t.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string"){throw new RangeError("Invalid text node in JSON")}return t.text(r.text,n)}var o=Fragment.fromJSON(t,r.content);return t.nodeType(r.type).create(r.attrs,o,n)};Object.defineProperties(Node$1.prototype,prototypeAccessors$3);var TextNode=function(e){function t(t,r,n,o){e.call(this,t,r,null,o);if(!n){throw new RangeError("Empty text nodes are not allowed")}this.text=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={textContent:{configurable:true},nodeSize:{configurable:true}};t.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}return wrapMarks(this.marks,JSON.stringify(this.text))};r.textContent.get=function(){return this.text};t.prototype.textBetween=function e(t,r){return this.text.slice(t,r)};r.nodeSize.get=function(){return this.text.length};t.prototype.mark=function e(r){return r==this.marks?this:new t(this.type,this.attrs,this.text,r)};t.prototype.withText=function e(r){if(r==this.text){return this}return new t(this.type,this.attrs,r,this.marks)};t.prototype.cut=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.text.length;if(t==0&&r==this.text.length){return this}return this.withText(this.text.slice(t,r))};t.prototype.eq=function e(t){return this.sameMarkup(t)&&this.text==t.text};t.prototype.toJSON=function t(){var r=e.prototype.toJSON.call(this);r.text=this.text;return r};Object.defineProperties(t.prototype,r);return t}(Node$1);function wrapMarks(e,t){for(var r=e.length-1;r>=0;r--){t=e[r].type.name+"("+t+")"}return t}var ContentMatch=function e(t){this.validEnd=t;this.next=[];this.wrapCache=[]};var prototypeAccessors$4={inlineContent:{configurable:true},defaultType:{configurable:true},edgeCount:{configurable:true}};ContentMatch.parse=function e(t,r){var n=new TokenStream(t,r);if(n.next==null){return ContentMatch.empty}var o=parseExpr(n);if(n.next){n.err("Unexpected trailing text")}var i=dfa(nfa(o));checkForDeadEnds(i,n);return i};ContentMatch.prototype.matchType=function e(t){for(var r=0;r<this.next.length;r+=2){if(this.next[r]==t){return this.next[r+1]}}return null};ContentMatch.prototype.matchFragment=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=t.childCount;var o=this;for(var i=r;o&&i<n;i++){o=o.matchType(t.child(i).type)}return o};prototypeAccessors$4.inlineContent.get=function(){var e=this.next[0];return e?e.isInline:false};prototypeAccessors$4.defaultType.get=function(){for(var e=0;e<this.next.length;e+=2){var t=this.next[e];if(!(t.isText||t.hasRequiredAttrs())){return t}}};ContentMatch.prototype.compatible=function e(t){for(var r=0;r<this.next.length;r+=2){for(var n=0;n<t.next.length;n+=2){if(this.next[r]==t.next[n]){return true}}}return false};ContentMatch.prototype.fillBefore=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=0;var o=[this];function i(e,a){var s=e.matchFragment(t,n);if(s&&(!r||s.validEnd)){return Fragment.from(a.map((function(e){return e.createAndFill()})))}for(var l=0;l<e.next.length;l+=2){var c=e.next[l],u=e.next[l+1];if(!(c.isText||c.hasRequiredAttrs())&&o.indexOf(u)==-1){o.push(u);var p=i(u,a.concat(c));if(p){return p}}}}return i(this,[])};ContentMatch.prototype.findWrapping=function e(t){for(var r=0;r<this.wrapCache.length;r+=2){if(this.wrapCache[r]==t){return this.wrapCache[r+1]}}var n=this.computeWrapping(t);this.wrapCache.push(t,n);return n};ContentMatch.prototype.computeWrapping=function e(t){var r=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var o=n.shift(),i=o.match;if(i.matchType(t)){var a=[];for(var s=o;s.type;s=s.via){a.push(s.type)}return a.reverse()}for(var l=0;l<i.next.length;l+=2){var c=i.next[l];if(!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in r)&&(!o.type||i.next[l+1].validEnd)){n.push({match:c.contentMatch,type:c,via:o});r[c.name]=true}}}};prototypeAccessors$4.edgeCount.get=function(){return this.next.length>>1};ContentMatch.prototype.edge=function e(t){var r=t<<1;if(r>=this.next.length){throw new RangeError("There's no "+t+"th edge in this content match")}return{type:this.next[r],next:this.next[r+1]}};ContentMatch.prototype.toString=function e(){var t=[];function r(e){t.push(e);for(var n=1;n<e.next.length;n+=2){if(t.indexOf(e.next[n])==-1){r(e.next[n])}}}r(this);return t.map((function(e,r){var n=r+(e.validEnd?"*":" ")+" ";for(var o=0;o<e.next.length;o+=2){n+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1])}return n})).join("\n")};Object.defineProperties(ContentMatch.prototype,prototypeAccessors$4);ContentMatch.empty=new ContentMatch(true);var TokenStream=function e(t,r){this.string=t;this.nodeTypes=r;this.inline=null;this.pos=0;this.tokens=t.split(/\s*(?=\b|\W|$)/);if(this.tokens[this.tokens.length-1]==""){this.tokens.pop()}if(this.tokens[0]==""){this.tokens.shift()}};var prototypeAccessors$1$2={next:{configurable:true}};prototypeAccessors$1$2.next.get=function(){return this.tokens[this.pos]};TokenStream.prototype.eat=function e(t){return this.next==t&&(this.pos++||true)};TokenStream.prototype.err=function e(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(TokenStream.prototype,prototypeAccessors$1$2);function parseExpr(e){var t=[];do{t.push(parseExprSeq(e))}while(e.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function parseExprSeq(e){var t=[];do{t.push(parseExprSubscript(e))}while(e.next&&e.next!=")"&&e.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function parseExprSubscript(e){var t=parseExprAtom(e);for(;;){if(e.eat("+")){t={type:"plus",expr:t}}else if(e.eat("*")){t={type:"star",expr:t}}else if(e.eat("?")){t={type:"opt",expr:t}}else if(e.eat("{")){t=parseExprRange(e,t)}else{break}}return t}function parseNum(e){if(/\D/.test(e.next)){e.err("Expected number, got '"+e.next+"'")}var t=Number(e.next);e.pos++;return t}function parseExprRange(e,t){var r=parseNum(e),n=r;if(e.eat(",")){if(e.next!="}"){n=parseNum(e)}else{n=-1}}if(!e.eat("}")){e.err("Unclosed braced range")}return{type:"range",min:r,max:n,expr:t}}function resolveName(e,t){var r=e.nodeTypes,n=r[t];if(n){return[n]}var o=[];for(var i in r){var a=r[i];if(a.groups.indexOf(t)>-1){o.push(a)}}if(o.length==0){e.err("No node type or group '"+t+"' found")}return o}function parseExprAtom(e){if(e.eat("(")){var t=parseExpr(e);if(!e.eat(")")){e.err("Missing closing paren")}return t}else if(!/\W/.test(e.next)){var r=resolveName(e,e.next).map((function(t){if(e.inline==null){e.inline=t.isInline}else if(e.inline!=t.isInline){e.err("Mixing inline and block content")}return{type:"name",value:t}}));e.pos++;return r.length==1?r[0]:{type:"choice",exprs:r}}else{e.err("Unexpected token '"+e.next+"'")}}function nfa(e){var t=[[]];o(i(e,0),r());return t;function r(){return t.push([])-1}function n(e,r,n){var o={term:n,to:r};t[e].push(o);return o}function o(e,t){e.forEach((function(e){return e.to=t}))}function i(e,t){if(e.type=="choice"){return e.exprs.reduce((function(e,r){return e.concat(i(r,t))}),[])}else if(e.type=="seq"){for(var a=0;;a++){var s=i(e.exprs[a],t);if(a==e.exprs.length-1){return s}o(s,t=r())}}else if(e.type=="star"){var l=r();n(t,l);o(i(e.expr,l),l);return[n(l)]}else if(e.type=="plus"){var c=r();o(i(e.expr,t),c);o(i(e.expr,c),c);return[n(c)]}else if(e.type=="opt"){return[n(t)].concat(i(e.expr,t))}else if(e.type=="range"){var u=t;for(var p=0;p<e.min;p++){var f=r();o(i(e.expr,u),f);u=f}if(e.max==-1){o(i(e.expr,u),u)}else{for(var d=e.min;d<e.max;d++){var h=r();n(u,h);o(i(e.expr,u),h);u=h}}return[n(u)]}else if(e.type=="name"){return[n(t,null,e.value)]}}}function cmp(e,t){return t-e}function nullFrom(e,t){var r=[];n(t);return r.sort(cmp);function n(t){var o=e[t];if(o.length==1&&!o[0].term){return n(o[0].to)}r.push(t);for(var i=0;i<o.length;i++){var a=o[i];var s=a.term;var l=a.to;if(!s&&r.indexOf(l)==-1){n(l)}}}}function dfa(e){var t=Object.create(null);return r(nullFrom(e,0));function r(n){var o=[];n.forEach((function(t){e[t].forEach((function(t){var r=t.term;var n=t.to;if(!r){return}var i=o.indexOf(r),a=i>-1&&o[i+1];nullFrom(e,n).forEach((function(e){if(!a){o.push(r,a=[])}if(a.indexOf(e)==-1){a.push(e)}}))}))}));var i=t[n.join(",")]=new ContentMatch(n.indexOf(e.length-1)>-1);for(var a=0;a<o.length;a+=2){var s=o[a+1].sort(cmp);i.next.push(o[a],t[s.join(",")]||r(s))}return i}}function checkForDeadEnds(e,t){for(var r=0,n=[e];r<n.length;r++){var o=n[r],i=!o.validEnd,a=[];for(var s=0;s<o.next.length;s+=2){var l=o.next[s],c=o.next[s+1];a.push(l.name);if(i&&!(l.isText||l.hasRequiredAttrs())){i=false}if(n.indexOf(c)==-1){n.push(c)}}if(i){t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}}function defaultAttrs(e){var t=Object.create(null);for(var r in e){var n=e[r];if(!n.hasDefault){return null}t[r]=n.default}return t}function computeAttrs(e,t){var r=Object.create(null);for(var n in e){var o=t&&t[n];if(o===undefined){var i=e[n];if(i.hasDefault){o=i.default}else{throw new RangeError("No value supplied for attribute "+n)}}r[n]=o}return r}function initAttrs(e){var t=Object.create(null);if(e){for(var r in e){t[r]=new Attribute(e[r])}}return t}var NodeType=function e(t,r,n){this.name=t;this.schema=r;this.spec=n;this.groups=n.group?n.group.split(" "):[];this.attrs=initAttrs(n.attrs);this.defaultAttrs=defaultAttrs(this.attrs);this.contentMatch=null;this.markSet=null;this.inlineContent=null;this.isBlock=!(n.inline||t=="text");this.isText=t=="text"};var prototypeAccessors$5={isInline:{configurable:true},isTextblock:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};prototypeAccessors$5.isInline.get=function(){return!this.isBlock};prototypeAccessors$5.isTextblock.get=function(){return this.isBlock&&this.inlineContent};prototypeAccessors$5.isLeaf.get=function(){return this.contentMatch==ContentMatch.empty};prototypeAccessors$5.isAtom.get=function(){return this.isLeaf||this.spec.atom};NodeType.prototype.hasRequiredAttrs=function e(){for(var t in this.attrs){if(this.attrs[t].isRequired){return true}}return false};NodeType.prototype.compatibleContent=function e(t){return this==t||this.contentMatch.compatible(t.contentMatch)};NodeType.prototype.computeAttrs=function e(t){if(!t&&this.defaultAttrs){return this.defaultAttrs}else{return computeAttrs(this.attrs,t)}};NodeType.prototype.create=function e(t,r,n){if(this.isText){throw new Error("NodeType.create can't construct text nodes")}return new Node$1(this,this.computeAttrs(t),Fragment.from(r),Mark.setFrom(n))};NodeType.prototype.createChecked=function e(t,r,n){r=Fragment.from(r);if(!this.validContent(r)){throw new RangeError("Invalid content for node "+this.name)}return new Node$1(this,this.computeAttrs(t),r,Mark.setFrom(n))};NodeType.prototype.createAndFill=function e(t,r,n){t=this.computeAttrs(t);r=Fragment.from(r);if(r.size){var o=this.contentMatch.fillBefore(r);if(!o){return null}r=o.append(r)}var i=this.contentMatch.matchFragment(r).fillBefore(Fragment.empty,true);if(!i){return null}return new Node$1(this,t,r.append(i),Mark.setFrom(n))};NodeType.prototype.validContent=function e(t){var r=this.contentMatch.matchFragment(t);if(!r||!r.validEnd){return false}for(var n=0;n<t.childCount;n++){if(!this.allowsMarks(t.child(n).marks)){return false}}return true};NodeType.prototype.allowsMarkType=function e(t){return this.markSet==null||this.markSet.indexOf(t)>-1};NodeType.prototype.allowsMarks=function e(t){if(this.markSet==null){return true}for(var r=0;r<t.length;r++){if(!this.allowsMarkType(t[r].type)){return false}}return true};NodeType.prototype.allowedMarks=function e(t){if(this.markSet==null){return t}var r;for(var n=0;n<t.length;n++){if(!this.allowsMarkType(t[n].type)){if(!r){r=t.slice(0,n)}}else if(r){r.push(t[n])}}return!r?t:r.length?r:Mark.empty};NodeType.compile=function e(t,r){var n=Object.create(null);t.forEach((function(e,t){return n[e]=new NodeType(e,r,t)}));var o=r.spec.topNode||"doc";if(!n[o]){throw new RangeError("Schema is missing its top node type ('"+o+"')")}if(!n.text){throw new RangeError("Every schema needs a 'text' type")}for(var i in n.text.attrs){throw new RangeError("The text node type should not have attributes")}return n};Object.defineProperties(NodeType.prototype,prototypeAccessors$5);var Attribute=function e(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default");this.default=t.default};var prototypeAccessors$1$3={isRequired:{configurable:true}};prototypeAccessors$1$3.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(Attribute.prototype,prototypeAccessors$1$3);var MarkType=function e(t,r,n,o){this.name=t;this.schema=n;this.spec=o;this.attrs=initAttrs(o.attrs);this.rank=r;this.excluded=null;var i=defaultAttrs(this.attrs);this.instance=i&&new Mark(this,i)};MarkType.prototype.create=function e(t){if(!t&&this.instance){return this.instance}return new Mark(this,computeAttrs(this.attrs,t))};MarkType.compile=function e(t,r){var n=Object.create(null),o=0;t.forEach((function(e,t){return n[e]=new MarkType(e,o++,r,t)}));return n};MarkType.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t.slice(0,r).concat(t.slice(r+1))}}return t};MarkType.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t[r]}}};MarkType.prototype.excludes=function e(t){return this.excluded.indexOf(t)>-1};var Schema=function e(t){this.spec={};for(var r in t){this.spec[r]=t[r]}this.spec.nodes=orderedmap.from(t.nodes);this.spec.marks=orderedmap.from(t.marks);this.nodes=NodeType.compile(this.spec.nodes,this);this.marks=MarkType.compile(this.spec.marks,this);var n=Object.create(null);for(var o in this.nodes){if(o in this.marks){throw new RangeError(o+" can not be both a node and a mark")}var i=this.nodes[o],a=i.spec.content||"",s=i.spec.marks;i.contentMatch=n[a]||(n[a]=ContentMatch.parse(a,this.nodes));i.inlineContent=i.contentMatch.inlineContent;i.markSet=s=="_"?null:s?gatherMarks(this,s.split(" ")):s==""||!i.inlineContent?[]:null}for(var l in this.marks){var c=this.marks[l],u=c.spec.excludes;c.excluded=u==null?[c]:u==""?[]:gatherMarks(this,u.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this);this.markFromJSON=this.markFromJSON.bind(this);this.topNodeType=this.nodes[this.spec.topNode||"doc"];this.cached=Object.create(null);this.cached.wrappings=Object.create(null)};Schema.prototype.node=function e(t,r,n,o){if(typeof t=="string"){t=this.nodeType(t)}else if(!(t instanceof NodeType)){throw new RangeError("Invalid node type: "+t)}else if(t.schema!=this){throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(r,n,o)};Schema.prototype.text=function e(t,r){var n=this.nodes.text;return new TextNode(n,n.defaultAttrs,t,Mark.setFrom(r))};Schema.prototype.mark=function e(t,r){if(typeof t=="string"){t=this.marks[t]}return t.create(r)};Schema.prototype.nodeFromJSON=function e(t){return Node$1.fromJSON(this,t)};Schema.prototype.markFromJSON=function e(t){return Mark.fromJSON(this,t)};Schema.prototype.nodeType=function e(t){var r=this.nodes[t];if(!r){throw new RangeError("Unknown node type: "+t)}return r};function gatherMarks(e,t){var r=[];for(var n=0;n<t.length;n++){var o=t[n],i=e.marks[o],a=i;if(i){r.push(i)}else{for(var s in e.marks){var l=e.marks[s];if(o=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(o)>-1){r.push(a=l)}}}if(!a){throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}}return r}var DOMParser=function e(t,r){var n=this;this.schema=t;this.rules=r;this.tags=[];this.styles=[];r.forEach((function(e){if(e.tag){n.tags.push(e)}else if(e.style){n.styles.push(e)}}));this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node){return false}var r=t.nodes[e.node];return r.contentMatch.matchType(r)}))};DOMParser.prototype.parse=function e(t,r){if(r===void 0)r={};var n=new ParseContext(this,r,false);n.addAll(t,null,r.from,r.to);return n.finish()};DOMParser.prototype.parseSlice=function e(t,r){if(r===void 0)r={};var n=new ParseContext(this,r,true);n.addAll(t,null,r.from,r.to);return Slice.maxOpen(n.finish())};DOMParser.prototype.matchTag=function e(t,r,n){for(var o=n?this.tags.indexOf(n)+1:0;o<this.tags.length;o++){var i=this.tags[o];if(matches(t,i.tag)&&(i.namespace===undefined||t.namespaceURI==i.namespace)&&(!i.context||r.matchesContext(i.context))){if(i.getAttrs){var a=i.getAttrs(t);if(a===false){continue}i.attrs=a}return i}}};DOMParser.prototype.matchStyle=function e(t,r,n,o){for(var i=o?this.styles.indexOf(o)+1:0;i<this.styles.length;i++){var a=this.styles[i];if(a.style.indexOf(t)!=0||a.context&&!n.matchesContext(a.context)||a.style.length>t.length&&(a.style.charCodeAt(t.length)!=61||a.style.slice(t.length+1)!=r)){continue}if(a.getAttrs){var s=a.getAttrs(r);if(s===false){continue}a.attrs=s}return a}};DOMParser.schemaRules=function e(t){var r=[];function n(e){var t=e.priority==null?50:e.priority,n=0;for(;n<r.length;n++){var o=r[n],i=o.priority==null?50:o.priority;if(i<t){break}}r.splice(n,0,e)}var o=function(e){var r=t.marks[e].spec.parseDOM;if(r){r.forEach((function(t){n(t=copy(t));t.mark=e}))}};for(var i in t.marks)o(i);var a=function(e){var r=t.nodes[s].spec.parseDOM;if(r){r.forEach((function(e){n(e=copy(e));e.node=s}))}};for(var s in t.nodes)a();return r};DOMParser.fromSchema=function e(t){return t.cached.domParser||(t.cached.domParser=new DOMParser(t,DOMParser.schemaRules(t)))};var blockTags={address:true,article:true,aside:true,blockquote:true,canvas:true,dd:true,div:true,dl:true,fieldset:true,figcaption:true,figure:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,li:true,noscript:true,ol:true,output:true,p:true,pre:true,section:true,table:true,tfoot:true,ul:true};var ignoreTags={head:true,noscript:true,object:true,script:true,style:true,title:true};var listTags={ol:true,ul:true};var OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(e){return(e?OPT_PRESERVE_WS:0)|(e==="full"?OPT_PRESERVE_WS_FULL:0)}var NodeContext=function e(t,r,n,o,i,a,s){this.type=t;this.attrs=r;this.solid=i;this.match=a||(s&OPT_OPEN_LEFT?null:t.contentMatch);this.options=s;this.content=[];this.marks=n;this.activeMarks=Mark.none;this.pendingMarks=o;this.stashMarks=[]};NodeContext.prototype.findWrapping=function e(t){if(!this.match){if(!this.type){return[]}var r=this.type.contentMatch.fillBefore(Fragment.from(t));if(r){this.match=this.type.contentMatch.matchFragment(r)}else{var n=this.type.contentMatch,o;if(o=n.findWrapping(t.type)){this.match=n;return o}else{return null}}}return this.match.findWrapping(t.type)};NodeContext.prototype.finish=function e(t){if(!(this.options&OPT_PRESERVE_WS)){var r=this.content[this.content.length-1],n;if(r&&r.isText&&(n=/[ \t\r\n\u000c]+$/.exec(r.text))){if(r.text.length==n[0].length){this.content.pop()}else{this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-n[0].length))}}}var o=Fragment.from(this.content);if(!t&&this.match){o=o.append(this.match.fillBefore(Fragment.empty,true))}return this.type?this.type.create(this.attrs,o,this.marks):o};NodeContext.prototype.popFromStashMark=function e(t){for(var r=this.stashMarks.length-1;r>=0;r--){if(t.eq(this.stashMarks[r])){return this.stashMarks.splice(r,1)[0]}}};NodeContext.prototype.applyPending=function e(t){for(var r=0,n=this.pendingMarks;r<n.length;r++){var o=n[r];if((this.type?this.type.allowsMarkType(o.type):markMayApply(o.type,t))&&!o.isInSet(this.activeMarks)){this.activeMarks=o.addToSet(this.activeMarks);this.pendingMarks=o.removeFromSet(this.pendingMarks)}}};var ParseContext=function e(t,r,n){this.parser=t;this.options=r;this.isOpen=n;var o=r.topNode,i;var a=wsOptionsFor(r.preserveWhitespace)|(n?OPT_OPEN_LEFT:0);if(o){i=new NodeContext(o.type,o.attrs,Mark.none,Mark.none,true,r.topMatch||o.type.contentMatch,a)}else if(n){i=new NodeContext(null,null,Mark.none,Mark.none,true,null,a)}else{i=new NodeContext(t.schema.topNodeType,null,Mark.none,Mark.none,true,null,a)}this.nodes=[i];this.open=0;this.find=r.findPositions;this.needsBlock=false};var prototypeAccessors$6={top:{configurable:true},currentPos:{configurable:true}};prototypeAccessors$6.top.get=function(){return this.nodes[this.open]};ParseContext.prototype.addDOM=function e(t){if(t.nodeType==3){this.addTextNode(t)}else if(t.nodeType==1){var r=t.getAttribute("style");var n=r?this.readStyles(parseStyles(r)):null,o=this.top;if(n!=null){for(var i=0;i<n.length;i++){this.addPendingMark(n[i])}}this.addElement(t);if(n!=null){for(var a=0;a<n.length;a++){this.removePendingMark(n[a],o)}}}};ParseContext.prototype.addTextNode=function e(t){var r=t.nodeValue;var n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(r)){if(!(n.options&OPT_PRESERVE_WS)){r=r.replace(/[ \t\r\n\u000c]+/g," ");if(/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var o=n.content[n.content.length-1];var i=t.previousSibling;if(!o||i&&i.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text)){r=r.slice(1)}}}else if(!(n.options&OPT_PRESERVE_WS_FULL)){r=r.replace(/\r?\n|\r/g," ")}if(r){this.insertNode(this.parser.schema.text(r))}this.findInText(t)}else{this.findInside(t)}};ParseContext.prototype.addElement=function e(t,r){var n=t.nodeName.toLowerCase(),o;if(listTags.hasOwnProperty(n)&&this.parser.normalizeLists){normalizeList(t)}var i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(o=this.parser.matchTag(t,this,r));if(i?i.ignore:ignoreTags.hasOwnProperty(n)){this.findInside(t)}else if(!i||i.skip||i.closeParent){if(i&&i.closeParent){this.open=Math.max(0,this.open-1)}else if(i&&i.skip.nodeType){t=i.skip}var a,s=this.top,l=this.needsBlock;if(blockTags.hasOwnProperty(n)){a=true;if(!s.type){this.needsBlock=true}}else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t);if(a){this.sync(s)}this.needsBlock=l}else{this.addElementByRule(t,i,i.consuming===false?o:null)}};ParseContext.prototype.leafFallback=function e(t){if(t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent){this.addTextNode(t.ownerDocument.createTextNode("\n"))}};ParseContext.prototype.readStyles=function e(t){var r=Mark.none;e:for(var n=0;n<t.length;n+=2){for(var o=null;;){var i=this.parser.matchStyle(t[n],t[n+1],this,o);if(!i){continue e}if(i.ignore){return null}r=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(r);if(i.consuming===false){o=i}else{break}}}return r};ParseContext.prototype.addElementByRule=function e(t,r,n){var o=this;var i,a,s,l;if(r.node){a=this.parser.schema.nodes[r.node];if(!a.isLeaf){i=this.enter(a,r.attrs,r.preserveWhitespace)}else if(!this.insertNode(a.create(r.attrs))){this.leafFallback(t)}}else{s=this.parser.schema.marks[r.mark];l=s.create(r.attrs);this.addPendingMark(l)}var c=this.top;if(a&&a.isLeaf){this.findInside(t)}else if(n){this.addElement(t,n)}else if(r.getContent){this.findInside(t);r.getContent(t,this.parser.schema).forEach((function(e){return o.insertNode(e)}))}else{var u=r.contentElement;if(typeof u=="string"){u=t.querySelector(u)}else if(typeof u=="function"){u=u(t)}if(!u){u=t}this.findAround(t,u,true);this.addAll(u,i)}if(i){this.sync(c);this.open--}if(l){this.removePendingMark(l,c)}};ParseContext.prototype.addAll=function e(t,r,n,o){var i=n||0;for(var a=n?t.childNodes[n]:t.firstChild,s=o==null?null:t.childNodes[o];a!=s;a=a.nextSibling,++i){this.findAtPoint(t,i);this.addDOM(a);if(r&&blockTags.hasOwnProperty(a.nodeName.toLowerCase())){this.sync(r)}}this.findAtPoint(t,i)};ParseContext.prototype.findPlace=function e(t){var r,n;for(var o=this.open;o>=0;o--){var i=this.nodes[o];var a=i.findWrapping(t);if(a&&(!r||r.length>a.length)){r=a;n=i;if(!a.length){break}}if(i.solid){break}}if(!r){return false}this.sync(n);for(var s=0;s<r.length;s++){this.enterInner(r[s],null,false)}return true};ParseContext.prototype.insertNode=function e(t){if(t.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();if(r){this.enterInner(r)}}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type);if(n.match){n.match=n.match.matchType(t.type)}var o=n.activeMarks;for(var i=0;i<t.marks.length;i++){if(!n.type||n.type.allowsMarkType(t.marks[i].type)){o=t.marks[i].addToSet(o)}}n.content.push(t.mark(o));return true}return false};ParseContext.prototype.enter=function e(t,r,n){var o=this.findPlace(t.create(r));if(o){this.enterInner(t,r,true,n)}return o};ParseContext.prototype.enterInner=function e(t,r,n,o){this.closeExtra();var i=this.top;i.applyPending(t);i.match=i.match&&i.match.matchType(t,r);var a=o==null?i.options&~OPT_OPEN_LEFT:wsOptionsFor(o);if(i.options&OPT_OPEN_LEFT&&i.content.length==0){a|=OPT_OPEN_LEFT}this.nodes.push(new NodeContext(t,r,i.activeMarks,i.pendingMarks,n,null,a));this.open++};ParseContext.prototype.closeExtra=function e(t){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--){this.nodes[r-1].content.push(this.nodes[r].finish(t))}this.nodes.length=this.open+1}};ParseContext.prototype.finish=function e(){this.open=0;this.closeExtra(this.isOpen);return this.nodes[0].finish(this.isOpen||this.options.topOpen)};ParseContext.prototype.sync=function e(t){for(var r=this.open;r>=0;r--){if(this.nodes[r]==t){this.open=r;return}}};prototypeAccessors$6.currentPos.get=function(){this.closeExtra();var e=0;for(var t=this.open;t>=0;t--){var r=this.nodes[t].content;for(var n=r.length-1;n>=0;n--){e+=r[n].nodeSize}if(t){e++}}return e};ParseContext.prototype.findAtPoint=function e(t,r){if(this.find){for(var n=0;n<this.find.length;n++){if(this.find[n].node==t&&this.find[n].offset==r){this.find[n].pos=this.currentPos}}}};ParseContext.prototype.findInside=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)){this.find[r].pos=this.currentPos}}}};ParseContext.prototype.findAround=function e(t,r,n){if(t!=r&&this.find){for(var o=0;o<this.find.length;o++){if(this.find[o].pos==null&&t.nodeType==1&&t.contains(this.find[o].node)){var i=r.compareDocumentPosition(this.find[o].node);if(i&(n?2:4)){this.find[o].pos=this.currentPos}}}}};ParseContext.prototype.findInText=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].node==t){this.find[r].pos=this.currentPos-(t.nodeValue.length-this.find[r].offset)}}}};ParseContext.prototype.matchesContext=function e(t){var r=this;if(t.indexOf("|")>-1){return t.split(/\s*\|\s*/).some(this.matchesContext,this)}var n=t.split("/");var o=this.options.context;var i=!this.isOpen&&(!o||o.parent.type==this.nodes[0].type);var a=-(o?o.depth+1:0)+(i?0:1);var s=function(e,t){for(;e>=0;e--){var l=n[e];if(l==""){if(e==n.length-1||e==0){continue}for(;t>=a;t--){if(s(e-1,t)){return true}}return false}else{var c=t>0||t==0&&i?r.nodes[t].type:o&&t>=a?o.node(t-a).type:null;if(!c||c.name!=l&&c.groups.indexOf(l)==-1){return false}t--}}return true};return s(n.length-1,this.open)};ParseContext.prototype.textblockFromContext=function e(){var t=this.options.context;if(t){for(var r=t.depth;r>=0;r--){var n=t.node(r).contentMatchAt(t.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs){return n}}}for(var o in this.parser.schema.nodes){var i=this.parser.schema.nodes[o];if(i.isTextblock&&i.defaultAttrs){return i}}};ParseContext.prototype.addPendingMark=function e(t){var r=findSameMarkInSet(t,this.top.pendingMarks);if(r){this.top.stashMarks.push(r)}this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};ParseContext.prototype.removePendingMark=function e(t,r){for(var n=this.open;n>=0;n--){var o=this.nodes[n];var i=o.pendingMarks.lastIndexOf(t);if(i>-1){o.pendingMarks=t.removeFromSet(o.pendingMarks)}else{o.activeMarks=t.removeFromSet(o.activeMarks);var a=o.popFromStashMark(t);if(a){o.activeMarks=a.addToSet(o.activeMarks)}}if(o==r){break}}};Object.defineProperties(ParseContext.prototype,prototypeAccessors$6);function normalizeList(e){for(var t=e.firstChild,r=null;t;t=t.nextSibling){var n=t.nodeType==1?t.nodeName.toLowerCase():null;if(n&&listTags.hasOwnProperty(n)&&r){r.appendChild(t);t=r}else if(n=="li"){r=t}else if(n){r=null}}}function matches(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function parseStyles(e){var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,n=[];while(r=t.exec(e)){n.push(r[1],r[2].trim())}return n}function copy(e){var t={};for(var r in e){t[r]=e[r]}return t}function markMayApply(e,t){var r=t.schema.nodes;var n=function(n){var o=r[n];if(!o.allowsMarkType(e)){return}var i=[],a=function(e){i.push(e);for(var r=0;r<e.edgeCount;r++){var n=e.edge(r);var o=n.type;var s=n.next;if(o==t){return true}if(i.indexOf(s)<0&&a(s)){return true}}};if(a(o.contentMatch)){return{v:true}}};for(var o in r){var i=n(o);if(i)return i.v}}function findSameMarkInSet(e,t){for(var r=0;r<t.length;r++){if(e.eq(t[r])){return t[r]}}}var DOMSerializer=function e(t,r){this.nodes=t||{};this.marks=r||{}};DOMSerializer.prototype.serializeFragment=function e(t,r,n){var o=this;if(r===void 0)r={};if(!n){n=doc(r).createDocumentFragment()}var i=n,a=null;t.forEach((function(e){if(a||e.marks.length){if(!a){a=[]}var t=0,n=0;while(t<a.length&&n<e.marks.length){var s=e.marks[n];if(!o.marks[s.type.name]){n++;continue}if(!s.eq(a[t])||s.type.spec.spanning===false){break}t+=2;n++}while(t<a.length){i=a.pop();a.pop()}while(n<e.marks.length){var l=e.marks[n++];var c=o.serializeMark(l,e.isInline,r);if(c){a.push(l,i);i.appendChild(c.dom);i=c.contentDOM||c.dom}}}i.appendChild(o.serializeNode(e,r))}));return n};DOMSerializer.prototype.serializeNode=function e(t,r){if(r===void 0)r={};var n=DOMSerializer.renderSpec(doc(r),this.nodes[t.type.name](t));var o=n.dom;var i=n.contentDOM;if(i){if(t.isLeaf){throw new RangeError("Content hole not allowed in a leaf node spec")}if(r.onContent){r.onContent(t,i,r)}else{this.serializeFragment(t.content,r,i)}}return o};DOMSerializer.prototype.serializeNodeAndMarks=function e(t,r){if(r===void 0)r={};var n=this.serializeNode(t,r);for(var o=t.marks.length-1;o>=0;o--){var i=this.serializeMark(t.marks[o],t.isInline,r);if(i){(i.contentDOM||i.dom).appendChild(n);n=i.dom}}return n};DOMSerializer.prototype.serializeMark=function e(t,r,n){if(n===void 0)n={};var o=this.marks[t.type.name];return o&&DOMSerializer.renderSpec(doc(n),o(t,r))};DOMSerializer.renderSpec=function e(t,r,n){if(n===void 0)n=null;if(typeof r=="string"){return{dom:t.createTextNode(r)}}if(r.nodeType!=null){return{dom:r}}if(r.dom&&r.dom.nodeType!=null){return r}var o=r[0],i=o.indexOf(" ");if(i>0){n=o.slice(0,i);o=o.slice(i+1)}var a=null,s=n?t.createElementNS(n,o):t.createElement(o);var l=r[1],c=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){c=2;for(var u in l){if(l[u]!=null){var p=u.indexOf(" ");if(p>0){s.setAttributeNS(u.slice(0,p),u.slice(p+1),l[u])}else{s.setAttribute(u,l[u])}}}}for(var f=c;f<r.length;f++){var d=r[f];if(d===0){if(f<r.length-1||f>c){throw new RangeError("Content hole must be the only child of its parent node")}return{dom:s,contentDOM:s}}else{var h=DOMSerializer.renderSpec(t,d,n);var m=h.dom;var v=h.contentDOM;s.appendChild(m);if(v){if(a){throw new RangeError("Multiple content holes")}a=v}}}return{dom:s,contentDOM:a}};DOMSerializer.fromSchema=function e(t){return t.cached.domSerializer||(t.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(t),this.marksFromSchema(t)))};DOMSerializer.nodesFromSchema=function e(t){var r=gatherToDOM(t.nodes);if(!r.text){r.text=function(e){return e.text}}return r};DOMSerializer.marksFromSchema=function e(t){return gatherToDOM(t.marks)};function gatherToDOM(e){var t={};for(var r in e){var n=e[r].spec.toDOM;if(n){t[r]=n}}return t}function doc(e){return e.document||window.document}var lower16=65535;var factor16=Math.pow(2,16);function makeRecover(e,t){return e+t*factor16}function recoverIndex(e){return e&lower16}function recoverOffset(e){return(e-(e&lower16))/factor16}var MapResult=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=null;this.pos=t;this.deleted=r;this.recover=n};var StepMap=function e(t,r){if(r===void 0)r=false;this.ranges=t;this.inverted=r};StepMap.prototype.recover=function e(t){var r=0,n=recoverIndex(t);if(!this.inverted){for(var o=0;o<n;o++){r+=this.ranges[o*3+2]-this.ranges[o*3+1]}}return this.ranges[n*3]+r+recoverOffset(t)};StepMap.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};StepMap.prototype.map=function e(t,r){if(r===void 0)r=1;return this._map(t,r,true)};StepMap.prototype._map=function e(t,r,n){var o=0,i=this.inverted?2:1,a=this.inverted?1:2;for(var s=0;s<this.ranges.length;s+=3){var l=this.ranges[s]-(this.inverted?o:0);if(l>t){break}var c=this.ranges[s+i],u=this.ranges[s+a],p=l+c;if(t<=p){var f=!c?r:t==l?-1:t==p?1:r;var d=l+o+(f<0?0:u);if(n){return d}var h=t==(r<0?l:p)?null:makeRecover(s/3,t-l);return new MapResult(d,r<0?t!=l:t!=p,h)}o+=u-c}return n?t+o:new MapResult(t+o)};StepMap.prototype.touches=function e(t,r){var n=0,o=recoverIndex(r);var i=this.inverted?2:1,a=this.inverted?1:2;for(var s=0;s<this.ranges.length;s+=3){var l=this.ranges[s]-(this.inverted?n:0);if(l>t){break}var c=this.ranges[s+i],u=l+c;if(t<=u&&s==o*3){return true}n+=this.ranges[s+a]-c}return false};StepMap.prototype.forEach=function e(t){var r=this.inverted?2:1,n=this.inverted?1:2;for(var o=0,i=0;o<this.ranges.length;o+=3){var a=this.ranges[o],s=a-(this.inverted?i:0),l=a+(this.inverted?0:i);var c=this.ranges[o+r],u=this.ranges[o+n];t(s,s+c,l,l+u);i+=u-c}};StepMap.prototype.invert=function e(){return new StepMap(this.ranges,!this.inverted)};StepMap.prototype.toString=function e(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};StepMap.offset=function e(t){return t==0?StepMap.empty:new StepMap(t<0?[0,-t,0]:[0,0,t])};StepMap.empty=new StepMap([]);var Mapping=function e(t,r,n,o){this.maps=t||[];this.from=n||0;this.to=o==null?this.maps.length:o;this.mirror=r};Mapping.prototype.slice=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.maps.length;return new Mapping(this.maps,this.mirror,t,r)};Mapping.prototype.copy=function e(){return new Mapping(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Mapping.prototype.appendMap=function e(t,r){this.to=this.maps.push(t);if(r!=null){this.setMirror(this.maps.length-1,r)}};Mapping.prototype.appendMapping=function e(t){for(var r=0,n=this.maps.length;r<t.maps.length;r++){var o=t.getMirror(r);this.appendMap(t.maps[r],o!=null&&o<r?n+o:null)}};Mapping.prototype.getMirror=function e(t){if(this.mirror){for(var r=0;r<this.mirror.length;r++){if(this.mirror[r]==t){return this.mirror[r+(r%2?-1:1)]}}}};Mapping.prototype.setMirror=function e(t,r){if(!this.mirror){this.mirror=[]}this.mirror.push(t,r)};Mapping.prototype.appendMappingInverted=function e(t){for(var r=t.maps.length-1,n=this.maps.length+t.maps.length;r>=0;r--){var o=t.getMirror(r);this.appendMap(t.maps[r].invert(),o!=null&&o>r?n-o-1:null)}};Mapping.prototype.invert=function e(){var t=new Mapping;t.appendMappingInverted(this);return t};Mapping.prototype.map=function e(t,r){if(r===void 0)r=1;if(this.mirror){return this._map(t,r,true)}for(var n=this.from;n<this.to;n++){t=this.maps[n].map(t,r)}return t};Mapping.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};Mapping.prototype._map=function e(t,r,n){var o=false;for(var i=this.from;i<this.to;i++){var a=this.maps[i],s=a.mapResult(t,r);if(s.recover!=null){var l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l;t=this.maps[l].recover(s.recover);continue}}if(s.deleted){o=true}t=s.pos}return n?t:new MapResult(t,o)};function TransformError(e){var t=Error.call(this,e);t.__proto__=TransformError.prototype;return t}TransformError.prototype=Object.create(Error.prototype);TransformError.prototype.constructor=TransformError;TransformError.prototype.name="TransformError";var Transform=function e(t){this.doc=t;this.steps=[];this.docs=[];this.mapping=new Mapping};var prototypeAccessors$7={before:{configurable:true},docChanged:{configurable:true}};prototypeAccessors$7.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Transform.prototype.step=function e(t){var r=this.maybeStep(t);if(r.failed){throw new TransformError(r.failed)}return this};Transform.prototype.maybeStep=function e(t){var r=t.apply(this.doc);if(!r.failed){this.addStep(t,r.doc)}return r};prototypeAccessors$7.docChanged.get=function(){return this.steps.length>0};Transform.prototype.addStep=function e(t,r){this.docs.push(this.doc);this.steps.push(t);this.mapping.appendMap(t.getMap());this.doc=r};Object.defineProperties(Transform.prototype,prototypeAccessors$7);function mustOverride(){throw new Error("Override me")}var stepsByID=Object.create(null);var Step=function e(){};Step.prototype.apply=function e(t){return mustOverride()};Step.prototype.getMap=function e(){return StepMap.empty};Step.prototype.invert=function e(t){return mustOverride()};Step.prototype.map=function e(t){return mustOverride()};Step.prototype.merge=function e(t){return null};Step.prototype.toJSON=function e(){return mustOverride()};Step.fromJSON=function e(t,r){if(!r||!r.stepType){throw new RangeError("Invalid input for Step.fromJSON")}var n=stepsByID[r.stepType];if(!n){throw new RangeError("No step type "+r.stepType+" defined")}return n.fromJSON(t,r)};Step.jsonID=function e(t,r){if(t in stepsByID){throw new RangeError("Duplicate use of step JSON ID "+t)}stepsByID[t]=r;r.prototype.jsonID=t;return r};var StepResult=function e(t,r){this.doc=t;this.failed=r};StepResult.ok=function e(t){return new StepResult(t,null)};StepResult.fail=function e(t){return new StepResult(null,t)};StepResult.fromReplace=function e(t,r,n,o){try{return StepResult.ok(t.replace(r,n,o))}catch(e){if(e instanceof ReplaceError){return StepResult.fail(e.message)}throw e}};var ReplaceStep=function(e){function t(t,r,n,o){e.call(this);this.from=t;this.to=r;this.slice=n;this.structure=!!o}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&contentBetween(t,this.from,this.to)){return StepResult.fail("Structure replace would overwrite content")}return StepResult.fromReplace(t,this.from,this.to,this.slice)};t.prototype.getMap=function e(){return new StepMap([this.from,this.to-this.from,this.slice.size])};t.prototype.invert=function e(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);if(n.deleted&&o.deleted){return null}return new t(n.pos,Math.max(n.pos,o.pos),this.slice)};t.prototype.merge=function e(r){if(!(r instanceof t)||r.structure!=this.structure){return null}if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var n=this.slice.size+r.slice.size==0?Slice.empty:new Slice(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),n,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var o=this.slice.size+r.slice.size==0?Slice.empty:new Slice(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}else{return null}};t.prototype.toJSON=function e(){var t={stepType:"replace",from:this.from,to:this.to};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for ReplaceStep.fromJSON")}return new t(n.from,n.to,Slice.fromJSON(r,n.slice),!!n.structure)};return t}(Step);Step.jsonID("replace",ReplaceStep);var ReplaceAroundStep=function(e){function t(t,r,n,o,i,a,s){e.call(this);this.from=t;this.to=r;this.gapFrom=n;this.gapTo=o;this.slice=i;this.insert=a;this.structure=!!s}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&(contentBetween(t,this.from,this.gapFrom)||contentBetween(t,this.gapTo,this.to))){return StepResult.fail("Structure gap-replace would overwrite content")}var r=t.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd){return StepResult.fail("Gap is not a flat range")}var n=this.slice.insertAt(this.insert,r.content);if(!n){return StepResult.fail("Content does not fit in gap")}return StepResult.fromReplace(t,this.from,this.to,n)};t.prototype.getMap=function e(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])};t.prototype.invert=function e(r){var n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);var i=r.map(this.gapFrom,-1),a=r.map(this.gapTo,1);if(n.deleted&&o.deleted||i<n.pos||a>o.pos){return null}return new t(n.pos,o.pos,i,a,this.slice,this.insert,this.structure)};t.prototype.toJSON=function e(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number"){throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON")}return new t(n.from,n.to,n.gapFrom,n.gapTo,Slice.fromJSON(r,n.slice),n.insert,!!n.structure)};return t}(Step);Step.jsonID("replaceAround",ReplaceAroundStep);function contentBetween(e,t,r){var n=e.resolve(t),o=r-t,i=n.depth;while(o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount){i--;o--}if(o>0){var a=n.node(i).maybeChild(n.indexAfter(i));while(o>0){if(!a||a.isLeaf){return true}a=a.firstChild;o--}}return false}function canCut(e,t,r){return(t==0||e.canReplace(t,e.childCount))&&(r==e.childCount||e.canReplace(0,r))}function liftTarget(e){var t=e.parent;var r=t.content.cutByIndex(e.startIndex,e.endIndex);for(var n=e.depth;;--n){var o=e.$from.node(n);var i=e.$from.index(n),a=e.$to.indexAfter(n);if(n<e.depth&&o.canReplace(i,a,r)){return n}if(n==0||o.type.spec.isolating||!canCut(o,i,a)){break}}}Transform.prototype.lift=function(e,t){var r=e.$from;var n=e.$to;var o=e.depth;var i=r.before(o+1),a=n.after(o+1);var s=i,l=a;var c=Fragment.empty,u=0;for(var p=o,f=false;p>t;p--){if(f||r.index(p)>0){f=true;c=Fragment.from(r.node(p).copy(c));u++}else{s--}}var d=Fragment.empty,h=0;for(var m=o,v=false;m>t;m--){if(v||n.after(m+1)<n.end(m)){v=true;d=Fragment.from(n.node(m).copy(d));h++}else{l++}}return this.step(new ReplaceAroundStep(s,l,i,a,new Slice(c.append(d),u,h),c.size-u,true))};function findWrapping(e,t,r,n){if(n===void 0)n=e;var o=findWrappingOutside(e,t);var i=o&&findWrappingInside(n,t);if(!i){return null}return o.map(withAttrs).concat({type:t,attrs:r}).concat(i.map(withAttrs))}function withAttrs(e){return{type:e,attrs:null}}function findWrappingOutside(e,t){var r=e.parent;var n=e.startIndex;var o=e.endIndex;var i=r.contentMatchAt(n).findWrapping(t);if(!i){return null}var a=i.length?i[0]:t;return r.canReplaceWith(n,o,a)?i:null}function findWrappingInside(e,t){var r=e.parent;var n=e.startIndex;var o=e.endIndex;var i=r.child(n);var a=t.contentMatch.findWrapping(i.type);if(!a){return null}var s=a.length?a[a.length-1]:t;var l=s.contentMatch;for(var c=n;l&&c<o;c++){l=l.matchType(r.child(c).type)}if(!l||!l.validEnd){return null}return a}Transform.prototype.wrap=function(e,t){var r=Fragment.empty;for(var n=t.length-1;n>=0;n--){r=Fragment.from(t[n].type.create(t[n].attrs,r))}var o=e.start,i=e.end;return this.step(new ReplaceAroundStep(o,i,o,i,new Slice(r,0,0),t.length,true))};Transform.prototype.setBlockType=function(e,t,r,n){var o=this;if(t===void 0)t=e;if(!r.isTextblock){throw new RangeError("Type given to setBlockType should be a textblock")}var i=this.steps.length;this.doc.nodesBetween(e,t,(function(e,t){if(e.isTextblock&&!e.hasMarkup(r,n)&&canChangeType(o.doc,o.mapping.slice(i).map(t),r)){o.clearIncompatible(o.mapping.slice(i).map(t,1),r);var a=o.mapping.slice(i);var s=a.map(t,1),l=a.map(t+e.nodeSize,1);o.step(new ReplaceAroundStep(s,l,s+1,l-1,new Slice(Fragment.from(r.create(n,null,e.marks)),0,0),1,true));return false}}));return this};function canChangeType(e,t,r){var n=e.resolve(t),o=n.index();return n.parent.canReplaceWith(o,o+1,r)}Transform.prototype.setNodeMarkup=function(e,t,r,n){var o=this.doc.nodeAt(e);if(!o){throw new RangeError("No node at given position")}if(!t){t=o.type}var i=t.create(r,null,n||o.marks);if(o.isLeaf){return this.replaceWith(e,e+o.nodeSize,i)}if(!t.validContent(o.content)){throw new RangeError("Invalid content for node type "+t.name)}return this.step(new ReplaceAroundStep(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new Slice(Fragment.from(i),0,0),1,true))};function canSplit(e,t,r,n){if(r===void 0)r=1;var o=e.resolve(t),i=o.depth-r;var a=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!a.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount))){return false}for(var s=o.depth-1,l=r-2;s>i;s--,l--){var c=o.node(s),u=o.index(s);if(c.type.spec.isolating){return false}var p=c.content.cutByIndex(u,c.childCount);var f=n&&n[l]||c;if(f!=c){p=p.replaceChild(0,f.type.create(f.attrs))}if(!c.canReplace(u+1,c.childCount)||!f.type.validContent(p)){return false}}var d=o.indexAfter(i);var h=n&&n[0];return o.node(i).canReplaceWith(d,d,h?h.type:o.node(i+1).type)}Transform.prototype.split=function(e,t,r){if(t===void 0)t=1;var n=this.doc.resolve(e),o=Fragment.empty,i=Fragment.empty;for(var a=n.depth,s=n.depth-t,l=t-1;a>s;a--,l--){o=Fragment.from(n.node(a).copy(o));var c=r&&r[l];i=Fragment.from(c?c.type.create(c.attrs,i):n.node(a).copy(i))}return this.step(new ReplaceStep(e,e,new Slice(o.append(i),t,t),true))};function canJoin(e,t){var r=e.resolve(t),n=r.index();return joinable$1(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function joinable$1(e,t){return e&&t&&!e.isLeaf&&e.canAppend(t)}function joinPoint(e,t,r){if(r===void 0)r=-1;var n=e.resolve(t);for(var o=n.depth;;o--){var i=void 0,a=void 0,s=n.index(o);if(o==n.depth){i=n.nodeBefore;a=n.nodeAfter}else if(r>0){i=n.node(o+1);s++;a=n.node(o).maybeChild(s)}else{i=n.node(o).maybeChild(s-1);a=n.node(o+1)}if(i&&!i.isTextblock&&joinable$1(i,a)&&n.node(o).canReplace(s,s+1)){return t}if(o==0){break}t=r<0?n.before(o):n.after(o)}}Transform.prototype.join=function(e,t){if(t===void 0)t=1;var r=new ReplaceStep(e-t,e+t,Slice.empty,true);return this.step(r)};function insertPoint(e,t,r){var n=e.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),r)){return t}if(n.parentOffset==0){for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,r)){return n.before(o+1)}if(i>0){return null}}}if(n.parentOffset==n.parent.content.size){for(var a=n.depth-1;a>=0;a--){var s=n.indexAfter(a);if(n.node(a).canReplaceWith(s,s,r)){return n.after(a+1)}if(s<n.node(a).childCount){return null}}}}function dropPoint(e,t,r){var n=e.resolve(t);if(!r.content.size){return t}var o=r.content;for(var i=0;i<r.openStart;i++){o=o.firstChild.content}for(var a=1;a<=(r.openStart==0&&r.size?2:1);a++){for(var s=n.depth;s>=0;s--){var l=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1;var c=n.index(s)+(l>0?1:0);if(a==1?n.node(s).canReplace(c,c,o):n.node(s).contentMatchAt(c).findWrapping(o.firstChild.type)){return l==0?n.pos:l<0?n.before(s+1):n.after(s+1)}}}return null}function mapFragment(e,t,r){var n=[];for(var o=0;o<e.childCount;o++){var i=e.child(o);if(i.content.size){i=i.copy(mapFragment(i.content,t,i))}if(i.isInline){i=t(i,r,o)}n.push(i)}return Fragment.fromArray(n)}var AddMarkStep=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var n=t.slice(this.from,this.to),o=t.resolve(this.from);var i=o.node(o.sharedDepth(this.to));var a=new Slice(mapFragment(n.content,(function(e,t){if(!t.type.allowsMarkType(r.mark.type)){return e}return e.mark(r.mark.addToSet(e.marks))}),i),n.openStart,n.openEnd);return StepResult.fromReplace(t,this.from,this.to,a)};t.prototype.invert=function e(){return new RemoveMarkStep(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);if(n.deleted&&o.deleted||n.pos>=o.pos){return null}return new t(n.pos,o.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for AddMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(Step);Step.jsonID("addMark",AddMarkStep);var RemoveMarkStep=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var n=t.slice(this.from,this.to);var o=new Slice(mapFragment(n.content,(function(e){return e.mark(r.mark.removeFromSet(e.marks))})),n.openStart,n.openEnd);return StepResult.fromReplace(t,this.from,this.to,o)};t.prototype.invert=function e(){return new AddMarkStep(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);if(n.deleted&&o.deleted||n.pos>=o.pos){return null}return new t(n.pos,o.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for RemoveMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(Step);Step.jsonID("removeMark",RemoveMarkStep);Transform.prototype.addMark=function(e,t,r){var n=this;var o=[],i=[],a=null,s=null;this.doc.nodesBetween(e,t,(function(n,l,c){if(!n.isInline){return}var u=n.marks;if(!r.isInSet(u)&&c.type.allowsMarkType(r.type)){var p=Math.max(l,e),f=Math.min(l+n.nodeSize,t);var d=r.addToSet(u);for(var h=0;h<u.length;h++){if(!u[h].isInSet(d)){if(a&&a.to==p&&a.mark.eq(u[h])){a.to=f}else{o.push(a=new RemoveMarkStep(p,f,u[h]))}}}if(s&&s.to==p){s.to=f}else{i.push(s=new AddMarkStep(p,f,r))}}}));o.forEach((function(e){return n.step(e)}));i.forEach((function(e){return n.step(e)}));return this};Transform.prototype.removeMark=function(e,t,r){var n=this;if(r===void 0)r=null;var o=[],i=0;this.doc.nodesBetween(e,t,(function(n,a){if(!n.isInline){return}i++;var s=null;if(r instanceof MarkType){var l=r.isInSet(n.marks);if(l){s=[l]}}else if(r){if(r.isInSet(n.marks)){s=[r]}}else{s=n.marks}if(s&&s.length){var c=Math.min(a+n.nodeSize,t);for(var u=0;u<s.length;u++){var p=s[u],f=void 0;for(var d=0;d<o.length;d++){var h=o[d];if(h.step==i-1&&p.eq(o[d].style)){f=h}}if(f){f.to=c;f.step=i}else{o.push({style:p,from:Math.max(a,e),to:c,step:i})}}}}));o.forEach((function(e){return n.step(new RemoveMarkStep(e.from,e.to,e.style))}));return this};Transform.prototype.clearIncompatible=function(e,t,r){if(r===void 0)r=t.contentMatch;var n=this.doc.nodeAt(e);var o=[],i=e+1;for(var a=0;a<n.childCount;a++){var s=n.child(a),l=i+s.nodeSize;var c=r.matchType(s.type,s.attrs);if(!c){o.push(new ReplaceStep(i,l,Slice.empty))}else{r=c;for(var u=0;u<s.marks.length;u++){if(!t.allowsMarkType(s.marks[u].type)){this.step(new RemoveMarkStep(i,l,s.marks[u]))}}}i=l}if(!r.validEnd){var p=r.fillBefore(Fragment.empty,true);this.replace(i,i,new Slice(p,0,0))}for(var f=o.length-1;f>=0;f--){this.step(o[f])}return this};function replaceStep(e,t,r,n){if(r===void 0)r=t;if(n===void 0)n=Slice.empty;if(t==r&&!n.size){return null}var o=e.resolve(t),i=e.resolve(r);if(fitsTrivially(o,i,n)){return new ReplaceStep(t,r,n)}return new Fitter(o,i,n).fit()}Transform.prototype.replace=function(e,t,r){if(t===void 0)t=e;if(r===void 0)r=Slice.empty;var n=replaceStep(this.doc,e,t,r);if(n){this.step(n)}return this};Transform.prototype.replaceWith=function(e,t,r){return this.replace(e,t,new Slice(Fragment.from(r),0,0))};Transform.prototype.delete=function(e,t){return this.replace(e,t,Slice.empty)};Transform.prototype.insert=function(e,t){return this.replaceWith(e,e,t)};function fitsTrivially(e,t,r){return!r.openStart&&!r.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),r.content)}var Fitter=function e(t,r,n){this.$to=r;this.$from=t;this.unplaced=n;this.frontier=[];for(var o=0;o<=t.depth;o++){var i=t.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(t.indexAfter(o))})}this.placed=Fragment.empty;for(var a=t.depth;a>0;a--){this.placed=Fragment.from(t.node(a).copy(this.placed))}};var prototypeAccessors$1$4={depth:{configurable:true}};prototypeAccessors$1$4.depth.get=function(){return this.frontier.length-1};Fitter.prototype.fit=function e(){while(this.unplaced.size){var e=this.findFittable();if(e){this.placeNodes(e)}else{this.openMore()||this.dropNode()}}var t=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth;var n=this.$from,o=this.close(t<0?this.$to:n.doc.resolve(t));if(!o){return null}var i=this.placed,a=n.depth,s=o.depth;while(a&&s&&i.childCount==1){i=i.firstChild.content;a--;s--}var l=new Slice(i,a,s);if(t>-1){return new ReplaceAroundStep(n.pos,t,this.$to.pos,this.$to.end(),l,r)}if(l.size||n.pos!=this.$to.pos){return new ReplaceStep(n.pos,o.pos,l)}};Fitter.prototype.findFittable=function e(){for(var t=1;t<=2;t++){for(var r=this.unplaced.openStart;r>=0;r--){var n=void 0,o=void 0;if(r){o=contentAt(this.unplaced.content,r-1).firstChild;n=o.content}else{n=this.unplaced.content}var i=n.firstChild;for(var a=this.depth;a>=0;a--){var s=this.frontier[a];var l=s.type;var c=s.match;var u=void 0,p=void 0;if(t==1&&(i?c.matchType(i.type)||(p=c.fillBefore(Fragment.from(i),false)):l.compatibleContent(o.type))){return{sliceDepth:r,frontierDepth:a,parent:o,inject:p}}else if(t==2&&i&&(u=c.findWrapping(i.type))){return{sliceDepth:r,frontierDepth:a,parent:o,wrap:u}}if(o&&c.matchType(o.type)){break}}}}};Fitter.prototype.openMore=function e(){var t=this.unplaced;var r=t.content;var n=t.openStart;var o=t.openEnd;var i=contentAt(r,n);if(!i.childCount||i.firstChild.isLeaf){return false}this.unplaced=new Slice(r,n+1,Math.max(o,i.size+n>=r.size-o?n+1:0));return true};Fitter.prototype.dropNode=function e(){var t=this.unplaced;var r=t.content;var n=t.openStart;var o=t.openEnd;var i=contentAt(r,n);if(i.childCount<=1&&n>0){var a=r.size-n<=n+i.size;this.unplaced=new Slice(dropFromFragment(r,n-1,1),n-1,a?n-1:o)}else{this.unplaced=new Slice(dropFromFragment(r,n,1),n,o)}};Fitter.prototype.placeNodes=function e(t){var r=t.sliceDepth;var n=t.frontierDepth;var o=t.parent;var i=t.inject;var a=t.wrap;while(this.depth>n){this.closeFrontierNode()}if(a){for(var s=0;s<a.length;s++){this.openFrontierNode(a[s])}}var l=this.unplaced,c=o?o.content:l.content;var u=l.openStart-r;var p=0,f=[];var d=this.frontier[n];var h=d.match;var m=d.type;if(i){for(var v=0;v<i.childCount;v++){f.push(i.child(v))}h=h.matchFragment(i)}var g=c.size+r-(l.content.size-l.openEnd);while(p<c.childCount){var y=c.child(p),b=h.matchType(y.type);if(!b){break}p++;if(p>1||u==0||y.content.size){h=b;f.push(closeNodeStart(y.mark(m.allowedMarks(y.marks)),p==1?u:0,p==c.childCount?g:-1))}}var w=p==c.childCount;if(!w){g=-1}this.placed=addToFragment(this.placed,n,Fragment.from(f));this.frontier[n].match=h;if(w&&g<0&&o&&o.type==this.frontier[this.depth].type&&this.frontier.length>1){this.closeFrontierNode()}for(var S=0,C=c;S<g;S++){var R=C.lastChild;this.frontier.push({type:R.type,match:R.contentMatchAt(R.childCount)});C=R.content}this.unplaced=!w?new Slice(dropFromFragment(l.content,r,p),l.openStart,l.openEnd):r==0?Slice.empty:new Slice(dropFromFragment(l.content,r-1,1),r-1,g<0?l.openEnd:r-1)};Fitter.prototype.mustMoveInline=function e(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos){return-1}var t=this.frontier[this.depth],r;if(!t.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,t.type,t.match,false)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth){return-1}var n=this.$to;var o=n.depth;var i=this.$to.after(o);while(o>1&&i==this.$to.end(--o)){++i}return i};Fitter.prototype.findCloseLevel=function e(t){e:for(var r=Math.min(this.depth,t.depth);r>=0;r--){var n=this.frontier[r];var o=n.match;var i=n.type;var a=r<t.depth&&t.end(r+1)==t.pos+(t.depth-(r+1));var s=contentAfterFits(t,r,i,o,a);if(!s){continue}for(var l=r-1;l>=0;l--){var c=this.frontier[l];var u=c.match;var p=c.type;var f=contentAfterFits(t,l,p,u,true);if(!f||f.childCount){continue e}}return{depth:r,fit:s,move:a?t.doc.resolve(t.after(r+1)):t}}};Fitter.prototype.close=function e(t){var e=this.findCloseLevel(t);if(!e){return null}while(this.depth>e.depth){this.closeFrontierNode()}if(e.fit.childCount){this.placed=addToFragment(this.placed,e.depth,e.fit)}t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),o=n.type.contentMatch.fillBefore(n.content,true,t.index(r));this.openFrontierNode(n.type,n.attrs,o)}return t};Fitter.prototype.openFrontierNode=function e(t,r,n){var o=this.frontier[this.depth];o.match=o.match.matchType(t);this.placed=addToFragment(this.placed,this.depth,Fragment.from(t.create(r,n)));this.frontier.push({type:t,match:t.contentMatch})};Fitter.prototype.closeFrontierNode=function e(){var t=this.frontier.pop();var r=t.match.fillBefore(Fragment.empty,true);if(r.childCount){this.placed=addToFragment(this.placed,this.frontier.length,r)}};Object.defineProperties(Fitter.prototype,prototypeAccessors$1$4);function dropFromFragment(e,t,r){if(t==0){return e.cutByIndex(r)}return e.replaceChild(0,e.firstChild.copy(dropFromFragment(e.firstChild.content,t-1,r)))}function addToFragment(e,t,r){if(t==0){return e.append(r)}return e.replaceChild(e.childCount-1,e.lastChild.copy(addToFragment(e.lastChild.content,t-1,r)))}function contentAt(e,t){for(var r=0;r<t;r++){e=e.firstChild.content}return e}function closeNodeStart(e,t,r){if(t<=0){return e}var n=e.content;if(t>1){n=n.replaceChild(0,closeNodeStart(n.firstChild,t-1,n.childCount==1?r-1:0))}if(t>0){n=e.type.contentMatch.fillBefore(n).append(n);if(r<=0){n=n.append(e.type.contentMatch.matchFragment(n).fillBefore(Fragment.empty,true))}}return e.copy(n)}function contentAfterFits(e,t,r,n,o){var i=e.node(t),a=o?e.indexAfter(t):e.index(t);if(a==i.childCount&&!r.compatibleContent(i.type)){return null}var s=n.fillBefore(i.content,true,a);return s&&!invalidMarks(r,i.content,a)?s:null}function invalidMarks(e,t,r){for(var n=r;n<t.childCount;n++){if(!e.allowsMarks(t.child(n).marks)){return true}}return false}Transform.prototype.replaceRange=function(e,t,r){if(!r.size){return this.deleteRange(e,t)}var n=this.doc.resolve(e),o=this.doc.resolve(t);if(fitsTrivially(n,o,r)){return this.step(new ReplaceStep(e,t,r))}var i=coveredDepths(n,this.doc.resolve(t));if(i[i.length-1]==0){i.pop()}var a=-(n.depth+1);i.unshift(a);for(var s=n.depth,l=n.pos-1;s>0;s--,l--){var c=n.node(s).type.spec;if(c.defining||c.isolating){break}if(i.indexOf(s)>-1){a=s}else if(n.before(s)==l){i.splice(1,0,-s)}}var u=i.indexOf(a);var p=[],f=r.openStart;for(var d=r.content,h=0;;h++){var m=d.firstChild;p.push(m);if(h==r.openStart){break}d=m.content}if(f>0&&p[f-1].type.spec.defining&&n.node(u).type!=p[f-1].type){f-=1}else if(f>=2&&p[f-1].isTextblock&&p[f-2].type.spec.defining&&n.node(u).type!=p[f-2].type){f-=2}for(var v=r.openStart;v>=0;v--){var g=(v+f+1)%(r.openStart+1);var y=p[g];if(!y){continue}for(var b=0;b<i.length;b++){var w=i[(b+u)%i.length],S=true;if(w<0){S=false;w=-w}var C=n.node(w-1),R=n.index(w-1);if(C.canReplaceWith(R,R,y.type,y.marks)){return this.replace(n.before(w),S?o.after(w):t,new Slice(closeFragment(r.content,0,r.openStart,g),g,r.openEnd))}}}var M=this.steps.length;for(var x=i.length-1;x>=0;x--){this.replace(e,t,r);if(this.steps.length>M){break}var T=i[x];if(x<0){continue}e=n.before(T);t=o.after(T)}return this};function closeFragment(e,t,r,n,o){if(t<r){var i=e.firstChild;e=e.replaceChild(0,i.copy(closeFragment(i.content,t+1,r,n,i)))}if(t>n){var a=o.contentMatchAt(0);var s=a.fillBefore(e).append(e);e=s.append(a.matchFragment(s).fillBefore(Fragment.empty,true))}return e}Transform.prototype.replaceRangeWith=function(e,t,r){if(!r.isInline&&e==t&&this.doc.resolve(e).parent.content.size){var n=insertPoint(this.doc,e,r.type);if(n!=null){e=t=n}}return this.replaceRange(e,t,new Slice(Fragment.from(r),0,0))};Transform.prototype.deleteRange=function(e,t){var r=this.doc.resolve(e),n=this.doc.resolve(t);var o=coveredDepths(r,n);for(var i=0;i<o.length;i++){var a=o[i],s=i==o.length-1;if(s&&a==0||r.node(a).type.contentMatch.validEnd){return this.delete(r.start(a),n.end(a))}if(a>0&&(s||r.node(a-1).canReplace(r.index(a-1),n.indexAfter(a-1)))){return this.delete(r.before(a),n.after(a))}}for(var l=1;l<=r.depth&&l<=n.depth;l++){if(e-r.start(l)==r.depth-l&&t>r.end(l)&&n.end(l)-t!=n.depth-l){return this.delete(r.before(l),t)}}return this.delete(e,t)};function coveredDepths(e,t){var r=[],n=Math.min(e.depth,t.depth);for(var o=n;o>=0;o--){var i=e.start(o);if(i<e.pos-(e.depth-o)||t.end(o)>t.pos+(t.depth-o)||e.node(o).type.spec.isolating||t.node(o).type.spec.isolating){break}if(i==t.start(o)){r.push(o)}}return r}var classesById=Object.create(null);var Selection=function e(t,r,n){this.ranges=n||[new SelectionRange(t.min(r),t.max(r))];this.$anchor=t;this.$head=r};var prototypeAccessors$8={anchor:{configurable:true},head:{configurable:true},from:{configurable:true},to:{configurable:true},$from:{configurable:true},$to:{configurable:true},empty:{configurable:true}};prototypeAccessors$8.anchor.get=function(){return this.$anchor.pos};prototypeAccessors$8.head.get=function(){return this.$head.pos};prototypeAccessors$8.from.get=function(){return this.$from.pos};prototypeAccessors$8.to.get=function(){return this.$to.pos};prototypeAccessors$8.$from.get=function(){return this.ranges[0].$from};prototypeAccessors$8.$to.get=function(){return this.ranges[0].$to};prototypeAccessors$8.empty.get=function(){var e=this.ranges;for(var t=0;t<e.length;t++){if(e[t].$from.pos!=e[t].$to.pos){return false}}return true};Selection.prototype.content=function e(){return this.$from.node(0).slice(this.from,this.to,true)};Selection.prototype.replace=function e(t,r){if(r===void 0)r=Slice.empty;var n=r.content.lastChild,o=null;for(var i=0;i<r.openEnd;i++){o=n;n=n.lastChild}var a=t.steps.length,s=this.ranges;for(var l=0;l<s.length;l++){var c=s[l];var u=c.$from;var p=c.$to;var f=t.mapping.slice(a);t.replaceRange(f.map(u.pos),f.map(p.pos),l?Slice.empty:r);if(l==0){selectionToInsertionEnd(t,a,(n?n.isInline:o&&o.isTextblock)?-1:1)}}};Selection.prototype.replaceWith=function e(t,r){var n=t.steps.length,o=this.ranges;for(var i=0;i<o.length;i++){var a=o[i];var s=a.$from;var l=a.$to;var c=t.mapping.slice(n);var u=c.map(s.pos),p=c.map(l.pos);if(i){t.deleteRange(u,p)}else{t.replaceRangeWith(u,p,r);selectionToInsertionEnd(t,n,r.isInline?-1:1)}}};Selection.findFrom=function e(t,r,n){var o=t.parent.inlineContent?new TextSelection(t):findSelectionIn(t.node(0),t.parent,t.pos,t.index(),r,n);if(o){return o}for(var i=t.depth-1;i>=0;i--){var a=r<0?findSelectionIn(t.node(0),t.node(i),t.before(i+1),t.index(i),r,n):findSelectionIn(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,r,n);if(a){return a}}};Selection.near=function e(t,r){if(r===void 0)r=1;return this.findFrom(t,r)||this.findFrom(t,-r)||new AllSelection(t.node(0))};Selection.atStart=function e(t){return findSelectionIn(t,t,0,0,1)||new AllSelection(t)};Selection.atEnd=function e(t){return findSelectionIn(t,t,t.content.size,t.childCount,-1)||new AllSelection(t)};Selection.fromJSON=function e(t,r){if(!r||!r.type){throw new RangeError("Invalid input for Selection.fromJSON")}var n=classesById[r.type];if(!n){throw new RangeError("No selection type "+r.type+" defined")}return n.fromJSON(t,r)};Selection.jsonID=function e(t,r){if(t in classesById){throw new RangeError("Duplicate use of selection JSON ID "+t)}classesById[t]=r;r.prototype.jsonID=t;return r};Selection.prototype.getBookmark=function e(){return TextSelection.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(Selection.prototype,prototypeAccessors$8);Selection.prototype.visible=true;var SelectionRange=function e(t,r){this.$from=t;this.$to=r};var TextSelection=function(e){function t(t,r){if(r===void 0)r=t;e.call(this,t,r)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={$cursor:{configurable:true}};r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null};t.prototype.map=function r(n,o){var i=n.resolve(o.map(this.head));if(!i.parent.inlineContent){return e.near(i)}var a=n.resolve(o.map(this.anchor));return new t(a.parent.inlineContent?a:i,i)};t.prototype.replace=function t(r,n){if(n===void 0)n=Slice.empty;e.prototype.replace.call(this,r,n);if(n==Slice.empty){var o=this.$from.marksAcross(this.$to);if(o){r.ensureMarks(o)}}};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor&&r.head==this.head};t.prototype.getBookmark=function e(){return new TextBookmark(this.anchor,this.head)};t.prototype.toJSON=function e(){return{type:"text",anchor:this.anchor,head:this.head}};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"||typeof n.head!="number"){throw new RangeError("Invalid input for TextSelection.fromJSON")}return new t(r.resolve(n.anchor),r.resolve(n.head))};t.create=function e(t,r,n){if(n===void 0)n=r;var o=t.resolve(r);return new this(o,n==r?o:t.resolve(n))};t.between=function r(n,o,i){var a=n.pos-o.pos;if(!i||a){i=a>=0?1:-1}if(!o.parent.inlineContent){var s=e.findFrom(o,i,true)||e.findFrom(o,-i,true);if(s){o=s.$head}else{return e.near(o,i)}}if(!n.parent.inlineContent){if(a==0){n=o}else{n=(e.findFrom(n,-i,true)||e.findFrom(n,i,true)).$anchor;if(n.pos<o.pos!=a<0){n=o}}}return new t(n,o)};Object.defineProperties(t.prototype,r);return t}(Selection);Selection.jsonID("text",TextSelection);var TextBookmark=function e(t,r){this.anchor=t;this.head=r};TextBookmark.prototype.map=function e(t){return new TextBookmark(t.map(this.anchor),t.map(this.head))};TextBookmark.prototype.resolve=function e(t){return TextSelection.between(t.resolve(this.anchor),t.resolve(this.head))};var NodeSelection=function(e){function t(t){var r=t.nodeAfter;var n=t.node(0).resolve(t.pos+r.nodeSize);e.call(this,t,n);this.node=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function r(n,o){var i=o.mapResult(this.anchor);var a=i.deleted;var s=i.pos;var l=n.resolve(s);if(a){return e.near(l)}return new t(l)};t.prototype.content=function e(){return new Slice(Fragment.from(this.node),0,0)};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor};t.prototype.toJSON=function e(){return{type:"node",anchor:this.anchor}};t.prototype.getBookmark=function e(){return new NodeBookmark(this.anchor)};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"){throw new RangeError("Invalid input for NodeSelection.fromJSON")}return new t(r.resolve(n.anchor))};t.create=function e(t,r){return new this(t.resolve(r))};t.isSelectable=function e(t){return!t.isText&&t.type.spec.selectable!==false};return t}(Selection);NodeSelection.prototype.visible=false;Selection.jsonID("node",NodeSelection);var NodeBookmark=function e(t){this.anchor=t};NodeBookmark.prototype.map=function e(t){var r=t.mapResult(this.anchor);var n=r.deleted;var o=r.pos;return n?new TextBookmark(o,o):new NodeBookmark(o)};NodeBookmark.prototype.resolve=function e(t){var r=t.resolve(this.anchor),n=r.nodeAfter;if(n&&NodeSelection.isSelectable(n)){return new NodeSelection(r)}return Selection.near(r)};var AllSelection=function(e){function t(t){e.call(this,t.resolve(0),t.resolve(t.content.size))}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.replace=function t(r,n){if(n===void 0)n=Slice.empty;if(n==Slice.empty){r.delete(0,r.doc.content.size);var o=e.atStart(r.doc);if(!o.eq(r.selection)){r.setSelection(o)}}else{e.prototype.replace.call(this,r,n)}};t.prototype.toJSON=function e(){return{type:"all"}};t.fromJSON=function e(r){return new t(r)};t.prototype.map=function e(r){return new t(r)};t.prototype.eq=function e(r){return r instanceof t};t.prototype.getBookmark=function e(){return AllBookmark};return t}(Selection);Selection.jsonID("all",AllSelection);var AllBookmark={map:function e(){return this},resolve:function e(t){return new AllSelection(t)}};function findSelectionIn(e,t,r,n,o,i){if(t.inlineContent){return TextSelection.create(e,r)}for(var a=n-(o>0?0:1);o>0?a<t.childCount:a>=0;a+=o){var s=t.child(a);if(!s.isAtom){var l=findSelectionIn(e,s,r+o,o<0?s.childCount:0,o,i);if(l){return l}}else if(!i&&NodeSelection.isSelectable(s)){return NodeSelection.create(e,r-(o<0?s.nodeSize:0))}r+=s.nodeSize*o}}function selectionToInsertionEnd(e,t,r){var n=e.steps.length-1;if(n<t){return}var o=e.steps[n];if(!(o instanceof ReplaceStep||o instanceof ReplaceAroundStep)){return}var i=e.mapping.maps[n],a;i.forEach((function(e,t,r,n){if(a==null){a=n}}));e.setSelection(Selection.near(e.doc.resolve(a),r))}var UPDATED_SEL=1,UPDATED_MARKS=2,UPDATED_SCROLL=4;var Transaction=function(e){function t(t){e.call(this,t.doc);this.time=Date.now();this.curSelection=t.selection;this.curSelectionFor=0;this.storedMarks=t.storedMarks;this.updated=0;this.meta=Object.create(null)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={selection:{configurable:true},selectionSet:{configurable:true},storedMarksSet:{configurable:true},isGeneric:{configurable:true},scrolledIntoView:{configurable:true}};r.selection.get=function(){if(this.curSelectionFor<this.steps.length){this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor));this.curSelectionFor=this.steps.length}return this.curSelection};t.prototype.setSelection=function e(t){if(t.$from.doc!=this.doc){throw new RangeError("Selection passed to setSelection must point at the current document")}this.curSelection=t;this.curSelectionFor=this.steps.length;this.updated=(this.updated|UPDATED_SEL)&~UPDATED_MARKS;this.storedMarks=null;return this};r.selectionSet.get=function(){return(this.updated&UPDATED_SEL)>0};t.prototype.setStoredMarks=function e(t){this.storedMarks=t;this.updated|=UPDATED_MARKS;return this};t.prototype.ensureMarks=function e(t){if(!Mark.sameSet(this.storedMarks||this.selection.$from.marks(),t)){this.setStoredMarks(t)}return this};t.prototype.addStoredMark=function e(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))};t.prototype.removeStoredMark=function e(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))};r.storedMarksSet.get=function(){return(this.updated&UPDATED_MARKS)>0};t.prototype.addStep=function t(r,n){e.prototype.addStep.call(this,r,n);this.updated=this.updated&~UPDATED_MARKS;this.storedMarks=null};t.prototype.setTime=function e(t){this.time=t;return this};t.prototype.replaceSelection=function e(t){this.selection.replace(this,t);return this};t.prototype.replaceSelectionWith=function e(t,r){var n=this.selection;if(r!==false){t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Mark.none))}n.replaceWith(this,t);return this};t.prototype.deleteSelection=function e(){this.selection.replace(this);return this};t.prototype.insertText=function e(t,r,n){if(n===void 0)n=r;var o=this.doc.type.schema;if(r==null){if(!t){return this.deleteSelection()}return this.replaceSelectionWith(o.text(t),true)}else{if(!t){return this.deleteRange(r,n)}var i=this.storedMarks;if(!i){var a=this.doc.resolve(r);i=n==r?a.marks():a.marksAcross(this.doc.resolve(n))}this.replaceRangeWith(r,n,o.text(t,i));if(!this.selection.empty){this.setSelection(Selection.near(this.selection.$to))}return this}};t.prototype.setMeta=function e(t,r){this.meta[typeof t=="string"?t:t.key]=r;return this};t.prototype.getMeta=function e(t){return this.meta[typeof t=="string"?t:t.key]};r.isGeneric.get=function(){for(var e in this.meta){return false}return true};t.prototype.scrollIntoView=function e(){this.updated|=UPDATED_SCROLL;return this};r.scrolledIntoView.get=function(){return(this.updated&UPDATED_SCROLL)>0};Object.defineProperties(t.prototype,r);return t}(Transform);function bind(e,t){return!t||!e?e:e.bind(t)}var FieldDesc=function e(t,r,n){this.name=t;this.init=bind(r.init,n);this.apply=bind(r.apply,n)};var baseFields=[new FieldDesc("doc",{init:function e(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function e(t){return t.doc}}),new FieldDesc("selection",{init:function e(t,r){return t.selection||Selection.atStart(r.doc)},apply:function e(t){return t.selection}}),new FieldDesc("storedMarks",{init:function e(t){return t.storedMarks||null},apply:function e(t,r,n,o){return o.selection.$cursor?t.storedMarks:null}}),new FieldDesc("scrollToSelection",{init:function e(){return 0},apply:function e(t,r){return t.scrolledIntoView?r+1:r}})];var Configuration=function e(t,r){var n=this;this.schema=t;this.fields=baseFields.concat();this.plugins=[];this.pluginsByKey=Object.create(null);if(r){r.forEach((function(e){if(n.pluginsByKey[e.key]){throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")")}n.plugins.push(e);n.pluginsByKey[e.key]=e;if(e.spec.state){n.fields.push(new FieldDesc(e.key,e.spec.state,e))}}))}};var EditorState=function e(t){this.config=t};var prototypeAccessors$1$5={schema:{configurable:true},plugins:{configurable:true},tr:{configurable:true}};prototypeAccessors$1$5.schema.get=function(){return this.config.schema};prototypeAccessors$1$5.plugins.get=function(){return this.config.plugins};EditorState.prototype.apply=function e(t){return this.applyTransaction(t).state};EditorState.prototype.filterTransaction=function e(t,r){if(r===void 0)r=-1;for(var n=0;n<this.config.plugins.length;n++){if(n!=r){var o=this.config.plugins[n];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,t,this)){return false}}}return true};EditorState.prototype.applyTransaction=function e(t){if(!this.filterTransaction(t)){return{state:this,transactions:[]}}var r=[t],n=this.applyInner(t),o=null;for(;;){var i=false;for(var a=0;a<this.config.plugins.length;a++){var s=this.config.plugins[a];if(s.spec.appendTransaction){var l=o?o[a].n:0,c=o?o[a].state:this;var u=l<r.length&&s.spec.appendTransaction.call(s,l?r.slice(l):r,c,n);if(u&&n.filterTransaction(u,a)){u.setMeta("appendedTransaction",t);if(!o){o=[];for(var p=0;p<this.config.plugins.length;p++){o.push(p<a?{state:n,n:r.length}:{state:this,n:0})}}r.push(u);n=n.applyInner(u);i=true}if(o){o[a]={state:n,n:r.length}}}}if(!i){return{state:n,transactions:r}}}};EditorState.prototype.applyInner=function e(t){if(!t.before.eq(this.doc)){throw new RangeError("Applying a mismatched transaction")}var r=new EditorState(this.config),n=this.config.fields;for(var o=0;o<n.length;o++){var i=n[o];r[i.name]=i.apply(t,this[i.name],this,r)}for(var a=0;a<applyListeners.length;a++){applyListeners[a](this,t,r)}return r};prototypeAccessors$1$5.tr.get=function(){return new Transaction(this)};EditorState.create=function e(t){var r=new Configuration(t.schema||t.doc.type.schema,t.plugins);var n=new EditorState(r);for(var o=0;o<r.fields.length;o++){n[r.fields[o].name]=r.fields[o].init(t,n)}return n};EditorState.prototype.reconfigure=function e(t){var r=new Configuration(t.schema||this.schema,t.plugins);var n=r.fields,o=new EditorState(r);for(var i=0;i<n.length;i++){var a=n[i].name;o[a]=this.hasOwnProperty(a)?this[a]:n[i].init(t,o)}return o};EditorState.prototype.toJSON=function e(t){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks){r.storedMarks=this.storedMarks.map((function(e){return e.toJSON()}))}if(t&&typeof t=="object"){for(var n in t){if(n=="doc"||n=="selection"){throw new RangeError("The JSON fields `doc` and `selection` are reserved")}var o=t[n],i=o.spec.state;if(i&&i.toJSON){r[n]=i.toJSON.call(o,this[o.key])}}}return r};EditorState.fromJSON=function e(t,r,n){if(!r){throw new RangeError("Invalid input for EditorState.fromJSON")}if(!t.schema){throw new RangeError("Required config field 'schema' missing")}var o=new Configuration(t.schema,t.plugins);var i=new EditorState(o);o.fields.forEach((function(e){if(e.name=="doc"){i.doc=Node$1.fromJSON(t.schema,r.doc)}else if(e.name=="selection"){i.selection=Selection.fromJSON(i.doc,r.selection)}else if(e.name=="storedMarks"){if(r.storedMarks){i.storedMarks=r.storedMarks.map(t.schema.markFromJSON)}}else{if(n){for(var o in n){var a=n[o],s=a.spec.state;if(a.key==e.name&&s&&s.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){i[e.name]=s.fromJSON.call(a,t,r[o],i);return}}}i[e.name]=e.init(t,i)}}));return i};EditorState.addApplyListener=function e(t){applyListeners.push(t)};EditorState.removeApplyListener=function e(t){var r=applyListeners.indexOf(t);if(r>-1){applyListeners.splice(r,1)}};Object.defineProperties(EditorState.prototype,prototypeAccessors$1$5);var applyListeners=[];function bindProps(e,t,r){for(var n in e){var o=e[n];if(o instanceof Function){o=o.bind(t)}else if(n=="handleDOMEvents"){o=bindProps(o,t,{})}r[n]=o}return r}var Plugin=function e(t){this.props={};if(t.props){bindProps(t.props,this,this.props)}this.spec=t;this.key=t.key?t.key.key:createKey("plugin")};Plugin.prototype.getState=function e(t){return t[this.key]};var keys=Object.create(null);function createKey(e){if(e in keys){return e+"$"+ ++keys[e]}keys[e]=0;return e+"$"}var PluginKey=function e(t){if(t===void 0)t="key";this.key=createKey(t)};PluginKey.prototype.get=function e(t){return t.config.pluginsByKey[this.key]};PluginKey.prototype.getState=function e(t){return t[this.key]};var result$1={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var ie_edge=/Edge\/(\d+)/.exec(navigator.userAgent);var ie_upto10=/MSIE \d/.test(navigator.userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);result$1.mac=/Mac/.test(navigator.platform);var ie=result$1.ie=!!(ie_upto10||ie_11up||ie_edge);result$1.ie_version=ie_upto10?document.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:null;result$1.gecko=!ie&&/gecko\/(\d+)/i.test(navigator.userAgent);result$1.gecko_version=result$1.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var chrome=!ie&&/Chrome\/(\d+)/.exec(navigator.userAgent);result$1.chrome=!!chrome;result$1.chrome_version=chrome&&+chrome[1];result$1.safari=!ie&&/Apple Computer/.test(navigator.vendor);result$1.ios=result$1.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);result$1.android=/Android \d/.test(navigator.userAgent);result$1.webkit="webkitFontSmoothing"in document.documentElement.style;result$1.webkit_version=result$1.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var domIndex=function(e){for(var t=0;;t++){e=e.previousSibling;if(!e){return t}}};var parentNode=function(e){var t=e.parentNode;return t&&t.nodeType==11?t.host:t};var reusedRange=null;var textRange=function(e,t,r){var n=reusedRange||(reusedRange=document.createRange());n.setEnd(e,r==null?e.nodeValue.length:r);n.setStart(e,t||0);return n};var isEquivalentPosition=function(e,t,r,n){return r&&(scanFor(e,t,r,n,-1)||scanFor(e,t,r,n,1))};var atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(e,t,r,n,o){for(;;){if(e==r&&t==n){return true}if(t==(o<0?0:nodeSize(e))){var i=e.parentNode;if(i.nodeType!=1||hasBlockDesc(e)||atomElements.test(e.nodeName)||e.contentEditable=="false"){return false}t=domIndex(e)+(o<0?0:1);e=i}else if(e.nodeType==1){e=e.childNodes[t+(o<0?-1:0)];if(e.contentEditable=="false"){return false}t=o<0?nodeSize(e):0}else{return false}}}function nodeSize(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function isOnEdge(e,t,r){for(var n=t==0,o=t==nodeSize(e);n||o;){if(e==r){return true}var i=domIndex(e);e=e.parentNode;if(!e){return false}n=n&&i==0;o=o&&i==nodeSize(e)}}function hasBlockDesc(e){var t;for(var r=e;r;r=r.parentNode){if(t=r.pmViewDesc){break}}return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}var selectionCollapsed=function(e){var t=e.isCollapsed;if(t&&result$1.chrome&&e.rangeCount&&!e.getRangeAt(0).collapsed){t=false}return t};function keyEvent(e,t){var r=document.createEvent("Event");r.initEvent("keydown",true,true);r.keyCode=e;r.key=r.code=t;return r}function windowRect(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function getSide(e,t){return typeof e=="number"?e:e[t]}function clientRect(e){var t=e.getBoundingClientRect();return{left:t.left,right:t.left+e.clientWidth,top:t.top,bottom:t.top+e.clientHeight}}function scrollRectIntoView(e,t,r){var n=e.someProp("scrollThreshold")||0,o=e.someProp("scrollMargin")||5;var i=e.dom.ownerDocument;for(var a=r||e.dom;;a=parentNode(a)){if(!a){break}if(a.nodeType!=1){continue}var s=a==i.body||a.nodeType!=1;var l=s?windowRect(i):clientRect(a);var c=0,u=0;if(t.top<l.top+getSide(n,"top")){u=-(l.top-t.top+getSide(o,"top"))}else if(t.bottom>l.bottom-getSide(n,"bottom")){u=t.bottom-l.bottom+getSide(o,"bottom")}if(t.left<l.left+getSide(n,"left")){c=-(l.left-t.left+getSide(o,"left"))}else if(t.right>l.right-getSide(n,"right")){c=t.right-l.right+getSide(o,"right")}if(c||u){if(s){i.defaultView.scrollBy(c,u)}else{var p=a.scrollLeft,f=a.scrollTop;if(u){a.scrollTop+=u}if(c){a.scrollLeft+=c}var d=a.scrollLeft-p,h=a.scrollTop-f;t={left:t.left-d,top:t.top-h,right:t.right-d,bottom:t.bottom-h}}}if(s){break}}}function storeScrollPos(e){var t=e.dom.getBoundingClientRect(),r=Math.max(0,t.top);var n,o;for(var i=(t.left+t.right)/2,a=r+1;a<Math.min(innerHeight,t.bottom);a+=5){var s=e.root.elementFromPoint(i,a);if(s==e.dom||!e.dom.contains(s)){continue}var l=s.getBoundingClientRect();if(l.top>=r-20){n=s;o=l.top;break}}return{refDOM:n,refTop:o,stack:scrollStack(e.dom)}}function scrollStack(e){var t=[],r=e.ownerDocument;for(;e;e=parentNode(e)){t.push({dom:e,top:e.scrollTop,left:e.scrollLeft});if(e==r){break}}return t}function resetScrollPos(e){var t=e.refDOM;var r=e.refTop;var n=e.stack;var o=t?t.getBoundingClientRect().top:0;restoreScrollStack(n,o==0?0:o-r)}function restoreScrollStack(e,t){for(var r=0;r<e.length;r++){var n=e[r];var o=n.dom;var i=n.top;var a=n.left;if(o.scrollTop!=i+t){o.scrollTop=i+t}if(o.scrollLeft!=a){o.scrollLeft=a}}}var preventScrollSupported=null;function focusPreventScroll(e){if(e.setActive){return e.setActive()}if(preventScrollSupported){return e.focus(preventScrollSupported)}var t=scrollStack(e);e.focus(preventScrollSupported==null?{get preventScroll(){preventScrollSupported={preventScroll:true};return true}}:undefined);if(!preventScrollSupported){preventScrollSupported=false;restoreScrollStack(t,0)}}function findOffsetInNode(e,t){var r,n=2e8,o,i=0;var a=t.top,s=t.top;for(var l=e.firstChild,c=0;l;l=l.nextSibling,c++){var u=void 0;if(l.nodeType==1){u=l.getClientRects()}else if(l.nodeType==3){u=textRange(l).getClientRects()}else{continue}for(var p=0;p<u.length;p++){var f=u[p];if(f.top<=a&&f.bottom>=s){a=Math.max(f.bottom,a);s=Math.min(f.top,s);var d=f.left>t.left?f.left-t.left:f.right<t.left?t.left-f.right:0;if(d<n){r=l;n=d;o=d&&r.nodeType==3?{left:f.right<t.left?f.right:f.left,top:t.top}:t;if(l.nodeType==1&&d){i=c+(t.left>=(f.left+f.right)/2?1:0)}continue}}if(!r&&(t.left>=f.right&&t.top>=f.top||t.left>=f.left&&t.top>=f.bottom)){i=c+1}}}if(r&&r.nodeType==3){return findOffsetInText(r,o)}if(!r||n&&r.nodeType==1){return{node:e,offset:i}}return findOffsetInNode(r,o)}function findOffsetInText(e,t){var r=e.nodeValue.length;var n=document.createRange();for(var o=0;o<r;o++){n.setEnd(e,o+1);n.setStart(e,o);var i=singleRect(n,1);if(i.top==i.bottom){continue}if(inRect(t,i)){return{node:e,offset:o+(t.left>=(i.left+i.right)/2?1:0)}}}return{node:e,offset:0}}function inRect(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function targetKludge(e,t){var r=e.parentNode;if(r&&/^li$/i.test(r.nodeName)&&t.left<e.getBoundingClientRect().left){return r}return e}function posFromElement(e,t,r){var n=findOffsetInNode(t,r);var o=n.node;var i=n.offset;var a=-1;if(o.nodeType==1&&!o.firstChild){var s=o.getBoundingClientRect();a=s.left!=s.right&&r.left>(s.left+s.right)/2?1:-1}return e.docView.posFromDOM(o,i,a)}function posFromCaret(e,t,r,n){var o=-1;for(var i=t;;){if(i==e.dom){break}var a=e.docView.nearestDesc(i,true);if(!a){return null}if(a.node.isBlock&&a.parent){var s=a.dom.getBoundingClientRect();if(s.left>n.left||s.top>n.top){o=a.posBefore}else if(s.right<n.left||s.bottom<n.top){o=a.posAfter}else{break}}i=a.dom.parentNode}return o>-1?o:e.docView.posFromDOM(t,r)}function elementFromPoint(e,t,r){var n=e.childNodes.length;if(n&&r.top<r.bottom){for(var o=Math.max(0,Math.min(n-1,Math.floor(n*(t.top-r.top)/(r.bottom-r.top))-2)),i=o;;){var a=e.childNodes[i];if(a.nodeType==1){var s=a.getClientRects();for(var l=0;l<s.length;l++){var c=s[l];if(inRect(t,c)){return elementFromPoint(a,t,c)}}}if((i=(i+1)%n)==o){break}}}return e}function posAtCoords(e,t){var r,n;var o=e.root,i,a;if(o.caretPositionFromPoint){try{var s=o.caretPositionFromPoint(t.left,t.top);if(s){r=s,i=r.offsetNode,a=r.offset}}catch(e){}}if(!i&&o.caretRangeFromPoint){var l=o.caretRangeFromPoint(t.left,t.top);if(l){n=l,i=n.startContainer,a=n.startOffset}}var c=o.elementFromPoint(t.left,t.top+1),u;if(!c||!e.dom.contains(c.nodeType!=1?c.parentNode:c)){var p=e.dom.getBoundingClientRect();if(!inRect(t,p)){return null}c=elementFromPoint(e.dom,t,p);if(!c){return null}}if(result$1.safari&&c.draggable){i=a=null}c=targetKludge(c,t);if(i){if(result$1.gecko&&i.nodeType==1){a=Math.min(a,i.childNodes.length);if(a<i.childNodes.length){var f=i.childNodes[a],d;if(f.nodeName=="IMG"&&(d=f.getBoundingClientRect()).right<=t.left&&d.bottom>t.top){a++}}}if(i==e.dom&&a==i.childNodes.length-1&&i.lastChild.nodeType==1&&t.top>i.lastChild.getBoundingClientRect().bottom){u=e.state.doc.content.size}else if(a==0||i.nodeType!=1||i.childNodes[a-1].nodeName!="BR"){u=posFromCaret(e,i,a,t)}}if(u==null){u=posFromElement(e,c,t)}var h=e.docView.nearestDesc(c,true);return{pos:u,inside:h?h.posAtStart-h.border:-1}}function singleRect(e,t){var r=e.getClientRects();return!r.length?e.getBoundingClientRect():r[t<0?0:r.length-1]}var BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(e,t,r){var n=e.docView.domFromPos(t,r<0?-1:1);var o=n.node;var i=n.offset;var a=result$1.webkit||result$1.gecko;if(o.nodeType==3){if(a&&(BIDI.test(o.nodeValue)||(r<0?!i:i==o.nodeValue.length))){var s=singleRect(textRange(o,i,i),r);if(result$1.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=singleRect(textRange(o,i-1,i-1),-1);if(l.top==s.top){var c=singleRect(textRange(o,i,i+1),-1);if(c.top!=s.top){return flattenV(c,c.left<l.left)}}}return s}else{var u=i,p=i,f=r<0?1:-1;if(r<0&&!i){p++;f=-1}else if(r>=0&&i==o.nodeValue.length){u--;f=1}else if(r<0){u--}else{p++}return flattenV(singleRect(textRange(o,u,p),f),f<0)}}if(!e.state.doc.resolve(t).parent.inlineContent){if(i&&(r<0||i==nodeSize(o))){var d=o.childNodes[i-1];if(d.nodeType==1){return flattenH(d.getBoundingClientRect(),false)}}if(i<nodeSize(o)){var h=o.childNodes[i];if(h.nodeType==1){return flattenH(h.getBoundingClientRect(),true)}}return flattenH(o.getBoundingClientRect(),r>=0)}if(i&&(r<0||i==nodeSize(o))){var m=o.childNodes[i-1];var v=m.nodeType==3?textRange(m,nodeSize(m)-(a?0:1)):m.nodeType==1&&(m.nodeName!="BR"||!m.nextSibling)?m:null;if(v){return flattenV(singleRect(v,1),false)}}if(i<nodeSize(o)){var g=o.childNodes[i];var y=g.nodeType==3?textRange(g,0,a?0:1):g.nodeType==1?g:null;if(y){return flattenV(singleRect(y,-1),true)}}return flattenV(singleRect(o.nodeType==3?textRange(o):o,-r),r>=0)}function flattenV(e,t){if(e.width==0){return e}var r=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:r,right:r}}function flattenH(e,t){if(e.height==0){return e}var r=t?e.top:e.bottom;return{top:r,bottom:r,left:e.left,right:e.right}}function withFlushedState(e,t,r){var n=e.state,o=e.root.activeElement;if(n!=t){e.updateState(t)}if(o!=e.dom){e.focus()}try{return r()}finally{if(n!=t){e.updateState(n)}if(o!=e.dom&&o){o.focus()}}}function endOfTextblockVertical(e,t,r){var n=t.selection;var o=r=="up"?n.$from:n.$to;return withFlushedState(e,t,(function(){var t=e.docView.domFromPos(o.pos,r=="up"?-1:1);var n=t.node;for(;;){var i=e.docView.nearestDesc(n,true);if(!i){break}if(i.node.isBlock){n=i.dom;break}n=i.dom.parentNode}var a=coordsAtPos(e,o.pos,1);for(var s=n.firstChild;s;s=s.nextSibling){var l=void 0;if(s.nodeType==1){l=s.getClientRects()}else if(s.nodeType==3){l=textRange(s,0,s.nodeValue.length).getClientRects()}else{continue}for(var c=0;c<l.length;c++){var u=l[c];if(u.bottom>u.top&&(r=="up"?u.bottom<a.top+1:u.top>a.bottom-1)){return false}}}return true}))}var maybeRTL=/[\u0590-\u08ac]/;function endOfTextblockHorizontal(e,t,r){var n=t.selection;var o=n.$head;if(!o.parent.isTextblock){return false}var i=o.parentOffset,a=!i,s=i==o.parent.content.size;var l=getSelection();if(!maybeRTL.test(o.parent.textContent)||!l.modify){return r=="left"||r=="backward"?a:s}return withFlushedState(e,t,(function(){var t=l.getRangeAt(0),n=l.focusNode,i=l.focusOffset;var a=l.caretBidiLevel;l.modify("move",r,"character");var s=o.depth?e.docView.domAfterPos(o.before()):e.dom;var c=!s.contains(l.focusNode.nodeType==1?l.focusNode:l.focusNode.parentNode)||n==l.focusNode&&i==l.focusOffset;l.removeAllRanges();l.addRange(t);if(a!=null){l.caretBidiLevel=a}return c}))}var cachedState=null,cachedDir=null,cachedResult=false;function endOfTextblock(e,t,r){if(cachedState==t&&cachedDir==r){return cachedResult}cachedState=t;cachedDir=r;return cachedResult=r=="up"||r=="down"?endOfTextblockVertical(e,t,r):endOfTextblockHorizontal(e,t,r)}var NOT_DIRTY=0,CHILD_DIRTY=1,CONTENT_DIRTY=2,NODE_DIRTY=3;var ViewDesc=function e(t,r,n,o){this.parent=t;this.children=r;this.dom=n;n.pmViewDesc=this;this.contentDOM=o;this.dirty=NOT_DIRTY};var prototypeAccessors$9={beforePosition:{configurable:true},size:{configurable:true},border:{configurable:true},posBefore:{configurable:true},posAtStart:{configurable:true},posAfter:{configurable:true},posAtEnd:{configurable:true},contentLost:{configurable:true},domAtom:{configurable:true}};ViewDesc.prototype.matchesWidget=function e(){return false};ViewDesc.prototype.matchesMark=function e(){return false};ViewDesc.prototype.matchesNode=function e(){return false};ViewDesc.prototype.matchesHack=function e(){return false};prototypeAccessors$9.beforePosition.get=function(){return false};ViewDesc.prototype.parseRule=function e(){return null};ViewDesc.prototype.stopEvent=function e(){return false};prototypeAccessors$9.size.get=function(){var e=0;for(var t=0;t<this.children.length;t++){e+=this.children[t].size}return e};prototypeAccessors$9.border.get=function(){return 0};ViewDesc.prototype.destroy=function e(){this.parent=null;if(this.dom.pmViewDesc==this){this.dom.pmViewDesc=null}for(var t=0;t<this.children.length;t++){this.children[t].destroy()}};ViewDesc.prototype.posBeforeChild=function e(t){for(var r=0,n=this.posAtStart;r<this.children.length;r++){var o=this.children[r];if(o==t){return n}n+=o.size}};prototypeAccessors$9.posBefore.get=function(){return this.parent.posBeforeChild(this)};prototypeAccessors$9.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};prototypeAccessors$9.posAfter.get=function(){return this.posBefore+this.size};prototypeAccessors$9.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};ViewDesc.prototype.localPosFromDOM=function e(t,r,n){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode)){if(n<0){var o,i;if(t==this.contentDOM){o=t.childNodes[r-1]}else{while(t.parentNode!=this.contentDOM){t=t.parentNode}o=t.previousSibling}while(o&&!((i=o.pmViewDesc)&&i.parent==this)){o=o.previousSibling}return o?this.posBeforeChild(i)+i.size:this.posAtStart}else{var a,s;if(t==this.contentDOM){a=t.childNodes[r]}else{while(t.parentNode!=this.contentDOM){t=t.parentNode}a=t.nextSibling}while(a&&!((s=a.pmViewDesc)&&s.parent==this)){a=a.nextSibling}return a?this.posBeforeChild(s):this.posAtEnd}}var l;if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM)){l=t.compareDocumentPosition(this.contentDOM)&2}else if(this.dom.firstChild){if(r==0){for(var c=t;;c=c.parentNode){if(c==this.dom){l=false;break}if(c.parentNode.firstChild!=c){break}}}if(l==null&&r==t.childNodes.length){for(var u=t;;u=u.parentNode){if(u==this.dom){l=true;break}if(u.parentNode.lastChild!=u){break}}}}return(l==null?n>0:l)?this.posAtEnd:this.posAtStart};ViewDesc.prototype.nearestDesc=function e(t,r){for(var n=true,o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i&&(!r||i.node)){if(n&&i.nodeDOM&&!(i.nodeDOM.nodeType==1?i.nodeDOM.contains(t.nodeType==1?t:t.parentNode):i.nodeDOM==t)){n=false}else{return i}}}};ViewDesc.prototype.getDesc=function e(t){var r=t.pmViewDesc;for(var n=r;n;n=n.parent){if(n==this){return r}}};ViewDesc.prototype.posFromDOM=function e(t,r,n){for(var o=t;o;o=o.parentNode){var i=this.getDesc(o);if(i){return i.localPosFromDOM(t,r,n)}}return-1};ViewDesc.prototype.descAt=function e(t){for(var r=0,n=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==t&&i!=n){while(!o.border&&o.children.length){o=o.children[0]}return o}if(t<i){return o.descAt(t-n-o.border)}n=i}};ViewDesc.prototype.domFromPos=function e(t,r){if(!this.contentDOM){return{node:this.dom,offset:0}}for(var n=0,o=0,i=true;;o++,i=false){while(o<this.children.length&&(this.children[o].beforePosition||this.children[o].dom.parentNode!=this.contentDOM)){n+=this.children[o++].size}var a=o==this.children.length?null:this.children[o];if(n==t&&(r==0||!a||a.border||r<0&&i)||a&&a.domAtom&&t<n+a.size){return{node:this.contentDOM,offset:a?domIndex(a.dom):this.contentDOM.childNodes.length}}if(!a){throw new Error("Invalid position "+t)}var s=n+a.size;if(!a.domAtom&&(r<0&&!a.border?s>=t:s>t)){return a.domFromPos(t-n-a.border,r)}n=s}};ViewDesc.prototype.parseRange=function e(t,r,n){if(n===void 0)n=0;if(this.children.length==0){return{node:this.contentDOM,from:t,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length}}var o=-1,i=-1;for(var a=n,s=0;;s++){var l=this.children[s],c=a+l.size;if(o==-1&&t<=c){var u=a+l.border;if(t>=u&&r<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM)){return l.parseRange(t,r,u)}t=a;for(var p=s;p>0;p--){var f=this.children[p-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){o=domIndex(f.dom)+1;break}t-=f.size}if(o==-1){o=0}}if(o>-1&&(c>r||s==this.children.length-1)){r=c;for(var d=s+1;d<this.children.length;d++){var h=this.children[d];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=domIndex(h.dom);break}r+=h.size}if(i==-1){i=this.contentDOM.childNodes.length}break}a=c}return{node:this.contentDOM,from:t,to:r,fromOffset:o,toOffset:i}};ViewDesc.prototype.emptyChildAt=function e(t){if(this.border||!this.contentDOM||!this.children.length){return false}var r=this.children[t<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(t)};ViewDesc.prototype.domAfterPos=function e(t){var r=this.domFromPos(t,0);var n=r.node;var o=r.offset;if(n.nodeType!=1||o==n.childNodes.length){throw new RangeError("No node after pos "+t)}return n.childNodes[o]};ViewDesc.prototype.setSelection=function e(t,r,n,o){var i=Math.min(t,r),a=Math.max(t,r);for(var s=0,l=0;s<this.children.length;s++){var c=this.children[s],u=l+c.size;if(i>l&&a<u){return c.setSelection(t-l-c.border,r-l-c.border,n,o)}l=u}var p=this.domFromPos(t,t?-1:1);var f=r==t?p:this.domFromPos(r,r?-1:1);var d=n.getSelection();var h=false;if((result$1.gecko||result$1.safari)&&t==r){if(p.node.nodeType==3){h=p.offset&&p.node.nodeValue[p.offset-1]=="\n"}else{var m=p.node.childNodes[p.offset-1];h=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(!(o||h&&result$1.safari)&&isEquivalentPosition(p.node,p.offset,d.anchorNode,d.anchorOffset)&&isEquivalentPosition(f.node,f.offset,d.focusNode,d.focusOffset)){return}var v=false;if((d.extend||t==r)&&!h){d.collapse(p.node,p.offset);try{if(t!=r){d.extend(f.node,f.offset)}v=true}catch(e){if(!(e instanceof DOMException)){throw e}}}if(!v){if(t>r){var g=p;p=f;f=g}var y=document.createRange();y.setEnd(f.node,f.offset);y.setStart(p.node,p.offset);d.removeAllRanges();d.addRange(y)}};ViewDesc.prototype.ignoreMutation=function e(t){return!this.contentDOM&&t.type!="selection"};prototypeAccessors$9.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};ViewDesc.prototype.markDirty=function e(t,r){for(var n=0,o=0;o<this.children.length;o++){var i=this.children[o],a=n+i.size;if(n==a?t<=a&&r>=n:t<a&&r>n){var s=n+i.border,l=a-i.border;if(t>=s&&r<=l){this.dirty=t==n||r==a?CONTENT_DIRTY:CHILD_DIRTY;if(t==s&&r==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)){i.dirty=NODE_DIRTY}else{i.markDirty(t-s,r-s)}return}else{i.dirty=NODE_DIRTY}}n=a}this.dirty=CONTENT_DIRTY};ViewDesc.prototype.markParentsDirty=function e(){var t=1;for(var r=this.parent;r;r=r.parent,t++){var n=t==1?CONTENT_DIRTY:CHILD_DIRTY;if(r.dirty<n){r.dirty=n}}};prototypeAccessors$9.domAtom.get=function(){return false};Object.defineProperties(ViewDesc.prototype,prototypeAccessors$9);var nothing=[];var WidgetViewDesc=function(e){function t(t,r,n,o){var i,a=r.type.toDOM;if(typeof a=="function"){a=a(n,(function(){if(!i){return o}if(i.parent){return i.parent.posBeforeChild(i)}}))}if(!r.type.spec.raw){if(a.nodeType!=1){var s=document.createElement("span");s.appendChild(a);a=s}a.contentEditable=false;a.classList.add("ProseMirror-widget")}e.call(this,t,nothing,a,null);this.widget=r;i=this}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={beforePosition:{configurable:true},domAtom:{configurable:true}};r.beforePosition.get=function(){return this.widget.type.side<0};t.prototype.matchesWidget=function e(t){return this.dirty==NOT_DIRTY&&t.type.eq(this.widget.type)};t.prototype.parseRule=function e(){return{ignore:true}};t.prototype.stopEvent=function e(t){var r=this.widget.spec.stopEvent;return r?r(t):false};t.prototype.ignoreMutation=function e(t){return t.type!="selection"||this.widget.spec.ignoreSelection};r.domAtom.get=function(){return true};Object.defineProperties(t.prototype,r);return t}(ViewDesc);var CompositionViewDesc=function(e){function t(t,r,n,o){e.call(this,t,nothing,r,null);this.textDOM=n;this.text=o}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={size:{configurable:true}};r.size.get=function(){return this.text.length};t.prototype.localPosFromDOM=function e(t,r){if(t!=this.textDOM){return this.posAtStart+(r?this.size:0)}return this.posAtStart+r};t.prototype.domFromPos=function e(t){return{node:this.textDOM,offset:t}};t.prototype.ignoreMutation=function e(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue};Object.defineProperties(t.prototype,r);return t}(ViewDesc);var MarkViewDesc=function(e){function t(t,r,n,o){e.call(this,t,[],n,o);this.mark=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.create=function e(r,n,o,i){var a=i.nodeViews[n.type.name];var s=a&&a(n,i,o);if(!s||!s.dom){s=DOMSerializer.renderSpec(document,n.type.spec.toDOM(n,o))}return new t(r,n,s.dom,s.contentDOM||s.dom)};t.prototype.parseRule=function e(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}};t.prototype.matchesMark=function e(t){return this.dirty!=NODE_DIRTY&&this.mark.eq(t)};t.prototype.markDirty=function t(r,n){e.prototype.markDirty.call(this,r,n);if(this.dirty!=NOT_DIRTY){var o=this.parent;while(!o.node){o=o.parent}if(o.dirty<this.dirty){o.dirty=this.dirty}this.dirty=NOT_DIRTY}};t.prototype.slice=function e(r,n,o){var i=t.create(this.parent,this.mark,true,o);var a=this.children,s=this.size;if(n<s){a=replaceNodes(a,n,s,o)}if(r>0){a=replaceNodes(a,0,r,o)}for(var l=0;l<a.length;l++){a[l].parent=i}i.children=a;return i};return t}(ViewDesc);var NodeViewDesc=function(e){function t(t,r,n,o,i,a,s,l,c){e.call(this,t,r.isLeaf?nothing:[],i,a);this.nodeDOM=s;this.node=r;this.outerDeco=n;this.innerDeco=o;if(a){this.updateChildren(l,c)}}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={size:{configurable:true},border:{configurable:true},domAtom:{configurable:true}};t.create=function e(r,n,o,i,a,s){var l;var c=a.nodeViews[n.type.name],u;var p=c&&c(n,a,(function(){if(!u){return s}if(u.parent){return u.parent.posBeforeChild(u)}}),o);var f=p&&p.dom,d=p&&p.contentDOM;if(n.isText){if(!f){f=document.createTextNode(n.text)}else if(f.nodeType!=3){throw new RangeError("Text must be rendered as a DOM text node")}}else if(!f){l=DOMSerializer.renderSpec(document,n.type.spec.toDOM(n)),f=l.dom,d=l.contentDOM}if(!d&&!n.isText&&f.nodeName!="BR"){if(!f.hasAttribute("contenteditable")){f.contentEditable=false}if(n.type.spec.draggable){f.draggable=true}}var h=f;f=applyOuterDeco(f,o,n);if(p){return u=new CustomNodeViewDesc(r,n,o,i,f,d,h,p,a,s+1)}else if(n.isText){return new TextViewDesc(r,n,o,i,f,h,a)}else{return new t(r,n,o,i,f,d,h,a,s+1)}};t.prototype.parseRule=function e(){var t=this;if(this.node.type.spec.reparseInView){return null}var r={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.spec.code){r.preserveWhitespace="full"}if(this.contentDOM&&!this.contentLost){r.contentElement=this.contentDOM}else{r.getContent=function(){return t.contentDOM?Fragment.empty:t.node.content}}return r};t.prototype.matchesNode=function e(t,r,n){return this.dirty==NOT_DIRTY&&t.eq(this.node)&&sameOuterDeco(r,this.outerDeco)&&n.eq(this.innerDeco)};r.size.get=function(){return this.node.nodeSize};r.border.get=function(){return this.node.isLeaf?0:1};t.prototype.updateChildren=function e(t,r){var n=this;var o=this.node.inlineContent,i=r;var a=o&&t.composing&&this.localCompositionNode(t,r);var s=new ViewTreeUpdater(this,a&&a.node);iterDeco(this.node,this.innerDeco,(function(e,r,a){if(e.spec.marks){s.syncToMarks(e.spec.marks,o,t)}else if(e.type.side>=0&&!a){s.syncToMarks(r==n.node.childCount?Mark.none:n.node.child(r).marks,o,t)}s.placeWidget(e,t,i)}),(function(e,r,n,a){s.syncToMarks(e.marks,o,t);s.findNodeMatch(e,r,n,a)||s.updateNextNode(e,r,n,t,a)||s.addNode(e,r,n,t,i);i+=e.nodeSize}));s.syncToMarks(nothing,o,t);if(this.node.isTextblock){s.addTextblockHacks()}s.destroyRest();if(s.changed||this.dirty==CONTENT_DIRTY){if(a){this.protectLocalComposition(t,a)}renderDescs(this.contentDOM,this.children,t);if(result$1.ios){iosHacks(this.dom)}}};t.prototype.localCompositionNode=function e(t,r){var n=t.state.selection;var o=n.from;var i=n.to;if(!(t.state.selection instanceof TextSelection)||o<r||i>r+this.node.content.size){return}var a=t.root.getSelection();var s=nearbyTextNode(a.focusNode,a.focusOffset);if(!s||!this.dom.contains(s.parentNode)){return}var l=s.nodeValue;var c=findTextInFragment(this.node.content,l,o-r,i-r);return c<0?null:{node:s,pos:c,text:l}};t.prototype.protectLocalComposition=function e(t,r){var n=r.node;var o=r.pos;var i=r.text;if(this.getDesc(n)){return}var a=n;for(;;a=a.parentNode){if(a.parentNode==this.contentDOM){break}while(a.previousSibling){a.parentNode.removeChild(a.previousSibling)}while(a.nextSibling){a.parentNode.removeChild(a.nextSibling)}if(a.pmViewDesc){a.pmViewDesc=null}}var s=new CompositionViewDesc(this,a,n,i);t.compositionNodes.push(s);this.children=replaceNodes(this.children,o,o+i.length,t,s)};t.prototype.update=function e(t,r,n,o){if(this.dirty==NODE_DIRTY||!t.sameMarkup(this.node)){return false}this.updateInner(t,r,n,o);return true};t.prototype.updateInner=function e(t,r,n,o){this.updateOuterDeco(r);this.node=t;this.innerDeco=n;if(this.contentDOM){this.updateChildren(o,this.posAtStart)}this.dirty=NOT_DIRTY};t.prototype.updateOuterDeco=function e(t){if(sameOuterDeco(t,this.outerDeco)){return}var r=this.nodeDOM.nodeType!=1;var n=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,r),computeOuterDeco(t,this.node,r));if(this.dom!=n){n.pmViewDesc=null;this.dom.pmViewDesc=this}this.outerDeco=t};t.prototype.selectNode=function e(){this.nodeDOM.classList.add("ProseMirror-selectednode");if(this.contentDOM||!this.node.type.spec.draggable){this.dom.draggable=true}};t.prototype.deselectNode=function e(){this.nodeDOM.classList.remove("ProseMirror-selectednode");if(this.contentDOM||!this.node.type.spec.draggable){this.dom.removeAttribute("draggable")}};r.domAtom.get=function(){return this.node.isAtom};Object.defineProperties(t.prototype,r);return t}(ViewDesc);function docViewDesc(e,t,r,n,o){applyOuterDeco(n,t,e);return new NodeViewDesc(null,e,t,r,n,n,n,o,0)}var TextViewDesc=function(e){function t(t,r,n,o,i,a,s){e.call(this,t,r,n,o,i,null,a,s)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={domAtom:{configurable:true}};t.prototype.parseRule=function e(){var t=this.nodeDOM.parentNode;while(t&&t!=this.dom&&!t.pmIsDeco){t=t.parentNode}return{skip:t||true}};t.prototype.update=function e(t,r,n,o){if(this.dirty==NODE_DIRTY||this.dirty!=NOT_DIRTY&&!this.inParent()||!t.sameMarkup(this.node)){return false}this.updateOuterDeco(r);if((this.dirty!=NOT_DIRTY||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue){this.nodeDOM.nodeValue=t.text;if(o.trackWrites==this.nodeDOM){o.trackWrites=null}}this.node=t;this.dirty=NOT_DIRTY;return true};t.prototype.inParent=function e(){var t=this.parent.contentDOM;for(var r=this.nodeDOM;r;r=r.parentNode){if(r==t){return true}}return false};t.prototype.domFromPos=function e(t){return{node:this.nodeDOM,offset:t}};t.prototype.localPosFromDOM=function t(r,n,o){if(r==this.nodeDOM){return this.posAtStart+Math.min(n,this.node.text.length)}return e.prototype.localPosFromDOM.call(this,r,n,o)};t.prototype.ignoreMutation=function e(t){return t.type!="characterData"&&t.type!="selection"};t.prototype.slice=function e(r,n,o){var i=this.node.cut(r,n),a=document.createTextNode(i.text);return new t(this.parent,i,this.outerDeco,this.innerDeco,a,a,o)};r.domAtom.get=function(){return false};Object.defineProperties(t.prototype,r);return t}(NodeViewDesc);var BRHackViewDesc=function(e){function t(){e.apply(this,arguments)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={domAtom:{configurable:true}};t.prototype.parseRule=function e(){return{ignore:true}};t.prototype.matchesHack=function e(){return this.dirty==NOT_DIRTY};r.domAtom.get=function(){return true};Object.defineProperties(t.prototype,r);return t}(ViewDesc);var CustomNodeViewDesc=function(e){function t(t,r,n,o,i,a,s,l,c,u){e.call(this,t,r,n,o,i,a,s,c,u);this.spec=l}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.update=function t(r,n,o,i){if(this.dirty==NODE_DIRTY){return false}if(this.spec.update){var a=this.spec.update(r,n);if(a){this.updateInner(r,n,o,i)}return a}else if(!this.contentDOM&&!r.isLeaf){return false}else{return e.prototype.update.call(this,r,n,o,i)}};t.prototype.selectNode=function t(){this.spec.selectNode?this.spec.selectNode():e.prototype.selectNode.call(this)};t.prototype.deselectNode=function t(){this.spec.deselectNode?this.spec.deselectNode():e.prototype.deselectNode.call(this)};t.prototype.setSelection=function t(r,n,o,i){this.spec.setSelection?this.spec.setSelection(r,n,o):e.prototype.setSelection.call(this,r,n,o,i)};t.prototype.destroy=function t(){if(this.spec.destroy){this.spec.destroy()}e.prototype.destroy.call(this)};t.prototype.stopEvent=function e(t){return this.spec.stopEvent?this.spec.stopEvent(t):false};t.prototype.ignoreMutation=function t(r){return this.spec.ignoreMutation?this.spec.ignoreMutation(r):e.prototype.ignoreMutation.call(this,r)};return t}(NodeViewDesc);function renderDescs(e,t,r){var n=e.firstChild,o=false;for(var i=0;i<t.length;i++){var a=t[i],s=a.dom;if(s.parentNode==e){while(s!=n){n=rm(n);o=true}n=n.nextSibling}else{o=true;e.insertBefore(s,n)}if(a instanceof MarkViewDesc){var l=n?n.previousSibling:e.lastChild;renderDescs(a.contentDOM,a.children,r);n=l?l.nextSibling:e.firstChild}}while(n){n=rm(n);o=true}if(o&&r.trackWrites==e){r.trackWrites=null}}function OuterDecoLevel(e){if(e){this.nodeName=e}}OuterDecoLevel.prototype=Object.create(null);var noDeco=[new OuterDecoLevel];function computeOuterDeco(e,t,r){if(e.length==0){return noDeco}var n=r?noDeco[0]:new OuterDecoLevel,o=[n];for(var i=0;i<e.length;i++){var a=e[i].type.attrs;if(!a){continue}if(a.nodeName){o.push(n=new OuterDecoLevel(a.nodeName))}for(var s in a){var l=a[s];if(l==null){continue}if(r&&o.length==1){o.push(n=new OuterDecoLevel(t.isInline?"span":"div"))}if(s=="class"){n.class=(n.class?n.class+" ":"")+l}else if(s=="style"){n.style=(n.style?n.style+";":"")+l}else if(s!="nodeName"){n[s]=l}}}return o}function patchOuterDeco(e,t,r,n){if(r==noDeco&&n==noDeco){return t}var o=t;for(var i=0;i<n.length;i++){var a=n[i],s=r[i];if(i){var l=void 0;if(s&&s.nodeName==a.nodeName&&o!=e&&(l=o.parentNode)&&l.tagName.toLowerCase()==a.nodeName){o=l}else{l=document.createElement(a.nodeName);l.pmIsDeco=true;l.appendChild(o);s=noDeco[0];o=l}}patchAttributes(o,s||noDeco[0],a)}return o}function patchAttributes(e,t,r){for(var n in t){if(n!="class"&&n!="style"&&n!="nodeName"&&!(n in r)){e.removeAttribute(n)}}for(var o in r){if(o!="class"&&o!="style"&&o!="nodeName"&&r[o]!=t[o]){e.setAttribute(o,r[o])}}if(t.class!=r.class){var i=t.class?t.class.split(" "):nothing;var a=r.class?r.class.split(" "):nothing;for(var s=0;s<i.length;s++){if(a.indexOf(i[s])==-1){e.classList.remove(i[s])}}for(var l=0;l<a.length;l++){if(i.indexOf(a[l])==-1){e.classList.add(a[l])}}}if(t.style!=r.style){if(t.style){var c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,u;while(u=c.exec(t.style)){e.style.removeProperty(u[1])}}if(r.style){e.style.cssText+=r.style}}}function applyOuterDeco(e,t,r){return patchOuterDeco(e,e,noDeco,computeOuterDeco(t,r,e.nodeType!=1))}function sameOuterDeco(e,t){if(e.length!=t.length){return false}for(var r=0;r<e.length;r++){if(!e[r].type.eq(t[r].type)){return false}}return true}function rm(e){var t=e.nextSibling;e.parentNode.removeChild(e);return t}var ViewTreeUpdater=function e(t,r){this.top=t;this.lock=r;this.index=0;this.stack=[];this.changed=false;var n=preMatch(t.node.content,t.children);this.preMatched=n.nodes;this.preMatchOffset=n.offset};ViewTreeUpdater.prototype.getPreMatch=function e(t){return t>=this.preMatchOffset?this.preMatched[t-this.preMatchOffset]:null};ViewTreeUpdater.prototype.destroyBetween=function e(t,r){if(t==r){return}for(var n=t;n<r;n++){this.top.children[n].destroy()}this.top.children.splice(t,r-t);this.changed=true};ViewTreeUpdater.prototype.destroyRest=function e(){this.destroyBetween(this.index,this.top.children.length)};ViewTreeUpdater.prototype.syncToMarks=function e(t,r,n){var o=0,i=this.stack.length>>1;var a=Math.min(i,t.length);while(o<a&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&t[o].type.spec.spanning!==false){o++}while(o<i){this.destroyRest();this.top.dirty=NOT_DIRTY;this.index=this.stack.pop();this.top=this.stack.pop();i--}while(i<t.length){this.stack.push(this.top,this.index+1);var s=-1;for(var l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){if(this.top.children[l].matchesMark(t[i])){s=l;break}}if(s>-1){if(s>this.index){this.changed=true;this.destroyBetween(this.index,s)}this.top=this.top.children[this.index]}else{var c=MarkViewDesc.create(this.top,t[i],r,n);this.top.children.splice(this.index,0,c);this.top=c;this.changed=true}this.index=0;i++}};ViewTreeUpdater.prototype.findNodeMatch=function e(t,r,n,o){var i=-1,a=o<0?undefined:this.getPreMatch(o),s=this.top.children;if(a&&a.matchesNode(t,r,n)){i=s.indexOf(a)}else{for(var l=this.index,c=Math.min(s.length,l+5);l<c;l++){var u=s[l];if(u.matchesNode(t,r,n)&&this.preMatched.indexOf(u)<0){i=l;break}}}if(i<0){return false}this.destroyBetween(this.index,i);this.index++;return true};ViewTreeUpdater.prototype.updateNextNode=function e(t,r,n,o,i){for(var a=this.index;a<this.top.children.length;a++){var s=this.top.children[a];if(s instanceof NodeViewDesc){var l=this.preMatched.indexOf(s);if(l>-1&&l+this.preMatchOffset!=i){return false}var c=s.dom;var u=this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(t.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==t.text&&s.dirty!=NODE_DIRTY&&sameOuterDeco(r,s.outerDeco));if(!u&&s.update(t,r,n,o)){this.destroyBetween(this.index,a);if(s.dom!=c){this.changed=true}this.index++;return true}break}}return false};ViewTreeUpdater.prototype.addNode=function e(t,r,n,o,i){this.top.children.splice(this.index++,0,NodeViewDesc.create(this.top,t,r,n,o,i));this.changed=true};ViewTreeUpdater.prototype.placeWidget=function e(t,r,n){var o=this.index<this.top.children.length?this.top.children[this.index]:null;if(o&&o.matchesWidget(t)&&(t==o.widget||!o.widget.type.toDOM.parentNode)){this.index++}else{var i=new WidgetViewDesc(this.top,t,r,n);this.top.children.splice(this.index++,0,i);this.changed=true}};ViewTreeUpdater.prototype.addTextblockHacks=function e(){var t=this.top.children[this.index-1];while(t instanceof MarkViewDesc){t=t.children[t.children.length-1]}if(!t||!(t instanceof TextViewDesc)||/\n$/.test(t.node.text)){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack()){this.index++}else{var r=document.createElement("br");this.top.children.splice(this.index++,0,new BRHackViewDesc(this.top,nothing,r,null));this.changed=true}}};function preMatch(e,t){var r=[],n=e.childCount;for(var o=t.length-1;n>0&&o>=0;o--){var i=t[o],a=i.node;if(!a){continue}if(a!=e.child(n-1)){break}r.push(i);--n}return{nodes:r.reverse(),offset:n}}function compareSide(e,t){return e.type.side-t.type.side}function iterDeco(e,t,r,n){var o=t.locals(e),i=0;if(o.length==0){for(var a=0;a<e.childCount;a++){var s=e.child(a);n(s,o,t.forChild(i,s),a);i+=s.nodeSize}return}var l=0,c=[],u=null;for(var p=0;;){if(l<o.length&&o[l].to==i){var f=o[l++],d=void 0;while(l<o.length&&o[l].to==i){(d||(d=[f])).push(o[l++])}if(d){d.sort(compareSide);for(var h=0;h<d.length;h++){r(d[h],p,!!u)}}else{r(f,p,!!u)}}var m=void 0,v=void 0;if(u){v=-1;m=u;u=null}else if(p<e.childCount){v=p;m=e.child(p++)}else{break}for(var g=0;g<c.length;g++){if(c[g].to<=i){c.splice(g--,1)}}while(l<o.length&&o[l].from<=i&&o[l].to>i){c.push(o[l++])}var y=i+m.nodeSize;if(m.isText){var b=y;if(l<o.length&&o[l].from<b){b=o[l].from}for(var w=0;w<c.length;w++){if(c[w].to<b){b=c[w].to}}if(b<y){u=m.cut(b-i);m=m.cut(0,b-i);y=b;v=-1}}var S=!c.length?nothing:m.isInline&&!m.isLeaf?c.filter((function(e){return!e.inline})):c.slice();n(m,S,t.forChild(i,m),v);i=y}}function iosHacks(e){if(e.nodeName=="UL"||e.nodeName=="OL"){var t=e.style.cssText;e.style.cssText=t+"; list-style: square !important";window.getComputedStyle(e).listStyle;e.style.cssText=t}}function nearbyTextNode(e,t){for(;;){if(e.nodeType==3){return e}if(e.nodeType==1&&t>0){if(e.childNodes.length>t&&e.childNodes[t].nodeType==3){return e.childNodes[t]}e=e.childNodes[t-1];t=nodeSize(e)}else if(e.nodeType==1&&t<e.childNodes.length){e=e.childNodes[t];t=0}else{return null}}}function findTextInFragment(e,t,r,n){for(var o=0,i=0;o<e.childCount&&i<=n;){var a=e.child(o++),s=i;i+=a.nodeSize;if(!a.isText){continue}var l=a.text;while(o<e.childCount){var c=e.child(o++);i+=c.nodeSize;if(!c.isText){break}l+=c.text}if(i>=r){var u=l.lastIndexOf(t,n-s);if(u>=0&&u+t.length+s>=r){return s+u}}}return-1}function replaceNodes(e,t,r,n,o){var i=[];for(var a=0,s=0;a<e.length;a++){var l=e[a],c=s,u=s+=l.size;if(c>=r||u<=t){i.push(l)}else{if(c<t){i.push(l.slice(0,t-c,n))}if(o){i.push(o);o=null}if(u>r){i.push(l.slice(r-c,l.size,n))}}}return i}function selectionFromDOM(e,t){var r=e.root.getSelection(),n=e.state.doc;if(!r.focusNode){return null}var o=e.docView.nearestDesc(r.focusNode),i=o&&o.size==0;var a=e.docView.posFromDOM(r.focusNode,r.focusOffset);if(a<0){return null}var s=n.resolve(a),l,c;if(selectionCollapsed(r)){l=s;while(o&&!o.node){o=o.parent}if(o&&o.node.isAtom&&NodeSelection.isSelectable(o.node)&&o.parent&&!(o.node.isInline&&isOnEdge(r.focusNode,r.focusOffset,o.dom))){var u=o.posBefore;c=new NodeSelection(a==u?s:n.resolve(u))}}else{var p=e.docView.posFromDOM(r.anchorNode,r.anchorOffset);if(p<0){return null}l=n.resolve(p)}if(!c){var f=t=="pointer"||e.state.selection.head<s.pos&&!i?1:-1;c=selectionBetween(e,l,s,f)}return c}function selectionToDOM(e,t){var r=e.state.selection;syncNodeSelection(e,r);if(e.editable?!e.hasFocus():!(hasSelection(e)&&document.activeElement&&document.activeElement.contains(e.dom))){return}e.domObserver.disconnectSelection();if(e.cursorWrapper){selectCursorWrapper(e)}else{var n=r.anchor;var o=r.head;var i,a;if(brokenSelectBetweenUneditable&&!(r instanceof TextSelection)){if(!r.$from.parent.inlineContent){i=temporarilyEditableNear(e,r.from)}if(!r.empty&&!r.$from.parent.inlineContent){a=temporarilyEditableNear(e,r.to)}}e.docView.setSelection(n,o,e.root,t);if(brokenSelectBetweenUneditable){if(i){resetEditable(i)}if(a){resetEditable(a)}}if(r.visible){e.dom.classList.remove("ProseMirror-hideselection")}else{e.dom.classList.add("ProseMirror-hideselection");if("onselectionchange"in document){removeClassOnSelectionChange(e)}}}e.domObserver.setCurSelection();e.domObserver.connectSelection()}var brokenSelectBetweenUneditable=result$1.safari||result$1.chrome&&result$1.chrome_version<63;function temporarilyEditableNear(e,t){var r=e.docView.domFromPos(t,0);var n=r.node;var o=r.offset;var i=o<n.childNodes.length?n.childNodes[o]:null;var a=o?n.childNodes[o-1]:null;if(result$1.safari&&i&&i.contentEditable=="false"){return setEditable(i)}if((!i||i.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(i){return setEditable(i)}else if(a){return setEditable(a)}}}function setEditable(e){e.contentEditable="true";if(result$1.safari&&e.draggable){e.draggable=false;e.wasDraggable=true}return e}function resetEditable(e){e.contentEditable="false";if(e.wasDraggable){e.draggable=true;e.wasDraggable=null}}function removeClassOnSelectionChange(e){var t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.hideSelectionGuard);var r=e.root.getSelection();var n=r.anchorNode,o=r.anchorOffset;t.addEventListener("selectionchange",e.hideSelectionGuard=function(){if(r.anchorNode!=n||r.anchorOffset!=o){t.removeEventListener("selectionchange",e.hideSelectionGuard);e.dom.classList.remove("ProseMirror-hideselection")}})}function selectCursorWrapper(e){var t=e.root.getSelection(),r=document.createRange();var n=e.cursorWrapper.dom,o=n.nodeName=="IMG";if(o){r.setEnd(n.parentNode,domIndex(n)+1)}else{r.setEnd(n,0)}r.collapse(false);t.removeAllRanges();t.addRange(r);if(!o&&!e.state.selection.visible&&result$1.ie&&result$1.ie_version<=11){n.disabled=true;n.disabled=false}}function syncNodeSelection(e,t){if(t instanceof NodeSelection){var r=e.docView.descAt(t.from);if(r!=e.lastSelectedViewDesc){clearNodeSelection(e);if(r){r.selectNode()}e.lastSelectedViewDesc=r}}else{clearNodeSelection(e)}}function clearNodeSelection(e){if(e.lastSelectedViewDesc){if(e.lastSelectedViewDesc.parent){e.lastSelectedViewDesc.deselectNode()}e.lastSelectedViewDesc=null}}function selectionBetween(e,t,r,n){return e.someProp("createSelectionBetween",(function(n){return n(e,t,r)}))||TextSelection.between(t,r,n)}function hasFocusAndSelection(e){if(e.editable&&e.root.activeElement!=e.dom){return false}return hasSelection(e)}function hasSelection(e){var t=e.root.getSelection();if(!t.anchorNode){return false}try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch(e){return false}}function anchorInRightPlace(e){var t=e.docView.domFromPos(e.state.selection.anchor,0);var r=e.root.getSelection();return isEquivalentPosition(t.node,t.offset,r.anchorNode,r.anchorOffset)}function moveSelectionBlock(e,t){var r=e.selection;var n=r.$anchor;var o=r.$head;var i=t>0?n.max(o):n.min(o);var a=!i.parent.inlineContent?i:i.depth?e.doc.resolve(t>0?i.after():i.before()):null;return a&&Selection.findFrom(a,t)}function apply(e,t){e.dispatch(e.state.tr.setSelection(t).scrollIntoView());return true}function selectHorizontally(e,t,r){var n=e.state.selection;if(n instanceof TextSelection){if(!n.empty||r.indexOf("s")>-1){return false}else if(e.endOfTextblock(t>0?"right":"left")){var o=moveSelectionBlock(e.state,t);if(o&&o instanceof NodeSelection){return apply(e,o)}return false}else if(!(result$1.mac&&r.indexOf("m")>-1)){var i=n.$head,a=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter,s;if(!a||a.isText){return false}var l=t<0?i.pos-a.nodeSize:i.pos;if(!(a.isAtom||(s=e.docView.descAt(l))&&!s.contentDOM)){return false}if(NodeSelection.isSelectable(a)){return apply(e,new NodeSelection(t<0?e.state.doc.resolve(i.pos-a.nodeSize):i))}else if(result$1.webkit){return apply(e,new TextSelection(e.state.doc.resolve(t<0?l:l+a.nodeSize)))}else{return false}}}else if(n instanceof NodeSelection&&n.node.isInline){return apply(e,new TextSelection(t>0?n.$to:n.$from))}else{var c=moveSelectionBlock(e.state,t);if(c){return apply(e,c)}return false}}function nodeLen(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function isIgnorable(e){var t=e.pmViewDesc;return t&&t.size==0&&(e.nextSibling||e.nodeName!="BR")}function skipIgnoredNodesLeft(e){var t=e.root.getSelection();var r=t.focusNode,n=t.focusOffset;if(!r){return}var o,i,a=false;if(result$1.gecko&&r.nodeType==1&&n<nodeLen(r)&&isIgnorable(r.childNodes[n])){a=true}for(;;){if(n>0){if(r.nodeType!=1){break}else{var s=r.childNodes[n-1];if(isIgnorable(s)){o=r;i=--n}else if(s.nodeType==3){r=s;n=r.nodeValue.length}else{break}}}else if(isBlockNode(r)){break}else{var l=r.previousSibling;while(l&&isIgnorable(l)){o=r.parentNode;i=domIndex(l);l=l.previousSibling}if(!l){r=r.parentNode;if(r==e.dom){break}n=0}else{r=l;n=nodeLen(r)}}}if(a){setSelFocus(e,t,r,n)}else if(o){setSelFocus(e,t,o,i)}}function skipIgnoredNodesRight(e){var t=e.root.getSelection();var r=t.focusNode,n=t.focusOffset;if(!r){return}var o=nodeLen(r);var i,a;for(;;){if(n<o){if(r.nodeType!=1){break}var s=r.childNodes[n];if(isIgnorable(s)){i=r;a=++n}else{break}}else if(isBlockNode(r)){break}else{var l=r.nextSibling;while(l&&isIgnorable(l)){i=l.parentNode;a=domIndex(l)+1;l=l.nextSibling}if(!l){r=r.parentNode;if(r==e.dom){break}n=o=0}else{r=l;n=0;o=nodeLen(r)}}}if(i){setSelFocus(e,t,i,a)}}function isBlockNode(e){var t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function setSelFocus(e,t,r,n){if(selectionCollapsed(t)){var o=document.createRange();o.setEnd(r,n);o.setStart(r,n);t.removeAllRanges();t.addRange(o)}else if(t.extend){t.extend(r,n)}e.domObserver.setCurSelection();var i=e.state;setTimeout((function(){if(e.state==i){selectionToDOM(e)}}),50)}function selectVertically(e,t,r){var n=e.state.selection;if(n instanceof TextSelection&&!n.empty||r.indexOf("s")>-1){return false}if(result$1.mac&&r.indexOf("m")>-1){return false}var o=n.$from;var i=n.$to;if(!o.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){var a=moveSelectionBlock(e.state,t);if(a&&a instanceof NodeSelection){return apply(e,a)}}if(!o.parent.inlineContent){var s=Selection.findFrom(t<0?o:i,t);return s?apply(e,s):true}return false}function stopNativeHorizontalDelete(e,t){if(!(e.state.selection instanceof TextSelection)){return true}var r=e.state.selection;var n=r.$head;var o=r.$anchor;var i=r.empty;if(!n.sameParent(o)){return true}if(!i){return false}if(e.endOfTextblock(t>0?"forward":"backward")){return true}var a=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){var s=e.state.tr;if(t<0){s.delete(n.pos-a.nodeSize,n.pos)}else{s.delete(n.pos,n.pos+a.nodeSize)}e.dispatch(s);return true}return false}function switchEditable(e,t,r){e.domObserver.stop();t.contentEditable=r;e.domObserver.start()}function safariDownArrowBug(e){if(!result$1.safari||e.state.selection.$head.parentOffset>0){return}var t=e.root.getSelection();var r=t.focusNode;var n=t.focusOffset;if(r&&r.nodeType==1&&n==0&&r.firstChild&&r.firstChild.contentEditable=="false"){var o=r.firstChild;switchEditable(e,o,true);setTimeout((function(){return switchEditable(e,o,false)}),20)}}function getMods(e){var t="";if(e.ctrlKey){t+="c"}if(e.metaKey){t+="m"}if(e.altKey){t+="a"}if(e.shiftKey){t+="s"}return t}function captureKeyDown(e,t){var r=t.keyCode,n=getMods(t);if(r==8||result$1.mac&&r==72&&n=="c"){return stopNativeHorizontalDelete(e,-1)||skipIgnoredNodesLeft(e)}else if(r==46||result$1.mac&&r==68&&n=="c"){return stopNativeHorizontalDelete(e,1)||skipIgnoredNodesRight(e)}else if(r==13||r==27){return true}else if(r==37){return selectHorizontally(e,-1,n)||skipIgnoredNodesLeft(e)}else if(r==39){return selectHorizontally(e,1,n)||skipIgnoredNodesRight(e)}else if(r==38){return selectVertically(e,-1,n)||skipIgnoredNodesLeft(e)}else if(r==40){return safariDownArrowBug(e)||selectVertically(e,1,n)||skipIgnoredNodesRight(e)}else if(n==(result$1.mac?"m":"c")&&(r==66||r==73||r==89||r==90)){return true}return false}function parseBetween(e,t,r){var n=e.docView.parseRange(t,r);var o=n.node;var i=n.fromOffset;var a=n.toOffset;var s=n.from;var l=n.to;var c=e.root.getSelection(),u=null,p=c.anchorNode;if(p&&e.dom.contains(p.nodeType==1?p:p.parentNode)){u=[{node:p,offset:c.anchorOffset}];if(!selectionCollapsed(c)){u.push({node:c.focusNode,offset:c.focusOffset})}}if(result$1.chrome&&e.lastKeyCode===8){for(var f=a;f>i;f--){var d=o.childNodes[f-1],h=d.pmViewDesc;if(d.nodeType=="BR"&&!h){a=f;break}if(!h||h.size){break}}}var m=e.state.doc;var v=e.someProp("domParser")||DOMParser.fromSchema(e.state.schema);var g=m.resolve(s);var y=null,b=v.parse(o,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:true,from:i,to:a,preserveWhitespace:g.parent.type.spec.code?"full":true,editableContent:true,findPositions:u,ruleFromNode:ruleFromNode,context:g});if(u&&u[0].pos!=null){var w=u[0].pos,S=u[1]&&u[1].pos;if(S==null){S=w}y={anchor:w+s,head:S+s}}return{doc:b,sel:y,from:s,to:l}}function ruleFromNode(e){var t=e.pmViewDesc;if(t){return t.parseRule()}else if(e.nodeName=="BR"&&e.parentNode){if(result$1.safari&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){var r=document.createElement("div");r.appendChild(document.createElement("li"));return{skip:r}}else if(e.parentNode.lastChild==e||result$1.safari&&/^(tr|table)$/i.test(e.parentNode.nodeName)){return{ignore:true}}}else if(e.nodeName=="IMG"&&e.getAttribute("mark-placeholder")){return{ignore:true}}}function readDOMChange(e,t,r,n,o){if(t<0){var i=e.lastSelectionTime>Date.now()-50?e.lastSelectionOrigin:null;var a=selectionFromDOM(e,i);if(a&&!e.state.selection.eq(a)){var s=e.state.tr.setSelection(a);if(i=="pointer"){s.setMeta("pointer",true)}else if(i=="key"){s.scrollIntoView()}e.dispatch(s)}return}var l=e.state.doc.resolve(t);var c=l.sharedDepth(r);t=l.before(c+1);r=e.state.doc.resolve(r).after(c+1);var u=e.state.selection;var p=parseBetween(e,t,r);if(result$1.chrome&&e.cursorWrapper&&p.sel&&p.sel.anchor==e.cursorWrapper.deco.from){var f=e.cursorWrapper.deco.type.toDOM.nextSibling;var d=f&&f.nodeValue?f.nodeValue.length:1;p.sel={anchor:p.sel.anchor+d,head:p.sel.anchor+d}}var h=e.state.doc,m=h.slice(p.from,p.to);var v,g;if(e.lastKeyCode===8&&Date.now()-100<e.lastKeyCodeTime){v=e.state.selection.to;g="end"}else{v=e.state.selection.from;g="start"}e.lastKeyCode=null;var y=findDiff(m.content,p.doc.content,p.from,v,g);if(!y){if(n&&u instanceof TextSelection&&!u.empty&&u.$head.sameParent(u.$anchor)&&!e.composing&&!(p.sel&&p.sel.anchor!=p.sel.head)){y={start:u.from,endA:u.to,endB:u.to}}else if(result$1.ios&&e.lastIOSEnter>Date.now()-225&&o.some((function(e){return e.nodeName=="DIV"||e.nodeName=="P"}))&&e.someProp("handleKeyDown",(function(t){return t(e,keyEvent(13,"Enter"))}))){e.lastIOSEnter=0;return}else{if(p.sel){var b=resolveSelection(e,e.state.doc,p.sel);if(b&&!b.eq(e.state.selection)){e.dispatch(e.state.tr.setSelection(b))}}return}}e.domChangeCount++;if(e.state.selection.from<e.state.selection.to&&y.start==y.endB&&e.state.selection instanceof TextSelection){if(y.start>e.state.selection.from&&y.start<=e.state.selection.from+2){y.start=e.state.selection.from}else if(y.endA<e.state.selection.to&&y.endA>=e.state.selection.to-2){y.endB+=e.state.selection.to-y.endA;y.endA=e.state.selection.to}}if(result$1.ie&&result$1.ie_version<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>p.from&&p.doc.textBetween(y.start-p.from-1,y.start-p.from+1)==" "){y.start--;y.endA--;y.endB--}var w=p.doc.resolveNoCache(y.start-p.from);var S=p.doc.resolveNoCache(y.endB-p.from);var C=w.sameParent(S)&&w.parent.inlineContent;var R;if((result$1.ios&&e.lastIOSEnter>Date.now()-225&&(!C||o.some((function(e){return e.nodeName=="DIV"||e.nodeName=="P"})))||!C&&w.pos<p.doc.content.size&&(R=Selection.findFrom(p.doc.resolve(w.pos+1),1,true))&&R.head==S.pos)&&e.someProp("handleKeyDown",(function(t){return t(e,keyEvent(13,"Enter"))}))){e.lastIOSEnter=0;return}if(e.state.selection.anchor>y.start&&looksLikeJoin(h,y.start,y.endA,w,S)&&e.someProp("handleKeyDown",(function(t){return t(e,keyEvent(8,"Backspace"))}))){if(result$1.android&&result$1.chrome){e.domObserver.suppressSelectionUpdates()}return}if(result$1.android&&!C&&w.start()!=S.start()&&S.parentOffset==0&&w.depth==S.depth&&p.sel&&p.sel.anchor==p.sel.head&&p.sel.head==y.endA){y.endB-=2;S=p.doc.resolveNoCache(y.endB-p.from);setTimeout((function(){e.someProp("handleKeyDown",(function(t){return t(e,keyEvent(13,"Enter"))}))}),20)}var M=y.start,x=y.endA;var T,k,A,E;if(C){if(w.pos==S.pos){if(result$1.ie&&result$1.ie_version<=11&&w.parentOffset==0){e.domObserver.suppressSelectionUpdates();setTimeout((function(){return selectionToDOM(e)}),20)}T=e.state.tr.delete(M,x);k=h.resolve(y.start).marksAcross(h.resolve(y.endA))}else if(y.endA==y.endB&&(E=h.resolve(y.start))&&(A=isMarkChange(w.parent.content.cut(w.parentOffset,S.parentOffset),E.parent.content.cut(E.parentOffset,y.endA-E.start())))){T=e.state.tr;if(A.type=="add"){T.addMark(M,x,A.mark)}else{T.removeMark(M,x,A.mark)}}else if(w.parent.child(w.index()).isText&&w.index()==S.index()-(S.textOffset?0:1)){var N=w.parent.textBetween(w.parentOffset,S.parentOffset);if(e.someProp("handleTextInput",(function(t){return t(e,M,x,N)}))){return}T=e.state.tr.insertText(N,M,x)}}if(!T){T=e.state.tr.replace(M,x,p.doc.slice(y.start-p.from,y.endB-p.from))}if(p.sel){var O=resolveSelection(e,T.doc,p.sel);if(O&&!(result$1.chrome&&result$1.android&&e.composing&&O.empty&&(O.head==M||O.head==T.mapping.map(x)-1)||result$1.ie&&O.empty&&O.head==M)){T.setSelection(O)}}if(k){T.ensureMarks(k)}e.dispatch(T.scrollIntoView())}function resolveSelection(e,t,r){if(Math.max(r.anchor,r.head)>t.content.size){return null}return selectionBetween(e,t.resolve(r.anchor),t.resolve(r.head))}function isMarkChange(e,t){var r=e.firstChild.marks,n=t.firstChild.marks;var o=r,i=n,a,s,l;for(var c=0;c<n.length;c++){o=n[c].removeFromSet(o)}for(var u=0;u<r.length;u++){i=r[u].removeFromSet(i)}if(o.length==1&&i.length==0){s=o[0];a="add";l=function(e){return e.mark(s.addToSet(e.marks))}}else if(o.length==0&&i.length==1){s=i[0];a="remove";l=function(e){return e.mark(s.removeFromSet(e.marks))}}else{return null}var p=[];for(var f=0;f<t.childCount;f++){p.push(l(t.child(f)))}if(Fragment.from(p).eq(e)){return{mark:s,type:a}}}function looksLikeJoin(e,t,r,n,o){if(!n.parent.isTextblock||r-t<=o.pos-n.pos||skipClosingAndOpening(n,true,false)<o.pos){return false}var i=e.resolve(t);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock){return false}var a=e.resolve(skipClosingAndOpening(i,true,true));if(!a.parent.isTextblock||a.pos>r||skipClosingAndOpening(a,true,false)<r){return false}return n.parent.content.cut(n.parentOffset).eq(a.parent.content)}function skipClosingAndOpening(e,t,r){var n=e.depth,o=t?e.end():e.pos;while(n>0&&(t||e.indexAfter(n)==e.node(n).childCount)){n--;o++;t=false}if(r){var i=e.node(n).maybeChild(e.indexAfter(n));while(i&&!i.isLeaf){i=i.firstChild;o++}}return o}function findDiff(e,t,r,n,o){var i=e.findDiffStart(t,r);if(i==null){return null}var a=e.findDiffEnd(t,r+e.size,r+t.size);var s=a.a;var l=a.b;if(o=="end"){var c=Math.max(0,i-Math.min(s,l));n-=s+c-i}if(s<i&&e.size<t.size){var u=n<=i&&n>=s?i-n:0;i-=u;l=i+(l-s);s=i}else if(l<i){var p=n<=i&&n>=l?i-n:0;i-=p;s=i+(s-l);l=i}return{start:i,endA:s,endB:l}}function serializeForClipboard(e,t){var r=[];var n=t.content;var o=t.openStart;var i=t.openEnd;while(o>1&&i>1&&n.childCount==1&&n.firstChild.childCount==1){o--;i--;var a=n.firstChild;r.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null);n=a.content}var s=e.someProp("clipboardSerializer")||DOMSerializer.fromSchema(e.state.schema);var l=detachedDoc(),c=l.createElement("div");c.appendChild(s.serializeFragment(n,{document:l}));var u=c.firstChild,p;while(u&&u.nodeType==1&&(p=wrapMap[u.nodeName.toLowerCase()])){for(var f=p.length-1;f>=0;f--){var d=l.createElement(p[f]);while(c.firstChild){d.appendChild(c.firstChild)}c.appendChild(d)}u=c.firstChild}if(u&&u.nodeType==1){u.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(r))}var h=e.someProp("clipboardTextSerializer",(function(e){return e(t)}))||t.content.textBetween(0,t.content.size,"\n\n");return{dom:c,text:h}}function parseFromClipboard(e,t,r,n,o){var i,a=o.parent.type.spec.code,s;if(!r&&!t){return null}var l=t&&(n||a||!r);if(l){e.someProp("transformPastedText",(function(e){t=e(t,a||n)}));if(a){return new Slice(Fragment.from(e.state.schema.text(t)),0,0)}var c=e.someProp("clipboardTextParser",(function(e){return e(t,o,n)}));if(c){s=c}else{i=document.createElement("div");t.trim().split(/(?:\r\n?|\n)+/).forEach((function(e){i.appendChild(document.createElement("p")).textContent=e}))}}else{e.someProp("transformPastedHTML",(function(e){r=e(r)}));i=readHTML(r)}var u=i&&i.querySelector("[data-pm-slice]");var p=u&&/^(\d+) (\d+) (.*)/.exec(u.getAttribute("data-pm-slice"));if(!s){var f=e.someProp("clipboardParser")||e.someProp("domParser")||DOMParser.fromSchema(e.state.schema);s=f.parseSlice(i,{preserveWhitespace:!!(l||p),context:o})}if(p){s=addContext(closeSlice(s,+p[1],+p[2]),p[3])}else{s=Slice.maxOpen(normalizeSiblings(s.content,o),false)}e.someProp("transformPasted",(function(e){s=e(s)}));return s}function normalizeSiblings(e,t){if(e.childCount<2){return e}var r=function(r){var n=t.node(r);var o=n.contentMatchAt(t.index(r));var i=void 0,a=[];e.forEach((function(e){if(!a){return}var t=o.findWrapping(e.type),r;if(!t){return a=null}if(r=a.length&&i.length&&addToSibling(t,i,e,a[a.length-1],0)){a[a.length-1]=r}else{if(a.length){a[a.length-1]=closeRight(a[a.length-1],i.length)}var n=withWrappers(e,t);a.push(n);o=o.matchType(n.type,n.attrs);i=t}}));if(a){return{v:Fragment.from(a)}}};for(var n=t.depth;n>=0;n--){var o=r(n);if(o)return o.v}return e}function withWrappers(e,t,r){if(r===void 0)r=0;for(var n=t.length-1;n>=r;n--){e=t[n].create(null,Fragment.from(e))}return e}function addToSibling(e,t,r,n,o){if(o<e.length&&o<t.length&&e[o]==t[o]){var i=addToSibling(e,t,r,n.lastChild,o+1);if(i){return n.copy(n.content.replaceChild(n.childCount-1,i))}var a=n.contentMatchAt(n.childCount);if(a.matchType(o==e.length-1?r.type:e[o+1])){return n.copy(n.content.append(Fragment.from(withWrappers(r,e,o+1))))}}}function closeRight(e,t){if(t==0){return e}var r=e.content.replaceChild(e.childCount-1,closeRight(e.lastChild,t-1));var n=e.contentMatchAt(e.childCount).fillBefore(Fragment.empty,true);return e.copy(r.append(n))}function closeRange(e,t,r,n,o,i){var a=t<0?e.firstChild:e.lastChild,s=a.content;if(o<n-1){s=closeRange(s,t,r,n,o+1,i)}if(o>=r){s=t<0?a.contentMatchAt(0).fillBefore(s,e.childCount>1||i<=o).append(s):s.append(a.contentMatchAt(a.childCount).fillBefore(Fragment.empty,true))}return e.replaceChild(t<0?0:e.childCount-1,a.copy(s))}function closeSlice(e,t,r){if(t<e.openStart){e=new Slice(closeRange(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)}if(r<e.openEnd){e=new Slice(closeRange(e.content,1,r,e.openEnd,0,0),e.openStart,r)}return e}var wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};var _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}function readHTML(e){var t=/(\s*<meta [^>]*>)*/.exec(e);if(t){e=e.slice(t[0].length)}var r=detachedDoc().createElement("div");var n=/(?:<meta [^>]*>)*<([a-z][^>\s]+)/i.exec(e),o,i=0;if(o=n&&wrapMap[n[1].toLowerCase()]){e=o.map((function(e){return"<"+e+">"})).join("")+e+o.map((function(e){return"</"+e+">"})).reverse().join("");i=o.length}r.innerHTML=e;for(var a=0;a<i;a++){r=r.firstChild}return r}function addContext(e,t){if(!e.size){return e}var r=e.content.firstChild.type.schema,n;try{n=JSON.parse(t)}catch(t){return e}var o=e.content;var i=e.openStart;var a=e.openEnd;for(var s=n.length-2;s>=0;s-=2){var l=r.nodes[n[s]];if(!l||l.hasRequiredAttrs()){break}o=Fragment.from(l.create(n[s+1],o));i++;a++}return new Slice(o,i,a)}var observeOptions={childList:true,characterData:true,characterDataOldValue:true,attributes:true,attributeOldValue:true,subtree:true};var useCharData=result$1.ie&&result$1.ie_version<=11;var SelectionState=function e(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};SelectionState.prototype.set=function e(t){this.anchorNode=t.anchorNode;this.anchorOffset=t.anchorOffset;this.focusNode=t.focusNode;this.focusOffset=t.focusOffset};SelectionState.prototype.eq=function e(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var DOMObserver=function e(t,r){var n=this;this.view=t;this.handleDOMChange=r;this.queue=[];this.flushingSoon=-1;this.observer=window.MutationObserver&&new window.MutationObserver((function(e){for(var t=0;t<e.length;t++){n.queue.push(e[t])}if(result$1.ie&&result$1.ie_version<=11&&e.some((function(e){return e.type=="childList"&&e.removedNodes.length||e.type=="characterData"&&e.oldValue.length>e.target.nodeValue.length}))){n.flushSoon()}else{n.flush()}}));this.currentSelection=new SelectionState;if(useCharData){this.onCharData=function(e){n.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue});n.flushSoon()}}this.onSelectionChange=this.onSelectionChange.bind(this);this.suppressingSelectionUpdates=false};DOMObserver.prototype.flushSoon=function e(){var t=this;if(this.flushingSoon<0){this.flushingSoon=window.setTimeout((function(){t.flushingSoon=-1;t.flush()}),20)}};DOMObserver.prototype.forceFlush=function e(){if(this.flushingSoon>-1){window.clearTimeout(this.flushingSoon);this.flushingSoon=-1;this.flush()}};DOMObserver.prototype.start=function e(){if(this.observer){this.observer.observe(this.view.dom,observeOptions)}if(useCharData){this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData)}this.connectSelection()};DOMObserver.prototype.stop=function e(){var t=this;if(this.observer){var r=this.observer.takeRecords();if(r.length){for(var n=0;n<r.length;n++){this.queue.push(r[n])}window.setTimeout((function(){return t.flush()}),20)}this.observer.disconnect()}if(useCharData){this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)}this.disconnectSelection()};DOMObserver.prototype.connectSelection=function e(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};DOMObserver.prototype.disconnectSelection=function e(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};DOMObserver.prototype.suppressSelectionUpdates=function e(){var t=this;this.suppressingSelectionUpdates=true;setTimeout((function(){return t.suppressingSelectionUpdates=false}),50)};DOMObserver.prototype.onSelectionChange=function e(){if(!hasFocusAndSelection(this.view)){return}if(this.suppressingSelectionUpdates){return selectionToDOM(this.view)}if(result$1.ie&&result$1.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&isEquivalentPosition(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)){return this.flushSoon()}}this.flush()};DOMObserver.prototype.setCurSelection=function e(){this.currentSelection.set(this.view.root.getSelection())};DOMObserver.prototype.ignoreSelectionChange=function e(t){if(t.rangeCount==0){return true}var r=t.getRangeAt(0).commonAncestorContainer;var n=this.view.docView.nearestDesc(r);if(n&&n.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r})){this.setCurSelection();return true}};DOMObserver.prototype.flush=function e(){if(!this.view.docView||this.flushingSoon>-1){return}var t=this.observer?this.observer.takeRecords():[];if(this.queue.length){t=this.queue.concat(t);this.queue.length=0}var r=this.view.root.getSelection();var n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&hasSelection(this.view);var o=-1,i=-1,a=false,s=[];if(this.view.editable){for(var l=0;l<t.length;l++){var c=this.registerMutation(t[l],s);if(c){o=o<0?c.from:Math.min(c.from,o);i=i<0?c.to:Math.max(c.to,i);if(c.typeOver){a=true}}}}if(result$1.gecko&&s.length>1){var u=s.filter((function(e){return e.nodeName=="BR"}));if(u.length==2){var p=u[0];var f=u[1];if(p.parentNode&&p.parentNode.parentNode==f.parentNode){f.remove()}else{p.remove()}}}if(o>-1||n){if(o>-1){this.view.docView.markDirty(o,i);checkCSS(this.view)}this.handleDOMChange(o,i,a,s);if(this.view.docView.dirty){this.view.updateState(this.view.state)}else if(!this.currentSelection.eq(r)){selectionToDOM(this.view)}}};DOMObserver.prototype.registerMutation=function e(t,r){if(r.indexOf(t.target)>-1){return null}var n=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(n==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))){return null}if(!n||n.ignoreMutation(t)){return null}if(t.type=="childList"){var o=t.previousSibling,i=t.nextSibling;if(result$1.ie&&result$1.ie_version<=11&&t.addedNodes.length){for(var a=0;a<t.addedNodes.length;a++){var s=t.addedNodes[a];var l=s.previousSibling;var c=s.nextSibling;if(!l||Array.prototype.indexOf.call(t.addedNodes,l)<0){o=l}if(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0){i=c}}}var u=o&&o.parentNode==t.target?domIndex(o)+1:0;var p=n.localPosFromDOM(t.target,u,-1);var f=i&&i.parentNode==t.target?domIndex(i):t.target.childNodes.length;for(var d=0;d<t.addedNodes.length;d++){r.push(t.addedNodes[d])}var h=n.localPosFromDOM(t.target,f,1);return{from:p,to:h}}else if(t.type=="attributes"){return{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}}else{return{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}}};var cssChecked=false;function checkCSS(e){if(cssChecked){return}cssChecked=true;if(getComputedStyle(e.dom).whiteSpace=="normal"){console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package.")}}var handlers={},editHandlers={};function initInput(e){e.shiftKey=false;e.mouseDown=null;e.lastKeyCode=null;e.lastKeyCodeTime=0;e.lastClick={time:0,x:0,y:0,type:""};e.lastSelectionOrigin=null;e.lastSelectionTime=0;e.lastIOSEnter=0;e.lastIOSEnterFallbackTimeout=null;e.composing=false;e.composingTimeout=null;e.compositionNodes=[];e.compositionEndedAt=-2e8;e.domObserver=new DOMObserver(e,(function(t,r,n,o){return readDOMChange(e,t,r,n,o)}));e.domObserver.start();e.domChangeCount=0;e.eventHandlers=Object.create(null);var t=function(t){var r=handlers[t];e.dom.addEventListener(t,e.eventHandlers[t]=function(t){if(eventBelongsToView(e,t)&&!runCustomHandler(e,t)&&(e.editable||!(t.type in editHandlers))){r(e,t)}})};for(var r in handlers)t(r);if(result$1.safari){e.dom.addEventListener("input",(function(){return null}))}ensureListeners(e)}function setSelectionOrigin(e,t){e.lastSelectionOrigin=t;e.lastSelectionTime=Date.now()}function destroyInput(e){e.domObserver.stop();for(var t in e.eventHandlers){e.dom.removeEventListener(t,e.eventHandlers[t])}clearTimeout(e.composingTimeout);clearTimeout(e.lastIOSEnterFallbackTimeout)}function ensureListeners(e){e.someProp("handleDOMEvents",(function(t){for(var r in t){if(!e.eventHandlers[r]){e.dom.addEventListener(r,e.eventHandlers[r]=function(t){return runCustomHandler(e,t)})}}}))}function runCustomHandler(e,t){return e.someProp("handleDOMEvents",(function(r){var n=r[t.type];return n?n(e,t)||t.defaultPrevented:false}))}function eventBelongsToView(e,t){if(!t.bubbles){return true}if(t.defaultPrevented){return false}for(var r=t.target;r!=e.dom;r=r.parentNode){if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(t)){return false}}return true}function dispatchEvent(e,t){if(!runCustomHandler(e,t)&&handlers[t.type]&&(e.editable||!(t.type in editHandlers))){handlers[t.type](e,t)}}editHandlers.keydown=function(e,t){e.shiftKey=t.keyCode==16||t.shiftKey;if(inOrNearComposition(e,t)){return}e.domObserver.forceFlush();e.lastKeyCode=t.keyCode;e.lastKeyCodeTime=Date.now();if(result$1.ios&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var r=Date.now();e.lastIOSEnter=r;e.lastIOSEnterFallbackTimeout=setTimeout((function(){if(e.lastIOSEnter==r){e.someProp("handleKeyDown",(function(t){return t(e,keyEvent(13,"Enter"))}));e.lastIOSEnter=0}}),200)}else if(e.someProp("handleKeyDown",(function(r){return r(e,t)}))||captureKeyDown(e,t)){t.preventDefault()}else{setSelectionOrigin(e,"key")}};editHandlers.keyup=function(e,t){if(t.keyCode==16){e.shiftKey=false}};editHandlers.keypress=function(e,t){if(inOrNearComposition(e,t)||!t.charCode||t.ctrlKey&&!t.altKey||result$1.mac&&t.metaKey){return}if(e.someProp("handleKeyPress",(function(r){return r(e,t)}))){t.preventDefault();return}var r=e.state.selection;if(!(r instanceof TextSelection)||!r.$from.sameParent(r.$to)){var n=String.fromCharCode(t.charCode);if(!e.someProp("handleTextInput",(function(t){return t(e,r.$from.pos,r.$to.pos,n)}))){e.dispatch(e.state.tr.insertText(n).scrollIntoView())}t.preventDefault()}};function eventCoords(e){return{left:e.clientX,top:e.clientY}}function isNear(e,t){var r=t.x-e.clientX,n=t.y-e.clientY;return r*r+n*n<100}function runHandlerOnContext(e,t,r,n,o){if(n==-1){return false}var i=e.state.doc.resolve(n);var a=function(n){if(e.someProp(t,(function(t){return n>i.depth?t(e,r,i.nodeAfter,i.before(n),o,true):t(e,r,i.node(n),i.before(n),o,false)}))){return{v:true}}};for(var s=i.depth+1;s>0;s--){var l=a(s);if(l)return l.v}return false}function updateSelection(e,t,r){if(!e.focused){e.focus()}var n=e.state.tr.setSelection(t);if(r=="pointer"){n.setMeta("pointer",true)}e.dispatch(n)}function selectClickedLeaf(e,t){if(t==-1){return false}var r=e.state.doc.resolve(t),n=r.nodeAfter;if(n&&n.isAtom&&NodeSelection.isSelectable(n)){updateSelection(e,new NodeSelection(r),"pointer");return true}return false}function selectClickedNode(e,t){if(t==-1){return false}var r=e.state.selection,n,o;if(r instanceof NodeSelection){n=r.node}var i=e.state.doc.resolve(t);for(var a=i.depth+1;a>0;a--){var s=a>i.depth?i.nodeAfter:i.node(a);if(NodeSelection.isSelectable(s)){if(n&&r.$from.depth>0&&a>=r.$from.depth&&i.before(r.$from.depth+1)==r.$from.pos){o=i.before(r.$from.depth)}else{o=i.before(a)}break}}if(o!=null){updateSelection(e,NodeSelection.create(e.state.doc,o),"pointer");return true}else{return false}}function handleSingleClick(e,t,r,n,o){return runHandlerOnContext(e,"handleClickOn",t,r,n)||e.someProp("handleClick",(function(r){return r(e,t,n)}))||(o?selectClickedNode(e,r):selectClickedLeaf(e,r))}function handleDoubleClick(e,t,r,n){return runHandlerOnContext(e,"handleDoubleClickOn",t,r,n)||e.someProp("handleDoubleClick",(function(r){return r(e,t,n)}))}function handleTripleClick(e,t,r,n){return runHandlerOnContext(e,"handleTripleClickOn",t,r,n)||e.someProp("handleTripleClick",(function(r){return r(e,t,n)}))||defaultTripleClick(e,r)}function defaultTripleClick(e,t){var r=e.state.doc;if(t==-1){if(r.inlineContent){updateSelection(e,TextSelection.create(r,0,r.content.size),"pointer");return true}return false}var n=r.resolve(t);for(var o=n.depth+1;o>0;o--){var i=o>n.depth?n.nodeAfter:n.node(o);var a=n.before(o);if(i.inlineContent){updateSelection(e,TextSelection.create(r,a+1,a+1+i.content.size),"pointer")}else if(NodeSelection.isSelectable(i)){updateSelection(e,NodeSelection.create(r,a),"pointer")}else{continue}return true}}function forceDOMFlush(e){return endComposition(e)}var selectNodeModifier=result$1.mac?"metaKey":"ctrlKey";handlers.mousedown=function(e,t){e.shiftKey=t.shiftKey;var r=forceDOMFlush(e);var n=Date.now(),o="singleClick";if(n-e.lastClick.time<500&&isNear(t,e.lastClick)&&!t[selectNodeModifier]){if(e.lastClick.type=="singleClick"){o="doubleClick"}else if(e.lastClick.type=="doubleClick"){o="tripleClick"}}e.lastClick={time:n,x:t.clientX,y:t.clientY,type:o};var i=e.posAtCoords(eventCoords(t));if(!i){return}if(o=="singleClick"){e.mouseDown=new MouseDown(e,i,t,r)}else if((o=="doubleClick"?handleDoubleClick:handleTripleClick)(e,i.pos,i.inside,t)){t.preventDefault()}else{setSelectionOrigin(e,"pointer")}};var MouseDown=function e(t,r,n,o){var i=this;this.view=t;this.startDoc=t.state.doc;this.pos=r;this.event=n;this.flushed=o;this.selectNode=n[selectNodeModifier];this.allowDefault=n.shiftKey;var a,s;if(r.inside>-1){a=t.state.doc.nodeAt(r.inside);s=r.inside}else{var l=t.state.doc.resolve(r.pos);a=l.parent;s=l.depth?l.before():0}this.mightDrag=null;var c=o?null:n.target;var u=c?t.docView.nearestDesc(c,true):null;this.target=u?u.dom:null;if(a.type.spec.draggable&&a.type.spec.selectable!==false||t.state.selection instanceof NodeSelection&&s==t.state.selection.from){this.mightDrag={node:a,pos:s,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&result$1.gecko&&!this.target.hasAttribute("contentEditable")}}if(this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)){this.view.domObserver.stop();if(this.mightDrag.addAttr){this.target.draggable=true}if(this.mightDrag.setUneditable){setTimeout((function(){return i.target.setAttribute("contentEditable","false")}),20)}this.view.domObserver.start()}t.root.addEventListener("mouseup",this.up=this.up.bind(this));t.root.addEventListener("mousemove",this.move=this.move.bind(this));setSelectionOrigin(t,"pointer")};MouseDown.prototype.done=function e(){this.view.root.removeEventListener("mouseup",this.up);this.view.root.removeEventListener("mousemove",this.move);if(this.mightDrag&&this.target){this.view.domObserver.stop();if(this.mightDrag.addAttr){this.target.removeAttribute("draggable")}if(this.mightDrag.setUneditable){this.target.removeAttribute("contentEditable")}this.view.domObserver.start()}this.view.mouseDown=null};MouseDown.prototype.up=function e(t){this.done();if(!this.view.dom.contains(t.target.nodeType==3?t.target.parentNode:t.target)){return}var r=this.pos;if(this.view.state.doc!=this.startDoc){r=this.view.posAtCoords(eventCoords(t))}if(this.allowDefault||!r){setSelectionOrigin(this.view,"pointer")}else if(handleSingleClick(this.view,r.pos,r.inside,t,this.selectNode)){t.preventDefault()}else if(this.flushed||result$1.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||result$1.chrome&&!(this.view.state.selection instanceof TextSelection)&&(r.pos==this.view.state.selection.from||r.pos==this.view.state.selection.to)){updateSelection(this.view,Selection.near(this.view.state.doc.resolve(r.pos)),"pointer");t.preventDefault()}else{setSelectionOrigin(this.view,"pointer")}};MouseDown.prototype.move=function e(t){if(!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)){this.allowDefault=true}setSelectionOrigin(this.view,"pointer")};handlers.touchdown=function(e){forceDOMFlush(e);setSelectionOrigin(e,"pointer")};handlers.contextmenu=function(e){return forceDOMFlush(e)};function inOrNearComposition(e,t){if(e.composing){return true}if(result$1.safari&&Math.abs(t.timeStamp-e.compositionEndedAt)<500){e.compositionEndedAt=-2e8;return true}return false}var timeoutComposition=result$1.android?5e3:-1;editHandlers.compositionstart=editHandlers.compositionupdate=function(e){if(!e.composing){e.domObserver.flush();var t=e.state;var r=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some((function(e){return e.type.spec.inclusive===false})))){e.markCursor=e.state.storedMarks||r.marks();endComposition(e,true);e.markCursor=null}else{endComposition(e);if(result$1.gecko&&t.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){var n=e.root.getSelection();for(var o=n.focusNode,i=n.focusOffset;o&&o.nodeType==1&&i!=0;){var a=i<0?o.lastChild:o.childNodes[i-1];if(!a){break}if(a.nodeType==3){n.collapse(a,a.nodeValue.length);break}else{o=a;i=-1}}}}e.composing=true}scheduleComposeEnd(e,timeoutComposition)};editHandlers.compositionend=function(e,t){if(e.composing){e.composing=false;e.compositionEndedAt=t.timeStamp;scheduleComposeEnd(e,20)}};function scheduleComposeEnd(e,t){clearTimeout(e.composingTimeout);if(t>-1){e.composingTimeout=setTimeout((function(){return endComposition(e)}),t)}}function clearComposition(e){e.composing=false;while(e.compositionNodes.length>0){e.compositionNodes.pop().markParentsDirty()}}function endComposition(e,t){e.domObserver.forceFlush();clearComposition(e);if(t||e.docView.dirty){var r=selectionFromDOM(e);if(r&&!r.eq(e.state.selection)){e.dispatch(e.state.tr.setSelection(r))}else{e.updateState(e.state)}return true}return false}function captureCopy(e,t){if(!e.dom.parentNode){return}var r=e.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(t);r.style.cssText="position: fixed; left: -10000px; top: 10px";var n=getSelection(),o=document.createRange();o.selectNodeContents(t);e.dom.blur();n.removeAllRanges();n.addRange(o);setTimeout((function(){if(r.parentNode){r.parentNode.removeChild(r)}e.focus()}),50)}var brokenClipboardAPI=result$1.ie&&result$1.ie_version<15||result$1.ios&&result$1.webkit_version<604;handlers.copy=editHandlers.cut=function(e,t){var r=e.state.selection,n=t.type=="cut";if(r.empty){return}var o=brokenClipboardAPI?null:t.clipboardData;var i=r.content();var a=serializeForClipboard(e,i);var s=a.dom;var l=a.text;if(o){t.preventDefault();o.clearData();o.setData("text/html",s.innerHTML);o.setData("text/plain",l)}else{captureCopy(e,s)}if(n){e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function sliceSingleNode(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function capturePaste(e,t){if(!e.dom.parentNode){return}var r=e.shiftKey||e.state.selection.$from.parent.type.spec.code;var n=e.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));if(!r){n.contentEditable="true"}n.style.cssText="position: fixed; left: -10000px; top: 10px";n.focus();setTimeout((function(){e.focus();if(n.parentNode){n.parentNode.removeChild(n)}if(r){doPaste(e,n.value,null,t)}else{doPaste(e,n.textContent,n.innerHTML,t)}}),50)}function doPaste(e,t,r,n){var o=parseFromClipboard(e,t,r,e.shiftKey,e.state.selection.$from);if(e.someProp("handlePaste",(function(t){return t(e,n,o||Slice.empty)}))){return true}if(!o){return false}var i=sliceSingleNode(o);var a=i?e.state.tr.replaceSelectionWith(i,e.shiftKey):e.state.tr.replaceSelection(o);e.dispatch(a.scrollIntoView().setMeta("paste",true).setMeta("uiEvent","paste"));hurmet.updateCalculations(e,e.state.schema.nodes.calculation,true);return true}editHandlers.paste=function(e,t){var r=brokenClipboardAPI?null:t.clipboardData;if(r&&doPaste(e,r.getData("text/plain"),r.getData("text/html"),t)){t.preventDefault()}else{capturePaste(e,t)}};var Dragging=function e(t,r){this.slice=t;this.move=r};var dragCopyModifier=result$1.mac?"altKey":"ctrlKey";handlers.dragstart=function(e,t){var r=e.mouseDown;if(r){r.done()}if(!t.dataTransfer){return}var n=e.state.selection;var o=n.empty?null:e.posAtCoords(eventCoords(t));if(o&&o.pos>=n.from&&o.pos<=(n instanceof NodeSelection?n.to-1:n.to));else if(r&&r.mightDrag){e.dispatch(e.state.tr.setSelection(NodeSelection.create(e.state.doc,r.mightDrag.pos)))}else if(t.target&&t.target.nodeType==1){var i=e.docView.nearestDesc(t.target,true);if(!i||!i.node.type.spec.draggable||i==e.docView){return}e.dispatch(e.state.tr.setSelection(NodeSelection.create(e.state.doc,i.posBefore)))}var a=e.state.selection.content();var s=serializeForClipboard(e,a);var l=s.dom;var c=s.text;t.dataTransfer.clearData();t.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",l.innerHTML);if(!brokenClipboardAPI){t.dataTransfer.setData("text/plain",c)}e.dragging=new Dragging(a,!t[dragCopyModifier])};handlers.dragend=function(e){var t=e.dragging;window.setTimeout((function(){if(e.dragging==t){e.dragging=null}}),50)};editHandlers.dragover=editHandlers.dragenter=function(e,t){return t.preventDefault()};editHandlers.drop=function(e,t){var r=e.dragging;e.dragging=null;if(!t.dataTransfer){return}var n=e.posAtCoords(eventCoords(t));if(!n){return}var o=e.state.doc.resolve(n.pos);if(!o){return}var i=r&&r.slice||parseFromClipboard(e,t.dataTransfer.getData(brokenClipboardAPI?"Text":"text/plain"),brokenClipboardAPI?null:t.dataTransfer.getData("text/html"),false,o);var a=r&&!t[dragCopyModifier];if(e.someProp("handleDrop",(function(r){return r(e,t,i||Slice.empty,a)}))){t.preventDefault();return}if(!i){return}t.preventDefault();var s=i?dropPoint(e.state.doc,o.pos,i):o.pos;if(s==null){s=o.pos}var l=e.state.tr;if(a){l.deleteSelection()}var c=l.mapping.map(s);var u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1;var p=l.doc;if(u){l.replaceRangeWith(c,c,i.content.firstChild)}else{l.replaceRange(c,c,i)}if(l.doc.eq(p)){return}var f=l.doc.resolve(c);if(u&&NodeSelection.isSelectable(i.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(i.content.firstChild)){l.setSelection(new NodeSelection(f))}else{var d=l.mapping.map(s);l.mapping.maps[l.mapping.maps.length-1].forEach((function(e,t,r,n){return d=n}));l.setSelection(selectionBetween(e,f,l.doc.resolve(d)))}e.focus();e.dispatch(l.setMeta("uiEvent","drop"))};handlers.focus=function(e){if(!e.focused){e.domObserver.stop();e.dom.classList.add("ProseMirror-focused");e.domObserver.start();e.focused=true;setTimeout((function(){if(e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.root.getSelection())){selectionToDOM(e)}}),20)}};handlers.blur=function(e){if(e.focused){e.domObserver.stop();e.dom.classList.remove("ProseMirror-focused");e.domObserver.start();e.domObserver.currentSelection.set({});e.focused=false}};handlers.beforeinput=function(e,t){if(result$1.chrome&&result$1.android&&t.inputType=="deleteContentBackward"){var r=e.domChangeCount;setTimeout((function(){if(e.domChangeCount!=r){return}e.dom.blur();e.focus();if(e.someProp("handleKeyDown",(function(t){return t(e,keyEvent(8,"Backspace"))}))){return}var t=e.state.selection;var n=t.$cursor;if(n&&n.pos>0){e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}}),50)}};for(var prop in editHandlers){handlers[prop]=editHandlers[prop]}function compareObjs(e,t){if(e==t){return true}for(var r in e){if(e[r]!==t[r]){return false}}for(var n in t){if(!(n in e)){return false}}return true}var WidgetType=function e(t,r){this.spec=r||noSpec;this.side=this.spec.side||0;this.toDOM=t};WidgetType.prototype.map=function e(t,r,n,o){var i=t.mapResult(r.from+o,this.side<0?-1:1);var a=i.pos;var s=i.deleted;return s?null:new Decoration(a-n,a-n,this)};WidgetType.prototype.valid=function e(){return true};WidgetType.prototype.eq=function e(t){return this==t||t instanceof WidgetType&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&compareObjs(this.spec,t.spec))};var InlineType=function e(t,r){this.spec=r||noSpec;this.attrs=t};InlineType.prototype.map=function e(t,r,n,o){var i=t.map(r.from+o,this.spec.inclusiveStart?-1:1)-n;var a=t.map(r.to+o,this.spec.inclusiveEnd?1:-1)-n;return i>=a?null:new Decoration(i,a,this)};InlineType.prototype.valid=function e(t,r){return r.from<r.to};InlineType.prototype.eq=function e(t){return this==t||t instanceof InlineType&&compareObjs(this.attrs,t.attrs)&&compareObjs(this.spec,t.spec)};InlineType.is=function e(t){return t.type instanceof InlineType};var NodeType$1=function e(t,r){this.spec=r||noSpec;this.attrs=t};NodeType$1.prototype.map=function e(t,r,n,o){var i=t.mapResult(r.from+o,1);if(i.deleted){return null}var a=t.mapResult(r.to+o,-1);if(a.deleted||a.pos<=i.pos){return null}return new Decoration(i.pos-n,a.pos-n,this)};NodeType$1.prototype.valid=function e(t,r){var n=t.content.findIndex(r.from);var o=n.index;var i=n.offset;return i==r.from&&i+t.child(o).nodeSize==r.to};NodeType$1.prototype.eq=function e(t){return this==t||t instanceof NodeType$1&&compareObjs(this.attrs,t.attrs)&&compareObjs(this.spec,t.spec)};var Decoration=function e(t,r,n){this.from=t;this.to=r;this.type=n};var prototypeAccessors$1$6={spec:{configurable:true},inline:{configurable:true}};Decoration.prototype.copy=function e(t,r){return new Decoration(t,r,this.type)};Decoration.prototype.eq=function e(t,r){if(r===void 0)r=0;return this.type.eq(t.type)&&this.from+r==t.from&&this.to+r==t.to};Decoration.prototype.map=function e(t,r,n){return this.type.map(t,this,r,n)};Decoration.widget=function e(t,r,n){return new Decoration(t,t,new WidgetType(r,n))};Decoration.inline=function e(t,r,n,o){return new Decoration(t,r,new InlineType(n,o))};Decoration.node=function e(t,r,n,o){return new Decoration(t,r,new NodeType$1(n,o))};prototypeAccessors$1$6.spec.get=function(){return this.type.spec};prototypeAccessors$1$6.inline.get=function(){return this.type instanceof InlineType};Object.defineProperties(Decoration.prototype,prototypeAccessors$1$6);var none=[],noSpec={};var DecorationSet=function e(t,r){this.local=t&&t.length?t:none;this.children=r&&r.length?r:none};DecorationSet.create=function e(t,r){return r.length?buildTree(r,t,0,noSpec):empty};DecorationSet.prototype.find=function e(t,r,n){var o=[];this.findInner(t==null?0:t,r==null?1e9:r,o,0,n);return o};DecorationSet.prototype.findInner=function e(t,r,n,o,i){for(var a=0;a<this.local.length;a++){var s=this.local[a];if(s.from<=r&&s.to>=t&&(!i||i(s.spec))){n.push(s.copy(s.from+o,s.to+o))}}for(var l=0;l<this.children.length;l+=3){if(this.children[l]<r&&this.children[l+1]>t){var c=this.children[l]+1;this.children[l+2].findInner(t-c,r-c,n,o+c,i)}}};DecorationSet.prototype.map=function e(t,r,n){if(this==empty||t.maps.length==0){return this}return this.mapInner(t,r,0,0,n||noSpec)};DecorationSet.prototype.mapInner=function e(t,r,n,o,i){var a;for(var s=0;s<this.local.length;s++){var l=this.local[s].map(t,n,o);if(l&&l.type.valid(r,l)){(a||(a=[])).push(l)}else if(i.onRemove){i.onRemove(this.local[s].spec)}}if(this.children.length){return mapChildren(this.children,a,t,r,n,o,i)}else{return a?new DecorationSet(a.sort(byPos)):empty}};DecorationSet.prototype.add=function e(t,r){if(!r.length){return this}if(this==empty){return DecorationSet.create(t,r)}return this.addInner(t,r,0)};DecorationSet.prototype.addInner=function e(t,r,n){var o=this;var i,a=0;t.forEach((function(e,t){var s=t+n,l;if(!(l=takeSpansForNode(r,e,s))){return}if(!i){i=o.children.slice()}while(a<i.length&&i[a]<t){a+=3}if(i[a]==t){i[a+2]=i[a+2].addInner(e,l,s+1)}else{i.splice(a,0,t,t+e.nodeSize,buildTree(l,e,s+1,noSpec))}a+=3}));var s=moveSpans(a?withoutNulls(r):r,-n);return new DecorationSet(s.length?this.local.concat(s).sort(byPos):this.local,i||this.children)};DecorationSet.prototype.remove=function e(t){if(t.length==0||this==empty){return this}return this.removeInner(t,0)};DecorationSet.prototype.removeInner=function e(t,r){var n=this.children,o=this.local;for(var i=0;i<n.length;i+=3){var a=void 0,s=n[i]+r,l=n[i+1]+r;for(var c=0,u=void 0;c<t.length;c++){if(u=t[c]){if(u.from>s&&u.to<l){t[c]=null;(a||(a=[])).push(u)}}}if(!a){continue}if(n==this.children){n=this.children.slice()}var p=n[i+2].removeInner(a,s+1);if(p!=empty){n[i+2]=p}else{n.splice(i,3);i-=3}}if(o.length){for(var f=0,d=void 0;f<t.length;f++){if(d=t[f]){for(var h=0;h<o.length;h++){if(o[h].eq(d,r)){if(o==this.local){o=this.local.slice()}o.splice(h--,1)}}}}}if(n==this.children&&o==this.local){return this}return o.length||n.length?new DecorationSet(o,n):empty};DecorationSet.prototype.forChild=function e(t,r){if(this==empty){return this}if(r.isLeaf){return DecorationSet.empty}var n,o;for(var i=0;i<this.children.length;i+=3){if(this.children[i]>=t){if(this.children[i]==t){n=this.children[i+2]}break}}var a=t+1,s=a+r.content.size;for(var l=0;l<this.local.length;l++){var c=this.local[l];if(c.from<s&&c.to>a&&c.type instanceof InlineType){var u=Math.max(a,c.from)-a,p=Math.min(s,c.to)-a;if(u<p){(o||(o=[])).push(c.copy(u,p))}}}if(o){var f=new DecorationSet(o.sort(byPos));return n?new DecorationGroup([f,n]):f}return n||empty};DecorationSet.prototype.eq=function e(t){if(this==t){return true}if(!(t instanceof DecorationSet)||this.local.length!=t.local.length||this.children.length!=t.children.length){return false}for(var r=0;r<this.local.length;r++){if(!this.local[r].eq(t.local[r])){return false}}for(var n=0;n<this.children.length;n+=3){if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2])){return false}}return true};DecorationSet.prototype.locals=function e(t){return removeOverlap(this.localsInner(t))};DecorationSet.prototype.localsInner=function e(t){if(this==empty){return none}if(t.inlineContent||!this.local.some(InlineType.is)){return this.local}var r=[];for(var n=0;n<this.local.length;n++){if(!(this.local[n].type instanceof InlineType)){r.push(this.local[n])}}return r};var empty=new DecorationSet;DecorationSet.empty=empty;DecorationSet.removeOverlap=removeOverlap;var DecorationGroup=function e(t){this.members=t};DecorationGroup.prototype.forChild=function e(t,r){if(r.isLeaf){return DecorationSet.empty}var n=[];for(var o=0;o<this.members.length;o++){var i=this.members[o].forChild(t,r);if(i==empty){continue}if(i instanceof DecorationGroup){n=n.concat(i.members)}else{n.push(i)}}return DecorationGroup.from(n)};DecorationGroup.prototype.eq=function e(t){if(!(t instanceof DecorationGroup)||t.members.length!=this.members.length){return false}for(var r=0;r<this.members.length;r++){if(!this.members[r].eq(t.members[r])){return false}}return true};DecorationGroup.prototype.locals=function e(t){var r,n=true;for(var o=0;o<this.members.length;o++){var e=this.members[o].localsInner(t);if(!e.length){continue}if(!r){r=e}else{if(n){r=r.slice();n=false}for(var i=0;i<e.length;i++){r.push(e[i])}}}return r?removeOverlap(n?r:r.sort(byPos)):none};DecorationGroup.from=function e(t){switch(t.length){case 0:return empty;case 1:return t[0];default:return new DecorationGroup(t)}};function mapChildren(e,t,r,n,o,i,a){var s=e.slice();var l=function(e,t,r,n){for(var a=0;a<s.length;a+=3){var l=s[a+1],c=void 0;if(l==-1||e>l+i){continue}if(t>=s[a]+i){s[a+1]=-1}else if(r>=o&&(c=n-r-(t-e))){s[a]+=c;s[a+1]+=c}}};for(var c=0;c<r.maps.length;c++){r.maps[c].forEach(l)}var u=false;for(var p=0;p<s.length;p+=3){if(s[p+1]==-1){var f=r.map(e[p]+i),d=f-o;if(d<0||d>=n.content.size){u=true;continue}var h=r.map(e[p+1]+i,-1),m=h-o;var v=n.content.findIndex(d);var g=v.index;var y=v.offset;var b=n.maybeChild(g);if(b&&y==d&&y+b.nodeSize==m){var w=s[p+2].mapInner(r,b,f+1,e[p]+i+1,a);if(w!=empty){s[p]=d;s[p+1]=m;s[p+2]=w}else{s[p+1]=-2;u=true}}else{u=true}}}if(u){var S=mapAndGatherRemainingDecorations(s,e,t||[],r,o,i,a);var C=buildTree(S,n,0,a);t=C.local;for(var R=0;R<s.length;R+=3){if(s[R+1]<0){s.splice(R,3);R-=3}}for(var M=0,x=0;M<C.children.length;M+=3){var T=C.children[M];while(x<s.length&&s[x]<T){x+=3}s.splice(x,0,C.children[M],C.children[M+1],C.children[M+2])}}return new DecorationSet(t&&t.sort(byPos),s)}function moveSpans(e,t){if(!t||!e.length){return e}var r=[];for(var n=0;n<e.length;n++){var o=e[n];r.push(new Decoration(o.from+t,o.to+t,o.type))}return r}function mapAndGatherRemainingDecorations(e,t,r,n,o,i,a){function s(e,t){for(var i=0;i<e.local.length;i++){var l=e.local[i].map(n,o,t);if(l){r.push(l)}else if(a.onRemove){a.onRemove(e.local[i].spec)}}for(var c=0;c<e.children.length;c+=3){s(e.children[c+2],e.children[c]+t+1)}}for(var l=0;l<e.length;l+=3){if(e[l+1]==-1){s(e[l+2],t[l]+i+1)}}return r}function takeSpansForNode(e,t,r){if(t.isLeaf){return null}var n=r+t.nodeSize,o=null;for(var i=0,a=void 0;i<e.length;i++){if((a=e[i])&&a.from>r&&a.to<n){(o||(o=[])).push(a);e[i]=null}}return o}function withoutNulls(e){var t=[];for(var r=0;r<e.length;r++){if(e[r]!=null){t.push(e[r])}}return t}function buildTree(e,t,r,n){var o=[],i=false;t.forEach((function(t,a){var s=takeSpansForNode(e,t,a+r);if(s){i=true;var l=buildTree(s,t,r+a+1,n);if(l!=empty){o.push(a,a+t.nodeSize,l)}}}));var a=moveSpans(i?withoutNulls(e):e,-r).sort(byPos);for(var s=0;s<a.length;s++){if(!a[s].type.valid(t,a[s])){if(n.onRemove){n.onRemove(a[s].spec)}a.splice(s--,1)}}return a.length||o.length?new DecorationSet(a,o):empty}function byPos(e,t){return e.from-t.from||e.to-t.to}function removeOverlap(e){var t=e;for(var r=0;r<t.length-1;r++){var n=t[r];if(n.from!=n.to){for(var o=r+1;o<t.length;o++){var i=t[o];if(i.from==n.from){if(i.to!=n.to){if(t==e){t=e.slice()}t[o]=i.copy(i.from,n.to);insertAhead(t,o+1,i.copy(n.to,i.to))}continue}else{if(i.from<n.to){if(t==e){t=e.slice()}t[r]=n.copy(n.from,i.from);insertAhead(t,o,n.copy(i.from,n.to))}break}}}}return t}function insertAhead(e,t,r){while(t<e.length&&byPos(r,e[t])>0){t++}e.splice(t,0,r)}function viewDecorations(e){var t=[];e.someProp("decorations",(function(r){var n=r(e.state);if(n&&n!=empty){t.push(n)}}));if(e.cursorWrapper){t.push(DecorationSet.create(e.state.doc,[e.cursorWrapper.deco]))}return DecorationGroup.from(t)}var EditorView=function e(t,r){this._props=r;this.state=r.state;this.dispatch=this.dispatch.bind(this);this._root=null;this.focused=false;this.trackWrites=null;this.dom=t&&t.mount||document.createElement("div");if(t){if(t.appendChild){t.appendChild(this.dom)}else if(t.apply){t(this.dom)}else if(t.mount){this.mounted=true}}this.editable=getEditable(this);this.markCursor=null;this.cursorWrapper=null;updateCursorWrapper(this);this.nodeViews=buildNodeViews(this);this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this);this.lastSelectedViewDesc=null;this.dragging=null;initInput(this);this.pluginViews=[];this.updatePluginViews()};var prototypeAccessors$2$1={props:{configurable:true},root:{configurable:true}};prototypeAccessors$2$1.props.get=function(){if(this._props.state!=this.state){var e=this._props;this._props={};for(var t in e){this._props[t]=e[t]}this._props.state=this.state}return this._props};EditorView.prototype.update=function e(t){if(t.handleDOMEvents!=this._props.handleDOMEvents){ensureListeners(this)}this._props=t;this.updateStateInner(t.state,true)};EditorView.prototype.setProps=function e(t){var r={};for(var n in this._props){r[n]=this._props[n]}r.state=this.state;for(var o in t){r[o]=t[o]}this.update(r)};EditorView.prototype.updateState=function e(t){this.updateStateInner(t,this.state.plugins!=t.plugins)};EditorView.prototype.updateStateInner=function e(t,r){var n=this;var o=this.state,i=false,a=false;if(t.storedMarks&&this.composing){clearComposition(this);a=true}this.state=t;if(r){var s=buildNodeViews(this);if(changedNodeViews(s,this.nodeViews)){this.nodeViews=s;i=true}ensureListeners(this)}this.editable=getEditable(this);updateCursorWrapper(this);var l=viewDecorations(this),c=computeDocDeco(this);var u=r?"reset":t.scrollToSelection>o.scrollToSelection?"to selection":"preserve";var p=i||!this.docView.matchesNode(t.doc,c,l);if(p||!t.selection.eq(o.selection)){a=true}var f=u=="preserve"&&a&&this.dom.style.overflowAnchor==null&&storeScrollPos(this);if(a){this.domObserver.stop();var d=p&&(result$1.ie||result$1.chrome)&&!this.composing&&!o.selection.empty&&!t.selection.empty&&selectionContextChanged(o.selection,t.selection);if(p){var h=result$1.chrome?this.trackWrites=this.root.getSelection().focusNode:null;if(i||!this.docView.update(t.doc,c,l,this)){this.docView.updateOuterDeco([]);this.docView.destroy();this.docView=docViewDesc(t.doc,c,l,this.dom,this)}if(h&&!this.trackWrites){d=true}}if(d||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&anchorInRightPlace(this))){selectionToDOM(this,d)}else{syncNodeSelection(this,t.selection);this.domObserver.setCurSelection()}this.domObserver.start()}this.updatePluginViews(o);if(u=="reset"){this.dom.scrollTop=0}else if(u=="to selection"){var m=this.root.getSelection().focusNode;if(this.someProp("handleScrollToSelection",(function(e){return e(n)})));else if(t.selection instanceof NodeSelection){scrollRectIntoView(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect(),m)}else{scrollRectIntoView(this,this.coordsAtPos(t.selection.head,1),m)}}else if(f){resetScrollPos(f)}};EditorView.prototype.destroyPluginViews=function e(){var t;while(t=this.pluginViews.pop()){if(t.destroy){t.destroy()}}};EditorView.prototype.updatePluginViews=function e(t){if(!t||t.plugins!=this.state.plugins){this.destroyPluginViews();for(var r=0;r<this.state.plugins.length;r++){var n=this.state.plugins[r];if(n.spec.view){this.pluginViews.push(n.spec.view(this))}}}else{for(var o=0;o<this.pluginViews.length;o++){var i=this.pluginViews[o];if(i.update){i.update(this,t)}}}};EditorView.prototype.someProp=function e(t,r){var n=this._props&&this._props[t],o;if(n!=null&&(o=r?r(n):n)){return o}var i=this.state.plugins;if(i){for(var a=0;a<i.length;a++){var s=i[a].props[t];if(s!=null&&(o=r?r(s):s)){return o}}}};EditorView.prototype.hasFocus=function e(){return this.root.activeElement==this.dom};EditorView.prototype.focus=function e(){this.domObserver.stop();if(this.editable){focusPreventScroll(this.dom)}selectionToDOM(this);this.domObserver.start()};prototypeAccessors$2$1.root.get=function(){var e=this._root;if(e==null){for(var t=this.dom.parentNode;t;t=t.parentNode){if(t.nodeType==9||t.nodeType==11&&t.host){if(!t.getSelection){Object.getPrototypeOf(t).getSelection=function(){return document.getSelection()}}return this._root=t}}}return e||document};EditorView.prototype.posAtCoords=function e(t){return posAtCoords(this,t)};EditorView.prototype.coordsAtPos=function e(t,r){if(r===void 0)r=1;return coordsAtPos(this,t,r)};EditorView.prototype.domAtPos=function e(t,r){if(r===void 0)r=0;return this.docView.domFromPos(t,r)};EditorView.prototype.nodeDOM=function e(t){var r=this.docView.descAt(t);return r?r.nodeDOM:null};EditorView.prototype.posAtDOM=function e(t,r,n){if(n===void 0)n=-1;var o=this.docView.posFromDOM(t,r,n);if(o==null){throw new RangeError("DOM position not inside the editor")}return o};EditorView.prototype.endOfTextblock=function e(t,r){return endOfTextblock(this,r||this.state,t)};EditorView.prototype.destroy=function e(){if(!this.docView){return}destroyInput(this);this.destroyPluginViews();if(this.mounted){this.docView.update(this.state.doc,[],viewDecorations(this),this);this.dom.textContent=""}else if(this.dom.parentNode){this.dom.parentNode.removeChild(this.dom)}this.docView.destroy();this.docView=null};EditorView.prototype.dispatchEvent=function e(t){return dispatchEvent(this,t)};EditorView.prototype.dispatch=function e(t){var r=this._props.dispatchTransaction;if(r){r.call(this,t)}else{this.updateState(this.state.apply(t))}};Object.defineProperties(EditorView.prototype,prototypeAccessors$2$1);function computeDocDeco(e){var t=Object.create(null);t.class="ProseMirror";t.contenteditable=String(e.editable);e.someProp("attributes",(function(r){if(typeof r=="function"){r=r(e.state)}if(r){for(var n in r){if(n=="class"){t.class+=" "+r[n]}else if(!t[n]&&n!="contenteditable"&&n!="nodeName"){t[n]=String(r[n])}}}}));return[Decoration.node(0,e.state.doc.content.size,t)]}function updateCursorWrapper(e){if(e.markCursor){var t=document.createElement("img");t.setAttribute("mark-placeholder","true");e.cursorWrapper={dom:t,deco:Decoration.widget(e.state.selection.head,t,{raw:true,marks:e.markCursor})}}else{e.cursorWrapper=null}}function getEditable(e){return!e.someProp("editable",(function(t){return t(e.state)===false}))}function selectionContextChanged(e,t){var r=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(r)!=t.$anchor.start(r)}function buildNodeViews(e){var t={};e.someProp("nodeViews",(function(e){for(var r in e){if(!Object.prototype.hasOwnProperty.call(t,r)){t[r]=e[r]}}}));return t}function changedNodeViews(e,t){var r=0,n=0;for(var o in e){if(e[o]!=t[o]){return true}r++}for(var i in t){n++}return r!=n}var GOOD_LEAF_SIZE=200;var RopeSequence=function e(){};RopeSequence.prototype.append=function e(t){if(!t.length){return this}t=RopeSequence.from(t);return!this.length&&t||t.length<GOOD_LEAF_SIZE&&this.leafAppend(t)||this.length<GOOD_LEAF_SIZE&&t.leafPrepend(this)||this.appendInner(t)};RopeSequence.prototype.prepend=function e(t){if(!t.length){return this}return RopeSequence.from(t).append(this)};RopeSequence.prototype.appendInner=function e(t){return new Append(this,t)};RopeSequence.prototype.slice=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.length;if(t>=r){return RopeSequence.empty}return this.sliceInner(Math.max(0,t),Math.min(this.length,r))};RopeSequence.prototype.get=function e(t){if(t<0||t>=this.length){return undefined}return this.getInner(t)};RopeSequence.prototype.forEach=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=this.length;if(r<=n){this.forEachInner(t,r,n,0)}else{this.forEachInvertedInner(t,r,n,0)}};RopeSequence.prototype.map=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=this.length;var o=[];this.forEach((function(e,r){return o.push(t(e,r))}),r,n);return o};RopeSequence.from=function e(t){if(t instanceof RopeSequence){return t}return t&&t.length?new Leaf(t):RopeSequence.empty};var Leaf=function(e){function t(t){e.call(this);this.values=t}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={length:{configurable:true},depth:{configurable:true}};t.prototype.flatten=function e(){return this.values};t.prototype.sliceInner=function e(r,n){if(r==0&&n==this.length){return this}return new t(this.values.slice(r,n))};t.prototype.getInner=function e(t){return this.values[t]};t.prototype.forEachInner=function e(t,r,n,o){for(var i=r;i<n;i++){if(t(this.values[i],o+i)===false){return false}}};t.prototype.forEachInvertedInner=function e(t,r,n,o){for(var i=r-1;i>=n;i--){if(t(this.values[i],o+i)===false){return false}}};t.prototype.leafAppend=function e(r){if(this.length+r.length<=GOOD_LEAF_SIZE){return new t(this.values.concat(r.flatten()))}};t.prototype.leafPrepend=function e(r){if(this.length+r.length<=GOOD_LEAF_SIZE){return new t(r.flatten().concat(this.values))}};r.length.get=function(){return this.values.length};r.depth.get=function(){return 0};Object.defineProperties(t.prototype,r);return t}(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=function(e){function t(t,r){e.call(this);this.left=t;this.right=r;this.length=t.length+r.length;this.depth=Math.max(t.depth,r.depth)+1}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.flatten=function e(){return this.left.flatten().concat(this.right.flatten())};t.prototype.getInner=function e(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)};t.prototype.forEachInner=function e(t,r,n,o){var i=this.left.length;if(r<i&&this.left.forEachInner(t,r,Math.min(n,i),o)===false){return false}if(n>i&&this.right.forEachInner(t,Math.max(r-i,0),Math.min(this.length,n)-i,o+i)===false){return false}};t.prototype.forEachInvertedInner=function e(t,r,n,o){var i=this.left.length;if(r>i&&this.right.forEachInvertedInner(t,r-i,Math.max(n,i)-i,o+i)===false){return false}if(n<i&&this.left.forEachInvertedInner(t,Math.min(r,i),n,o)===false){return false}};t.prototype.sliceInner=function e(t,r){if(t==0&&r==this.length){return this}var n=this.left.length;if(r<=n){return this.left.slice(t,r)}if(t>=n){return this.right.slice(t-n,r-n)}return this.left.slice(t,n).append(this.right.slice(0,r-n))};t.prototype.leafAppend=function e(r){var n=this.right.leafAppend(r);if(n){return new t(this.left,n)}};t.prototype.leafPrepend=function e(r){var n=this.left.leafPrepend(r);if(n){return new t(n,this.right)}};t.prototype.appendInner=function e(r){if(this.left.depth>=Math.max(this.right.depth,r.depth)+1){return new t(this.left,new t(this.right,r))}return new t(this,r)};return t}(RopeSequence);var ropeSequence=RopeSequence;var max_empty_items=500;var Branch=function e(t,r){this.items=t;this.eventCount=r};Branch.prototype.popEvent=function e(t,r){var n=this;if(this.eventCount==0){return null}var o=this.items.length;for(;;o--){var i=this.items.get(o-1);if(i.selection){--o;break}}var a,s;if(r){a=this.remapping(o,this.items.length);s=a.maps.length}var l=t.tr;var c,u;var p=[],f=[];this.items.forEach((function(e,t){if(!e.step){if(!a){a=n.remapping(o,t+1);s=a.maps.length}s--;f.push(e);return}if(a){f.push(new Item(e.map));var r=e.step.map(a.slice(s)),i;if(r&&l.maybeStep(r).doc){i=l.mapping.maps[l.mapping.maps.length-1];p.push(new Item(i,null,null,p.length+f.length))}s--;if(i){a.appendMap(i,s)}}else{l.maybeStep(e.step)}if(e.selection){c=a?e.selection.map(a.slice(s)):e.selection;u=new Branch(n.items.slice(0,o).append(f.reverse().concat(p)),n.eventCount-1);return false}}),this.items.length,0);return{remaining:u,transform:l,selection:c}};Branch.prototype.addTransform=function e(t,r,n,o){var i=[],a=this.eventCount;var s=this.items,l=!o&&s.length?s.get(s.length-1):null;for(var c=0;c<t.steps.length;c++){var u=t.steps[c].invert(t.docs[c]);var p=new Item(t.mapping.maps[c],u,r),f=void 0;if(f=l&&l.merge(p)){p=f;if(c){i.pop()}else{s=s.slice(0,s.length-1)}}i.push(p);if(r){a++;r=null}if(!o){l=p}}var d=a-n.depth;if(d>DEPTH_OVERFLOW){s=cutOffEvents(s,d);a-=d}return new Branch(s.append(i),a)};Branch.prototype.remapping=function e(t,r){var n=new Mapping;this.items.forEach((function(e,r){var o=e.mirrorOffset!=null&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:null;n.appendMap(e.map,o)}),t,r);return n};Branch.prototype.addMaps=function e(t){if(this.eventCount==0){return this}return new Branch(this.items.append(t.map((function(e){return new Item(e)}))),this.eventCount)};Branch.prototype.rebased=function e(t,r){if(!this.eventCount){return this}var n=[],o=Math.max(0,this.items.length-r);var i=t.mapping;var a=t.steps.length;var s=this.eventCount;this.items.forEach((function(e){if(e.selection){s--}}),o);var l=r;this.items.forEach((function(e){var r=i.getMirror(--l);if(r==null){return}a=Math.min(a,r);var o=i.maps[r];if(e.step){var c=t.steps[r].invert(t.docs[r]);var u=e.selection&&e.selection.map(i.slice(l+1,r));if(u){s++}n.push(new Item(o,c,u))}else{n.push(new Item(o))}}),o);var c=[];for(var u=r;u<a;u++){c.push(new Item(i.maps[u]))}var p=this.items.slice(0,o).append(c).append(n);var f=new Branch(p,s);if(f.emptyItemCount()>max_empty_items){f=f.compress(this.items.length-n.length)}return f};Branch.prototype.emptyItemCount=function e(){var t=0;this.items.forEach((function(e){if(!e.step){t++}}));return t};Branch.prototype.compress=function e(t){if(t===void 0)t=this.items.length;var r=this.remapping(0,t),n=r.maps.length;var o=[],i=0;this.items.forEach((function(e,a){if(a>=t){o.push(e);if(e.selection){i++}}else if(e.step){var s=e.step.map(r.slice(n)),l=s&&s.getMap();n--;if(l){r.appendMap(l,n)}if(s){var c=e.selection&&e.selection.map(r.slice(n));if(c){i++}var u=new Item(l.invert(),s,c),p,f=o.length-1;if(p=o.length&&o[f].merge(u)){o[f]=p}else{o.push(u)}}}else if(e.map){n--}}),this.items.length,0);return new Branch(ropeSequence.from(o.reverse()),i)};Branch.empty=new Branch(ropeSequence.empty,0);function cutOffEvents(e,t){var r;e.forEach((function(e,n){if(e.selection&&t--==0){r=n;return false}}));return e.slice(r)}var Item=function e(t,r,n,o){this.map=t;this.step=r;this.selection=n;this.mirrorOffset=o};Item.prototype.merge=function e(t){if(this.step&&t.step&&!t.selection){var r=t.step.merge(this.step);if(r){return new Item(r.getMap().invert(),r,this.selection)}}};var HistoryState=function e(t,r,n,o){this.done=t;this.undone=r;this.prevRanges=n;this.prevTime=o};var DEPTH_OVERFLOW=20;function applyTransaction(e,t,r,n){var o=r.getMeta(historyKey),i;if(o){return o.historyState}if(r.getMeta(closeHistoryKey)){e=new HistoryState(e.done,e.undone,null,0)}var a=r.getMeta("appendedTransaction");if(r.steps.length==0){return e}else if(a&&a.getMeta(historyKey)){if(a.getMeta(historyKey).redo){return new HistoryState(e.done.addTransform(r,null,n,mustPreserveItems(t)),e.undone,rangesFor(r.mapping.maps[r.steps.length-1]),e.prevTime)}else{return new HistoryState(e.done,e.undone.addTransform(r,null,n,mustPreserveItems(t)),null,e.prevTime)}}else if(r.getMeta("addToHistory")!==false&&!(a&&a.getMeta("addToHistory")===false)){var s=e.prevTime==0||!a&&(e.prevTime<(r.time||0)-n.newGroupDelay||!isAdjacentTo(r,e.prevRanges));var l=a?mapRanges(e.prevRanges,r.mapping):rangesFor(r.mapping.maps[r.steps.length-1]);return new HistoryState(e.done.addTransform(r,s?t.selection.getBookmark():null,n,mustPreserveItems(t)),Branch.empty,l,r.time)}else if(i=r.getMeta("rebased")){return new HistoryState(e.done.rebased(r,i),e.undone.rebased(r,i),mapRanges(e.prevRanges,r.mapping),e.prevTime)}else{return new HistoryState(e.done.addMaps(r.mapping.maps),e.undone.addMaps(r.mapping.maps),mapRanges(e.prevRanges,r.mapping),e.prevTime)}}function isAdjacentTo(e,t){if(!t){return false}if(!e.docChanged){return true}var r=false;e.mapping.maps[0].forEach((function(e,n){for(var o=0;o<t.length;o+=2){if(e<=t[o+1]&&n>=t[o]){r=true}}}));return r}function rangesFor(e){var t=[];e.forEach((function(e,r,n,o){return t.push(n,o)}));return t}function mapRanges(e,t){if(!e){return null}var r=[];for(var n=0;n<e.length;n+=2){var o=t.map(e[n],1),i=t.map(e[n+1],-1);if(o<=i){r.push(o,i)}}return r}function histTransaction(e,t,r,n){var o=mustPreserveItems(t),i=historyKey.get(t).spec.config;var a=(n?e.undone:e.done).popEvent(t,o);if(!a){return}var s=a.selection.resolve(a.transform.doc);var l=(n?e.done:e.undone).addTransform(a.transform,t.selection.getBookmark(),i,o);var c=new HistoryState(n?l:a.remaining,n?a.remaining:l,null,0);r(a.transform.setSelection(s).setMeta(historyKey,{redo:n,historyState:c}).scrollIntoView())}var cachedPreserveItems=false,cachedPreserveItemsPlugins=null;function mustPreserveItems(e){var t=e.plugins;if(cachedPreserveItemsPlugins!=t){cachedPreserveItems=false;cachedPreserveItemsPlugins=t;for(var r=0;r<t.length;r++){if(t[r].spec.historyPreserveItems){cachedPreserveItems=true;break}}}return cachedPreserveItems}var historyKey=new PluginKey("history");var closeHistoryKey=new PluginKey("closeHistory");function history(e){e={depth:e&&e.depth||100,newGroupDelay:e&&e.newGroupDelay||500};return new Plugin({key:historyKey,state:{init:function e(){return new HistoryState(Branch.empty,Branch.empty,null,0)},apply:function t(r,n,o){return applyTransaction(n,o,r,e)}},config:e})}function undo(e,t){var r=historyKey.getState(e);if(!r||r.done.eventCount==0){return false}if(t){histTransaction(r,e,t,false)}return true}function redo(e,t){var r=historyKey.getState(e);if(!r||r.undone.eventCount==0){return false}if(t){histTransaction(r,e,t,true)}return true}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"};var shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};var chrome$1=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);var safari=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor);var gecko=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var mac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ie$1=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);var brokenModifierNames=chrome$1&&(mac||+chrome$1[1]<57)||gecko&&mac;for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++){base[i]=String.fromCharCode(i+32);shift[i]=String.fromCharCode(i)}for(var code in base)if(!shift.hasOwnProperty(code))shift[code]=base[code];function keyName(e){var t=brokenModifierNames&&(e.ctrlKey||e.altKey||e.metaKey)||(safari||ie$1)&&e.shiftKey&&e.key&&e.key.length==1;var r=!t&&e.key||(e.shiftKey?shift:base)[e.keyCode]||e.key||"Unidentified";if(r=="Esc")r="Escape";if(r=="Del")r="Delete";if(r=="Left")r="ArrowLeft";if(r=="Up")r="ArrowUp";if(r=="Right")r="ArrowRight";if(r=="Down")r="ArrowDown";return r}var mac$1=typeof navigator!="undefined"?/Mac/.test(navigator.platform):false;function normalizeKeyName(e){var t=e.split(/-(?!$)/),r=t[t.length-1];if(r=="Space"){r=" "}var n,o,i,a;for(var s=0;s<t.length-1;s++){var l=t[s];if(/^(cmd|meta|m)$/i.test(l)){a=true}else if(/^a(lt)?$/i.test(l)){n=true}else if(/^(c|ctrl|control)$/i.test(l)){o=true}else if(/^s(hift)?$/i.test(l)){i=true}else if(/^mod$/i.test(l)){if(mac$1){a=true}else{o=true}}else{throw new Error("Unrecognized modifier name: "+l)}}if(n){r="Alt-"+r}if(o){r="Ctrl-"+r}if(a){r="Meta-"+r}if(i){r="Shift-"+r}return r}function normalize(e){var t=Object.create(null);for(var r in e){t[normalizeKeyName(r)]=e[r]}return t}function modifiers(e,t,r){if(t.altKey){e="Alt-"+e}if(t.ctrlKey){e="Ctrl-"+e}if(t.metaKey){e="Meta-"+e}if(r!==false&&t.shiftKey){e="Shift-"+e}return e}function keymap(e){return new Plugin({props:{handleKeyDown:keydownHandler(e)}})}function keydownHandler(e){var t=normalize(e);return function(e,r){var n=keyName(r),o=n.length==1&&n!=" ",i;var a=t[modifiers(n,r,!o)];if(a&&a(e.state,e.dispatch,e)){return true}if(o&&(r.shiftKey||r.altKey||r.metaKey||n.charCodeAt(0)>127)&&(i=base[r.keyCode])&&i!=n){var s=t[modifiers(i,r,true)];if(s&&s(e.state,e.dispatch,e)){return true}}else if(o&&r.shiftKey){var l=t[modifiers(n,r,true)];if(l&&l(e.state,e.dispatch,e)){return true}}return false}}var GapCursor=function(e){function t(t){e.call(this,t,t)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function r(n,o){var i=n.resolve(o.map(this.head));return t.valid(i)?new t(i):e.near(i)};t.prototype.content=function e(){return Slice.empty};t.prototype.eq=function e(r){return r instanceof t&&r.head==this.head};t.prototype.toJSON=function e(){return{type:"gapcursor",pos:this.head}};t.fromJSON=function e(r,n){if(typeof n.pos!="number"){throw new RangeError("Invalid input for GapCursor.fromJSON")}return new t(r.resolve(n.pos))};t.prototype.getBookmark=function e(){return new GapBookmark(this.anchor)};t.valid=function e(t){var r=t.parent;if(r.isTextblock||!closedBefore(t)||!closedAfter(t)){return false}var n=r.type.spec.allowGapCursor;if(n!=null){return n}var o=r.contentMatchAt(t.index()).defaultType;return o&&o.isTextblock};t.findFrom=function e(r,n,o){e:for(;;){if(!o&&t.valid(r)){return r}var i=r.pos,a=null;for(var s=r.depth;;s--){var l=r.node(s);if(n>0?r.indexAfter(s)<l.childCount:r.index(s)>0){a=l.child(n>0?r.indexAfter(s):r.index(s)-1);break}else if(s==0){return null}i+=n;var c=r.doc.resolve(i);if(t.valid(c)){return c}}for(;;){var u=n>0?a.firstChild:a.lastChild;if(!u){if(a.isAtom&&!a.isText&&!NodeSelection.isSelectable(a)){r=r.doc.resolve(i+a.nodeSize*n);o=false;continue e}break}a=u;i+=n;var p=r.doc.resolve(i);if(t.valid(p)){return p}}return null}};return t}(Selection);GapCursor.prototype.visible=false;Selection.jsonID("gapcursor",GapCursor);var GapBookmark=function e(t){this.pos=t};GapBookmark.prototype.map=function e(t){return new GapBookmark(t.map(this.pos))};GapBookmark.prototype.resolve=function e(t){var r=t.resolve(this.pos);return GapCursor.valid(r)?new GapCursor(r):Selection.near(r)};function closedBefore(e){for(var t=e.depth;t>=0;t--){var r=e.index(t);if(r==0){continue}for(var n=e.node(t).child(r-1);;n=n.lastChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating){return true}if(n.inlineContent){return false}}}return true}function closedAfter(e){for(var t=e.depth;t>=0;t--){var r=e.indexAfter(t),n=e.node(t);if(r==n.childCount){continue}for(var o=n.child(r);;o=o.firstChild){if(o.childCount==0&&!o.inlineContent||o.isAtom||o.type.spec.isolating){return true}if(o.inlineContent){return false}}}return true}var gapCursor=function(){return new Plugin({props:{decorations:drawGapCursor,createSelectionBetween:function e(t,r,n){if(r.pos==n.pos&&GapCursor.valid(n)){return new GapCursor(n)}},handleClick:handleClick,handleKeyDown:handleKeyDown}})};var handleKeyDown=keydownHandler({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(e,t){var r=e=="vert"?t>0?"down":"up":t>0?"right":"left";return function(e,n,o){var i=e.selection;var a=t>0?i.$to:i.$from,s=i.empty;if(i instanceof TextSelection){if(!o.endOfTextblock(r)||a.depth==0){return false}s=false;a=e.doc.resolve(t>0?a.after():a.before())}var l=GapCursor.findFrom(a,t,s);if(!l){return false}if(n){n(e.tr.setSelection(new GapCursor(l)))}return true}}function handleClick(e,t,r){if(!e.editable){return false}var n=e.state.doc.resolve(t);if(!GapCursor.valid(n)){return false}var o=e.posAtCoords({left:r.clientX,top:r.clientY});var i=o.inside;if(i>-1&&NodeSelection.isSelectable(e.state.doc.nodeAt(i))){return false}e.dispatch(e.state.tr.setSelection(new GapCursor(n)));return true}function drawGapCursor(e){if(!(e.selection instanceof GapCursor)){return null}var t=document.createElement("div");t.className="ProseMirror-gapcursor";return DecorationSet.create(e.doc,[Decoration.widget(e.selection.head,t,{key:"gapcursor"})])}function deleteSelection(e,t){if(e.selection.empty){return false}if(t){t(e.tr.deleteSelection().scrollIntoView())}return true}function joinBackward(e,t,r){var n=e.selection;var o=n.$cursor;if(!o||(r?!r.endOfTextblock("backward",e):o.parentOffset>0)){return false}var i=findCutBefore(o);if(!i){var a=o.blockRange(),s=a&&liftTarget(a);if(s==null){return false}if(t){t(e.tr.lift(a,s).scrollIntoView())}return true}var l=i.nodeBefore;if(!l.type.spec.isolating&&deleteBarrier(e,i,t)){return true}if(o.parent.content.size==0&&(textblockAt(l,"end")||NodeSelection.isSelectable(l))){if(t){var c=e.tr.deleteRange(o.before(),o.after());c.setSelection(textblockAt(l,"end")?Selection.findFrom(c.doc.resolve(c.mapping.map(i.pos,-1)),-1):NodeSelection.create(c.doc,i.pos-l.nodeSize));t(c.scrollIntoView())}return true}if(l.isAtom&&i.depth==o.depth-1){if(t){t(e.tr.delete(i.pos-l.nodeSize,i.pos).scrollIntoView())}return true}return false}function textblockAt(e,t){for(;e;e=t=="start"?e.firstChild:e.lastChild){if(e.isTextblock){return true}}return false}function selectNodeBackward(e,t,r){var n=e.selection;var o=n.$head;var i=n.empty;var a=o;if(!i){return false}if(o.parent.isTextblock){if(r?!r.endOfTextblock("backward",e):o.parentOffset>0){return false}a=findCutBefore(o)}var s=a&&a.nodeBefore;if(!s||!NodeSelection.isSelectable(s)){return false}if(t){t(e.tr.setSelection(NodeSelection.create(e.doc,a.pos-s.nodeSize)).scrollIntoView())}return true}function findCutBefore(e){if(!e.parent.type.spec.isolating){for(var t=e.depth-1;t>=0;t--){if(e.index(t)>0){return e.doc.resolve(e.before(t+1))}if(e.node(t).type.spec.isolating){break}}}return null}function joinForward(e,t,r){var n=e.selection;var o=n.$cursor;if(!o||(r?!r.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)){return false}var i=findCutAfter(o);if(!i){return false}var a=i.nodeAfter;if(deleteBarrier(e,i,t)){return true}if(o.parent.content.size==0&&(textblockAt(a,"start")||NodeSelection.isSelectable(a))){if(t){var s=e.tr.deleteRange(o.before(),o.after());s.setSelection(textblockAt(a,"start")?Selection.findFrom(s.doc.resolve(s.mapping.map(i.pos)),1):NodeSelection.create(s.doc,s.mapping.map(i.pos)));t(s.scrollIntoView())}return true}if(a.isAtom&&i.depth==o.depth-1){if(t){t(e.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView())}return true}return false}function selectNodeForward(e,t,r){var n=e.selection;var o=n.$head;var i=n.empty;var a=o;if(!i){return false}if(o.parent.isTextblock){if(r?!r.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size){return false}a=findCutAfter(o)}var s=a&&a.nodeAfter;if(!s||!NodeSelection.isSelectable(s)){return false}if(t){t(e.tr.setSelection(NodeSelection.create(e.doc,a.pos)).scrollIntoView())}return true}function findCutAfter(e){if(!e.parent.type.spec.isolating){for(var t=e.depth-1;t>=0;t--){var r=e.node(t);if(e.index(t)+1<r.childCount){return e.doc.resolve(e.after(t+1))}if(r.type.spec.isolating){break}}}return null}function joinUp(e,t){var r=e.selection,n=r instanceof NodeSelection,o;if(n){if(r.node.isTextblock||!canJoin(e.doc,r.from)){return false}o=r.from}else{o=joinPoint(e.doc,r.from,-1);if(o==null){return false}}if(t){var i=e.tr.join(o);if(n){i.setSelection(NodeSelection.create(i.doc,o-e.doc.resolve(o).nodeBefore.nodeSize))}t(i.scrollIntoView())}return true}function joinDown(e,t){var r=e.selection,n;if(r instanceof NodeSelection){if(r.node.isTextblock||!canJoin(e.doc,r.to)){return false}n=r.to}else{n=joinPoint(e.doc,r.to,1);if(n==null){return false}}if(t){t(e.tr.join(n).scrollIntoView())}return true}function lift(e,t){var r=e.selection;var n=r.$from;var o=r.$to;var i=n.blockRange(o),a=i&&liftTarget(i);if(a==null){return false}if(t){t(e.tr.lift(i,a).scrollIntoView())}return true}function newlineInCode(e,t){var r=e.selection;var n=r.$head;var o=r.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o)){return false}if(t){t(e.tr.insertText("\n").scrollIntoView())}return true}function defaultBlockAt(e){for(var t=0;t<e.edgeCount;t++){var r=e.edge(t);var n=r.type;if(n.isTextblock&&!n.hasRequiredAttrs()){return n}}return null}function exitCode(e,t){var r=e.selection;var n=r.$head;var o=r.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o)){return false}var i=n.node(-1),a=n.indexAfter(-1),s=defaultBlockAt(i.contentMatchAt(a));if(!i.canReplaceWith(a,a,s)){return false}if(t){var l=n.after(),c=e.tr.replaceWith(l,l,s.createAndFill());c.setSelection(Selection.near(c.doc.resolve(l),1));t(c.scrollIntoView())}return true}function createParagraphNear(e,t){var r=e.selection;var n=r.$from;var o=r.$to;if(n.parent.inlineContent||o.parent.inlineContent){return false}var i=defaultBlockAt(n.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock){return false}if(t){var a=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos;var s=e.tr.insert(a,i.createAndFill());s.setSelection(TextSelection.create(s.doc,a+1));t(s.scrollIntoView())}return true}function liftEmptyBlock(e,t){var r=e.selection;var n=r.$cursor;if(!n||n.parent.content.size){return false}if(n.depth>1&&n.after()!=n.end(-1)){var o=n.before();if(canSplit(e.doc,o)){if(t){t(e.tr.split(o).scrollIntoView())}return true}}var i=n.blockRange(),a=i&&liftTarget(i);if(a==null){return false}if(t){t(e.tr.lift(i,a).scrollIntoView())}return true}function splitBlock(e,t){var r=e.selection;var n=r.$from;var o=r.$to;if(e.selection instanceof NodeSelection&&e.selection.node.isBlock){if(!n.parentOffset||!canSplit(e.doc,n.pos)){return false}if(t){t(e.tr.split(n.pos).scrollIntoView())}return true}if(!n.parent.isBlock){return false}if(t){var i=o.parentOffset==o.parent.content.size;var a=e.tr;if(e.selection instanceof TextSelection){a.deleteSelection()}var s=n.depth==0?null:defaultBlockAt(n.node(-1).contentMatchAt(n.indexAfter(-1)));var l=i&&s?[{type:s}]:null;var c=canSplit(a.doc,a.mapping.map(n.pos),1,l);if(!l&&!c&&canSplit(a.doc,a.mapping.map(n.pos),1,s&&[{type:s}])){l=[{type:s}];c=true}if(c){a.split(a.mapping.map(n.pos),1,l);if(!i&&!n.parentOffset&&n.parent.type!=s&&n.node(-1).canReplace(n.index(-1),n.indexAfter(-1),Fragment.from([s.create(),n.parent]))){a.setNodeMarkup(a.mapping.map(n.before()),s)}}t(a.scrollIntoView())}return true}function selectParentNode(e,t){var r=e.selection;var n=r.$from;var o=r.to;var i;var a=n.sharedDepth(o);if(a==0){return false}i=n.before(a);if(t){t(e.tr.setSelection(NodeSelection.create(e.doc,i)))}return true}function selectAll(e,t){if(t){t(e.tr.setSelection(new AllSelection(e.doc)))}return true}function joinMaybeClear(e,t,r){var n=t.nodeBefore,o=t.nodeAfter,i=t.index();if(!n||!o||!n.type.compatibleContent(o.type)){return false}if(!n.content.size&&t.parent.canReplace(i-1,i)){if(r){r(e.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView())}return true}if(!t.parent.canReplace(i,i+1)||!(o.isTextblock||canJoin(e.doc,t.pos))){return false}if(r){r(e.tr.clearIncompatible(t.pos,n.type,n.contentMatchAt(n.childCount)).join(t.pos).scrollIntoView())}return true}function deleteBarrier(e,t,r){var n=t.nodeBefore,o=t.nodeAfter,i,a;if(n.type.spec.isolating||o.type.spec.isolating){return false}if(joinMaybeClear(e,t,r)){return true}var s=t.parent.canReplace(t.index(),t.index()+1);if(s&&(i=(a=n.contentMatchAt(n.childCount)).findWrapping(o.type))&&a.matchType(i[0]||o.type).validEnd){if(r){var l=t.pos+o.nodeSize,c=Fragment.empty;for(var u=i.length-1;u>=0;u--){c=Fragment.from(i[u].create(null,c))}c=Fragment.from(n.copy(c));var p=e.tr.step(new ReplaceAroundStep(t.pos-1,l,t.pos,l,new Slice(c,1,0),i.length,true));var f=l+2*i.length;if(canJoin(p.doc,f)){p.join(f)}r(p.scrollIntoView())}return true}var d=Selection.findFrom(t,1);var h=d&&d.$from.blockRange(d.$to),m=h&&liftTarget(h);if(m!=null&&m>=t.depth){if(r){r(e.tr.lift(h,m).scrollIntoView())}return true}if(s&&o.isTextblock&&textblockAt(n,"end")){var v=n,g=[];for(;;){g.push(v);if(v.isTextblock){break}v=v.lastChild}if(v.canReplace(v.childCount,v.childCount,o.content)){if(r){var y=Fragment.empty;for(var b=g.length-1;b>=0;b--){y=Fragment.from(g[b].copy(y))}var w=e.tr.step(new ReplaceAroundStep(t.pos-g.length,t.pos+o.nodeSize,t.pos+1,t.pos+o.nodeSize-1,new Slice(y,g.length,0),0,true));r(w.scrollIntoView())}return true}}return false}function wrapIn(e,t){return function(r,n){var o=r.selection;var i=o.$from;var a=o.$to;var s=i.blockRange(a),l=s&&findWrapping(s,e,t);if(!l){return false}if(n){n(r.tr.wrap(s,l).scrollIntoView())}return true}}function setBlockType(e,t){return function(r,n){var o=r.selection;var i=o.from;var a=o.to;var s=false;r.doc.nodesBetween(i,a,(function(n,o){if(s){return false}if(!n.isTextblock||n.hasMarkup(e,t)){return}if(n.type==e){s=true}else{var i=r.doc.resolve(o),a=i.index();s=i.parent.canReplaceWith(a,a+1,e)}}));if(!s){return false}if(n){n(r.tr.setBlockType(i,a,e,t).scrollIntoView())}return true}}function markApplies(e,t,r){var n=function(n){var o=t[n];var i=o.$from;var a=o.$to;var s=i.depth==0?e.type.allowsMarkType(r):false;e.nodesBetween(i.pos,a.pos,(function(e){if(s){return false}s=e.inlineContent&&e.type.allowsMarkType(r)}));if(s){return{v:true}}};for(var o=0;o<t.length;o++){var i=n(o);if(i)return i.v}return false}function toggleMark(e,t){return function(r,n){var o=r.selection;var i=o.empty;var a=o.$cursor;var s=o.ranges;if(i&&!a||!markApplies(r.doc,s,e)){return false}if(n){if(a){if(e.isInSet(r.storedMarks||a.marks())){n(r.tr.removeStoredMark(e))}else{n(r.tr.addStoredMark(e.create(t)))}}else{var l=false,c=r.tr;for(var u=0;!l&&u<s.length;u++){var p=s[u];var f=p.$from;var d=p.$to;l=r.doc.rangeHasMark(f.pos,d.pos,e)}for(var h=0;h<s.length;h++){var m=s[h];var v=m.$from;var g=m.$to;if(l){c.removeMark(v.pos,g.pos,e)}else{var y=v.pos,b=g.pos,w=v.nodeAfter,S=g.nodeBefore;var C=w&&w.isText?/^\s*/.exec(w.text)[0].length:0;var R=S&&S.isText?/\s*$/.exec(S.text)[0].length:0;if(y+C<b){y+=C;b-=R}c.addMark(y,b,e.create(t))}}n(c.scrollIntoView())}}return true}}function chainCommands(){var e=[],t=arguments.length;while(t--)e[t]=arguments[t];return function(t,r,n){for(var o=0;o<e.length;o++){if(e[o](t,r,n)){return true}}return false}}var backspace=chainCommands(deleteSelection,joinBackward,selectNodeBackward);var del=chainCommands(deleteSelection,joinForward,selectNodeForward);var pcBaseKeymap={Enter:chainCommands(newlineInCode,createParagraphNear,liftEmptyBlock,splitBlock),"Mod-Enter":exitCode,Backspace:backspace,"Mod-Backspace":backspace,Delete:del,"Mod-Delete":del,"Mod-a":selectAll};var macBaseKeymap={"Ctrl-h":pcBaseKeymap["Backspace"],"Alt-Backspace":pcBaseKeymap["Mod-Backspace"],"Ctrl-d":pcBaseKeymap["Delete"],"Ctrl-Alt-Backspace":pcBaseKeymap["Mod-Delete"],"Alt-Delete":pcBaseKeymap["Mod-Delete"],"Alt-d":pcBaseKeymap["Mod-Delete"]};for(var key in pcBaseKeymap){macBaseKeymap[key]=pcBaseKeymap[key]}var mac$2=typeof navigator!="undefined"?/Mac/.test(navigator.platform):typeof os!="undefined"?os.platform()=="darwin":false;var baseKeymap=mac$2?macBaseKeymap:pcBaseKeymap;var readFromCache,addToCache;if(typeof WeakMap!="undefined"){var cache=new WeakMap;readFromCache=function(e){return cache.get(e)};addToCache=function(e,t){cache.set(e,t);return t}}else{var cache$1=[],cacheSize=10,cachePos=0;readFromCache=function(e){for(var t=0;t<cache$1.length;t+=2){if(cache$1[t]==e){return cache$1[t+1]}}};addToCache=function(e,t){if(cachePos==cacheSize){cachePos=0}cache$1[cachePos++]=e;return cache$1[cachePos++]=t}}var Rect=function e(t,r,n,o){this.left=t;this.top=r;this.right=n;this.bottom=o};var TableMap=function e(t,r,n,o){this.width=t;this.height=r;this.map=n;this.problems=o};TableMap.prototype.findCell=function e(t){for(var r=0;r<this.map.length;r++){var n=this.map[r];if(n!=t){continue}var o=r%this.width,i=r/this.width|0;var a=o+1,s=i+1;for(var l=1;a<this.width&&this.map[r+l]==n;l++){a++}for(var c=1;s<this.height&&this.map[r+this.width*c]==n;c++){s++}return new Rect(o,i,a,s)}throw new RangeError("No cell with offset "+t+" found")};TableMap.prototype.colCount=function e(t){for(var r=0;r<this.map.length;r++){if(this.map[r]==t){return r%this.width}}throw new RangeError("No cell with offset "+t+" found")};TableMap.prototype.nextCell=function e(t,r,n){var o=this.findCell(t);var i=o.left;var a=o.right;var s=o.top;var l=o.bottom;if(r=="horiz"){if(n<0?i==0:a==this.width){return null}return this.map[s*this.width+(n<0?i-1:a)]}else{if(n<0?s==0:l==this.height){return null}return this.map[i+this.width*(n<0?s-1:l)]}};TableMap.prototype.rectBetween=function e(t,r){var n=this.findCell(t);var o=n.left;var i=n.right;var a=n.top;var s=n.bottom;var l=this.findCell(r);var c=l.left;var u=l.right;var p=l.top;var f=l.bottom;return new Rect(Math.min(o,c),Math.min(a,p),Math.max(i,u),Math.max(s,f))};TableMap.prototype.cellsInRect=function e(t){var r=[],n={};for(var o=t.top;o<t.bottom;o++){for(var i=t.left;i<t.right;i++){var a=o*this.width+i,s=this.map[a];if(n[s]){continue}n[s]=true;if((i!=t.left||!i||this.map[a-1]!=s)&&(o!=t.top||!o||this.map[a-this.width]!=s)){r.push(s)}}}return r};TableMap.prototype.positionAt=function e(t,r,n){for(var o=0,i=0;;o++){var a=i+n.child(o).nodeSize;if(o==t){var s=r+t*this.width,l=(t+1)*this.width;while(s<l&&this.map[s]<i){s++}return s==l?a-1:this.map[s]}i=a}};TableMap.get=function e(t){return readFromCache(t)||addToCache(t,computeMap(t))};function computeMap(e){if(e.type.spec.tableRole!="table"){throw new RangeError("Not a table node: "+e.type.name)}var t=findWidth(e),r=e.childCount;var n=[],o=0,i=null,a=[];for(var s=0,l=t*r;s<l;s++){n[s]=0}for(var c=0,u=0;c<r;c++){var p=e.child(c);u++;for(var f=0;;f++){while(o<n.length&&n[o]!=0){o++}if(f==p.childCount){break}var d=p.child(f);var h=d.attrs;var m=h.colspan;var v=h.rowspan;var g=h.colwidth;for(var y=0;y<v;y++){if(y+c>=r){(i||(i=[])).push({type:"overlong_rowspan",pos:u,n:v-y});break}var b=o+y*t;for(var w=0;w<m;w++){if(n[b+w]==0){n[b+w]=u}else{(i||(i=[])).push({type:"collision",row:c,pos:u,n:m-w})}var S=g&&g[w];if(S){var C=(b+w)%t*2,R=a[C];if(R==null||R!=S&&a[C+1]==1){a[C]=S;a[C+1]=1}else if(R==S){a[C+1]++}}}}o+=m;u+=d.nodeSize}var M=(c+1)*t,x=0;while(o<M){if(n[o++]==0){x++}}if(x){(i||(i=[])).push({type:"missing",row:c,n:x})}u++}var T=new TableMap(t,r,n,i),k=false;for(var A=0;!k&&A<a.length;A+=2){if(a[A]!=null&&a[A+1]<r){k=true}}if(k){findBadColWidths(T,a,e)}return T}function findWidth(e){var t=-1,r=false;for(var n=0;n<e.childCount;n++){var o=e.child(n),i=0;if(r){for(var a=0;a<n;a++){var s=e.child(a);for(var l=0;l<s.childCount;l++){var c=s.child(l);if(a+c.attrs.rowspan>n){i+=c.attrs.colspan}}}}for(var u=0;u<o.childCount;u++){var p=o.child(u);i+=p.attrs.colspan;if(p.attrs.rowspan>1){r=true}}if(t==-1){t=i}else if(t!=i){t=Math.max(t,i)}}return t}function findBadColWidths(e,t,r){if(!e.problems){e.problems=[]}for(var n=0,o={};n<e.map.length;n++){var i=e.map[n];if(o[i]){continue}o[i]=true;var a=r.nodeAt(i),s=null;for(var l=0;l<a.attrs.colspan;l++){var c=(n+l)%e.width,u=t[c*2];if(u!=null&&(!a.attrs.colwidth||a.attrs.colwidth[l]!=u)){(s||(s=freshColWidth(a.attrs)))[l]=u}}if(s){e.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:s})}}}function freshColWidth(e){if(e.colwidth){return e.colwidth.slice()}var t=[];for(var r=0;r<e.colspan;r++){t.push(0)}return t}function tableNodeTypes(e){var t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(var r in e.nodes){var n=e.nodes[r],o=n.spec.tableRole;if(o){t[o]=n}}}return t}var key$1=new PluginKey("selectingCells");function cellAround(e){for(var t=e.depth-1;t>0;t--){if(e.node(t).type.spec.tableRole=="row"){return e.node(0).resolve(e.before(t+1))}}return null}function cellWrapping(e){for(var t=e.depth;t>0;t--){var r=e.node(t).type.spec.tableRole;if(r==="cell"||r==="header_cell"){return e.node(t)}}return null}function isInTable(e){var t=e.selection.$head;for(var r=t.depth;r>0;r--){if(t.node(r).type.spec.tableRole=="row"){return true}}return false}function selectionCell(e){var t=e.selection;if(t.$anchorCell){return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell}else if(t.node&&t.node.type.spec.tableRole=="cell"){return t.$anchor}return cellAround(t.$head)||cellNear(t.$head)}function cellNear(e){for(var t=e.nodeAfter,r=e.pos;t;t=t.firstChild,r++){var n=t.type.spec.tableRole;if(n=="cell"||n=="header_cell"){return e.doc.resolve(r)}}for(var o=e.nodeBefore,i=e.pos;o;o=o.lastChild,i--){var a=o.type.spec.tableRole;if(a=="cell"||a=="header_cell"){return e.doc.resolve(i-o.nodeSize)}}}function pointsAtCell(e){return e.parent.type.spec.tableRole=="row"&&e.nodeAfter}function moveCellForward(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function inSameTable(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function nextCell(e,t,r){var n=e.start(-1),o=TableMap.get(e.node(-1));var i=o.nextCell(e.pos-n,t,r);return i==null?null:e.node(0).resolve(n+i)}function setAttr(e,t,r){var n={};for(var o in e){n[o]=e[o]}n[t]=r;return n}function removeColSpan(e,t,r){if(r===void 0)r=1;var n=setAttr(e,"colspan",e.colspan-r);if(n.colwidth){n.colwidth=n.colwidth.slice();n.colwidth.splice(t,r);if(!n.colwidth.some((function(e){return e>0}))){n.colwidth=null}}return n}function addColSpan(e,t,r){if(r===void 0)r=1;var n=setAttr(e,"colspan",e.colspan+r);if(n.colwidth){n.colwidth=n.colwidth.slice();for(var o=0;o<r;o++){n.colwidth.splice(t,0,0)}}return n}function columnIsHeader(e,t,r){var n=tableNodeTypes(t.type.schema).header_cell;for(var o=0;o<e.height;o++){if(t.nodeAt(e.map[r+o*e.width]).type!=n){return false}}return true}var CellSelection=function(e){function t(t,r){if(r===void 0)r=t;var n=t.node(-1),o=TableMap.get(n),i=t.start(-1);var a=o.rectBetween(t.pos-i,r.pos-i);var s=t.node(0);var l=o.cellsInRect(a).filter((function(e){return e!=r.pos-i}));l.unshift(r.pos-i);var c=l.map((function(e){var t=n.nodeAt(e),r=e+i+1;return new SelectionRange(s.resolve(r),s.resolve(r+t.content.size))}));e.call(this,c[0].$from,c[0].$to,c);this.$anchorCell=t;this.$headCell=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function e(r,n){var o=r.resolve(n.map(this.$anchorCell.pos));var i=r.resolve(n.map(this.$headCell.pos));if(pointsAtCell(o)&&pointsAtCell(i)&&inSameTable(o,i)){var a=this.$anchorCell.node(-1)!=o.node(-1);if(a&&this.isRowSelection()){return t.rowSelection(o,i)}else if(a&&this.isColSelection()){return t.colSelection(o,i)}else{return new t(o,i)}}return TextSelection.between(o,i)};t.prototype.content=function e(){var t=this.$anchorCell.node(-1),r=TableMap.get(t),n=this.$anchorCell.start(-1);var o=r.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n);var i={},a=[];for(var s=o.top;s<o.bottom;s++){var l=[];for(var c=s*r.width+o.left,u=o.left;u<o.right;u++,c++){var p=r.map[c];if(!i[p]){i[p]=true;var f=r.findCell(p),d=t.nodeAt(p);var h=o.left-f.left,m=f.right-o.right;if(h>0||m>0){var v=d.attrs;if(h>0){v=removeColSpan(v,0,h)}if(m>0){v=removeColSpan(v,v.colspan-m,m)}if(f.left<o.left){d=d.type.createAndFill(v)}else{d=d.type.create(v,d.content)}}if(f.top<o.top||f.bottom>o.bottom){var g=setAttr(d.attrs,"rowspan",Math.min(f.bottom,o.bottom)-Math.max(f.top,o.top));if(f.top<o.top){d=d.type.createAndFill(g)}else{d=d.type.create(g,d.content)}}l.push(d)}}a.push(t.child(s).copy(Fragment.from(l)))}var y=this.isColSelection()&&this.isRowSelection()?t:a;return new Slice(Fragment.from(y),1,1)};t.prototype.replace=function t(r,n){if(n===void 0)n=Slice.empty;var o=r.steps.length,i=this.ranges;for(var a=0;a<i.length;a++){var s=i[a];var l=s.$from;var c=s.$to;var u=r.mapping.slice(o);r.replace(u.map(l.pos),u.map(c.pos),a?Slice.empty:n)}var p=e.findFrom(r.doc.resolve(r.mapping.slice(o).map(this.to)),-1);if(p){r.setSelection(p)}};t.prototype.replaceWith=function e(t,r){this.replace(t,new Slice(Fragment.from(r),0,0))};t.prototype.forEachCell=function e(t){var r=this.$anchorCell.node(-1),n=TableMap.get(r),o=this.$anchorCell.start(-1);var i=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(var a=0;a<i.length;a++){t(r.nodeAt(i[a]),o+i[a])}};t.prototype.isColSelection=function e(){var t=this.$anchorCell.index(-1),r=this.$headCell.index(-1);if(Math.min(t,r)>0){return false}var n=t+this.$anchorCell.nodeAfter.attrs.rowspan,o=r+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,o)==this.$headCell.node(-1).childCount};t.colSelection=function e(r,n){if(n===void 0)n=r;var o=TableMap.get(r.node(-1)),i=r.start(-1);var a=o.findCell(r.pos-i),s=o.findCell(n.pos-i);var l=r.node(0);if(a.top<=s.top){if(a.top>0){r=l.resolve(i+o.map[a.left])}if(s.bottom<o.height){n=l.resolve(i+o.map[o.width*(o.height-1)+s.right-1])}}else{if(s.top>0){n=l.resolve(i+o.map[s.left])}if(a.bottom<o.height){r=l.resolve(i+o.map[o.width*(o.height-1)+a.right-1])}}return new t(r,n)};t.prototype.isRowSelection=function e(){var t=TableMap.get(this.$anchorCell.node(-1)),r=this.$anchorCell.start(-1);var n=t.colCount(this.$anchorCell.pos-r),o=t.colCount(this.$headCell.pos-r);if(Math.min(n,o)>0){return false}var i=n+this.$anchorCell.nodeAfter.attrs.colspan,a=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,a)==t.width};t.prototype.eq=function e(r){return r instanceof t&&r.$anchorCell.pos==this.$anchorCell.pos&&r.$headCell.pos==this.$headCell.pos};t.rowSelection=function e(r,n){if(n===void 0)n=r;var o=TableMap.get(r.node(-1)),i=r.start(-1);var a=o.findCell(r.pos-i),s=o.findCell(n.pos-i);var l=r.node(0);if(a.left<=s.left){if(a.left>0){r=l.resolve(i+o.map[a.top*o.width])}if(s.right<o.width){n=l.resolve(i+o.map[o.width*(s.top+1)-1])}}else{if(s.left>0){n=l.resolve(i+o.map[s.top*o.width])}if(a.right<o.width){r=l.resolve(i+o.map[o.width*(a.top+1)-1])}}return new t(r,n)};t.prototype.toJSON=function e(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}};t.fromJSON=function e(r,n){return new t(r.resolve(n.anchor),r.resolve(n.head))};t.create=function e(r,n,o){if(o===void 0)o=n;return new t(r.resolve(n),r.resolve(o))};t.prototype.getBookmark=function e(){return new CellBookmark(this.$anchorCell.pos,this.$headCell.pos)};return t}(Selection);CellSelection.prototype.visible=false;Selection.jsonID("cell",CellSelection);var CellBookmark=function e(t,r){this.anchor=t;this.head=r};CellBookmark.prototype.map=function e(t){return new CellBookmark(t.map(this.anchor),t.map(this.head))};CellBookmark.prototype.resolve=function e(t){var r=t.resolve(this.anchor),n=t.resolve(this.head);if(r.parent.type.spec.tableRole=="row"&&n.parent.type.spec.tableRole=="row"&&r.index()<r.parent.childCount&&n.index()<n.parent.childCount&&inSameTable(r,n)){return new CellSelection(r,n)}else{return Selection.near(n,1)}};function drawCellSelection(e){if(!(e.selection instanceof CellSelection)){return null}var t=[];e.selection.forEachCell((function(e,r){t.push(Decoration.node(r,r+e.nodeSize,{class:"selectedCell"}))}));return DecorationSet.create(e.doc,t)}function isCellBoundarySelection(e){var t=e.$from;var r=e.$to;if(t.pos==r.pos||t.pos<t.pos-6){return false}var n=t.pos,o=r.pos,i=t.depth;for(;i>=0;i--,n++){if(t.after(i+1)<t.end(i)){break}}for(var a=r.depth;a>=0;a--,o--){if(r.before(a+1)>r.start(a)){break}}return n==o&&/row|table/.test(t.node(i).type.spec.tableRole)}function isTextSelectionAcrossCells(e){var t=e.$from;var r=e.$to;var n;var o;for(var i=t.depth;i>0;i--){var a=t.node(i);if(a.type.spec.tableRole==="cell"||a.type.spec.tableRole==="header_cell"){n=a;break}}for(var s=r.depth;s>0;s--){var l=r.node(s);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){o=l;break}}return n!==o&&r.parentOffset===0}function normalizeSelection(e,t,r){var n=(t||e).selection,o=(t||e).doc,i,a;if(n instanceof NodeSelection&&(a=n.node.type.spec.tableRole)){if(a=="cell"||a=="header_cell"){i=CellSelection.create(o,n.from)}else if(a=="row"){var s=o.resolve(n.from+1);i=CellSelection.rowSelection(s,s)}else if(!r){var l=TableMap.get(n.node),c=n.from+1;var u=c+l.map[l.width*l.height-1];i=CellSelection.create(o,c+1,u)}}else if(n instanceof TextSelection&&isCellBoundarySelection(n)){i=TextSelection.create(o,n.from)}else if(n instanceof TextSelection&&isTextSelectionAcrossCells(n)){i=TextSelection.create(o,n.$from.start(),n.$from.end())}if(i){(t||(t=e.tr)).setSelection(i)}return t}function pastedCells(e){if(!e.size){return null}var t=e.content;var r=e.openStart;var n=e.openEnd;while(t.childCount==1&&(r>0&&n>0||t.firstChild.type.spec.tableRole=="table")){r--;n--;t=t.firstChild.content}var o=t.firstChild,i=o.type.spec.tableRole;var a=o.type.schema,s=[];if(i=="row"){for(var l=0;l<t.childCount;l++){var c=t.child(l).content;var u=l?0:Math.max(0,r-1);var p=l<t.childCount-1?0:Math.max(0,n-1);if(u||p){c=fitSlice(tableNodeTypes(a).row,new Slice(c,u,p)).content}s.push(c)}}else if(i=="cell"||i=="header_cell"){s.push(r||n?fitSlice(tableNodeTypes(a).row,new Slice(t,r,n)).content:t)}else{return null}return ensureRectangular(a,s)}function ensureRectangular(e,t){var r=[];for(var n=0;n<t.length;n++){var o=t[n];for(var i=o.childCount-1;i>=0;i--){var a=o.child(i).attrs;var s=a.rowspan;var l=a.colspan;for(var c=n;c<n+s;c++){r[c]=(r[c]||0)+l}}}var u=0;for(var p=0;p<r.length;p++){u=Math.max(u,r[p])}for(var f=0;f<r.length;f++){if(f>=t.length){t.push(Fragment.empty)}if(r[f]<u){var d=tableNodeTypes(e).cell.createAndFill(),h=[];for(var m=r[f];m<u;m++){h.push(d)}t[f]=t[f].append(Fragment.from(h))}}return{height:t.length,width:u,rows:t}}function fitSlice(e,t){var r=e.createAndFill();var n=new Transform(r).replace(0,r.content.size,t);return n.doc}function clipCells(e,t,r){var n=e.width;var o=e.height;var i=e.rows;if(n!=t){var a=[],s=[];for(var l=0;l<i.length;l++){var c=i[l],u=[];for(var p=a[l]||0,f=0;p<t;f++){var d=c.child(f%c.childCount);if(p+d.attrs.colspan>t){d=d.type.create(removeColSpan(d.attrs,d.attrs.colspan,p+d.attrs.colspan-t),d.content)}u.push(d);p+=d.attrs.colspan;for(var h=1;h<d.attrs.rowspan;h++){a[l+h]=(a[l+h]||0)+d.attrs.colspan}}s.push(Fragment.from(u))}i=s;n=t}if(o!=r){var m=[];for(var v=0,g=0;v<r;v++,g++){var y=[],b=i[g%o];for(var w=0;w<b.childCount;w++){var S=b.child(w);if(v+S.attrs.rowspan>r){S=S.type.create(setAttr(S.attrs,"rowspan",Math.max(1,r-S.attrs.rowspan)),S.content)}y.push(S)}m.push(Fragment.from(y))}i=m;o=r}return{width:n,height:o,rows:i}}function growTable(e,t,r,n,o,i,a){var s=e.doc.type.schema,l=tableNodeTypes(s),c,u;if(o>t.width){for(var p=0,f=0;p<t.height;p++){var d=r.child(p);f+=d.nodeSize;var h=[],m=void 0;if(d.lastChild==null||d.lastChild.type==l.cell){m=c||(c=l.cell.createAndFill())}else{m=u||(u=l.header_cell.createAndFill())}for(var v=t.width;v<o;v++){h.push(m)}e.insert(e.mapping.slice(a).map(f-1+n),h)}}if(i>t.height){var g=[];for(var y=0,b=(t.height-1)*t.width;y<Math.max(t.width,o);y++){var w=y>=t.width?false:r.nodeAt(t.map[b+y]).type==l.header_cell;g.push(w?u||(u=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}var S=l.row.create(null,Fragment.from(g)),C=[];for(var R=t.height;R<i;R++){C.push(S)}e.insert(e.mapping.slice(a).map(n+r.nodeSize-2),C)}return!!(c||u)}function isolateHorizontal(e,t,r,n,o,i,a,s){if(a==0||a==t.height){return false}var l=false;for(var c=o;c<i;c++){var u=a*t.width+c,p=t.map[u];if(t.map[u-t.width]==p){l=true;var f=r.nodeAt(p);var d=t.findCell(p);var h=d.top;var m=d.left;e.setNodeMarkup(e.mapping.slice(s).map(p+n),null,setAttr(f.attrs,"rowspan",a-h));e.insert(e.mapping.slice(s).map(t.positionAt(a,m,r)),f.type.createAndFill(setAttr(f.attrs,"rowspan",h+f.attrs.rowspan-a)));c+=f.attrs.colspan-1}}return l}function isolateVertical(e,t,r,n,o,i,a,s){if(a==0||a==t.width){return false}var l=false;for(var c=o;c<i;c++){var u=c*t.width+a,p=t.map[u];if(t.map[u-1]==p){l=true;var f=r.nodeAt(p),d=t.colCount(p);var h=e.mapping.slice(s).map(p+n);e.setNodeMarkup(h,null,removeColSpan(f.attrs,a-d,f.attrs.colspan-(a-d)));e.insert(h+f.nodeSize,f.type.createAndFill(removeColSpan(f.attrs,0,a-d)));c+=f.attrs.rowspan-1}}return l}function insertCells(e,t,r,n,o){var i=r?e.doc.nodeAt(r-1):e.doc,a=TableMap.get(i);var s=n.top;var l=n.left;var c=l+o.width,u=s+o.height;var p=e.tr,f=0;function d(){i=r?p.doc.nodeAt(r-1):p.doc;a=TableMap.get(i);f=p.mapping.maps.length}if(growTable(p,a,i,r,c,u,f)){d()}if(isolateHorizontal(p,a,i,r,l,c,s,f)){d()}if(isolateHorizontal(p,a,i,r,l,c,u,f)){d()}if(isolateVertical(p,a,i,r,s,u,l,f)){d()}if(isolateVertical(p,a,i,r,s,u,c,f)){d()}for(var h=s;h<u;h++){var m=a.positionAt(h,l,i),v=a.positionAt(h,c,i);p.replace(p.mapping.slice(f).map(m+r),p.mapping.slice(f).map(v+r),new Slice(o.rows[h-s],0,0))}d();p.setSelection(new CellSelection(p.doc.resolve(r+a.positionAt(s,l,i)),p.doc.resolve(r+a.positionAt(u-1,c-1,i))));t(p)}var handleKeyDown$1=keydownHandler({ArrowLeft:arrow$1("horiz",-1),ArrowRight:arrow$1("horiz",1),ArrowUp:arrow$1("vert",-1),ArrowDown:arrow$1("vert",1),"Shift-ArrowLeft":shiftArrow("horiz",-1),"Shift-ArrowRight":shiftArrow("horiz",1),"Shift-ArrowUp":shiftArrow("vert",-1),"Shift-ArrowDown":shiftArrow("vert",1),Backspace:deleteCellSelection,"Mod-Backspace":deleteCellSelection,Delete:deleteCellSelection,"Mod-Delete":deleteCellSelection});function maybeSetSelection(e,t,r){if(r.eq(e.selection)){return false}if(t){t(e.tr.setSelection(r).scrollIntoView())}return true}function arrow$1(e,t){return function(r,n,o){var i=r.selection;if(i instanceof CellSelection){return maybeSetSelection(r,n,Selection.near(i.$headCell,t))}if(e!="horiz"&&!i.empty){return false}var a=atEndOfCell(o,e,t);if(a==null){return false}if(e=="horiz"){return maybeSetSelection(r,n,Selection.near(r.doc.resolve(i.head+t),t))}else{var s=r.doc.resolve(a),l=nextCell(s,e,t),c;if(l){c=Selection.near(l,1)}else if(t<0){c=Selection.near(r.doc.resolve(s.before(-1)),-1)}else{c=Selection.near(r.doc.resolve(s.after(-1)),1)}return maybeSetSelection(r,n,c)}}}function shiftArrow(e,t){return function(r,n,o){var i=r.selection;if(!(i instanceof CellSelection)){var a=atEndOfCell(o,e,t);if(a==null){return false}i=new CellSelection(r.doc.resolve(a))}var s=nextCell(i.$headCell,e,t);if(!s){return false}return maybeSetSelection(r,n,new CellSelection(i.$anchorCell,s))}}function deleteCellSelection(e,t){var r=e.selection;if(!(r instanceof CellSelection)){return false}if(t){var n=e.tr,o=tableNodeTypes(e.schema).cell.createAndFill().content;r.forEachCell((function(e,t){if(!e.content.eq(o)){n.replace(n.mapping.map(t+1),n.mapping.map(t+e.nodeSize-1),new Slice(o,0,0))}}));if(n.docChanged){t(n)}}return true}function handleTripleClick$1(e,t){var r=e.state.doc,n=cellAround(r.resolve(t));if(!n){return false}e.dispatch(e.state.tr.setSelection(new CellSelection(n)));return true}function handlePaste(e,t,r){if(!isInTable(e.state)){return false}var n=pastedCells(r),o=e.state.selection;if(o instanceof CellSelection){if(!n){n={width:1,height:1,rows:[Fragment.from(fitSlice(tableNodeTypes(e.state.schema).cell,r))]}}var i=o.$anchorCell.node(-1),a=o.$anchorCell.start(-1);var s=TableMap.get(i).rectBetween(o.$anchorCell.pos-a,o.$headCell.pos-a);n=clipCells(n,s.right-s.left,s.bottom-s.top);insertCells(e.state,e.dispatch,a,s,n);return true}else if(n){var l=selectionCell(e.state),c=l.start(-1);insertCells(e.state,e.dispatch,c,TableMap.get(l.node(-1)).findCell(l.pos-c),n);return true}else{return false}}function handleMouseDown(e,t){if(t.ctrlKey||t.metaKey){return}var r=domInCell(e,t.target),n;if(t.shiftKey&&e.state.selection instanceof CellSelection){o(e.state.selection.$anchorCell,t);t.preventDefault()}else if(t.shiftKey&&r&&(n=cellAround(e.state.selection.$anchor))!=null&&cellUnderMouse(e,t).pos!=n.pos){o(n,t);t.preventDefault()}else if(!r){return}function o(t,r){var n=cellUnderMouse(e,r);var o=key$1.getState(e.state)==null;if(!n||!inSameTable(t,n)){if(o){n=t}else{return}}var i=new CellSelection(t,n);if(o||!e.state.selection.eq(i)){var a=e.state.tr.setSelection(i);if(o){a.setMeta(key$1,t.pos)}e.dispatch(a)}}function i(){e.root.removeEventListener("mouseup",i);e.root.removeEventListener("dragstart",i);e.root.removeEventListener("mousemove",a);if(key$1.getState(e.state)!=null){e.dispatch(e.state.tr.setMeta(key$1,-1))}}function a(n){var a=key$1.getState(e.state),s;if(a!=null){s=e.state.doc.resolve(a)}else if(domInCell(e,n.target)!=r){s=cellUnderMouse(e,t);if(!s){return i()}}if(s){o(s,n)}}e.root.addEventListener("mouseup",i);e.root.addEventListener("dragstart",i);e.root.addEventListener("mousemove",a)}function atEndOfCell(e,t,r){if(!(e.state.selection instanceof TextSelection)){return null}var n=e.state.selection;var o=n.$head;for(var i=o.depth-1;i>=0;i--){var a=o.node(i),s=r<0?o.index(i):o.indexAfter(i);if(s!=(r<0?0:a.childCount)){return null}if(a.type.spec.tableRole=="cell"||a.type.spec.tableRole=="header_cell"){var l=o.before(i);var c=t=="vert"?r>0?"down":"up":r>0?"right":"left";return e.endOfTextblock(c)?l:null}}return null}function domInCell(e,t){for(;t&&t!=e.dom;t=t.parentNode){if(t.nodeName=="TD"||t.nodeName=="TH"){return t}}}function cellUnderMouse(e,t){var r=e.posAtCoords({left:t.clientX,top:t.clientY});if(!r){return null}return r?cellAround(e.state.doc.resolve(r.pos)):null}var fixTablesKey=new PluginKey("fix-tables");function changedDescendants(e,t,r,n){var o=e.childCount,i=t.childCount;e:for(var a=0,s=0;a<i;a++){var l=t.child(a);for(var c=s,u=Math.min(o,a+3);c<u;c++){if(e.child(c)==l){s=c+1;r+=l.nodeSize;continue e}}n(l,r);if(s<o&&e.child(s).sameMarkup(l)){changedDescendants(e.child(s),l,r+1,n)}else{l.nodesBetween(0,l.content.size,n,r+1)}r+=l.nodeSize}}function fixTables(e,t){var r,n=function(t,n){if(t.type.spec.tableRole=="table"){r=fixTable(e,t,n,r)}};if(!t){e.doc.descendants(n)}else if(t.doc!=e.doc){changedDescendants(t.doc,e.doc,0,n)}return r}function fixTable(e,t,r,n){var o=TableMap.get(t);if(!o.problems){return n}if(!n){n=e.tr}var i=[];for(var a=0;a<o.height;a++){i.push(0)}for(var s=0;s<o.problems.length;s++){var l=o.problems[s];if(l.type=="collision"){var c=t.nodeAt(l.pos);for(var u=0;u<c.attrs.rowspan;u++){i[l.row+u]+=l.n}n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,removeColSpan(c.attrs,c.attrs.colspan-l.n,l.n))}else if(l.type=="missing"){i[l.row]+=l.n}else if(l.type=="overlong_rowspan"){var p=t.nodeAt(l.pos);n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,setAttr(p.attrs,"rowspan",p.attrs.rowspan-l.n))}else if(l.type=="colwidth mismatch"){var f=t.nodeAt(l.pos);n.setNodeMarkup(n.mapping.map(r+1+l.pos),null,setAttr(f.attrs,"colwidth",l.colwidth))}}var d,h;for(var m=0;m<i.length;m++){if(i[m]){if(d==null){d=m}h=m}}for(var v=0,g=r+1;v<o.height;v++){var y=t.child(v);var b=g+y.nodeSize;var w=i[v];if(w>0){var S="cell";if(y.firstChild){S=y.firstChild.type.spec.tableRole}var C=[];for(var R=0;R<w;R++){C.push(tableNodeTypes(e.schema)[S].createAndFill())}var M=(v==0||d==v-1)&&h==v?g+1:b-1;n.insert(n.mapping.map(M),C)}g=b}return n.setMeta(fixTablesKey,{fixTables:true})}function selectedRect(e){var t=e.selection,r=selectionCell(e);var n=r.node(-1),o=r.start(-1),i=TableMap.get(n);var a;if(t instanceof CellSelection){a=i.rectBetween(t.$anchorCell.pos-o,t.$headCell.pos-o)}else{a=i.findCell(r.pos-o)}a.tableStart=o;a.map=i;a.table=n;return a}function addColumn(e,t,r){var n=t.map;var o=t.tableStart;var i=t.table;var a=r>0?-1:0;if(columnIsHeader(n,i,r+a)){a=r==0||r==n.width?null:0}for(var s=0;s<n.height;s++){var l=s*n.width+r;if(r>0&&r<n.width&&n.map[l-1]==n.map[l]){var c=n.map[l],u=i.nodeAt(c);e.setNodeMarkup(e.mapping.map(o+c),null,addColSpan(u.attrs,r-n.colCount(c)));s+=u.attrs.rowspan-1}else{var p=a==null?tableNodeTypes(i.type.schema).cell:i.nodeAt(n.map[l+a]).type;var f=n.positionAt(s,r,i);e.insert(e.mapping.map(o+f),p.createAndFill())}}return e}function addColumnBefore(e,t){if(!isInTable(e)){return false}if(t){var r=selectedRect(e);t(addColumn(e.tr,r,r.left))}return true}function removeColumn(e,t,r){var n=t.map;var o=t.table;var i=t.tableStart;var a=e.mapping.maps.length;for(var s=0;s<n.height;){var l=s*n.width+r,c=n.map[l],u=o.nodeAt(c);if(r>0&&n.map[l-1]==c||r<n.width-1&&n.map[l+1]==c){e.setNodeMarkup(e.mapping.slice(a).map(i+c),null,removeColSpan(u.attrs,r-n.colCount(c)))}else{var p=e.mapping.slice(a).map(i+c);e.delete(p,p+u.nodeSize)}s+=u.attrs.rowspan}}function deleteColumn(e,t){if(!isInTable(e)){return false}if(t){var r=selectedRect(e),n=e.tr;if(r.left==0&&r.right==r.map.width){return false}for(var o=r.right-1;;o--){removeColumn(n,r,o);if(o==r.left){break}r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc;r.map=TableMap.get(r.table)}t(n)}return true}function rowIsHeader(e,t,r){var n=tableNodeTypes(t.type.schema).header_cell;for(var o=0;o<e.width;o++){if(t.nodeAt(e.map[o+r*e.width]).type!=n){return false}}return true}function addRow(e,t,r){var n=t.map;var o=t.tableStart;var i=t.table;var a=o;for(var s=0;s<r;s++){a+=i.child(s).nodeSize}var l=[],c=r>0?-1:0;if(rowIsHeader(n,i,r+c)){c=r==0||r==n.height?null:0}for(var u=0,p=n.width*r;u<n.width;u++,p++){if(r>0&&r<n.height&&n.map[p]==n.map[p-n.width]){var f=n.map[p],d=i.nodeAt(f).attrs;e.setNodeMarkup(o+f,null,setAttr(d,"rowspan",d.rowspan+1));u+=d.colspan-1}else{var h=c==null?tableNodeTypes(i.type.schema).cell:i.nodeAt(n.map[p+c*n.width]).type;l.push(h.createAndFill())}}e.insert(a,tableNodeTypes(i.type.schema).row.create(null,l));return e}function addRowBefore(e,t){if(!isInTable(e)){return false}if(t){var r=selectedRect(e);t(addRow(e.tr,r,r.top))}return true}function removeRow(e,t,r){var n=t.map;var o=t.table;var i=t.tableStart;var a=0;for(var s=0;s<r;s++){a+=o.child(s).nodeSize}var l=a+o.child(r).nodeSize;var c=e.mapping.maps.length;e.delete(a+i,l+i);for(var u=0,p=r*n.width;u<n.width;u++,p++){var f=n.map[p];if(r>0&&f==n.map[p-n.width]){var d=o.nodeAt(f).attrs;e.setNodeMarkup(e.mapping.slice(c).map(f+i),null,setAttr(d,"rowspan",d.rowspan-1));u+=d.colspan-1}else if(r<n.width&&f==n.map[p+n.width]){var h=o.nodeAt(f);var m=h.type.create(setAttr(h.attrs,"rowspan",h.attrs.rowspan-1),h.content);var v=n.positionAt(r+1,u,o);e.insert(e.mapping.slice(c).map(i+v),m);u+=h.attrs.colspan-1}}}function deleteRow(e,t){if(!isInTable(e)){return false}if(t){var r=selectedRect(e),n=e.tr;if(r.top==0&&r.bottom==r.map.height){return false}for(var o=r.bottom-1;;o--){removeRow(n,r,o);if(o==r.top){break}r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc;r.map=TableMap.get(r.table)}t(n)}return true}function isEmpty(e){var t=e.content;return t.childCount==1&&t.firstChild.isTextblock&&t.firstChild.childCount==0}function cellsOverlapRectangle(e,t){var r=e.width;var n=e.height;var o=e.map;var i=t.top*r+t.left,a=i;var s=(t.bottom-1)*r+t.left,l=i+(t.right-t.left-1);for(var c=t.top;c<t.bottom;c++){if(t.left>0&&o[a]==o[a-1]||t.right<r&&o[l]==o[l+1]){return true}a+=r;l+=r}for(var u=t.left;u<t.right;u++){if(t.top>0&&o[i]==o[i-r]||t.bottom<n&&o[s]==o[s+r]){return true}i++;s++}return false}function mergeCells(e,t){var r=e.selection;if(!(r instanceof CellSelection)||r.$anchorCell.pos==r.$headCell.pos){return false}var n=selectedRect(e);var o=n.map;if(cellsOverlapRectangle(o,n)){return false}if(t){var i=e.tr,a={},s=Fragment.empty,l,c;for(var u=n.top;u<n.bottom;u++){for(var p=n.left;p<n.right;p++){var f=o.map[u*o.width+p],d=n.table.nodeAt(f);if(a[f]){continue}a[f]=true;if(l==null){l=f;c=d}else{if(!isEmpty(d)){s=s.append(d.content)}var h=i.mapping.map(f+n.tableStart);i.delete(h,h+d.nodeSize)}}}i.setNodeMarkup(l+n.tableStart,null,setAttr(addColSpan(c.attrs,c.attrs.colspan,n.right-n.left-c.attrs.colspan),"rowspan",n.bottom-n.top));if(s.size){var m=l+1+c.content.size;var v=isEmpty(c)?l+1:m;i.replaceWith(v+n.tableStart,m+n.tableStart,s)}i.setSelection(new CellSelection(i.doc.resolve(l+n.tableStart)));t(i)}return true}function splitCell(e,t){var r=tableNodeTypes(e.schema);return splitCellWithType((function(e){var t=e.node;return r[t.type.spec.tableRole]}))(e,t)}function splitCellWithType(e){return function(t,r){var n=t.selection;var o,i;if(!(n instanceof CellSelection)){o=cellWrapping(n.$from);if(!o){return false}i=cellAround(n.$from).pos}else{if(n.$anchorCell.pos!=n.$headCell.pos){return false}o=n.$anchorCell.nodeAfter;i=n.$anchorCell.pos}if(o.attrs.colspan==1&&o.attrs.rowspan==1){return false}if(r){var a=o.attrs,s=[],l=a.colwidth;if(a.rowspan>1){a=setAttr(a,"rowspan",1)}if(a.colspan>1){a=setAttr(a,"colspan",1)}var c=selectedRect(t),u=t.tr;for(var p=0;p<c.right-c.left;p++){s.push(l?setAttr(a,"colwidth",l&&l[p]?[l[p]]:null):a)}var f;for(var d=c.top;d<c.bottom;d++){var h=c.map.positionAt(d,c.left,c.table);if(d==c.top){h+=o.nodeSize}for(var m=c.left,v=0;m<c.right;m++,v++){if(m==c.left&&d==c.top){continue}u.insert(f=u.mapping.map(h+c.tableStart,1),e({node:o,row:d,col:m}).createAndFill(s[v]))}}u.setNodeMarkup(i,e({node:o,row:c.top,col:c.left}),s[0]);if(n instanceof CellSelection){u.setSelection(new CellSelection(u.doc.resolve(n.$anchorCell.pos),f&&u.doc.resolve(f)))}r(u)}return true}}function deprecated_toggleHeader(e){return function(t,r){if(!isInTable(t)){return false}if(r){var n=tableNodeTypes(t.schema);var o=selectedRect(t),i=t.tr;var a=o.map.cellsInRect(e=="column"?new Rect(o.left,0,o.right,o.map.height):e=="row"?new Rect(0,o.top,o.map.width,o.bottom):o);var s=a.map((function(e){return o.table.nodeAt(e)}));for(var l=0;l<a.length;l++){if(s[l].type==n.header_cell){i.setNodeMarkup(o.tableStart+a[l],n.cell,s[l].attrs)}}if(i.steps.length==0){for(var c=0;c<a.length;c++){i.setNodeMarkup(o.tableStart+a[c],n.header_cell,s[c].attrs)}}r(i)}return true}}function isHeaderEnabledByType(e,t,r){var n=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(var o=0;o<n.length;o++){var i=t.table.nodeAt(n[o]);if(i&&i.type!==r.header_cell){return false}}return true}function toggleHeader(e,t){t=t||{useDeprecatedLogic:false};if(t.useDeprecatedLogic){return deprecated_toggleHeader(e)}return function(t,r){if(!isInTable(t)){return false}if(r){var n=tableNodeTypes(t.schema);var o=selectedRect(t),i=t.tr;var a=isHeaderEnabledByType("row",o,n);var s=isHeaderEnabledByType("column",o,n);var l=e==="column"?a:e==="row"?s:false;var c=l?1:0;var u=e=="column"?new Rect(0,c,1,o.map.height):e=="row"?new Rect(c,0,o.map.width,1):o;var p=e=="column"?s?n.cell:n.header_cell:e=="row"?a?n.cell:n.header_cell:n.cell;o.map.cellsInRect(u).forEach((function(e){var t=e+o.tableStart;var r=i.doc.nodeAt(t);if(r){i.setNodeMarkup(t,p,r.attrs)}}));r(i)}return true}}var toggleHeaderRow=toggleHeader("row",{useDeprecatedLogic:true});var toggleHeaderColumn=toggleHeader("column",{useDeprecatedLogic:true});var toggleHeaderCell=toggleHeader("cell",{useDeprecatedLogic:true});function findNextCell(e,t){if(t<0){var r=e.nodeBefore;if(r){return e.pos-r.nodeSize}for(var n=e.index(-1)-1,o=e.before();n>=0;n--){var i=e.node(-1).child(n);if(i.childCount){return o-1-i.lastChild.nodeSize}o-=i.nodeSize}}else{if(e.index()<e.parent.childCount-1){return e.pos+e.nodeAfter.nodeSize}var a=e.node(-1);for(var s=e.indexAfter(-1),l=e.after();s<a.childCount;s++){var c=a.child(s);if(c.childCount){return l+1}l+=c.nodeSize}}}function goToNextCell(e){return function(t,r){if(!isInTable(t)){return false}var n=findNextCell(selectionCell(t),e);if(n==null){return}if(r){var o=t.doc.resolve(n);r(t.tr.setSelection(TextSelection.between(o,moveCellForward(o))).scrollIntoView())}return true}}function deleteTable(e,t){var r=e.selection.$anchor;for(var n=r.depth;n>0;n--){var o=r.node(n);if(o.type.spec.tableRole=="table"){if(t){t(e.tr.delete(r.before(n),r.after(n)).scrollIntoView())}return true}}return false}var TableView=function e(t,r){this.node=t;this.cellMinWidth=r;this.dom=document.createElement("div");this.dom.className="tableWrapper";this.table=this.dom.appendChild(document.createElement("table"));this.table.className=t.attrs.class;this.colgroup=this.table.appendChild(document.createElement("colgroup"));updateColumns(t,this.colgroup,this.table,r);this.contentDOM=this.table.appendChild(document.createElement("tbody"))};TableView.prototype.update=function e(t){if(t.type!=this.node.type){return false}this.node=t;updateColumns(t,this.colgroup,this.table,this.cellMinWidth);return true};TableView.prototype.ignoreMutation=function e(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))};function updateColumns(e,t,r,n,o,i){var a=0,s=true;var l=t.firstChild,c=e.firstChild;for(var u=0,p=0;u<c.childCount;u++){var f=c.child(u).attrs;var d=f.colspan;var h=f.colwidth;for(var m=0;m<d;m++,p++){var v=o==p?i:h&&h[m];var g=v?v+"px":"";a+=v||n;if(!v){s=false}if(!l){t.appendChild(document.createElement("col")).style.width=g}else{if(l.style.width!=g){l.style.width=g}l=l.nextSibling}}}while(l){var y=l.nextSibling;l.parentNode.removeChild(l);l=y}if(s){r.style.width=a+"px";r.style.minWidth=""}else{r.style.width="";r.style.minWidth=a+"px"}r.className=e.attrs.class}var key$1$1=new PluginKey("tableColumnResizing");function columnResizing(e){if(e===void 0)e={};var t=e.handleWidth;if(t===void 0)t=5;var r=e.cellMinWidth;if(r===void 0)r=25;var n=e.View;if(n===void 0)n=TableView;var o=e.lastColumnResizable;if(o===void 0)o=true;var i=new Plugin({key:key$1$1,state:{init:function e(t,o){this.spec.props.nodeViews[tableNodeTypes(o.schema).table.name]=function(e,t){return new n(e,r,t)};return new ResizeState(-1,false)},apply:function e(t,r){return r.apply(t)}},props:{attributes:function e(t){var r=key$1$1.getState(t);return r.activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function e(n,i){handleMouseMove(n,i,t,r,o)},mouseleave:function e(t){handleMouseLeave(t)},mousedown:function e(t,n){handleMouseDown$1(t,n,r)}},decorations:function e(t){var r=key$1$1.getState(t);if(r.activeHandle>-1){return handleDecorations(t,r.activeHandle)}},nodeViews:{}}});return i}var ResizeState=function e(t,r){this.activeHandle=t;this.dragging=r};ResizeState.prototype.apply=function e(t){var r=this,n=t.getMeta(key$1$1);if(n&&n.setHandle!=null){return new ResizeState(n.setHandle,null)}if(n&&n.setDragging!==undefined){return new ResizeState(r.activeHandle,n.setDragging)}if(r.activeHandle>-1&&t.docChanged){var o=t.mapping.map(r.activeHandle,-1);if(!pointsAtCell(t.doc.resolve(o))){o=null}r=new ResizeState(o,r.dragging)}return r};function handleMouseMove(e,t,r,n,o){var i=key$1$1.getState(e.state);if(!i.dragging){var a=domCellAround(t.target),s=-1;if(a){var l=a.getBoundingClientRect();var c=l.left;var u=l.right;if(t.clientX-c<=r){s=edgeCell(e,t,"left")}else if(u-t.clientX<=r){s=edgeCell(e,t,"right")}}if(s!=i.activeHandle){if(!o&&s!==-1){var p=e.state.doc.resolve(s);var f=p.node(-1),d=TableMap.get(f),h=p.start(-1);var m=d.colCount(p.pos-h)+p.nodeAfter.attrs.colspan-1;if(m==d.width-1){return}}updateHandle(e,s)}}}function handleMouseLeave(e){var t=key$1$1.getState(e.state);if(t.activeHandle>-1&&!t.dragging){updateHandle(e,-1)}}function handleMouseDown$1(e,t,r){var n=key$1$1.getState(e.state);if(n.activeHandle==-1||n.dragging){return false}var o=e.state.doc.nodeAt(n.activeHandle);var i=currentColWidth(e,n.activeHandle,o.attrs);e.dispatch(e.state.tr.setMeta(key$1$1,{setDragging:{startX:t.clientX,startWidth:i}}));function a(t){window.removeEventListener("mouseup",a);window.removeEventListener("mousemove",s);var n=key$1$1.getState(e.state);if(n.dragging){updateColumnWidth(e,n.activeHandle,draggedWidth(n.dragging,t,r));e.dispatch(e.state.tr.setMeta(key$1$1,{setDragging:null}))}}function s(t){if(!t.which){return a(t)}var n=key$1$1.getState(e.state);var o=draggedWidth(n.dragging,t,r);displayColumnWidth(e,n.activeHandle,o,r)}window.addEventListener("mouseup",a);window.addEventListener("mousemove",s);t.preventDefault();return true}function currentColWidth(e,t,r){var n=r.colspan;var o=r.colwidth;var i=o&&o[o.length-1];if(i){return i}var a=e.domAtPos(t);var s=a.node.childNodes[a.offset];var l=s.offsetWidth,c=n;if(o){for(var u=0;u<n;u++){if(o[u]){l-=o[u];c--}}}return l/c}function domCellAround(e){while(e&&e.nodeName!="TD"&&e.nodeName!="TH"){e=e.classList.contains("ProseMirror")?null:e.parentNode}return e}function edgeCell(e,t,r){var n=e.posAtCoords({left:t.clientX,top:t.clientY});if(!n){return-1}var o=n.pos;var i=cellAround(e.state.doc.resolve(o));if(!i){return-1}if(r=="right"){return i.pos}var a=TableMap.get(i.node(-1)),s=i.start(-1);var l=a.map.indexOf(i.pos-s);return l%a.width==0?-1:s+a.map[l-1]}function draggedWidth(e,t,r){var n=t.clientX-e.startX;return Math.max(r,e.startWidth+n)}function updateHandle(e,t){e.dispatch(e.state.tr.setMeta(key$1$1,{setHandle:t}))}function updateColumnWidth(e,t,r){var n=e.state.doc.resolve(t);var o=n.node(-1),i=TableMap.get(o),a=n.start(-1);var s=i.colCount(n.pos-a)+n.nodeAfter.attrs.colspan-1;var l=e.state.tr;for(var c=0;c<i.height;c++){var u=c*i.width+s;if(c&&i.map[u]==i.map[u-i.width]){continue}var p=i.map[u];var f=o.nodeAt(p);var d=f.attrs;var h=d.colspan==1?0:s-i.colCount(p);if(d.colwidth&&d.colwidth[h]==r){continue}var m=d.colwidth?d.colwidth.slice():zeroes(d.colspan);m[h]=r;l.setNodeMarkup(a+p,null,setAttr(d,"colwidth",m))}if(l.docChanged){e.dispatch(l)}}function displayColumnWidth(e,t,r,n){var o=e.state.doc.resolve(t);var i=o.node(-1),a=o.start(-1);var s=TableMap.get(i).colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1;var l=e.domAtPos(o.start(-1)).node;while(l.nodeName!="TABLE"){l=l.parentNode}updateColumns(i,l.firstChild,l,n,s,r)}function zeroes(e){var t=[];for(var r=0;r<e;r++){t.push(0)}return t}function handleDecorations(e,t){var r=[];var n=e.doc.resolve(t);var o=n.node(-1),i=TableMap.get(o),a=n.start(-1);var s=i.colCount(n.pos-a)+n.nodeAfter.attrs.colspan;for(var l=0;l<i.height;l++){var c=s+l*i.width-1;if((s==i.width||i.map[c]!=i.map[c+1])&&(l==0||i.map[c-1]!=i.map[c-1-i.width])){var u=i.map[c];var p=a+u+o.nodeAt(u).nodeSize-1;var f=document.createElement("div");f.className="column-resize-handle";r.push(Decoration.widget(p,f))}}return DecorationSet.create(e.doc,r)}function tableEditing(e){if(e===void 0)e={};var t=e.allowTableNodeSelection;if(t===void 0)t=false;return new Plugin({key:key$1,state:{init:function e(){return null},apply:function e(t,r){var n=t.getMeta(key$1);if(n!=null){return n==-1?null:n}if(r==null||!t.docChanged){return r}var o=t.mapping.mapResult(r);var i=o.deleted;var a=o.pos;return i?null:a}},props:{decorations:drawCellSelection,handleDOMEvents:{mousedown:handleMouseDown},createSelectionBetween:function e(t){if(key$1.getState(t.state)!=null){return t.state.selection}},handleTripleClick:handleTripleClick$1,handleKeyDown:handleKeyDown$1,handlePaste:handlePaste},appendTransaction:function e(r,n,o){return normalizeSelection(o,fixTables(o,n),t)}})}function crelt(){var e=arguments[0];if(typeof e=="string")e=document.createElement(e);var t=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var o=r[n];if(typeof o=="string")e.setAttribute(n,o);else if(o!=null)e[n]=o}t++}for(;t<arguments.length;t++)add(e,arguments[t]);return e}function add(e,t){if(typeof t=="string"){e.appendChild(document.createTextNode(t))}else if(t==null);else if(t.nodeType!=null){e.appendChild(t)}else if(Array.isArray(t)){for(var r=0;r<t.length;r++)add(e,t[r])}else{throw new RangeError("Unsupported child node: "+t)}}var SVG="http://www.w3.org/2000/svg";var XLINK="http://www.w3.org/1999/xlink";var prefix="ProseMirror-icon";function hashPath(e){var t=0;for(var r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r)|0}return t}function getIcon(e){var t=document.createElement("div");t.className=prefix;if(e.path){var r="pm-icon-"+hashPath(e.path).toString(16);if(!document.getElementById(r)){buildSVG(r,e)}var n=t.appendChild(document.createElementNS(SVG,"svg"));n.style.width=e.width/e.height+"em";var o=n.appendChild(document.createElementNS(SVG,"use"));o.setAttributeNS(XLINK,"href",/([^#]*)/.exec(document.location)[1]+"#"+r)}else if(e.dom){t.appendChild(e.dom.cloneNode(true))}else{t.appendChild(document.createElement("span")).textContent=e.text||"";if(e.css){t.firstChild.style.cssText=e.css}}return t}function buildSVG(e,t){var r=document.getElementById(prefix+"-collection");if(!r){r=document.createElementNS(SVG,"svg");r.id=prefix+"-collection";r.style.display="none";document.body.insertBefore(r,document.body.firstChild)}var n=document.createElementNS(SVG,"symbol");n.id=e;n.setAttribute("viewBox","0 0 "+t.width+" "+t.height);var o=n.appendChild(document.createElementNS(SVG,"path"));o.setAttribute("d",t.path);r.appendChild(n)}var prefix$1="ProseMirror-menu";var MenuItem=function e(t){this.spec=t};MenuItem.prototype.render=function e(t){var r=this.spec;var n=r.render?r.render(t):r.icon?getIcon(r.icon):r.label?crelt("div",null,translate(t,r.label)):null;if(!n){throw new RangeError("MenuItem without icon or label property")}if(r.title){var o=typeof r.title==="function"?r.title(t.state):r.title;n.setAttribute("title",translate(t,o))}if(r.class){n.classList.add(r.class)}if(r.css){n.style.cssText+=r.css}n.addEventListener("mousedown",(function(e){e.preventDefault();if(!n.classList.contains(prefix$1+"-disabled")){r.run(t.state,t.dispatch,t,e)}}));function i(e){if(r.select){var t=r.select(e);n.style.display=t?"":"none";if(!t){return false}}var o=true;if(r.enable){o=r.enable(e)||false;setClass(n,prefix$1+"-disabled",!o)}if(r.active){var i=o&&r.active(e)||false;setClass(n,prefix$1+"-active",i)}return true}return{dom:n,update:i}};function translate(e,t){return e._props.translate?e._props.translate(t):t}var lastMenuEvent={time:0,node:null};function markMenuEvent(e){lastMenuEvent.time=Date.now();lastMenuEvent.node=e.target}function isMenuEvent(e){return Date.now()-100<lastMenuEvent.time&&lastMenuEvent.node&&e.contains(lastMenuEvent.node)}var Dropdown=function e(t,r){this.options=r||{};this.content=Array.isArray(t)?t:[t]};Dropdown.prototype.render=function e(t){var r=this;var n=renderDropdownItems(this.content,t);var o=crelt("div",{class:prefix$1+"-dropdown "+(this.options.class||""),style:this.options.css},translate(t,this.options.label));if(this.options.title){o.setAttribute("title",translate(t,this.options.title))}var i=crelt("div",{class:prefix$1+"-dropdown-wrap"},o);var a=null,s=null;var l=function(){if(a&&a.close()){a=null;window.removeEventListener("mousedown",s)}};o.addEventListener("mousedown",(function(e){e.preventDefault();markMenuEvent(e);if(a){l()}else{a=r.expand(i,n.dom);window.addEventListener("mousedown",s=function(){if(!isMenuEvent(i)){l()}})}}));function c(e){var t=n.update(e);i.style.display=t?"":"none";return t}return{dom:i,update:c}};Dropdown.prototype.expand=function e(t,r){var n=crelt("div",{class:prefix$1+"-dropdown-menu "+(this.options.class||"")},r);var o=false;function i(){if(o){return}o=true;t.removeChild(n);return true}t.appendChild(n);return{close:i,node:n}};function renderDropdownItems(e,t){var r=[],n=[];for(var o=0;o<e.length;o++){var i=e[o].render(t);var a=i.dom;var s=i.update;r.push(crelt("div",{class:prefix$1+"-dropdown-item"},a));n.push(s)}return{dom:r,update:combineUpdates(n,r)}}function combineUpdates(e,t){return function(r){var n=false;for(var o=0;o<e.length;o++){var i=e[o](r);t[o].style.display=i?"":"none";if(i){n=true}}return n}}var DropdownSubmenu=function e(t,r){this.options=r||{};this.content=Array.isArray(t)?t:[t]};DropdownSubmenu.prototype.render=function e(t){var r=renderDropdownItems(this.content,t);var n=crelt("div",{class:prefix$1+"-submenu-label"},translate(t,this.options.label));var o=crelt("div",{class:prefix$1+"-submenu-wrap"},n,crelt("div",{class:prefix$1+"-submenu"},r.dom));var i=null;n.addEventListener("mousedown",(function(e){e.preventDefault();markMenuEvent(e);setClass(o,prefix$1+"-submenu-wrap-active");if(!i){window.addEventListener("mousedown",i=function(){if(!isMenuEvent(o)){o.classList.remove(prefix$1+"-submenu-wrap-active");window.removeEventListener("mousedown",i);i=null}})}}));function a(e){var t=r.update(e);o.style.display=t?"":"none";return t}return{dom:o,update:a}};function renderGrouped(e,t){var r=document.createDocumentFragment();var n=[],o=[];for(var i=0;i<t.length;i++){var a=t[i],s=[],l=[];for(var c=0;c<a.length;c++){var u=a[c].render(e);var p=u.dom;var f=u.update;var d=crelt("span",{class:prefix$1+"item"},p);r.appendChild(d);l.push(d);s.push(f)}if(s.length){n.push(combineUpdates(s,l));if(i<t.length-1){o.push(r.appendChild(separator()))}}}function h(e){var t=false,r=false;for(var i=0;i<n.length;i++){var a=n[i](e);if(i){o[i-1].style.display=r&&a?"":"none"}r=a;if(a){t=true}}return t}return{dom:r,update:h}}function separator(){return crelt("span",{class:prefix$1+"separator"})}var icons={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}};var joinUpItem=new MenuItem({title:"Join with above block",run:joinUp,select:function(e){return joinUp(e)},icon:icons.join});var undoItem=new MenuItem({title:"Undo last change",run:undo,enable:function(e){return undo(e)},icon:icons.undo});var redoItem=new MenuItem({title:"Redo last undone change",run:redo,enable:function(e){return redo(e)},icon:icons.redo});function wrapItem(e,t){var r={run:function r(n,o){return wrapIn(e,t.attrs)(n,o)},select:function r(n){return wrapIn(e,t.attrs instanceof Function?null:t.attrs)(n)}};for(var n in t){r[n]=t[n]}return new MenuItem(r)}function blockTypeItem(e,t){var r=setBlockType(e,t.attrs);var n={run:r,enable:function e(t){return r(t)},active:function r(n){var o=n.selection;var i=o.$from;var a=o.to;var s=o.node;if(s){return s.hasMarkup(e,t.attrs)}return a<=i.end()&&i.parent.hasMarkup(e,t.attrs)}};for(var o in t){n[o]=t[o]}return new MenuItem(n)}function setClass(e,t,r){if(r){e.classList.add(t)}else{e.classList.remove(t)}}var prefix$2="ProseMirror-menubar";function isIOS(){if(typeof navigator=="undefined"){return false}var e=navigator.userAgent;return!/Edge\/\d/.test(e)&&/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e)}function menuBar(e){return new Plugin({view:function t(r){return new MenuBarView(r,e)}})}var MenuBarView=function e(t,r){var n=this;this.editorView=t;this.options=r;this.wrapper=crelt("div",{class:prefix$2+"-wrapper"});this.menu=this.wrapper.appendChild(crelt("div",{class:prefix$2}));this.menu.className=prefix$2;this.spacer=null;t.dom.parentNode.replaceChild(this.wrapper,t.dom);this.wrapper.appendChild(t.dom);this.maxHeight=0;this.widthForMaxHeight=0;this.floating=false;var o=renderGrouped(this.editorView,this.options.content);var i=o.dom;var a=o.update;this.contentUpdate=a;this.menu.appendChild(i);this.update();if(r.floating&&!isIOS()){this.updateFloat();var s=getAllWrapping(this.wrapper);this.scrollFunc=function(e){var t=n.editorView.root;if(!(t.body||t).contains(n.wrapper)){s.forEach((function(e){return e.removeEventListener("scroll",n.scrollFunc)}))}else{n.updateFloat(e.target.getBoundingClientRect&&e.target)}};s.forEach((function(e){return e.addEventListener("scroll",n.scrollFunc)}))}};MenuBarView.prototype.update=function e(){this.contentUpdate(this.editorView.state);if(this.floating){this.updateScrollCursor()}else{if(this.menu.offsetWidth!=this.widthForMaxHeight){this.widthForMaxHeight=this.menu.offsetWidth;this.maxHeight=0}if(this.menu.offsetHeight>this.maxHeight){this.maxHeight=this.menu.offsetHeight;this.menu.style.minHeight=this.maxHeight+"px"}}};MenuBarView.prototype.updateScrollCursor=function e(){var t=this.editorView.root.getSelection();if(!t.focusNode){return}var r=t.getRangeAt(0).getClientRects();var n=r[selectionIsInverted(t)?0:r.length-1];if(!n){return}var o=this.menu.getBoundingClientRect();if(n.top<o.bottom&&n.bottom>o.top){var i=findWrappingScrollable(this.wrapper);if(i){i.scrollTop-=o.bottom-n.top}}};MenuBarView.prototype.updateFloat=function e(t){var r=this.wrapper,n=r.getBoundingClientRect(),o=t?Math.max(0,t.getBoundingClientRect().top):0;if(this.floating){if(n.top>=o||n.bottom<this.menu.offsetHeight+10){this.floating=false;this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="";this.menu.style.display="";this.spacer.parentNode.removeChild(this.spacer);this.spacer=null}else{var i=(r.offsetWidth-r.clientWidth)/2;this.menu.style.left=n.left+i+"px";this.menu.style.display=n.top>window.innerHeight?"none":"";if(t){this.menu.style.top=o+"px"}}}else{if(n.top<o&&n.bottom>=this.menu.offsetHeight+10){this.floating=true;var a=this.menu.getBoundingClientRect();this.menu.style.left=a.left+"px";this.menu.style.width=a.width+"px";if(t){this.menu.style.top=o+"px"}this.menu.style.position="fixed";this.spacer=crelt("div",{class:prefix$2+"-spacer",style:"height: "+a.height+"px"});r.insertBefore(this.spacer,this.menu)}}};MenuBarView.prototype.destroy=function e(){if(this.wrapper.parentNode){this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)}};function selectionIsInverted(e){if(e.anchorNode==e.focusNode){return e.anchorOffset>e.focusOffset}return e.anchorNode.compareDocumentPosition(e.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function findWrappingScrollable(e){for(var t=e.parentNode;t;t=t.parentNode){if(t.scrollHeight>t.clientHeight){return t}}}function getAllWrapping(e){var t=[window];for(var r=e.parentNode;r;r=r.parentNode){t.push(r)}return t}const headingsRegEx=/^H[1-6]$/;const levelRegEx=/(\d+)(?:[^\d]+(\d+))?/;const forToC=0;const forPrint=1;const findTOC=e=>{let t=undefined;let r=0;e.nodesBetween(0,e.content.size,(function(e,n){if(e.type.name==="toc"){t=e;r=n}}));return[t,r]};const tocLevels=e=>{const t=e.match(levelRegEx);const r=Number(t[1]);const n=Number(t[2]?t[2]:r);return[r,n]};const renderToC=(e,t)=>{t.innerHTML="";t.className="toc";for(const r of e){const e=document.createElement("li");if(r[1]>0){e.style.marginLeft=String(1.5*r[1])+"em"}const n=document.createElement("span");n.textContent=r[0].trim();e.appendChild(n);const o=document.createElement("span");o.textContent=String(r[2]).trim();e.appendChild(o);t.appendChild(e)}};const pushToToC=(e,t,r,n,o,i,a)=>{if(n===0&&r&&r.test(e.tagName)){const r=Number(e.tagName.slice(1))-o;t.push([e.textContent,r,i,a])}};const findPageBreaks=(e,t,r,n,o,i=0)=>{const a=t.doc;const s=a.nodeAt(0).type.name==="header";let l;let c=0;if(r===forPrint){[l,c]=findTOC(a);if(l){o=l.attrs.start;i=l.attrs.end}}let u;if(i>0){let e="^(";for(let t=o;t<=i;t++){e+="H"+t+"|"}e=e.slice(0,-1)+")$";u=e.length>0?RegExp(e):null}const p=[];const[f]=document.getElementsByClassName("ProseMirror-example-setup-style");const d=f.cloneNode(true);const h=document.getElementById("print-div");const m=document.createDocumentFragment();let v;let g=a.attrs.pageSize==="letter"?11*96:297/25.4*96;if(s){v=document.getElementsByTagName("header")[0].childNodes[0].childNodes[0].cloneNode(true);v.classList.add("header");v.innerHTML=v.innerHTML.replace("$PAGE",'<span class="page-display"></span>');const e=document.getElementsByTagName("header")[0].getBoundingClientRect();g=g-137-(e.bottom-e.top)}else{g=g-137}const y=r===forPrint?2:1;const b=d.childNodes.length;for(let i=0;i<y;i++){h.innerHTML="";let a=s?1:0;let y=0;let w=1;while(a<b){const e=f.children[a].getBoundingClientRect().top;for(let t=a+1;t<b;t++){const r=f.children[t];if(r.tagName==="H1"&&r.getBoundingClientRect().top-e>.75*g){y=t-1;pushToToC(r,p,u,i,o,w+1,t);break}if(r.tagName==="H2"&&r.getBoundingClientRect().top-e>.85*g){y=t-1;pushToToC(r,p,u,i,o,w+1,t);break}let n=r.getBoundingClientRect().bottom;const a=r.getElementsByTagName("img");for(let e=0;e<a.length;e++){n=Math.max(n,a[e].getBoundingClientRect().bottom)}if(n-e>g){const e=p.length===0?0:p[p.length-1][3];y=headingsRegEx.test(f.children[t-1].tagName)||r.className==="indented"?t-2:t-1;if(y+1!==e){pushToToC(f.children[y+1],p,u,i,o,w+1,y+1);break}}pushToToC(r,p,u,i,o,w,t)}if(y===a-1){y=b-1}if(r===forPrint){if(s&&w>1){m.append(v.cloneNode(true))}const e=document.createElement("div");e.className="print-body";for(let t=a;t<=y;t++){e.append(d.children[t].cloneNode(true))}m.append(e);h.append(m)}a=y+1;w+=1}if(r===forPrint&&l&&i===0){const r={start:l.attrs.start,end:l.attrs.end,body:p};const o=t.tr;o.replaceWith(c,c+1,n.createAndFill(r));e.dispatch(o)}}if(r===forToC){return p}};function getCellAttrs(e,t){let r=e.getAttribute("data-colwidth");let n=r&&/^\d+(,\d+)*$/.test(r)?r.split(",").map((e=>Number(e))):null;let o=Number(e.getAttribute("colspan")||1);let i={colspan:o,rowspan:Number(e.getAttribute("rowspan")||1),colwidth:n&&n.length==o?n:null};for(let r in t){let n=t[r].getFromDOM;let o=n&&n(e);if(o!=null)i[r]=o}return i}function setCellAttrs(e,t){let r={};if(e.attrs.colspan!=1)r.colspan=e.attrs.colspan;if(e.attrs.rowspan!=1)r.rowspan=e.attrs.rowspan;if(e.attrs.colwidth)r["data-colwidth"]=e.attrs.colwidth.join(",");for(let n in t){let o=t[n].setDOMAttr;if(o)o(e.attrs[n],r)}return r}const functionRegEx=/ *function /;const nodes={doc:{content:"block+",attrs:{decimalFormat:{default:"1,000,000."},inDraftMode:{default:false},fileHandle:{default:null},fontSize:{default:12},pageSize:{default:"letter"},snapshots:{default:[]}}},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},indented_div:{content:"block+",group:"block",defining:true,parseDOM:[{tag:"div.indented"}],toDOM(){return["div",{class:"indented"},0]}},centered_div:{content:"block+",group:"block",defining:true,parseDOM:[{tag:"div.centered"}],toDOM(){return["div",{class:"centered"},0]}},blockquote:{content:"block+",group:"block",defining:true,parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:true,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:true,defining:true,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:true,attrs:{src:{},alt:{default:null},width:{default:null},class:{default:"inline"}},group:"inline",draggable:true,parseDOM:[{tag:"img[src]",getAttrs(e){return{src:e.getAttribute("src"),alt:e.getAttribute("alt"),width:e.getAttribute("width"),class:e.getAttribute("class")}}}],toDOM(e){return["img",e.attrs]}},toc:{atom:true,attrs:{start:{default:1},end:{default:2},body:{default:[]}},group:"block",draggable:true,parseDOM:[{tag:"ul.toc",getAttrs(e){const[t,r]=tocLevels(e.getAttribute("data-levels"));const n=JSON.parse(e.getAttribute("data-body"));return{start:t,end:r,body:n}}}],toDOM(e){const t=document.createElement("ul");t.dataset.levels=String(e.attrs.start)+".."+String(e.attrs.end);t.dataset.body=JSON.stringify(e.attrs.body);renderToC(e.attrs.body,t);return t}},ordered_list:{attrs:{order:{default:1}},content:"list_item+",group:"block",parseDOM:[{tag:"ol",getAttrs(e){return{order:e.hasAttribute("start")?+e.getAttribute("start"):1}}}],toDOM(e){return e.attrs.order==1?["ol",0]:["ol",{start:e.attrs.order},0]}},bullet_list:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM(){return["ul",0]}},list_item:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM(){return["li",0]},defining:true},hard_break:{inline:true,group:"inline",selectable:false,parseDOM:[{tag:"br"}],toDOM(){return["br"]}},table:{content:"table_row+",tableRole:"table",group:"block",attrs:{class:{default:"grid"}},parseDOM:[{tag:"table",getAttrs(e){return{class:e.getAttribute("class")||"grid"}}}],toDOM(e){return["table",{class:e.attrs.class},["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}},table_cell:{content:"block+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"cell",isolating:true,parseDOM:[{tag:"td",getAttrs:e=>getCellAttrs(e,[])}],toDOM(e){return["td",setCellAttrs(e,[]),0]}},table_header:{content:"block+",attrs:{colspan:{default:1},rowspan:{default:1},colwidth:{default:null},background:{default:null}},tableRole:"header_cell",isolating:true,parseDOM:[{tag:"th",getAttrs:e=>getCellAttrs(e,[])}],toDOM(e){return["th",setCellAttrs(e,[]),0]}},header:{content:"table",group:"block",defining:true,parseDOM:[{tag:"header"}],toDOM(){return["header",0]}},calculation:{atom:true,defining:false,marks:"",group:"inline",inline:true,attrs:{entry:{default:""},displayMode:{default:false},name:{default:null},tex:{default:""},alt:{default:""},rpn:{default:null},inDraftMode:{default:false},resulttemplate:{default:null},altresulttemplate:{default:null},resultdisplay:{default:null},template:{default:null},altTemplate:{default:""},value:{default:null},unit:{default:""},expos:{default:null},factor:{default:null},gauge:{default:null},dtype:{default:0},isFetch:{default:false},error:{default:false}},parseDOM:[{tag:"span.hurmet-calc",getAttrs(e){const t=Boolean(e.getAttribute("data-display"))||false;return{entry:e.getAttribute("data-entry"),displayMode:t}}}],toDOM(e){let t;t=document.createElement("span");t.classList="hurmet-calc";if(e.attrs.dtype&&e.attrs.dtype===hurmet.dt.DRAWING){t=document.createElement("span");t.appendChild(hurmet.draw.renderSVG(e.attrs.resultdisplay))}else if(e.attrs.dtype&&e.attrs.dtype===hurmet.dt.MODULE&&functionRegEx.test(e.attrs.entry)){t.appendChild(document.createElement("pre"));t.firstChild.appendChild(document.createElement("code"));t.firstChild.firstChild.textContent=e.attrs.entry}else if(e.attrs.inDraftMode||!e.attrs.tex){t.appendChild(document.createElement("code"));t.firstChild.textContent=e.attrs.alt?e.attrs.alt:e.attrs.entry}else{const r=e.attrs.tex;const n="MozAppearance"in document.documentElement.style;if(n){temml.render(r,t,{displayMode:e.attrs.displayMode,trust:e=>e.command==="\\class"&&e.class==="special-fraction"})}else{katex.render(r,t,{displayMode:e.attrs.displayMode,output:"html",strict:false,macros:{"\\class":"\\htmlClass"},throwOnError:false,minRuleThickness:.06,trust:e=>e.command==="\\htmlClass"&&e.class==="special-fraction"})}}t.dataset.entry=e.attrs.entry;if(e.attrs.displayMode){t.dataset.display="true"}return t}},tex:{atom:true,marks:"",group:"inline",inline:true,attrs:{tex:{default:""},displayMode:{default:false}},parseDOM:[{tag:"span.hurmet-tex",getAttrs(e){const t=Boolean(e.getAttribute("data-display"))||false;return{tex:e.getAttribute("data-tex"),displayMode:t}}}],toDOM(e){const t=document.createElement("span");t.classList="hurmet-tex";const r=e.attrs.tex;t.dataset.tex=r;if(e.attrs.displayMode){t.dataset.display="true"}katex.render(r,t,{displayMode:e.attrs.displayMode,strict:false,output:"html",throwOnError:false,minRuleThickness:.06});return t}},comment:{atom:true,marks:"",group:"inline",inline:true,attrs:{comment:{default:""}},parseDOM:[{tag:"span.hurmet-comment",getAttrs(e){return{comment:e.getAttribute("data-comment")}}}],toDOM(e){const t=document.createElement("span");t.className="hurmet-comment";t.dataset.comment=e.attrs.comment;const r=document.createElement("span");r.className="left-triangle";t.appendChild(r);const n=document.createElement("span");n.className="comment-payload";n.appendChild(hurmet.renderMD(e.attrs.comment));t.appendChild(n);return t}}};const marks={link:{attrs:{href:{},title:{default:null}},inclusive:false,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM(e){return["a",e.attrs]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!="normal"&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong"]}},code:{parseDOM:[{tag:"code"}],toDOM(){return["code"]}},subscript:{excludes:"superscript",parseDOM:[{tag:"sub"}],toDOM(){return["sub"]}},superscript:{excludes:"subscript",parseDOM:[{tag:"sup"}],toDOM(){return["sup"]}},strikethru:{parseDOM:[{tag:"del"}],toDOM(){return["del"]}},underline:{parseDOM:[{tag:"u"}],toDOM(){return["u"]}},highlight:{parseDOM:[{tag:"mark"}],toDOM(){return["mark"]}}};function wrapInList(e,t){return function(r,n){let{$from:o,$to:i}=r.selection;let a=o.blockRange(i),s=false,l=a;if(!a)return false;if(a.depth>=2&&o.node(a.depth-1).type.compatibleContent(e)&&a.startIndex==0){if(o.index(a.depth-1)==0)return false;let e=r.doc.resolve(a.start-2);l=new NodeRange(e,e,a.depth);if(a.endIndex<a.parent.childCount)a=new NodeRange(o,r.doc.resolve(i.end(a.depth)),a.depth);s=true}let c=findWrapping(l,e,t,a);if(!c)return false;if(n)n(doWrapInList(r.tr,a,c,s,e).scrollIntoView());return true}}function doWrapInList(e,t,r,n,o){let i=Fragment.empty;for(let e=r.length-1;e>=0;e--)i=Fragment.from(r[e].type.create(r[e].attrs,i));e.step(new ReplaceAroundStep(t.start-(n?2:0),t.end,t.start,t.end,new Slice(i,0,0),r.length,true));let a=0;for(let e=0;e<r.length;e++)if(r[e].type==o)a=e+1;let s=r.length-a;let l=t.start+r.length-(n?2:0),c=t.parent;for(let r=t.startIndex,n=t.endIndex,o=true;r<n;r++,o=false){if(!o&&canSplit(e.doc,l,s)){e.split(l,s);l+=2*s}l+=c.child(r).nodeSize}return e}const schema=new Schema({nodes:nodes,marks:marks});const prefix$3="ProseMirror-prompt";function openPrompt(e){const t=document.body.appendChild(document.createElement("div"));t.className=prefix$3;const r=e=>{if(!t.contains(e.target)){n()}};setTimeout((()=>window.addEventListener("mousedown",r)),50);const n=()=>{window.removeEventListener("mousedown",r);if(t.parentNode){t.parentNode.removeChild(t)}};const o=[];for(const t in e.fields){if(!(t==="src"&&e.fields.src.options.value)){o.push(e.fields[t].render())}}const i=document.createElement("button");i.type="submit";i.className=prefix$3+"-submit";i.textContent="OK";const a=document.createElement("button");a.type="button";a.className=prefix$3+"-cancel";a.textContent="Cancel";a.addEventListener("click",n);const s=t.appendChild(document.createElement("form"));if(e.title){s.appendChild(document.createElement("h5")).textContent=e.title}if(e.note){const t=document.createElement("p");t.textContent=e.note;s.append(t)}o.forEach((e=>{s.appendChild(document.createElement("div")).appendChild(e)}));if(e.radioButtons){const t=document.createElement("div");const r=e.radioButtons.current;e.radioButtons.labels.forEach((n=>{const o=document.createElement("input");o.type="radio";o.name=e.radioButtons.name;o.value=n;o.setAttribute("id",n);if(n===r){o.setAttribute("checked",null)}const i=document.createElement("label");i.setAttribute("for",n);i.appendChild(document.createTextNode(n));t.appendChild(o);t.appendChild(i)}));s.appendChild(t)}const l=s.appendChild(document.createElement("div"));l.className=prefix$3+"-buttons";l.appendChild(i);l.appendChild(document.createTextNode(" "));l.appendChild(a);if(e.useOkButton){l.lastChild.style.float="right";l.style.display="block"}const c=t.getBoundingClientRect();t.style.top=(window.innerHeight-c.height)/2+"px";t.style.left=(window.innerWidth-c.width)/2+"px";const u=()=>{const t=getValues(e.fields,o);if(e.radioButtons){t.class=s[e.radioButtons.name].value}if(t){n();e.callback(t)}};s.addEventListener("submit",(e=>{e.preventDefault();u()}));s.addEventListener("keydown",(r=>{if(r.keyCode===27){r.preventDefault();n()}else if(r.keyCode===13){const t=e.useOkButton&&r.shiftKey?true:!e.useOkButton&&!(r.ctrlKey||r.metaKey||r.shiftKey)?true:false;if(t){r.preventDefault();u()}}else if(r.keyCode===9){window.setTimeout((()=>{if(!t.contains(document.activeElement)){n()}}),500)}}));const p=s.elements[0];if(p){p.focus()}}function getValues(e,t){const r=Object.create(null);let n=0;for(const o in e){if(o==="src"&&e.src.options.value){r.src=e.src.options.value}else{const i=e[o];const a=t[n++];const s=i.read(a);const l=i.validate(s);if(l){reportInvalid(a,l);return null}r[o]=i.clean(s)}}return r}function reportInvalid(e,t){const r=e.parentNode;const n=r.appendChild(document.createElement("div"));n.style.left=e.offsetLeft+e.offsetWidth+2+"px";n.style.top=e.offsetTop-5+"px";n.className="ProseMirror-invalid";n.textContent=t;setTimeout((()=>r.removeChild(n)),1500)}class Field{constructor(e){this.options=e}read(e){return e.value}validateType(e){}validate(e){if(!e&&this.options.required){return"Required field"}return this.validateType(e)||this.options.validate&&this.options.validate(e)}clean(e){return this.options.clean?this.options.clean(e):e}}class TextField extends Field{render(){const e=document.createElement("input");e.type="text";e.placeholder=this.options.label;e.value=this.options.value||"";e.autocomplete="off";return e}}class TextAreaField extends Field{render(){const e=document.createElement("textarea");e.maxLength=5e3;e.cols=80;e.rows=4;e.placeholder=this.options.label;e.value=this.options.value;e.autocomplete="off";return e}}const prefix$4="ProseMirror-prompt";function openSelectPrompt(e,t,r){const n=document.body.appendChild(document.createElement("div"));n.className=prefix$4;const o=e=>{if(!n.contains(e.target)){i()}};setTimeout((()=>window.addEventListener("mousedown",o)),50);const i=()=>{window.removeEventListener("mousedown",o);if(n.parentNode){n.parentNode.removeChild(n)}};const a=n.appendChild(document.createElement("form"));a.appendChild(document.createElement("h5")).textContent=e;for(let e=0;e<t.length;e++){const n=document.createElement("button");n.type="button";n.className=prefix$4+"-button";n.textContent=t[e].textContent;n.dataset.pos=t[e].pos;n.onclick=function(e){const t=e.target.dataset.pos;i();r(t)};a.appendChild(n)}const s=n.getBoundingClientRect();n.style.top=(window.innerHeight-s.height)/2+"px";n.style.left=(window.innerWidth-s.width)/2+"px"}function draftMode(e,t,r){const n=!e.doc.attrs.inDraftMode;e.doc.attrs.inDraftMode=n;const o=e.tr;e.doc.nodesBetween(0,e.doc.content.size,(function(e,t){if(e.type.name==="calculation"){const i=Object.assign({},e.attrs);i.inDraftMode=n;o.replaceWith(t,t+1,r.createAndFill(i))}}));t(o)}const isIn=(e,t)=>{if(t.length===0){return false}let r=0;let n=0;let o=t.length-1;while(n<o){r=Math.floor((n+o)/2);if(e>t[r]){n=r+1}else{o=r}}return e===t[n]};const clone=e=>{if(null==e||"object"!=typeof e){return e}if(e instanceof Date){return(new Date).setTime(e.valueOf())}if(Array.isArray(e)){const t=[];for(let r=0,n=e.length;r<n;r++){t[r]=clone(e[r])}return t}if(e instanceof Map){const t=new Map;for(const[r,n]of e.entries()){t.set(r,clone(n))}return t}if(typeof e==="object"){const t=Object.create(null);Object.entries(e).forEach((([e,r])=>{t[e]=clone(r)}));return t}throw new Error("Unable to clone obj! Its type isn't supported.")};const mapMap=(e,t)=>{const r=new Map;for(const[n,o]of e.entries()){r.set(n,t(o))}return r};const arrayOfRegExMatches=(e,t)=>{if(e.constructor!==RegExp){throw new Error("not RegExp")}const r=[];let n=null;if(e.global){while(n=e.exec(t)){r.push({value:n[0],index:n.index,length:n[0].length})}}else if(n=e.exec(t)){r.push({value:n[0],index:n.index,length:n[0].length})}return r};const textAccent={"":"`","":"'","":"^","":"~","":"=","":"=","":"u","":".","":'"',"":"r","":"v"};const escapeRegEx=/[#$&%_~^]/g;const accentRegEx=/[\u0300-\u0308\u030A\u030c]/g;const addTextEscapes=e=>{if(e.length>1){let t=arrayOfRegExMatches(escapeRegEx,e);let r=t.length;if(r>0){for(let n=r-1;n>=0;n--){const r=t[n];const o=r.index;if(r.value==="~"){e=e.slice(0,o)+"\\textasciitilde "+e.slice(o+1)}else if(r.value==="^"){e=e.slice(0,o)+"\\textasciicircum "+e.slice(o+1)}else if(o===0){e="\\"+e}else{const t=e.substr(o-1,1);if(t!=="\\"){e=e.slice(0,o)+"\\"+e.slice(o)}}}}t=arrayOfRegExMatches(accentRegEx,e);r=t.length;if(r>0){for(let n=r-1;n>=0;n--){const r=t[n];const o=r.index;if(o>0){e=e.slice(0,o-1)+"\\"+textAccent[r.value]+e.slice(o-1,o)+e.slice(o+1)}}}}return e};const numeralFromSuperScript=e=>{switch(e){case"":return"2";case"":return"3";case"":return"-";case"":return"1";case"":return"0";default:return String.fromCharCode(e.charCodeAt(0)-8256)}};const leadingSpaceRegEx=/^[ \r\n\f]+/;const trailingSpaceRegEx=/[ \r\n\f]+$/;const tablessTrim=e=>e.replace(leadingSpaceRegEx,"").replace(trailingSpaceRegEx,"");const midDotRegEx=/^(\*||\.|-[A-Za-z])/;const exponentRegEx=/[\u2074-\u2079]/;const unitTeXFromString=e=>{let t=" {\\text{";let r=false;for(let n=0;n<e.length;n++){let o=e.charAt(n);if(exponentRegEx.test(o)){o=numeralFromSuperScript(o)}if(midDotRegEx.test(e.slice(n))){t+="}\\mkern1mu{\\cdot}\\mkern1mu\\text{"}else if(/[0-9-]/.test(o)){o=o==="-"?"\\text{-}":o;if(r){t+=o}else{t+="}^{"+o;r=true}}else if(o==="^"){t+="}^{";r=true}else if(r){t+="}\\text{"+o;r=false}else if(o==="$"){t+="\\$"}else{t+=o}}return t+"}}"};const allZeros=Object.freeze([0,0,0,0,0,0,0,0]);const dt=Object.freeze({NULL:0,RATIONAL:1,COMPLEX:2,BOOLEAN:4,FROMCOMPARISON:8,BOOLEANFROMCOMPARISON:12,STRING:16,QUANTITY:32,DATE:64,RANGE:128,TUPLE:256,MAP:512,ROWVECTOR:1024,COLUMNVECTOR:2048,MATRIX:4096,DATAFRAME:8192,MODULE:16384,ERROR:32768,UNIT:65536,DRAWING:131072,RICHTEXT:262144});const errorMessages=Object.freeze({EN:{ERROR:"Error. Hurmet does not understand the expression.",ERR_FUNC:"@",BAD_FUN_NM:'Error. Unrecognized function name "@".',DIV:"Error. Divide by zero.",NAN:"Error. Value of $@$ is not a numeric.",NANARG:"Error. Argument to function $@$ must be numeric.",NULL:"Error. Missing value for $@$.",V_NAME:"Error. Variable $@$ not found.",F_NAME:"Error. Function @ not found.",NAN_OP:"Error. Arithmetic operation on a non-numeric value.",UNIT_ADD:"Error. Adding incompatible units.",UNIT_COMP:"Error. Comparing incompatible units.",UNIT_APEND:"Error. Apppending incompatible units.",UNIT_RES:"Error. Calculated units are not compatible with the desired result unit:",UNIT_MISS:"Error. No units specified for the result.",UNIT_IN:"Error. Incorrect unit for input to function @.",UNIT_ARG:"Error. Unit mis-match between arguments to function @.",UNIT_COL:"Error. Data frame column @ has no units. Do not make a unit-aware call to it.",UNIT_AWARE:"Error. Calculation must be unit-aware in order to apply unit @",DATE:"Error. Date required.",LOGIC:"Error. Logic operation @ on a non-boolean value.",FACT:"Error. Factorial may be applied only to a unit-less non-negative integer.",PER:"Error. Percentage may be applied only to a unit-less number.",BINOM:"Error. Binomial may be applied only to unit-less numbers.",LOGF:"Error. Argument to log!() must be a non-negative integer.","0":"Error. (0) is infinite.","POLE":"Error. () of a negative integer is infinite.","LOG":"Error. Argument to Hurmet log() must be a positive number.",TAN90:"Error. tan($@$) is infinite.",ATRIG:"Error. Input to @ must be between -1 and 1.",COT:"Error. Input to @ must not be zero.",ASEC:"Error. Absolute value of input to @ must be  1",STRING:"Error. Text operand required.",NUMARGS:"Error. Wrong number of arguments passed to function @.",NONSQUARE:"Error. Only a square matrix can be inverted.",SINGULAR:"Error. Matrix is singular and cannot be inverted.",BAD_ROW_NAME:"Error. Data frame does not have a row named @.",BAD_COLUMN_NAME:"Error. Data frame does not have a column named @.",SINGLE_ARG:"Error. A call to a data frame must have two arguments in the brackets.",BAD_TYPE:"Error. Unrecognized data type for $@$.",CONCAT:'Error. Cannot add strings. Use "&" if concatenation is desired.',MATRIX_DIV:"Error. Cannot divide one matrix by another.",MATRIX_MOD:"Error. Cannot take the modulo of one matrix by another.",BAD_INDEX:"Error. Index to a matrix must be numeric.",FUNC_LINE:"Error in function @.",BAD_BREAK:"Error in function @. break called outside of a loop",FETCH:"Error. A fetch() function must be the only item in its expression.",STR_INDEX:"Error. The index to text may be only a real number or a range.",UNIT_NAME:"Error. Unrecognized unit name: @",INT_NUM:'Error. Number display type "@" must be an integer.',TWO_MAPS:"Error. Both operands are maps. Hurmet accepts only one.",BAD_FORMAT:"Error. Invalid format @.",BAD_PREC:"Error. Significant digit specification must be between 1 and 15.",ZERO_ROOT:"Error. Zeroth root.",BAD_ROOT:"Error while taking root.",UNREAL:'Error. Argument to function "@" must be a real number.',BIGINDEX:"Error. Index too large.",MIS_ELNUM:"Error. Mis-matched number of elements",CROSS:"Error. Cross product can be performed only on three-vectors. Use * if you want element-wise multiplication.",QUANT_NUM:"Error. A Quantity must include a numeric magnitude.",CURRENCY:"Error. Currency exchange rates must be defined before using a monetary unit.",DF_UNIT:'Invalid unit "&" in data frame.',FORM_FRAC:"Error. Hurmet can do binary or hexadecimal format only on integers.",PRIVATE:"Error. Function @ is not private.",GCD:"Error. The gcd function can take only integers as arguments.",BAD_KEY:'Error. Data structure does not contain key "@".',NUM_KEY:"Error. A key must be a string, not a number.",IMMUT_UDF:`Error. Variable @ already contains a user-defined function.\n                Hurmet cannot assign a different value to @.`,NO_PROP:`Error. Cannot call a property from variable "@" because it has no properties.`,NOT_ARRAY:`Error. Cannot check if an element is in the second operand because\n the second operand is not an array.`,MULT_MIS:"Error. Mismatch in number of multiple assignment.",COUNT:"Error. The count() function works only on strings.",NOT_VECTOR:"Error. Arguments to dataframe() must be vectors.",BAD_DISPLAY:"Error. Result may not be suppressed. Use '?' display selector.",NA_COMPL_OP:'Error. "@" cannot be performed on a complex number.',NA_REAL:'Error. "@" can be performed only a complex number.',ORIGIN:'Error. Function "@" is undefined at the origin.',LOG_ZERO:"Error. Logarithm of zero is negative infinity.",END_MISS:"Error. Too few END statments in function @.",BAD_CONCAT:"Error. Unmatched dimensions.",BAD_KEYSTR:"Error. The key in a key:value pair must be a string.",BAD_APPEND:"Error. Can not append a @",MAP_APPEND:"Error. Can not append. Wrong data type.",BAD_J:"Error. Do not use j for a loop index. In Hurmet, j = (-1)"}});const errorOprnd=(e,t)=>{if(e===""){return{value:"Error",unit:null,dtype:dt.ERROR}}let r=errorMessages["EN"][e];if(r===undefined){return{value:"Error",unit:null,dtype:dt.ERROR}}if(t){t=addTextEscapes(t);r=r.replace(/@/g,t)}else{r=r.replace(/@ ?/,"")}return{value:r,unit:null,dtype:dt.ERROR}};const iZero=BigInt(0);const iOne=BigInt(1);const iTwo=BigInt(2);const zero=[iZero,iOne];const one=[iOne,iOne];const two=[iTwo,iOne];const pi$1=[BigInt(3141592653589793e34),BigInt(1e49)];const e$1=[BigInt(2718281828459045e42),BigInt(1e57)];const hbar=[BigInt(1054571817),BigInt(1e43)];const intAbs=e=>e>=iZero?e:BigInt(-1)*e;const numberPattern="^(-?)(?:(0x[0-9A-Fa-f]+)|([0-9]+)(?: ([0-9]+)\\/([0-9]+)|(?:\\.([0-9]+))?(?:e([+-]?[0-9]+)|(%))?))";const numberRegEx=new RegExp(numberPattern);const fromNumber=e=>{if(Number.isInteger(e)){return[BigInt(e),iOne]}else{const t=e.toExponential().match(numberRegEx);const r=t[6]||"";const n=BigInt(t[7])-BigInt(r.length);if(n<0){return[BigInt(t[1]+t[3]+r),BigInt(10)**-n]}else if(t[5]){const e=BigInt(t[5]);return normalize$1([BigInt(t[1]+t[3])*e+BigInt(t[4])])}else{return normalize$1([BigInt(t[1]+t[3]+r)*BigInt(10)**n,iOne])}}};const fromString=e=>{const t=e.match(numberRegEx);let r;if(t[5]){const e=BigInt(t[5]);const n=BigInt(t[1]+t[3])*e+BigInt(t[4]);r=normalize$1([n,e])}else if(t[2]){r=[BigInt(t[2]),iOne]}else{const e=t[6]||"";const n=BigInt(t[3]+e);const o=t[7]?BigInt(t[7])-BigInt(e.length):t[8]?BigInt(-2)-BigInt(e.length):BigInt(0)-BigInt(e.length);r=o<0?[n,BigInt(10)**-o]:normalize$1([n*BigInt(10)**o,iOne])}if(t[1]){r=negate(r)}return r};const gcdi=(e,t)=>{e=intAbs(e);t=intAbs(t);while(t!==iZero){const r=e%t;e=t;t=r}return e};const gcd=(e,t)=>{if(!Rnl.isInteger(e)||!Rnl.isInteger(t)){return errorOprnd("GCD")}return[gcdi(e[0]/e[1],t[0]/t[1]),iOne]};const normalize$1=e=>{const[t,r]=e;if(r===iOne){return e}const n=gcdi(t,r);return n===iOne?e:[t/n,r/n]};const isRational=e=>Array.isArray(e)&&e.length===2&&typeof e[0]==="bigint"&&typeof e[1]==="bigint";const isInteger=e=>e[1]===iOne||e[0]%e[1]===iZero;const isZero=e=>e[0]===iZero;const isNegative=e=>e[0]<iZero;const isPositive=e=>e[0]>iZero;const negate=e=>[BigInt(-1)*e[0],e[1]];const abs=e=>{const t=e[0]<iZero?BigInt(-1)*e[0]:e[0];return[t,e[1]]};const increment=e=>[e[0]+e[1],e[1]];const decrement=e=>[e[0]-e[1],e[1]];const floor=e=>{if(e[0]%e[1]===iZero){return[e[0]/e[1],iOne]}return e[0]>=iZero?[e[0]/e[1],iOne]:[e[0]/e[1]-iOne,iOne]};const ceil=e=>{if(e[0]%e[1]===iZero){return[e[0]/e[1],iOne]}return e[0]>=iZero?[e[0]/e[1]+iOne,iOne]:[e[0]/e[1],iOne]};const add$1=(e,t)=>e[1]===t[1]?[e[0]+t[0],e[1]]:normalize$1([e[0]*t[1]+t[0]*e[1],e[1]*t[1]]);const subtract=(e,t)=>e[1]===t[1]?[e[0]-t[0],e[1]]:normalize$1([e[0]*t[1]-t[0]*e[1],e[1]*t[1]]);const multiply=(e,t)=>[e[0]*t[0],e[1]*t[1]];const divide=(e,t)=>{let r=e[0]*t[1];let n=e[1]*t[0];if(n<0){r*=BigInt(-1);n*=BigInt(-1)}return[r,n]};const power=(e,t)=>{if(t[0]===iZero){return[iOne,iOne]}else{t=normalize$1(t);let r;try{r=isInteger(t)&&isNegative(t)?[e[1]**(BigInt(-1)*t[0]),e[0]**(BigInt(-1)*t[0])]:isInteger(t)?[e[0]**t[0],e[1]**t[0]]:isPositive(e)||greaterThan(t,one)||lessThan(t,negate(one))?fromNumber(toNumber(e)**toNumber(t)):areEqual(modulo(t,two),one)?fromNumber(-1*(-1*toNumber(e))**toNumber(t)):errorOprnd("BAD_ROOT")}catch(n){r=fromNumber(toNumber(e)**toNumber(t))}return r}};const sqrt=e=>fromNumber(Math.sqrt(toNumber(e)));const exp=e=>fromNumber(Math.exp(toNumber(e)));const reciprocal=e=>{let t=e[1];let r=e[0];if(r<0){t*=BigInt(-1);r*=BigInt(-1)}return[t,r]};const hypot=(e,t)=>{const r=abs(e);const n=abs(t);const o=max(r,n);const i=min(r,n);const a=Rnl.divide(i,o);return Rnl.multiply(o,sqrt(Rnl.increment(Rnl.multiply(a,a))))};const modulo=(e,t)=>{const r=divide(normalize$1(e),normalize$1(t));return[intAbs(r[0]%r[1]),iOne]};const areEqual=(e,t)=>e[1]===t[1]?e[0]===t[0]:e[0]*t[1]===e[1]*t[0];const lessThan=(e,t)=>isNegative(e)!==isNegative(t)?isNegative(e):isNegative(subtract(e,t));const greaterThan=(e,t)=>isPositive(e)!==isPositive(t)?isPositive(e):isPositive(subtract(e,t));const lessThanOrEqualTo=(e,t)=>lessThan(e,t)||areEqual(e,t);const greaterThanOrEqualTo=(e,t)=>greaterThan(e,t)||areEqual(e,t);const max=(e,t)=>greaterThan(e,t)?[e[0],e[1]]:[t[0],t[1]];const min=(e,t)=>lessThan(e,t)?[e[0],e[1]]:[t[0],t[1]];const cos=e=>areEqual(e,divide(pi$1,two))?zero:fromNumber(Math.cos(toNumber(e)));const sin=e=>fromNumber(Math.sin(toNumber(e)));const tan=e=>{if(areEqual(e,divide(pi$1,two))){return errorOprnd("TAN90","/2")}return fromNumber(Math.tan(toNumber(e)))};const cosh=e=>{const t=toNumber(e);return fromNumber((Math.exp(t)+Math.exp(-t))/2)};const sinh=e=>{const t=toNumber(e);return fromNumber((Math.exp(t)-Math.exp(-t))/2)};const tanh=e=>{const t=toNumber(e);return fromNumber((Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t)))};const toNumber=e=>{const t=Number(e[0])/Number(e[1]);if(!isNaN(t)&&t!==Infinity){return t}const r=toStringSignificant(e,20);return Number(r)};const toStringSignificant=(e,t)=>{if(isZero(e)){return"0"}else{const r=intAbs(e[0]/e[1]);if(r>0){return toString(e,t-String(r).length)}else{const r=String(intAbs(e[1]/e[0])).length;return toString(e,r+t-1)}}};const toString=(e,t)=>{if(isZero(e)){return"0"}else if(t<0){const r=-t;const n=toString(divide(e,[BigInt(10)**BigInt(r),iOne]),0);return n+"0".repeat(r)}else{const[r,n]=normalize$1(e);const o=r/n;let i=r%n;let a=String(o);if(i===iZero&&t>0){a+="."+"0".repeat(t)}else if(i!==iZero){i=intAbs(i);const e=i*BigInt(10)**BigInt(t);let r=e/n;const s=e%n;if(t===0){return intAbs(iTwo*s)>=intAbs(n)?String(o+iOne):a}if(intAbs(iTwo*s)>=intAbs(n)){r=r+iOne}a+="."+String(r).padStart(t,"0")}return a}};const preComputedFactorials=["1","1","2","6","24","120","720","5040","40320","362880","3628800","39916800","479001600","6227020800","87178291200","1307674368000","20922789888000","355687428096000","6402373705728000","121645100408832000","2432902008176640000","51090942171709440000","1124000727777607680000","25852016738884976640000","620448401733239439360000","15511210043330985984000000","403291461126605635584000000","10888869450418352160768000000","304888344611713860501504000000","8841761993739701954543616000000","265252859812191058636308480000000","8222838654177922817725562880000000","263130836933693530167218012160000000","8683317618811886495518194401280000000","295232799039604140847618609643520000000","10333147966386144929666651337523200000000","371993326789901217467999448150835200000000","13763753091226345046315979581580902400000000","523022617466601111760007224100074291200000000","20397882081197443358640281739902897356800000000","815915283247897734345611269596115894272000000000","33452526613163807108170062053440751665152000000000","1405006117752879898543142606244511569936384000000000","60415263063373835637355132068513997507264512000000000","2658271574788448768043625811014615890319638528000000000","119622220865480194561963161495657715064383733760000000000","5502622159812088949850305428800254892961651752960000000000","258623241511168180642964355153611979969197632389120000000000","12413915592536072670862289047373375038521486354677760000000000","608281864034267560872252163321295376887552831379210240000000000","30414093201713378043612608166064768844377641568960512000000000000","1551118753287382280224243016469303211063259720016986112000000000000","80658175170943878571660636856403766975289505440883277824000000000000","4274883284060025564298013753389399649690343788366813724672000000000000","230843697339241380472092742683027581083278564571807941132288000000000000","12696403353658275925965100847566516959580321051449436762275840000000000000","710998587804863451854045647463724949736497978881168458687447040000000000000","40526919504877216755680601905432322134980384796226602145184481280000000000000","2350561331282878571829474910515074683828862318181142924420699914240000000000000","138683118545689835737939019720389406345902876772687432540821294940160000000000000","8320987112741390144276341183223364380754172606361245952449277696409600000000000000","507580213877224798800856812176625227226004528988036003099405939480985600000000000000","31469973260387937525653122354950764088012280797258232192163168247821107200000000000000","1982608315404440064116146708361898137544773690227268628106279599612729753600000000000000","126886932185884164103433389335161480802865516174545192198801894375214704230400000000000000","8247650592082470666723170306785496252186258551345437492922123134388955774976000000000000000","544344939077443064003729240247842752644293064388798874532860126869671081148416000000000000000","36471110918188685288249859096605464427167635314049524593701628500267962436943872000000000000000","2480035542436830599600990418569171581047399201355367672371710738018221445712183296000000000000000","171122452428141311372468338881272839092270544893520369393648040923257279754140647424000000000000000","11978571669969891796072783721689098736458938142546425857555362864628009582789845319680000000000000000","850478588567862317521167644239926010288584608120796235886430763388588680378079017697280000000000000000","61234458376886086861524070385274672740778091784697328983823014963978384987221689274204160000000000000000","4470115461512684340891257138125051110076800700282905015819080092370422104067183317016903680000000000000000","330788544151938641225953028221253782145683251820934971170611926835411235700971565459250872320000000000000000","24809140811395398091946477116594033660926243886570122837795894512655842677572867409443815424000000000000000000","1885494701666050254987932260861146558230394535379329335672487982961844043495537923117729972224000000000000000000","145183092028285869634070784086308284983740379224208358846781574688061991349156420080065207861248000000000000000000","11324281178206297831457521158732046228731749579488251990048962825668835325234200766245086213177344000000000000000000","894618213078297528685144171539831652069808216779571907213868063227837990693501860533361810841010176000000000000000000","71569457046263802294811533723186532165584657342365752577109445058227039255480148842668944867280814080000000000000000000","5797126020747367985879734231578109105412357244731625958745865049716390179693892056256184534249745940480000000000000000000","475364333701284174842138206989404946643813294067993328617160934076743994734899148613007131808479167119360000000000000000000","39455239697206586511897471180120610571436503407643446275224357528369751562996629334879591940103770870906880000000000000000000","3314240134565353266999387579130131288000666286242049487118846032383059131291716864129885722968716753156177920000000000000000000","281710411438055027694947944226061159480056634330574206405101912752560026159795933451040286452340924018275123200000000000000000000","24227095383672732381765523203441259715284870552429381750838764496720162249742450276789464634901319465571660595200000000000000000000","2107757298379527717213600518699389595229783738061356212322972511214654115727593174080683423236414793504734471782400000000000000000000","185482642257398439114796845645546284380220968949399346684421580986889562184028199319100141244804501828416633516851200000000000000000000","16507955160908461081216919262453619309839666236496541854913520707833171034378509739399912570787600662729080382999756800000000000000000000","1485715964481761497309522733620825737885569961284688766942216863704985393094065876545992131370884059645617234469978112000000000000000000000","135200152767840296255166568759495142147586866476906677791741734597153670771559994765685283954750449427751168336768008192000000000000000000000","12438414054641307255475324325873553077577991715875414356840239582938137710983519518443046123837041347353107486982656753664000000000000000000000","1156772507081641574759205162306240436214753229576413535186142281213246807121467315215203289516844845303838996289387078090752000000000000000000000","108736615665674308027365285256786601004186803580182872307497374434045199869417927630229109214583415458560865651202385340530688000000000000000000000","10329978488239059262599702099394727095397746340117372869212250571234293987594703124871765375385424468563282236864226607350415360000000000000000000000","991677934870949689209571401541893801158183648651267795444376054838492222809091499987689476037000748982075094738965754305639874560000000000000000000000","96192759682482119853328425949563698712343813919172976158104477319333745612481875498805879175589072651261284189679678167647067832320000000000000000000000","9426890448883247745626185743057242473809693764078951663494238777294707070023223798882976159207729119823605850588608460429412647567360000000000000000000000","933262154439441526816992388562667004907159682643816214685929638952175999932299156089414639761565182862536979208272237582511852109168640000000000000000000000","93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000"];const factorial=e=>{if(lessThan(e,[BigInt(101),iOne])){return fromString(preComputedFactorials[toNumber(e)])}else{return lanczos(increment(e))}};const lanczos=e=>{const t=subtract(e,one);const r=multiply(two,sqrt(divide(e$1,pi$1)));const n=power(divide(add$1(t,fromNumber(11.400511)),e$1),add$1(t,[iOne,iTwo]));const o=["2.48574089138753565546e-5","1.05142378581721974210","-3.45687097222016235469","4.51227709466894823700","-2.98285225323576655721","1.05639711577126713077","-0.195428773191645869583","0.0170970543404441224307","-0.000571926117404305781283","0.00000463399473359905636708","-0.00000000271994908488607703910"];let i=fromString(o[0]);for(let e=1;e<=10;e++){i=add$1(i,divide(fromString(o[e]),add$1(t,fromNumber(e))))}return multiply(multiply(r,n),i)};const Rnl=Object.freeze({fromNumber:fromNumber,fromString:fromString,normalize:normalize$1,isRational:isRational,isInteger:isInteger,isZero:isZero,isNegative:isNegative,isPositive:isPositive,negate:negate,abs:abs,increment:increment,decrement:decrement,exp:exp,floor:floor,ceil:ceil,add:add$1,subtract:subtract,multiply:multiply,divide:divide,reciprocal:reciprocal,gcd:gcd,hbar:hbar,modulo:modulo,hypot:hypot,one:one,pi:pi$1,power:power,sqrt:sqrt,two:two,cos:cos,sin:sin,tan:tan,cosh:cosh,sinh:sinh,tanh:tanh,areEqual:areEqual,lessThan:lessThan,greaterThan:greaterThan,lessThanOrEqualTo:lessThanOrEqualTo,greaterThanOrEqualTo:greaterThanOrEqualTo,factorial:factorial,lanczos:lanczos,max:max,min:min,numberPattern:numberPattern,toNumber:toNumber,toString:toString,toStringSignificant:toStringSignificant,zero:zero});const siPrefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];const groupByThreeRegEx=/\B(?=(\d{3})+$)/g;const groupByFourRegEx=/\B(?=(\d{4})+$)/g;const groupByLakhCroreRegEx=/(\d)(?=(\d\d)+\d$)/g;const superscript=e=>{let t="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);t+=n===49?"":n===50?"":n===51?"":String.fromCharCode(n+8256)}return t};const subscript=e=>{let t="";for(let r=0;r<e.length;r++){t+=String.fromCharCode(e.charCodeAt(r)+8272)}return t};const texFromMixedFraction=e=>(e[1]?"-":"")+e[3]+"\\,\\class{special-fraction}{\\text{"+superscript(e[4])+""+subscript(e[5])+"}}";const intAbs$1=e=>e>=BigInt(0)?e:BigInt(-1)*e;const roundedString=(e,t)=>{const r=t.numDigits;switch(t.ftype){case"h":{const t=String(Rnl.toString(e,0));if(t.replace("-","").length>=r){return t}if(r<1||r>15){return errorOprnd("BAD_PREC")}return Rnl.toNumber(e).toPrecision(r)}case"f":case"%":return Rnl.toString(e,r);case"r":case"p":{if(r<1||r>15){return errorOprnd("BAD_PREC")}const t=Rnl.toNumber(e).toPrecision(r);return t.indexOf("e")>-1?Number(t).toPrecision():t}case"s":case"S":case"e":case"E":case"n":case"N":case"k":if(r<1||r>15){return errorOprnd("BAD_PREC")}return Rnl.toNumber(e).toExponential(r-1).replace("+","");default:{e=Rnl.normalize(e);const r=Rnl.isNegative(e)?"-":"";const n=intAbs$1(e[0]);const o=e[1];switch(t.ftype){case"m":{const e=String(n/o);const t=n%o;return r+e+""+superscript(t)+""+subscript(o)}case"t":return r+String(n/o);case"b":case"x":case"X":if(o!==BigInt(1)){return errorOprnd("INT_NUM",t.ftype)}if(n<=Number.MAX_SAFE_INTEGER){return t.ftype==="b"?r+"0b"+Number(n).toString(2):t.ftype==="x"?r+"0x"+Number(n).toString(16):r+"0x"+Number(n).toString(16).toUpperCase()}else{return""}}}}};const formattedInteger=(e,t)=>{const r=t.charAt(1);if(r==="0"){return e}else if(t==="1,00,000."){return e.replace(groupByLakhCroreRegEx,"$1{,}")}else if(t==="1,0000,0000."){return e.replace(groupByFourRegEx,"$1{,}")}else{return e.replace(groupByThreeRegEx,r===","?"{,}":r===" "?"\\:":r===""?"":".")}};const formattedDecimal=(e,t,r)=>{const n=e.indexOf(".");if(n===-1){return formattedInteger(e,t)}else{const o=e.slice(0,n);const i=t.slice(-1);let a=(i==="."?".":"{,}")+e.slice(n+1);if(r){a=a.replace(/(\.|{,})?0+$/,"")}return formattedInteger(o,t)+a}};const format=(e,t="h3",r="1,000,000.")=>{if(Rnl.isZero(e)){return"0"}const n={ftype:t.charAt(0)};if(/[j]$/.test(t)){t=t.slice(0,-1)}if(t.length>1){n.numDigits=Number(t.slice(1))}if(n.ftype==="%"||n.ftype==="p"){e[0]=e[0]*BigInt(100)}if((n.ftype==="b"||n.ftype==="x")&&!Rnl.isInteger(e)){return errorOprnd("FORM_FRAC")}const o=roundedString(e,n);switch(n.ftype){case"f":case"r":case"h":return formattedDecimal(o,r,n.ftype==="h");case"t":return formattedInteger(o,r);case"%":case"p":return formattedDecimal(o,r)+"\\%";case"m":case"b":case"x":case"X":return o;default:{const e=o.indexOf("e");let t=o.slice(0,e);if(r.slice(-1)===","){t=t.replace(".","{,}")}switch(n.ftype){case"e":case"E":{const r=t+"\\text{"+n.ftype;if(o.charAt(e+1)==="-"){return r+"-}"+o.slice(e+2)}else{return r+"}"+o.slice(e+1)}}case"s":case"S":case"n":case"N":{const r=n.ftype==="S"?"":"\\mkern2mu{\\cdot}\\mkern1mu";return t+r+"10^{"+o.slice(e+1)+"}"}case"k":{const r=Number(o.slice(e+1));const n=r/3;const i=n>=0?Math.floor(n):Math.ceil(n);const a=r%3;if(a!==0){t=String(Number(t)*Math.pow(10,a))}return t+siPrefixes[8+i]}}}}};const prefixFactor=JSON.parse('{"Y":1e24,"yotta":1e24,"Z":1e21,"zetta":1e21,"E":1e18,"exa":1e18,"P":1e15,"peta":1e15,"T":1e12,"tera":1e12,"G":1e9,"giga":1e9,"M":1e6,"mega":1e6,"k":1000,"kilo":1000,"h":100,"hecto":100,"deka":10,"d":0.1,"deci":0.1,"c":0.01,"centi":0.01,"m":0.001,"milli":0.001,"":1e-6,"":1e-6,"micro":1e-6,"n":1e-9,"nano":1e-9,"p":1e-12,"pico":1e-12,"f":1e-15,"femto":1e-15,"a":1e-18,"atto":1e-18,"z":1e-21,"zepto":1e-21,"y":1e-24,"yocto":1e-24,"Ki":1024,"kibi":1024,"Mi":1048576,"mebi":1048576,"Gi":1073741824,"gibi":1073741824,"Ti":1099511627776,"tebi":1099511627776}');const unitTable=Object.freeze(JSON.parse(`{\n"#":["0.45359237", "1","0","0",[0,1,0,0,0,0,0,0]],\n"$":["1","1","0","USD",[0,0,0,0,0,0,0,1]],\n"":["1","1","0","GBP",[0,0,0,0,0,0,0,1]],\n"'":["0.3048","1","0","0",[1,0,0,0,0,0,0,0]],\n"A":["1","1","0","siSymbol",[0,0,0,1,0,0,0,0]],\n"AUD":["1.5553","1","0","AUD",[0,0,0,0,0,0,0,1]],\n"Adobe point":["0.0254","72","0","0",[1,0,0,0,0,0,0,0]],\n"At":["1","1","0","siSymbol",[0,0,0,0,1,0,1,0]],\n"Australian dollar":["1","1","0","AUD",[0,0,0,0,0,0,0,1]],\n"BRL":["5.5457","1","0","BRL",[0,0,0,0,0,0,0,1]],\n"BTU":["1055.056","1","0","0",[2,1,-2,0,0,0,0,0]],\n"BThU":["1055.056","1","0","0",[2,1,-2,0,0,0,0,0]],\n"Bq":["1","1","0","siSymbol",[0,0,-1,0,0,0,0,0]],\n"Brazilian Real":["1","1","0","BRL",[0,0,0,0,0,0,0,1]],\n"British Pound":["1","1","0","GBP",[0,0,0,0,0,0,0,1]],\n"Btu":["1055.056","1","0","0",[2,1,-2,0,0,0,0,0]],\n"C":["1","1","0","siSymbol",[0,0,1,1,0,0,0,0]],\n"C$":["1","1","0","CAD",[0,0,0,0,0,0,0,1]],\n"CAD":["1.4380","1","0","CAD",[0,0,0,0,0,0,0,1]],\n"CCF":["1","1","0","0",[3,0,0,0,0,0,0,0]],\n"CHF":["0.9856","1","0","CHF",[0,0,0,0,0,0,0,1]],\n"CNY":["7.3475","1","0","CNY",[0,0,0,0,0,0,0,1]],\n"CY":["0.764554857984","1","0","0",[3,0,0,0,0,0,0,0]],\n"Calorie":["4186.8","1","0","0",[2,1,-2,0,0,0,0,0]],\n"Canadian dollar":["1","1","0","CAD",[0,0,0,0,0,0,0,1]],\n"Celsius":["1","1","273.15","0",[0,0,0,0,1,0,0,0]],\n"Chinese Yuan":["1","1","0","CNY",[0,0,0,0,0,0,0,1]],\n"Ci":["37000000000","1","0","siSymbol",[0,0,-1,0,0,0,0,0]],\n"Ckm":["100000","1","0","siSymbol",[1,0,0,0,0,0,0,0]],\n"Da":["1.66053872e-24","1","0","siSymbol",[0,1,0,0,0,0,0,0]],\n"Dalton":["1.66053872e-24","1","0","0",[0,1,0,0,0,0,0,0]],\n"Didot point":["15.625","41559","0","0",[1,0,0,0,0,0,0,0]],\n"EB":["9223372036854770000","1","0","0",[0,0,0,0,0,1,0,0]],\n"EMU":["0.01","360000","0","0",[1,0,0,0,0,0,0,0]],\n"EUR":["1","1","0","EUR",[0,0,0,0,0,0,0,1]],\n"EiB":["9223372036854770000","1","0","0",[0,0,0,0,0,1,0,0]],\n"Euro":["1","1","0","EUR",[0,0,0,0,0,0,0,1]],\n"F":["1","1","0","siSymbol",[-2,-1,4,2,0,0,0,0]],\n"Fahrenheit":["5","9","459","0",[0,0,0,0,1,0,0,0]],\n"G":["0.0001","1","0","siSymbol",[-2,-2,-2,-1,0,0,0,0]],\n"GB":["8589934592","1","0","0",[0,0,0,0,0,1,0,0]],\n"GBP":["0.85950","1","0","GBP",[0,0,0,0,0,0,0,1]],\n"Gal":["0.01","1","0","siSymbol",[1,0,-2,0,0,0,0,0]],\n"Gi":["10","12.5663706143592","0","siWord",[0,0,0,0,1,0,1,0]],\n"GiB":["8589934592","1","0","0",[0,0,0,0,0,1,0,0]],\n"Gregorian year":["31556952","1","0","0",[0,0,1,0,0,0,0,0]],\n"Gy":["1","1","0","siSymbol",[2,0,-2,0,0,0,0,0]],\n"H":["1","1","0","siSymbol",[2,1,-2,-2,0,0,0,0]],\n"HK$":["1","1","0","HKD",[0,0,0,0,0,0,0,1]],\n"HKD":["8.2169","1","0","HKD",[0,0,0,0,0,0,0,1]],\n"HP":["745.69987158227","1","0","0",[2,1,-3,0,0,0,0,0]],\n"Hong Kong dollar":["1","1","0","HKD",[0,0,0,0,0,0,0,1]],\n"Hz":["1","1","0","siSymbol",[0,0,-1,0,0,0,0,0]],\n"ILS":["3.6128","1","0","ILS",[0,0,0,0,0,0,0,1]],\n"INR":["86.9535","1","0","INR",[0,0,0,0,0,0,0,1]],\n"Indian Rupee":["1","1","0","INR",[0,0,0,0,0,0,0,1]],\n"Israeli New Shekel":["1","1","0","ILS",[0,0,0,0,0,0,0,1]],\n"J":["1","1","0","siSymbol",[2,1,-2,0,0,0,0,0]],\n"JPY":["143.30","1","0","JPY",[0,0,0,0,0,0,0,1]],\n"Japanese Yen":["1","1","0","JPY",[0,0,0,0,0,0,0,1]],\n"Joule":["1","1","0","0",[2,1,-2,0,0,0,0,0]],\n"Julian year":["31557600","1","0","0",[0,0,1,0,0,0,0,0]],\n"Jy":["1e-26","1","0","siSymbol",[0,1,-2,0,0,0,0,0]],\n"K":["1","1","0","0",[0,0,0,0,1,0,0,0]],\n"KiB":["8192","1","0","0",[0,0,0,0,0,1,0,0]],\n"KRW":["1373.94","1","0","KRW",[0,0,0,0,0,0,0,1]],\n"L":["0.001","1","0","siSymbol",[3,0,0,0,0,0,0,0]],\n"Lego stud":["0.008","1","0","siSymbol",[1,0,0,0,0,0,0,0]],\n"MB":["8388608","1","0","0",[0,0,0,0,0,1,0,0]],\n"MCM":["5.06707479097497e-07","1","0","0",[2,0,0,0,0,0,0,0]],\n"MMBtu":["1055056000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"MMbbl":["158987.294928","1","0","0",[3,0,0,0,0,0,0,0]],\n"MMbblpd":["158987.294928","86400","0","0",[3,0,-1,0,0,0,0,0]],\n"MMscf":["28316.846592","1","0","0",[3,0,0,0,0,0,0,0]],\n"MMscfd":["0.32774128","1","0","0",[3,0,0,0,0,0,0,0]],\n"MT":["1000","1","0","0",[0,1,0,0,0,0,0,0]],\n"MXN":["20.8490","1","0","MXN",[0,0,0,0,0,0,0,1]],\n"Mach":["331.6","1","0","0",[1,0,-1,0,0,0,0,0]],\n"Mbbl":["158.987294928","1","0","0",[3,0,0,0,0,0,0,0]],\n"Mexican Peso":["1","1","0","MXN",[0,0,0,0,0,0,0,1]],\n"MiB":["8388608","1","0","0",[0,0,0,0,0,1,0,0]],\n"Mscfd":["0.00032774128","1","0","0",[3,0,0,0,0,0,0,0]],\n"Mscfh":["0.00786579072","1","0","0",[3,0,0,0,0,0,0,0]],\n"N":["1","1","0","siSymbol",[1,1,-2,0,0,0,0,0]],\n"NM":["1852","1","0","0",[1,0,0,0,0,0,0,0]],\n"PB":["9007199254740990","1","0","0",[0,0,0,0,0,1,0,0]],\n"PS":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"Pa":["1","1","0","siSymbol",[-1,1,-2,0,0,0,0,0]],\n"Pascal":["1","1","0","siWord",[-1,1,-2,0,0,0,0,0]],\n"Pferdestrke":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"PiB":["9007199254740990","1","0","0",[0,0,0,0,0,1,0,0]],\n"R":["0.000258","1","0","siSymbol",[0,-1,1,1,0,0,0,0]],\n"R$":["1","1","0","BRL",[0,0,0,0,0,0,0,1]],\n"RT":["3516.8532","1","0","0",[2,1,-3,0,0,0,0,0]],\n"RUB":["1","1","0","RUB",[0,0,0,0,0,0,0,1]],\n"S":["1","1","0","siSymbol",[-2,-1,3,2,0,0,0,0]],\n"SF":["0.09290304","1","0","0",[2,0,0,0,0,0,0,0]],\n"SY":["0.83612736","1","0","0",[2,0,0,0,0,0,0,0]],\n"Sv":["1","1","0","siSymbol",[2,0,-2,0,0,0,0,0]],\n"Swiss Franc":["1","1","0","CHF",[0,0,0,0,0,0,0,1]],\n"T":["1","1","0","siSymbol",[-2,-2,-2,-1,0,0,0,0]],\n"TB":["8796093022208","1","0","0",[0,0,0,0,0,1,0,0]],\n"TWD":["1","1","0","TWD",[0,0,0,0,0,0,0,1]],\n"TeX point":["0.0003515","1","0","0",[1,0,0,0,0,0,0,0]],\n"TiB":["8796093022208","1","0","0",[0,0,0,0,0,1,0,0]],\n"US$":["1","1","0","USD",[0,0,0,0,0,0,0,1]],\n"USD":["1.0559","1","0","USD",[0,0,0,0,0,0,0,1]],\n"V":["1","1","0","siSymbol",[2,1,-3,-1,0,0,0,0]],\n"VA":["1","1","0","siSymbol",[2,1,-3,0,0,0,0,0]],\n"W":["1","1","0","siSymbol",[2,1,-3,0,0,0,0,0]],\n"Wb":["1","1","0","siSymbol",[2,1,-2,-1,0,0,0,0]],\n"Wh":["3600","1","0","siSymbol",[2,1,-2,0,0,0,0,0]],\n"Won":["1","1","0","KRW",[0,0,0,0,0,0,0,1]],\n"Yen":["1","1","0","JPY",[0,0,0,0,0,0,0,1]],\n"a":["31556925.9747","1","0","siSymbol",[0,0,1,0,0,0,0,0]],\n"ac":["4046.8564224","1","0","0",[2,0,0,0,0,0,0,0]],\n"acre":["4046.8564224","1","0","0",[2,0,0,0,0,0,0,0]],\n"admiralty mile":["1853.188","1","0","0",[1,0,0,0,0,0,0,0]],\n"af":["1233.48183754752","1","0","0",[3,0,0,0,0,0,0,0]],\n"amp":["1","1","0","0",[0,0,0,1,0,0,0,0]],\n"ampere":["1","1","0","siWord",[0,0,0,1,0,0,0,0]],\n"ampere turn":["1","1","0","siWord",[0,0,0,0,1,0,1,0]],\n"amu":["1.66053872e-24","1","0","0",[0,1,0,0,0,0,0,0]],\n"angstrom":["0.0000000001","1","0","0",[1,0,0,0,0,0,0,0]],\n"angstrom star":["0.00000000010000015","1","0","0",[1,0,0,0,0,0,0,0]],\n"apostilb":["1","3.14159265358979","0","0",[-2,0,0,0,0,0,1,0]],\n"arcminute":["3.14159265358979","10800","0","0",[0,0,0,0,0,0,0,0]],\n"arcsecond":["3.14159265358979","648000","0","0",[0,0,0,0,0,0,0,0]],\n"are":["100","1","0","0",[2,0,0,0,0,0,0,0]],\n"as":["4.3.14159265358979","648000","0","0",[0,0,0,0,0,0,0,0]],\n"asb":["1","3.14159265358979","0","0",[-2,0,0,0,0,0,1,0]],\n"assay ton":["0.0875","3","0","0",[0,1,0,0,0,0,0,0]],\n"astronomical unit":["149597870691","1","0","0",[1,0,0,0,0,0,0,0]],\n"atmosphere":["101325","1","0","siSymbol",[-1,1,-2,0,0,0,0,0]],\n"au":["149597870691","1","0","0",[1,0,0,0,0,0,0,0]],\n"bar":["100000","1","0","siWord",[-1,1,-2,0,0,0,0,0]],\n"barg":["100000","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"barleycorn":["0.0254","3","0","0",[1,0,0,0,0,0,0,0]],\n"barrel":["0.158987294928","1","0","0",[3,0,0,0,0,0,0,0]],\n"barrel bulk":["0.14158423296","1","0","0",[3,0,0,0,0,0,0,0]],\n"basis point":["0.0001","1","0","0",[0,0,0,0,0,0,0,0]],\n"baud":["1","1","0","siSymbol",[0,0,-1,0,0,1,0,0]],\n"bbl":["0.158987294928","1","0","0",[3,0,0,0,0,0,0,0]],\n"becquerel":["1","1","0","siWord",[0,0,-1,0,0,0,0,0]],\n"beer barrel":["0.119240471196","1","0","0",[3,0,0,0,0,0,0,0]],\n"bit":["1","1","0","0",[0,0,0,0,0,1,0,0]],\n"blink":["0.864","1","0","0",[0,0,1,0,0,0,0,0]],\n"bo":["0.158987294928","1","0","0",[3,0,0,0,0,0,0,0]],\n"boe":["6119000000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"boiler horsepower":["9812.5","1","0","0",[2,1,-3,0,0,0,0,0]],\n"bpd":["0.158987294928","86400","0","0",[3,0,-1,0,0,0,0,0]],\n"bph":["0.158987294928","3600","0","0",[3,0,-1,0,0,0,0,0]],\n"breadth":["0.2286","1","0","0",[1,0,0,0,0,0,0,0]],\n"bushel":["0.03523907016688","1","0","0",[3,0,0,0,0,0,0,0]],\n"byte":["8","1","0","0",[0,0,0,0,0,1,0,0]],\n"caballo de vapor":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"cal":["4.1868","1","0","0",[2,1,-2,0,0,0,0,0]],\n"calorie":["4.1868","1","0","siWord",[2,1,-2,0,0,0,0,0]],\n"candela":["1","1","0","siWord",[0,0,0,0,0,0,1,0]],\n"candlepower":["1","1","0","siWord",[0,0,0,0,0,0,1,0]],\n"carat":["0.00002","1","0","0",[0,1,0,0,0,0,0,0]],\n"cc":["0.000001","1","0","0",[3,0,0,0,0,0,0,0]],\n"cd":["1","1","0","siSymbol",[0,0,0,0,0,0,1,0]],\n"centipoise":["0.001","1","0","0",[-1,1,-1,0,0,0,0,0]],\n"centistoke":["0.000001","1","0","0",[2,0,-1,0,0,0,0,0]],\n"cfm":["0.0004719474432","1","0","0",[3,0,-1,0,0,0,0,0]],\n"cfs":["0.028316846592","1","0","0",[3,0,-1,0,0,0,0,0]],\n"ch":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"chain":["20.116","1","0","0",[1,0,0,0,0,0,0,0]],\n"cheval vapeur":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"cmil":["5.06707479097497e-10","1","0","0",[2,0,0,0,0,0,0,0]],\n"cmm":["0.00001","1","0","0",[1,0,0,0,0,0,0,0]],\n"constant":["1","1","0","0",[0,0,0,0,0,0,0,0]],\n"coulomb":["1","1","0","siWord",[0,0,1,1,0,0,0,0]],\n"cp":["1","1","0","siWord",[0,0,0,0,0,0,1,0]],\n"cps":["1","1","0","0",[0,0,-1,0,0,0,0,0]],\n"cu ft":["0.028316846592","1","0","0",[3,0,0,0,0,0,0,0]],\n"cu in":["0.000016387064","1","0","0",[3,0,0,0,0,0,0,0]],\n"cu yd":["0.764554857984","1","0","0",[3,0,0,0,0,0,0,0]],\n"cubic meter":["1","1","0","0",[3,0,0,0,0,0,0,0]],\n"cubic metre":["1","1","0","0",[3,0,0,0,0,0,0,0]],\n"cup":["0.0002365882365","1","0","0",[3,0,0,0,0,0,0,0]],\n"curie":["37000000000","1","0","siWord",[0,0,-1,0,0,0,0,0]],\n"cv":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"cy":["0.764554857984","1","0","0",[3,0,0,0,0,0,0,0]],\n"d":["86400","1","0","0",[0,0,1,0,0,0,0,0]],\n"daN":["10","1","0","0",[1,1,-2,0,0,0,0,0]],\n"darcy":["0.0000000000009869233","1","0","0",[2,0,0,0,0,0,0,0]],\n"day":["86400","1","0","0",[0,0,1,0,0,0,0,0]],\n"deg":["3.14159265358979","180","0","0",[0,0,0,0,0,0,0,0]],\n"degree":["3.14159265358979","180","0","0",[0,0,0,0,0,0,0,0]],\n"dekan":["31.4159265358979","180","0","0",[0,0,0,0,0,0,0,0]],\n"diopter":["1","1","0","0",[-1,0,0,0,0,0,0,0]],\n"dioptre":["1","1","0","0",[-1,0,0,0,0,0,0,0]],\n"dollar":["1","1","0","USD",[0,0,0,0,0,0,0,1]],\n"drum":["0.20819764812","1","0","0",[3,0,0,0,0,0,0,0]],\n"dscf":["0.028316846592","1","0","0",[3,0,0,0,0,0,0,0]],\n"dyn":["0.00001","1","0","0",[1,1,-2,0,0,0,0,0]],\n"dyne":["0.00001","1","0","0",[1,1,-2,0,0,0,0,0]],\n"eV":["1.602176462e-19","1","0","0",[2,1,-2,0,0,0,0,0]],\n"electric horsepower":["746","1","0","0",[2,1,-3,0,0,0,0,0]],\n"electrical horsepower":["746","1","0","0",[2,1,-3,0,0,0,0,0]],\n"electron volt":["1.602176462e-19","1","0","0",[2,1,-2,0,0,0,0,0]],\n"erg":["0.0000001","1","0","0",[2,1,-2,0,0,0,0,0]],\n"euro":["1","1","0","EUR",[0,0,0,0,0,0,0,1]],\n"exabyte":["9223372036854770000","1","0","0",[0,0,0,0,0,1,0,0]],\n"exbibyte":["9223372036854770000","1","0","0",[0,0,0,0,0,1,0,0]],\n"farad":["1","1","0","siWord",[-2,-1,4,2,0,0,0,0]],\n"faraday":["96485.339924","1","0","0",[0,0,1,1,0,0,0,0]],\n"fathom":["1.8288","1","0","0",[1,0,0,0,0,0,0,0]],\n"fc":["10.7639104167097","1","0","0",[-2,0,0,0,0,0,1,0]],\n"feet":["0.3048","1","0","0",[1,0,0,0,0,0,0,0]],\n"fermi":["0.000000000000001","1","0","siWord",[1,0,0,0,0,0,0,0]],\n"fl oz":["0.003785411784","128","0","0",[3,0,0,0,0,0,0,0]],\n"flop":["1","1","0","0",[0,0,-1,0,0,0,0,0]],\n"fluid ounce":["0.003785411784","128","0","0",[3,0,0,0,0,0,0,0]],\n"food calorie":["4186.8","1","0","0",[2,1,-2,0,0,0,0,0]],\n"foot":["0.3048","1","0","0",[1,0,0,0,0,0,0,0]],\n"footcandle":["10.7639104167097","1","0","0",[-2,0,0,0,0,0,1,0]],\n"footlambert":["1","3.14159265358979","0","0",[-2,0,0,0,0,0,1,0]],\n"fortnight":["1209600","1","0","0",[0,0,1,0,0,0,0,0]],\n"fps":["0.3048","1","0","0",[1,0,-1,0,0,0,0,0]],\n"franklin":["0.00000000033356","1","0","siWord",[0,0,1,1,0,0,0,0]],\n"ft":["0.3048","1","0","0",[1,0,0,0,0,0,0,0]],\n"ft water":["2988.874","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"ftc":["10.7639104167097","1","0","0",[-2,0,0,0,0,0,1,0]],\n"ftl":["3.426259","1","0","0",[-2,0,0,0,0,0,1,0]],\n"furlong":["201.168","1","0","0",[1,0,0,0,0,0,0,0]],\n"g":["0.001","1","0","siSymbol",[0,1,0,0,0,0,0,0]],\n"gal":["0.003785411784","1","0","0",[3,0,0,0,0,0,0,0]],\n"galileo":["0.01","1","0","siWord",[1,0,-2,0,0,0,0,0]],\n"gallon":["0.003785411784","1","0","0",[3,0,0,0,0,0,0,0]],\n"gauss":["0.0001","1","0","siSymbol",[-2,-2,-2,-1,0,0,0,0]],\n"gigabyte":["8589934592","1","0","0",[0,0,0,0,0,1,0,0]],\n"gilbert":["10","12.5663706143592","0","siWord",[0,0,0,0,1,0,1,0]],\n"gill":["0.003785411784","32","0","0",[3,0,0,0,0,0,0,0]],\n"gon":["3.14159265358979","200","0","0",[0,0,0,0,0,0,0,0]],\n"gongjin":["1","1","0","siSymbol",[0,1,0,0,0,0,0,0]],\n"gongli":["1000","1","0","siSymbol",[1,0,0,0,0,0,0,0]],\n"gpd":["0.003785411784","86400","0","0",[3,0,-1,0,0,0,0,0]],\n"gph":["0.003785411784","3600","0","0",[3,0,-1,0,0,0,0,0]],\n"gpm":["0.003785411784","60","0","0",[3,0,-1,0,0,0,0,0]],\n"gps":["0.003785411784","1","0","0",[3,0,-1,0,0,0,0,0]],\n"gr":["0.00006479891","1","0","0",[0,1,0,0,0,0,0,0]],\n"grad":["3.14159265358979","200","0","0",[0,0,0,0,0,0,0,0]],\n"grain":["0.00006479891","1","0","0",[0,1,0,0,0,0,0,0]],\n"gram":["0.001","1","0","0",[0,1,0,0,0,0,0,0]],\n"gramme":["0.001","1","0","0",[0,1,0,0,0,0,0,0]],\n"gray":["1","1","0","0",[2,0,-2,0,0,0,0,0]],\n"great year":["814000000000","1","0","0",[0,0,1,0,0,0,0,0]],\n"gsm":["0.001","1","0","0",[-2,1,0,0,0,0,0,0]],\n"gutenberg":["0.0254","7200","0","0",[1,0,0,0,0,0,0,0]],\n"gngjin":["1","1","0","siSymbol",[0,1,0,0,0,0,0,0]],\n"gngli":["1000","1","0","siSymbol",[1,0,0,0,0,0,0,0]],\n"h":["3600","1","0","0",[0,0,1,0,0,0,0,0]],\n"ha":["10000","1","0","siSymbol",[2,0,0,0,0,0,0,0]],\n"hand":["0.1016","1","0","0",[1,0,0,0,0,0,0,0]],\n"hectare":["10000","1","0","siWord",[2,0,0,0,0,0,0,0]],\n"helek":["10","3","0","0",[0,0,1,0,0,0,0,0]],\n"hemisphere":["6.28318530717959","1","0","0",[0,0,0,0,0,0,0,0]],\n"henrie":["1","1","0","siWord",[2,1,-2,-2,0,0,0,0]],\n"henry":["1","1","0","siWord",[2,1,-2,-2,0,0,0,0]],\n"hertz":["1","1","0","siWord",[0,0,-1,0,0,0,0,0]],\n"hk":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"horsepower":["745.69987158227","1","0","0",[2,1,-3,0,0,0,0,0]],\n"hour":["3600","1","0","0",[0,0,1,0,0,0,0,0]],\n"hp":["745.69987158227","1","0","0",[2,1,-3,0,0,0,0,0]],\n"hpE":["746","1","0","0",[2,1,-3,0,0,0,0,0]],\n"hpI":["745.69987158227","1","0","0",[2,1,-3,0,0,0,0,0]],\n"hpM":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"hpS":["9812.5","1","0","0",[2,1,-3,0,0,0,0,0]],\n"hr":["3600","1","0","0",[0,0,1,0,0,0,0,0]],\n"in":["0.0254","1","0","0",[1,0,0,0,0,0,0,0]],\n"in Hg":["3863.8","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"inch":["0.0254","1","0","0",[1,0,0,0,0,0,0,0]],\n"inche":["0.0254","1","0","0",[1,0,0,0,0,0,0,0]],\n"jansky":["1e-26","1","0","0",[0,1,-2,0,0,0,0,0]],\n"jar":["1","900000000","0","0",[-2,-1,4,2,0,0,0,0]],\n"joule":["1","1","0","0",[2,1,-2,0,0,0,0,0]],\n"k":["4448.2216152605","1","0","0",[1,1,-2,0,0,0,0,0]],\n"kB":["8192","1","0","0",[0,0,0,0,0,1,0,0]],\n"kB":["8192","1","0","0",[0,0,0,0,0,1,0,0]],\n"kairi":["1852","1","0","0",[1,0,0,0,0,0,0,0]],\n"kanal":["505.8570528","1","0","0",[2,0,0,0,0,0,0,0]],\n"katal":["6.02214179e+23","1","0","siWord",[0,0,-1,0,0,1,0,0]],\n"kcal":["4186.8","1","0","0",[2,1,-2,0,0,0,0,0]],\n"kcmil":["5.06707479097497e-07","1","0","0",[2,0,0,0,0,0,0,0]],\n"keg":["0.058673882652","1","0","0",[3,0,0,0,0,0,0,0]],\n"kelvin":["1","1","0","0",[0,0,0,0,1,0,0,0]],\n"kgf":["9.80665","1","0","0",[1,1,-2,0,0,0,0,0]],\n"kilo":["1","1","0","0",[0,1,0,0,0,0,0,0]],\n"kilobyte":["8192","1","0","0",[0,0,0,0,0,1,0,0]],\n"kilogram":["1","1","0","0",[0,1,0,0,0,0,0,0]],\n"kilogramme":["1","1","0","0",[0,1,0,0,0,0,0,0]],\n"kilopond":["9.80665","1","0","0",[1,1,-2,0,0,0,0,0]],\n"kip":["4448.2216152605","1","0","0",[1,1,-2,0,0,0,0,0]],\n"klf":["4448.2216152605","0.3048","0","0",[0,1,-2,0,0,0,0,0]],\n"kn":["1852","3600","0","0",[1,0,-1,0,0,0,0,0]],\n"knot":["1852","3600","0","0",[1,0,-1,0,0,0,0,0]],\n"kp":["9.80665","1","0","0",[1,1,-2,0,0,0,0,0]],\n"kpf":["4448.2216152605","0.3048","0","0",[0,1,-2,0,0,0,0,0]],\n"kph":["1000/3600","1","0","0",[1,0,-1,0,0,0,0,0]],\n"kpph":["1000/3600","1","0","0",[-1,1,-3,0,0,0,0,0]],\n"ks":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"ksf":["47880.2589803358","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"ksi":["6894757.29316836","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"kwh":["3600000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"l":["0.001","1","0","siSymbol",[3,0,0,0,0,0,0,0]],\n"lambert":["10000","3.14159265358979","0","0",[-2,0,0,0,0,0,1,0]],\n"lb":["0.45359237","1","0","0",[0,1,0,0,0,0,0,0]],\n"lbf":["4.4482216152605","1","0","0",[1,1,-2,0,0,0,0,0]],\n"lbm":["0.45359237","1","0","0",[0,1,0,0,0,0,0,0]],\n"league":["5556","1","0","0",[1,0,0,0,0,0,0,0]],\n"lf":["0.3048","1","0","0",[1,0,0,0,0,0,0,0]],\n"li":["500","1","0","0",[1,0,0,0,0,0,0,0]],\n"light year":["9460730472580800","1","0","0",[1,0,0,0,0,0,0,0]],\n"link":["0.201168","1","0","0",[1,0,0,0,0,0,0,0]],\n"liter":["0.001","1","0","siWord",[3,0,0,0,0,0,0,0]],\n"litre":["0.001","1","0","siWord",[3,0,0,0,0,0,0,0]],\n"lm":["1","1","0","siSymbol",[0,0,0,0,0,0,1,0]],\n"long ton":["1016.0469088","1","0","0",[0,1,0,0,0,0,0,0]],\n"lt":["1016.0469088","1","0","0",[0,1,0,0,0,0,0,0]],\n"ltpd":["0.0117598021851852","1","0","0",[0,1,-1,0,0,0,0,0]],\n"lumen":["1","1","0","siWord",[0,0,0,0,0,0,1,0]],\n"lunar day":["89416.32","1","0","0",[0,0,1,0,0,0,0,0]],\n"lunar month":["2551442.976","1","0","0",[0,0,1,0,0,0,0,0]],\n"lux":["1","1","0","siWord",[-2,0,0,0,0,0,1,0]],\n"lx":["1","1","0","siSymbol",[-2,0,0,0,0,0,1,0]],\n"m":["1","1","0","siSymbol",[1,0,0,0,0,0,0,0]],\n"mD":["9.869233e-16","1","0","0",[2,0,0,0,0,0,0,0]],\n"marathon":["42195","1","0","0",[1,0,0,0,0,0,0,0]],\n"marla":["25.29285264","1","0","0",[2,0,0,0,0,0,0,0]],\n"mas":["3.14159265358979","648000000","0","0",[0,0,0,0,0,0,0,0]],\n"maxwell":["0.00000001","1","0","siSymbol",[2,1,-2,-1,0,0,0,0]],\n"mb":["100","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"megabyte":["8388608","1","0","0",[0,0,0,0,0,1,0,0]],\n"megaton TNT":["4184000000000000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"megatons TNT":["4184000000000000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"megohm":["1000000","1","0","0",[2,1,-3,-2,0,0,0,0]],\n"meter":["1","1","0","siWord",[1,0,0,0,0,0,0,0]],\n"metre":["1","1","0","siWord",[1,0,0,0,0,0,0,0]],\n"metric horsepower":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"metric ton":["1000","1","0","0",[0,1,0,0,0,0,0,0]],\n"mgd":["3785.411784","86400","0","0",[3,0,-1,0,0,0,0,0]],\n"mho":["1","1","0","0",[-2,-1,3,2,0,0,0,0]],\n"mi":["1609.344","1","0","0",[1,0,0,0,0,0,0,0]],\n"mil":["0.0000254","1","0","0",[1,0,0,0,0,0,0,0]],\n"mile":["1609.344","1","0","0",[1,0,0,0,0,0,0,0]],\n"min":["60","1","0","0",[0,0,1,0,0,0,0,0]],\n"minute":["60","1","0","0",[0,0,1,0,0,0,0,0]],\n"moa":["3.14159265358979","10800","0","0",[0,0,0,0,0,0,0,0]],\n"mol":["6.02214179e+23","1","0","0",[0,0,0,0,0,1,0,0]],\n"mole":["6.02214179e+23","1","0","0",[0,0,0,0,0,1,0,0]],\n"mpg":["1609.344","0.003785411784","0","0",[-2,0,0,0,0,0,0,0]],\n"mph":["0.44704","1","0","0",[1,0,-1,0,0,0,0,0]],\n"mt":["1000","1","0","0",[0,1,0,0,0,0,0,0]],\n"nautical mile":["1852","1","0","0",[1,0,0,0,0,0,0,0]],\n"newton":["1","1","0","0",[1,1,-2,0,0,0,0,0]],\n"nit":["1","1","0","0",[-2,0,0,0,0,0,1,0]],\n"ohm":["1","1","0","siWord",[2,1,-3,-2,0,0,0,0]],\n"ounce":["0.45359237","16","0","0",[0,1,0,0,0,0,0,0]],\n"oz":["0.45359237","16","0","0",[0,1,0,0,0,0,0,0]],\n"oz t":["0.0311034768","1","0","0",[0,1,0,0,0,0,0,0]],\n"parsec":["30856780000000000","1","0","0",[1,0,0,0,0,0,0,0]],\n"pc":["0.0254","6","0","0",[1,0,0,0,0,0,0,0]],\n"pcf":["4.4482216152605","0.028316846592","0","0",[-2,1,-2,0,0,0,0,0]],\n"pci":["4.4482216152605","0.000016387064","0","0",[-2,1,-2,0,0,0,0,0]],\n"pebibyte":["9007199254740990","1","0","0",[0,0,0,0,0,1,0,0]],\n"peck":["0.00880976754172","1","0","0",[3,0,0,0,0,0,0,0]],\n"perfect ream":["516","1","0","0",[0,0,0,0,0,1,0,0]],\n"person":["1","1","0","0",[0,0,0,0,0,1,0,0]],\n"petabyte":["9007199254740990","1","0","0",[0,0,0,0,0,1,0,0]],\n"pfd":["0.5","1","0","0",[0,1,0,0,0,0,0,0]],\n"pferdestrke":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"pfund":["0.5","1","0","0",[0,1,0,0,0,0,0,0]],\n"phot":["10000","1","0","0",[-2,0,0,0,0,0,1,0]],\n"pica":["0.0254","6","0","0",[1,0,0,0,0,0,0,0]],\n"pied du roi":["9000","27706","0","0",[1,0,0,0,0,0,0,0]],\n"pieze":["1000","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"pint":["0.000473176473","1","0","0",[3,0,0,0,0,0,0,0]],\n"pk":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"platonic year":["814000000000","1","0","0",[0,0,1,0,0,0,0,0]],\n"plf":["4.4482216152605","0.3048","0","0",[0,1,-2,0,0,0,0,0]],\n"point":["0.0254","72","0","0",[1,0,0,0,0,0,0,0]],\n"poise":["0.1","1","0","siWord",[-1,1,-1,0,0,0,0,0]],\n"pound":["0.45359237","1","0","0",[0,1,0,0,0,0,0,0]],\n"poundal":["4.4482216152605","32.174","0","0",[1,1,-2,0,0,0,0,0]],\n"ppm":["0.000001","1","0","0",[0,0,0,0,0,0,0,0]],\n"ppmdv":["0.000001","1","0","0",[0,0,0,0,0,0,0,0]],\n"ppmv":["0.000001","1","0","0",[0,0,0,0,0,0,0,0]],\n"ppmw":["0.000001","1","0","0",[0,0,0,0,0,0,0,0]],\n"printer's point":["0.0003515","1","0","0",[1,0,0,0,0,0,0,0]],\n"printer's ream":["516","1","0","0",[0,0,0,0,0,1,0,0]],\n"ps":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"psf":["4.4482216152605","0.09290304","0","0",[-1,1,-2,0,0,0,0,0]],\n"psi":["4.4482216152605","0.00064516","0","0",[-1,1,-2,0,0,0,0,0]],\n"psia":["6894.75729316836","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"psig":["6894.75729316836","1","14.6959","0",[-1,1,-2,0,0,0,0,0]],\n"px":["0.0254","96","0","0",[1,0,0,0,0,0,0,0]],\n"pz":["1000","1","0","0",[-1,1,-2,0,0,0,0,0]],\n"quart":["0.003785411784","4","0","0",[3,0,0,0,0,0,0,0]],\n"quire":["25","1","0","0",[0,0,0,0,0,1,0,0]],\n"rad":["1","1","0","0",[0,0,0,0,0,0,0,0]],\n"radian":["1","1","0","0",[0,0,0,0,0,0,0,0]],\n"rankin":["5","9","0","0",[0,0,0,0,1,0,0,0]],\n"rd":["0.01","1","0","siSymbol",[2,0,-2,0,0,0,0,0]],\n"real":["1","1","0","BRL",[0,0,0,0,0,0,0,1]],\n"ream":["500","1","0","0",[0,0,0,0,0,1,0,0]],\n"rem":["0.01","1","0","siSymbol",[2,0,-2,0,0,0,0,0]],\n"rev":["6.28318530717959","1","0","0",[0,0,0,0,0,0,0,0]],\n"rod":["5.0292","1","0","0",[1,0,0,0,0,0,0,0]],\n"roentgen":["0.000258","1","0","siWord",[0,-1,1,1,0,0,0,0]],\n"rpm":["6.28318530717959","3600","0","0",[0,0,-1,0,0,0,0,0]],\n"ruble":["1","1","0","RUB",[0,0,0,0,0,0,0,1]],\n"rntgen":["0.000258","1","0","siWord",[0,-1,1,1,0,0,0,0]],\n"s":["1","1","0","siSymbol",[0,0,1,0,0,0,0,0]],\n"saltspoon":["0.003785411784","3072","0","0",[3,0,0,0,0,0,0,0]],\n"scf":["0.028316846592","1","0","0",[3,0,0,0,0,0,0,0]],\n"scfd":["0.028316846592","86400","0","0",[3,0,-1,0,0,0,0,0]],\n"scfh":["0.028316846592","3600","0","0",[3,0,-1,0,0,0,0,0]],\n"scfm":["0.028316846592","60","0","0",[3,0,-1,0,0,0,0,0]],\n"sea mile":["1852","1","0","0",[1,0,0,0,0,0,0,0]],\n"sec":["1","1","0","0",[0,0,1,0,0,0,0,0]],\n"second":["1","1","0","0",[0,0,1,0,0,0,0,0]],\n"section":["2589988.110336","1","0","0",[2,0,0,0,0,0,0,0]],\n"sennight":["604800","1","0","0",[0,0,1,0,0,0,0,0]],\n"sheet":["1","1","0","0",[0,0,0,0,0,1,0,0]],\n"short ream":["480","1","0","0",[0,0,0,0,0,1,0,0]],\n"short ton":["907.18474","1","0","0",[0,1,0,0,0,0,0,0]],\n"siemen":["1","1","0","siWord",[-2,-1,3,2,0,0,0,0]],\n"sievert":["1","1","0","siWord",[2,0,-2,0,0,0,0,0]],\n"slinch":["175.126835246477","1","0","0",[0,1,0,0,0,0,0,0]],\n"slug":["14.5939029372064","1","0","0",[0,1,0,0,0,0,0,0]],\n"smoot":["1.7018","1","0","0",[0,1,0,0,0,0,0,0]],\n"span":["0.2286","1","0","0",[1,0,0,0,0,0,0,0]],\n"sphere":["12.5663706143592","1","0","0",[0,0,0,0,0,0,0,0]],\n"sq ft":["0.09290304","1","0","0",[2,0,0,0,0,0,0,0]],\n"sq in":["0.00064516","1","0","0",[2,0,0,0,0,0,0,0]],\n"sq km":["1000000","1","0","0",[2,0,0,0,0,0,0,0]],\n"sq mi":["2589988.110336","1","0","0",[2,0,0,0,0,0,0,0]],\n"sq yd":["0.83612736","1","0","0",[2,0,0,0,0,0,0,0]],\n"square degree":["0.000304617419786709","1","0","0",[0,0,0,0,0,0,0,0]],\n"square meter":["1","1","0","0",[2,0,0,0,0,0,0,0]],\n"square metre":["1","1","0","0",[2,0,0,0,0,0,0,0]],\n"square mi":["2589988.110336","1","0","0",[2,0,0,0,0,0,0,0]],\n"sr":["1","1","0","siSymbol",[0,0,0,0,0,0,0,0]],\n"ssp":["0.003785411784","3072","0","0",[3,0,0,0,0,0,0,0]],\n"standard volume":["22.414","1","0","0",[3,0,0,0,0,0,0,0]],\n"statampere":["0.00000000033356","1","0","0",[0,0,0,1,0,0,0,0]],\n"statcoulomb":["0.00000000033356","1","0","0",[0,0,1,1,0,0,0,0]],\n"statfarad":["0.0000000000011126","1","0","0",[-2,-1,4,2,0,0,0,0]],\n"stathenrie":["898760000000","1","0","0",[2,1,-2,-2,0,0,0,0]],\n"stathenry":["898760000000","1","0","0",[2,1,-2,-2,0,0,0,0]],\n"statohm":["898760000000","1","0","0",[2,1,-3,-2,0,0,0,0]],\n"statvolt":["299.79","1","0","0",[2,1,-3,-1,0,0,0,0]],\n"statwatt":["0.0000001","1","0","0",[2,1,-3,0,0,0,0,0]],\n"steam horsepower":["9812.5","1","0","0",[2,1,-3,0,0,0,0,0]],\n"steradian":["1","1","0","0",[0,0,0,0,0,0,0,0]],\n"stere":["1","1","0","0",[3,0,0,0,0,0,0,0]],\n"stoke":["0.0001","1","0","0",[2,0,-1,0,0,0,0,0]],\n"stone":["6.35029318","1","0","0",[0,1,0,0,0,0,0,0]],\n"stpd":["0.0104998233796296","1","0","0",[0,1,-1,0,0,0,0,0]],\n"stunde":["3600","1","0","0",[0,0,1,0,0,0,0,0]],\n"survey feet":["1200","3937","0","0",[1,0,0,0,0,0,0,0]],\n"survey foot":["1200","3937","0","0",[1,0,0,0,0,0,0,0]],\n"Sv":["1","1","0","siSymbol",[2,0,-2,0,0,0,0,0]],\n"sverdrup":["1000000","1","0","0",[3,0,-1,0,0,0,0,0]],\n"sym":["1","1","0","siSymbol",[0,0,0,0,0,1,0,0]],\n"tablespoon":["0.003785411784","256","0","0",[3,0,0,0,0,0,0,0]],\n"tbsp":["0.003785411784","256","0","0",[3,0,0,0,0,0,0,0]],\n"teaspoon":["0.003785411784","768","0","0",[3,0,0,0,0,0,0,0]],\n"tebibyte":["8796093022208","1","0","0",[0,0,0,0,0,1,0,0]],\n"terabyte":["8796093022208","1","0","0",[0,0,0,0,0,1,0,0]],\n"tesla":["1","1","0","siSymbol",[-2,-2,-2,-1,0,0,0,0]],\n"therm":["105480400","1","0","0",[2,1,-2,0,0,0,0,0]],\n"tidal day":["89416.32","1","0","0",[0,0,1,0,0,0,0,0]],\n"ton":["907.18474","1","0","0",[0,1,0,0,0,0,0,0]],\n"tonf":["8896.443230521","1","0","0",[1,1,-2,0,0,0,0,0]],\n"ton TNT":["4184000000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"ton refrigeration":["3516.8532","1","0","0",[2,1,-3,0,0,0,0,0]],\n"tonne":["1000","1","0","0",[0,1,0,0,0,0,0,0]],\n"tons TNT":["4184000000","1","0","0",[2,1,-2,0,0,0,0,0]],\n"tons refrigeration":["3516.8532","1","0","0",[2,1,-3,0,0,0,0,0]],\n"township":["93239571.972096","1","0","0",[2,0,0,0,0,0,0,0]],\n"toz":["0.0311034768","1","0","0",[0,1,0,0,0,0,0,0]],\n"tpy":["0.0000287475400032297","1","0","0",[0,1,-1,0,0,0,0,0]],\n"tropical year":["31556925.9747","1","0","0",[0,0,1,0,0,0,0,0]],\n"troy ounce":["0.0311034768","1","0","0",[0,1,0,0,0,0,0,0]],\n"tsp":["0.003785411784","768","0","0",[3,0,0,0,0,0,0,0]],\n"turn":["6.28318530717958","1","0","0",[0,0,0,0,0,0,0,0]],\n"twip":["0.0254","1440","0","0",[1,0,0,0,0,0,0,0]],\n"unit":["1","1","0","0",[0,0,0,0,0,1,0,0]],\n"vapeur":["735.49875","1","0","0",[2,1,-3,0,0,0,0,0]],\n"var":["1","1","0","siSymbol",[2,1,-3,0,0,0,0,0]],\n"varistor":["1","1","0","siWord",[2,1,-3,0,0,0,0,0]],\n"volt":["1","1","0","siWord",[2,1,-3,-1,0,0,0,0]],\n"watt":["1","1","0","siWord",[2,1,-3,0,0,0,0,0]],\n"weber":["1","1","0","siSymbol",[2,1,-2,-1,0,0,0,0]],\n"week":["604800","1","0","0",[0,0,1,0,0,0,0,0]],\n"won":["1","1","0","KRW",[0,0,0,0,0,0,0,1]],\n"wppm":["0.000001","1","0","0",[0,0,0,0,0,0,0,0]],\n"yard":["0.9144","1","0","0",[1,0,0,0,0,0,0,0]],\n"yd":["0.9144","1","0","0",[1,0,0,0,0,0,0,0]],\n"year":["31556952","1","0","0",[0,0,1,0,0,0,0,0]],\n"yen":["1","1","0","JPY",[0,0,0,0,0,0,0,1]],\n"":["1","1","0","GBP",[0,0,0,0,0,0,0,1]],\n"":["1","1","0","JPY",[0,0,0,0,0,0,0,1]],\n"":["3.14159265358979","180","0","0",[0,0,0,0,0,0,0,0]],\n"C":["1","1","273.15","0",[0,0,0,0,1,0,0,0]],\n"F":["5","9","459","0",[0,0,0,0,1,0,0,0]],\n"K":["1","1","0","0",[0,0,0,0,1,0,0,0]],\n"R":["5","9","0","0",[0,0,0,0,1,0,0,0]],\n"R":["5","9","0","0",[0,0,0,0,1,0,0,0]],\n"":["0.0000000001","1","0","0",[1,0,0,0,0,0,0,0]],\n"":["1","1","0","siSymbol",[2,1,-3,-2,0,0,0,0]],\n"":["0.0254","1","0","0",[1,0,0,0,0,0,0,0]],\n"":["1","1","0","INR",[0,0,0,0,0,0,0,1]],\n"":["1","1","0","ILS",[0,0,0,0,0,0,0,1]],\n"":["1","1","0","EUR",[0,0,0,0,0,0,0,1]],\n"":["1","1","273.15","0",[0,0,0,0,1,0,0,0]],\n"":["5","9","459","0",[0,0,0,0,1,0,0,0]],\n"":["1","1","0","siSymbol",[2,1,-3,-2,0,0,0,0]],\n"":["1","1","0","0",[0,0,0,0,1,0,0,0]],\n"":["0.0000000001","1","0","0",[1,0,0,0,0,0,0,0,0]]\n}`));const synonyms=Object.freeze({$:"USD",US$:"USD",dollar:"USD",A$:"AUD","Australian dollar":"AUD","Brazilian Real":"BRL",real:"BRL",R$:"BRL","British Pound":"GBP","":"GBP",C$:"CAD","Canadian dollar":"CAD","Chinese Yuan":"CNY","":"EUR",Euro:"EUR",euro:"EUR",HK$:"HKD","Hong Kong dollar":"HKD","Indian Rupee":"IDR","":"IDR","Israeli New Shekel":"ILS","":"ILS","Mexican Peso":"MXN","Swiss Franc":"CHF",Won:"KRW",won:"KRW",yen:"JPY",Yen:"JPY","Japanese Yen":"JPY","":"JPY"});const unitFromWord=(e,t,r)=>{const n=e.trim();const o=n.length;const i={name:n,factor:Rnl.one,gauge:Rnl.zero,log:"",expos:[0,0,0,0,0,0,0,0]};if(e===""){return i}let a="";let s;let l=false;let c="";let u=false;let p=false;for(let e=1;e<3;e++){if(e===1){l=true;a=n;if(o>2){if(a.charAt(a.length-1)==="s"){if(!(a==="cfs"||o===3&a.charAt(1)==="p")){a=a.slice(0,-1)}}}let e="";if(o>3){const t=/^(yotta|zetta|exa|peta|tera|giga|mega|kilo|hecto|deka|deci|centi|milli|micro|nano|pico|femto|atto|zepto|yocto)/.exec(a);if(t){e=t[0].value;l=true;a=a.slice(e.length)}}}else{l=false;c=a.charAt(0);if("YZEPTGMkhdcmnpfazy".indexOf(c)>-1){l=true;a=a.substring(1)}}if(r&&Object.hasOwnProperty.call(r.value.columnMap,a)){const e=r.value.columnMap[a];const t=r.unit[r.value.units[e]];i.factor=Rnl.multiply(Rnl.fromString(r.value.data[e][0]),t.factor);i.expos=t.expos;return i}if(l){s=unitTable[a];if(s){p=true}if(e===1&&p&&c===""){break}else if(p){if(e===1){p=s[3]==="siWord";u=true;break}else{p=s[3]==="siSymbol";u=true}}}}if(p){i.gauge=Rnl.fromString(s[2]);i.expos=Object.freeze(s[4]);if(i.expos[7]===1){const e=synonyms[a]?synonyms[a]:a;if(t&&t.value.has(e)){i.factor=Rnl.reciprocal(t.value.get(e))}else{s=unitTable[e];if(s[0]==="0"){return errorOprnd("CURRENCY")}else{i.factor=Rnl.reciprocal(Rnl.fromString(s[0]))}}}else{i.factor=Rnl.divide(Rnl.fromString(s[0]),Rnl.fromString(s[1]))}if(u){i.factor=Rnl.multiply(i.factor,Rnl.fromNumber(prefixFactor[c]))}}else{return errorOprnd("UNIT_NAME",n)}return Object.freeze(i)};const opOrNumRegEx=/[0-9\-\u2074-\u2079/^()]/;const numeralRegEx=/[0-9-]/;const unitFromUnitName=(e,t)=>{if(!e){return{name:null,factor:null,gauge:null,log:"",expos:null}}const r=t.currencies;const n=t.units?t.units:null;let o=e.trim();o=o.replace(/[*.\-](?![0-9.])/g,"");const i={name:o,factor:Rnl.one,gauge:Rnl.zero,log:"",expos:allZeros};if(o===""){return i}else if(o===""||o===""||o==="degMinSec"){i.factor=Rnl.fromString("0.0174532925199433");return i}else if(o==="feetInch"){i.unitExpos=[1,0,0,0,0,0,0,0];i.factor=Rnl.fromString("0.3048");return i}else if(o===""||o===""){i.unitExpos=[1,0,0,0,0,0,0,0];i.factor=Rnl.fromString("0.0254");return i}const a=";";let s=false;let l="";let c="";let u="";let p="";const f=[];let d=0;const h=[{symbol:"",prec:-1}];let m="";for(let e=0;e<o.length;e++){l=o.charAt(e);if(numeralRegEx.test(l)){if(!s){u+=a;p+=a;h.push({symbol:"^",prec:3});s=true}u+=l;p+=l}else if(exponentRegEx.test(l)){if(!s){u+=a;p+=a;h.push({symbol:"^",prec:3});s=true}const e=numeralFromSuperScript(l);u+=e;p+=e}else if(l==="^"){u+=a;p+=a;h.push({symbol:"^",prec:3});s=true}else if(l===""||l==="/"){s=false;u+=a;p+=a;while(h[h.length-1].prec>=1){const e=h.pop().symbol;u+=e+a;p+=e+a}h.push({symbol:l,prec:1})}else if(l==="("){h.push({symbol:"(",prec:0})}else if(l===")"){while(h[h.length-1].prec>0){const e=h.pop().symbol;u+=e+a;p+=e+a}h.pop();s=false}else if(l==="-"){s=true;h.push({symbol:"^",prec:3});h.push({symbol:"-",prec:2});u+=a;p+=a}else{s=false;let t;for(t=e+1;t<o.length;t++){if(opOrNumRegEx.test(o.charAt(t))){break}}c=o.substring(e,t);m=unitFromWord(c,r,n);if(m.dtype&&m.dtype===dt.ERROR){return m}if(m.factor===0){i.name="";return i}u+=String(m.factor[0])+","+String(m.factor[1]);p+=""+d;f.push(m.expos);d+=1;e=t-1}}if(c===i.name){return Object.freeze(m)}while(h.length>1){const e=h.pop().symbol;u+=a+e;p+=a+e}const v=[];const g=[];const y=u.split(a);const b=p.split(a);let w=1;let S;d=0;for(let e=0;e<y.length;e++){if(/[/\-^]/.test(y[e])){w=v.pop();S=g.pop()}switch(y[e]){case"":v[v.length-1]=Rnl.multiply(v[v.length-1],w);g[g.length-1]=g[g.length-1].map(((e,t)=>e+S[t]));break;case"/":if(Rnl.isZero(w)){return errorOprnd("DIV")}v[v.length-1]=Rnl.divide(v[v.length-1],w);g[g.length-1]=g[g.length-1].map(((e,t)=>e-S[t]));break;case"^":v[v.length-1]=Rnl.power(v[v.length-1],w);g[g.length-1]=g[g.length-1].map((e=>e*S));break;case"-":v[v.length-1]=Rnl.negate(v[v.length-1]);break;default:if(y[e].indexOf(",")>-1){const t=y[e].split(",");v.push([BigInt(t[0]),BigInt(t[1])])}else{v.push([BigInt(y[e]),BigInt(1)])}if(b[e].charAt(0)===""){g.push(f[d]);d+=1}else{g.push(b[e])}}}i.factor=Object.freeze(v.pop());i.expos=Object.freeze(g.pop());return Object.freeze(i)};const j=[Rnl.zero,Rnl.one];const isComplex=e=>Array.isArray(e)&&e.length===2&&Rnl.isRational(e[0])&&Rnl.isRational(e[1]);const re=e=>e[0];const im=e=>e[1];const abs$1=e=>Rnl.hypot(e[0],e[1]);const negate$1=e=>[Rnl.negate(e[0]),Rnl.negate(e[1])];const conjugate=e=>[e[0],Rnl.negate(e[1])];const argument=e=>{if(Rnl.isZero(e[0])&&Rnl.isZero(e[1])){return errorOprnd("ORIGIN","argument")}else if(Rnl.isZero(e[1])){return Rnl.isPositive(e[0])?Rnl.zero:Rnl.pi}else if(Rnl.isZero(e[0])){return Rnl.isPositive(e[1])?Rnl.divide(Rnl.pi,Rnl.two):Rnl.negate(Rnl.divide(Rnl.pi,Rnl.two))}else{return Rnl.fromNumber(Math.atan2(Rnl.toNumber(e[1]),Rnl.toNumber(e[0])))}};const add$2=(e,t)=>[Rnl.add(e[0],t[0]),Rnl.add(e[1],t[1])];const subtract$1=(e,t)=>[Rnl.subtract(e[0],t[0]),Rnl.subtract(e[1],t[1])];const multiply$1=(e,t)=>[Rnl.subtract(Rnl.multiply(e[0],t[0]),Rnl.multiply(e[1],t[1])),Rnl.add(Rnl.multiply(e[0],t[1]),Rnl.multiply(e[1],t[0]))];const divide$1=(e,t)=>{if(!Rnl.isZero(e[1])&&!Rnl.isZero(t[1])){if(Rnl.lessThan(Rnl.abs(t[1]),Rnl.abs(t[0]))){const r=Rnl.divide(t[1],t[0]);const n=Rnl.add(t[0],Rnl.multiply(t[1],r));return[Rnl.divide(Rnl.add(e[0],Rnl.multiply(e[1],r)),n),Rnl.divide(Rnl.subtract(e[1],Rnl.multiply(e[0],r)),n)]}else{const r=Rnl.divide(t[0],t[1]);const n=Rnl.add(t[1],Rnl.multiply(t[0],r));return[Rnl.divide(Rnl.add(e[1],Rnl.multiply(e[0],r)),n),Rnl.divide(Rnl.add(Rnl.negate(e[0]),Rnl.multiply(e[1],r)),n)]}}else if(Rnl.isZero(e[1])){if(Rnl.lessThan(Rnl.abs(t[1]),Rnl.abs(t[0]))){const r=Rnl.divide(t[1],t[0]);const n=Rnl.add(t[0],Rnl.multiply(t[1],r));return[Rnl.divide(e[0],n),Rnl.negate(Rnl.multiply(e[0],Rnl.divide(r,n)))]}else{const r=Rnl.divide(t[0],t[1]);const n=Rnl.add(t[1],Rnl.multiply(t[0],r));return[Rnl.divide(Rnl.multiply(e[0],r),n),Rnl.negate(Rnl.divide(e[0],n))]}}else if(Rnl.isZero(t[1])){if(Rnl.isZero(t[0]));else{return[Rnl.divide(e[0],t[0]),Rnl.divide(e[1],t[0])]}}else{if(Rnl.isZero(t[0])){return errorOprnd("DIV")}else{return[Rnl.divide(e[0],t[0]),Rnl.zero]}}};const increment$1=e=>[Rnl.increment(e[0]),e[1]];const decrement$1=e=>[Rnl.decrement(e[0]),e[1]];const inverse=e=>{if(Rnl.isZero(e[1])){if(Rnl.isZero(e[0])){return errorOprnd("DIV")}return[Rnl.inverse(e[0]),0]}else{return divide$1([Rnl.one,Rnl.zero],e)}};const cos$1=e=>{const t=Rnl.multiply(Rnl.cos(e[0]),Rnl.cosh(e[1]));const r=Rnl.multiply(Rnl.negate(Rnl.sin(e[0])),Rnl.sinh(e[1]));return[t,r]};const sin$1=e=>{const t=Rnl.multiply(Rnl.sin(e[0]),Rnl.cosh(e[1]));const r=Rnl.multiply(Rnl.cos(e[0]),Rnl.sinh(e[1]));return[t,r]};const log=e=>{let t=[Rnl.zero,Rnl.zero];if(Rnl.isZero(e[0])&&Rnl.isZero(e[1])){return errorOprnd("ORIGIN","log")}else{t[0]=Rnl.fromNumber(Math.log(Rnl.toNumber(Rnl.hypot(e[0],e[1]))));t[1]=argument(e)}return t};const isSmall=e=>Rnl.lessThan(Rnl.abs(e),[BigInt(1),BigInt(1e14)]);const exp$1=e=>{let t=[Rnl.zero,Rnl.zero];if(isSmall(e[1])){t[1]=Rnl.zero;t[0]=Rnl.exp(e[0])}else{if(Rnl.isZero(e[0])){t[0]=Rnl.cos(e[1]);if(isSmall(t[0])){t[0]=Rnl.zero}t[1]=Rnl.sin(e[1]);if(isSmall(t[1])){t[1]=Rnl.zero}}else{const r=Rnl.exp(e[0]);t[0]=Rnl.multiply(r,Rnl.cos(e[1]));t[1]=Rnl.multiply(r,Rnl.sin(e[1]))}}return t};const power$1=(e,t)=>{let r=[Rnl.zero,Rnl.zero];if(!isComplex(t)){r=log(e);r[0]=Rnl.multiply(r[0],t);r[1]=Rnl.multiply(r[1],t)}else if(Rnl.isZero(t[1])){r=log(e);r[0]=Rnl.multiply(r[0],t[0]);r[1]=Rnl.multiply(r[1],t[0])}else if(Rnl.isZero(e[1])&&!Rnl.isNegative(e[0])){e[0]=Rnl.fromNumber(Math.log(Rnl.toNumber(e[0])));r[0]=Rnl.multiply(e[0],t[0]);r[1]=Rnl.multiply(e[0],t[1])}else{e=log(e);r[0]=Rnl.subtract(Rnl.multiply(e[0],t[0]),Rnl.multiply(e[1],t[1]));r[1]=Rnl.add(Rnl.multiply(e[1],t[0]),Rnl.multiply(e[0],t[1]))}r=exp$1(r);if(isSmall(r[1])){r[1]=Rnl.zero}if(isSmall(r[0])){r[0]=Rnl.zero}return r};const acosh=e=>log(add$2(e,multiply$1(sqrt$1(decrement$1(e)),sqrt$1(increment$1(e)))));const asinh=e=>{const t=sqrt$1(add$2(multiply$1(e,e),[Rnl.one,Rnl.zero]));return log(add$2(e,t))};const atanh=e=>divide$1(subtract$1(log(increment$1(e)),log(subtract$1([Rnl.one,Rnl.zero],e))),[Rnl.two,Rnl.zero]);const asin=e=>divide$1(asinh(multiply$1(j,e)),j);const atan=e=>{const t=log(increment$1(multiply$1(j,e)));const r=log(subtract$1([Rnl.one,Rnl.zero],multiply$1(j,e)));return divide$1(subtract$1(t,r),[Rnl.zero,Rnl.two])};const sqrt$1=e=>{const t=log(e);t[0]=Rnl.divide(t[0],Rnl.two);t[1]=Rnl.divide(t[1],Rnl.two);return exp$1(t)};const lanczos$1=t=>{const r=subtract$1(t,[Rnl.one,Rnl.zero]);const n=Rnl.sqrt(Rnl.divide(e,pi));const o=multiply$1([Rnl.two,Rnl.zero],[n,Rnl.zero]);const i=Rnl.fromNumber(11.400511);const a=[[BigInt(1),BigInt(2)],Rnl.zero];const s=power$1(divide$1(add$2(r,[i,Rnl.zero]),[e,Rnl.zero]),add$2(r,a));const l=["2.48574089138753565546e-5","1.05142378581721974210","-3.45687097222016235469","4.51227709466894823700","-2.98285225323576655721","1.05639711577126713077","-0.195428773191645869583","0.0170970543404441224307","-0.000571926117404305781283","0.00000463399473359905636708","-0.00000000271994908488607703910"];let c=[Rnl.fromString(l[0]),Rnl.zero];for(let e=1;e<=10;e++){const t=[Rnl.fromString(t[e]),Rnl.zero];const n=[Rnl.fromNumber(e),Rnl.zero];c=add$2(c,divide$1(t,add$2(r,n)))}return multiply$1(multiply$1(o,s),c)};const display=(e,t,r)=>{const n=/[j]/.test(t)?t.slice(-1):"j";let o="";let i="";if(n==="j"){const n=format(e[0],t,r);let a=format(e[1],t,r);if(a.charAt(0)==="-"){a="("+a+")"}o=n+" + j"+a;i=n+" + j"+a}else{const a=Rnl.hypot(e[0],e[1]);let s=Cpx.argument(result.value);if(n===""){s=Rnl.divide(Rnl.multiply(s,Rnl.fromNumber(180)),Rnl.pi)}o=format(a,t,r)+""+format(s,t,r)+(n===""?"":"");i=o}return[o,i]};const Cpx=Object.freeze({j:j,re:re,im:im,abs:abs$1,conjugate:conjugate,argument:argument,inverse:inverse,increment:increment$1,decrement:decrement$1,isComplex:isComplex,add:add$2,subtract:subtract$1,divide:divide$1,multiply:multiply$1,negate:negate$1,power:power$1,exp:exp$1,log:log,sqrt:sqrt$1,sin:sin$1,cos:cos$1,asin:asin,atan:atan,acosh:acosh,asinh:asinh,atanh:atanh,lanczos:lanczos$1,display:display});const isVector=e=>(e.dtype&dt.ROWVECTOR||e.dtype&dt.COLUMNVECTOR)>0;const convertFromBaseUnits=(e,t,r)=>{let n=isVector(e)?e.value.map((e=>Rnl.divide(e,r))):e.value.map((e=>e.map((e=>Rnl.divide(e,r)))));if(!Rnl.isZero(t)){n=isVector(e)?e.value.map((e=>Rnl.subtract(e,t))):e.value.map((e=>e.map((e=>Rnl.subtract(e,t)))))}return Object.freeze(n)};const convertToBaseUnits=(e,t,r)=>{let n=clone(e.value);if(!Rnl.isZero(t)){n=isVector(e)?e.value.map((e=>Rnl.add(e,t))):e.value.map((e=>e.map((e=>Rnl.add(e,t)))))}n=isVector(e)?n.map((e=>Rnl.multiply(e,r))):n.map((e=>e.map((e=>Rnl.multiply(e,r)))));return Object.freeze(n)};const display$1=(e,t,r)=>{let n="\\begin";if(e.dtype&dt.MATRIX){n+="{pmatrix}";const o=e.value.length;const i=e.value[1].length;for(let a=0;a<o;a++){for(let o=0;o<i;o++){n+=format(e.value[a][o],t,r)+" &"}n=n.slice(0,-1)+" \\\\ "}n=n.slice(0,-3).trim();n+="\\end{pmatrix}"}else{n+="{bmatrix}";const o=e.dtype&dt.ROWVECTOR?" & ":" \\\\ ";if(e.value.plain){const i=e.value.plain.length;for(let a=0;a<i;a++){n+=format(e.value.plain[a],t,r)+(a<i-1?o:"")}}else{const i=e.value.length;for(let a=0;a<i;a++){const s=e.value[a]===undefined?"":e.dtype&dt.RATIONAL?format(e.value[a],t,r):e.dtype&dt.COMPLEX?Cpx.display(e.value[a],t,r)[0]:e.dtype&dt.BOOLEAN||e.dtype&dt.STRING?"\\text{"+e.value[a]+"}":e.value[a];n+=s+(a<i-1?o:"")}}n+="\\end{bmatrix}"}return n};const displayAlt=(e,t,r)=>{let n="";if(e.dtype&dt.MATRIX){n+="(";const o=e.value.length;const i=e.value[1].length;for(let a=0;a<o;a++){for(let o=0;o<i;o++){n+=format(e.value[a][o],t,r).replace(/{,}/g,",")+", "}n=n.slice(0,-2)+"; "}n=n.slice(0,-2).trim();n+=")"}else{n+="[";const o=e.dtype&dt.ROWVECTOR?", ":"; ";if(e.value.plain){const i=e.value.plain.length;for(let a=0;a<i;a++){n+=format(e.value.plain[a],t,r).replace(/{,}/g,",")+(a<i-1?o:"")}}else{const i=e.value.length;for(let a=0;a<i;a++){const s=e.value[a]===undefined?"":e.dtype&dt.RATIONAL?format(e.value[a],t,r).replace(/{,}/g,","):e.dtype&dt.COMPLEX?Cpx.display(e.value[a],t,r)[1].replace(/{,}/g,","):e.value[a];n+=s+(a<i-1?o:"")}}n+="]"}return n};const displayMapOfVectors=(e,t,r)=>{let n="\\begin{Bmatrix}";Object.keys(e).forEach((o=>{const i=e[o];n+="\\text{"+o+"}: \\begin{bmatrix}";const a=i.plain.length;if(i.plain){for(let e=0;e<a;e++){n+=format(i.plain[e],t,r)+(e<a-1?", ":"")}}else{for(let e=0;e<a;e++){const o=Rnl.isRational(i[e])?format(i[e],t,r):typeof i[e]==="boolean"||typeof i[e]==="string"?"\\text{"+i[e]+"}":i[e];n+=o+(e<a-1?" & ":"")}}n+="\\end{bmatrix} \\\\"}));n=n.slice(0,-2)+"\\end{Bmatrix}";return n};const displayAltMapOfVectors=(e,t,r)=>{let n="{";Object.keys(e).forEach((o=>{const i=e[o];n+=o+": [";const a=i.plain.length;if(i.plain){for(let e=0;e<a;e++){n+=format(i.plain[e],t,r)+(e<a-1?", ":"").replace(/{,}/g,",")+" "}}else{for(let e=0;e<a;e++){const o=Rnl.isRational(i[e])?format(i[e],t,r).replace(/{,}/g,",")+" ":String(i[e])+"}";n+=o+(e<a-1?" ":"")}}n+="];"}));return n.slice(0,-1)+"}"};const identity=(e,t)=>{const r=Rnl.isRational(e)?Rnl.toNumber(e):e;if(r===1){return[Rnl.one]}else{const e=[];for(let t=0;t<r;t++){e.push(new Array(r).fill(Rnl.zero));e[t][t]=Rnl.one}return t?e:Object.freeze(e)}};const invert=(e,t)=>{if(e.length!==e[0].length){return errorOprnd("NONSQUARE")}const r=e.length;let n=0;let o=0;let i=0;let a=Rnl.zero;let s=Rnl.one;const l=clone(e);const c=identity(r,true);for(n=0;n<r;n+=1){a=l[n][n];if(Rnl.isZero(a)){for(o=n+1;o<r;o++){if(!Rnl.isZero(l[o][n])){for(i=0;i<r;i++){a=l[n][i];l[n][i]=l[o][i];l[o][i]=a;a=c[n][i];c[n][i]=c[o][i];c[o][i]=a}break}}a=l[n][n];if(Rnl.isZero(a)){return errorOprnd("SINGULAR")}}if(t){s=Rnl.divide(s,a);if(n===r-1){return s}}for(i=0;i<r;i++){l[n][i]=Rnl.divide(l[n][i],a);c[n][i]=Rnl.divide(c[n][i],a)}for(o=0;o<r;o++){if(o===n){continue}a=l[o][n];for(i=0;i<r;i++){l[o][i]=Rnl.subtract(l[o][i],Rnl.multiply(a,l[n][i]));c[o][i]=Rnl.subtract(c[o][i],Rnl.multiply(a,c[n][i]))}}}return Object.freeze(c)};const submatrix=(e,t,r)=>{if(!(t.dtype&dt.RATIONAL||t.dtype&dt.RANGE)){return errorOprnd("BAD_INDEX")}let n=[];let o=e.dtype;let i=0;let a=1;let s=0;if(t.dtype&dt.RANGE){i=Rnl.toNumber(t.value[0]);a=Rnl.toNumber(t.value[1]);s=t.value[2]===""?e.value.length:Rnl.toNumber(t.value[2])}else if(Rnl.areEqual(t.value,Rnl.zero)){i=1;s=e.value.length}else{i=Rnl.toNumber(t.value);s=i}if(isVector(e)){if(i===s){n=e.value[i-1];o=e.dtype-(e.dtype&dt.ROWVECTOR)-(e.dtype&dt.COLUMNVECTOR)}else if(a===1){n=e.value.slice(i-1,s)}else{for(let t=i-1;t<s;t+=a){n.push(e.value[t])}}Object.freeze(n);return Object.freeze({value:n,unit:e.unit,dtype:o})}let l=0;let c=1;let u=0;if(r){if(r.dtype&dt.RANGE){l=Rnl.toNumber(r.value[0]);c=Rnl.toNumber(r.value[1]);u=r.value[2]===""?e.value[0].length:Rnl.toNumber(r.value[2])}else if(Rnl.areEqual(r.value,Rnl.zero)){l=1;u=e.value[0].length}else{l=Rnl.toNumber(r.value);u=l}}if(i===s&&l===u){n=e.value[i-1][l-1];o-=dt.MATRIX}else if(i===s){if(c===1){n=e.value[i-1].slice(l-1,u)}else{for(let t=l-1;t<u;t+=c){n.push(e.value[i-1][t])}}o=o-dt.MATRIX+dt.ROWVECTOR}else if(l===u){for(let t=i-1;t<s;t+=a){n.push(e.value[t][l-1])}o=o-dt.MATRIX+dt.COLUMNVECTOR}else if(c===1){for(let t=i-1;t<s;t+=a){n.push([]);n[n.length-1]=e.value[t].slice(l-1,u)}}else{for(let t=i-1;t<s;t+=a){n.push([]);for(let r=l-1;r<u;r+=c){n[n.length-1].push(e[t][r])}}}Object.freeze(n);return Object.freeze({value:n,unit:e.unit,dtype:o})};const multResultType=(e,t)=>{if(e.dtype&dt.ROWVECTOR&&t.dtype&dt.COLUMNVECTOR){return dt.RATIONAL}else if(e.dtype&dt.MATRIX&&t.dtype&dt.COLUMNVECTOR){return t.dtype}else if(e.dtype&dt.ROWVECTOR&&t.dtype&dt.MATRIX){return e.dtype}else{return dt.MATRIX+dt.RATIONAL}};const operandFromRange=e=>{const t=[];if(Rnl.greaterThan(e[2],e[0])){for(let r=e[0];Rnl.lessThan(r,e[2]);r=Rnl.add(r,e[1])){t.push(r)}}else{for(let r=e[0];Rnl.greaterThanOrEqualTo(r,e[2]);r=Rnl.add(r,e[1])){t.push(r)}}if(!Rnl.areEqual(t[t.length-1],e[2])){t.push(e[2])}Object.freeze(t);return Object.freeze({value:t,unit:{expos:allZeros},dtype:dt.RATIONAL+dt.ROWVECTOR})};const operandFromTokenStack=(e,t,r)=>{if(t===0&&r===0){return Object.freeze({value:new Array(0),unit:null,dtype:dt.ROWVECTOR})}else if(t===1&&r===1){return e.pop()}else if(t===1||r===1){const n=Math.max(t,r);let o;let i=e[e.length-1].dtype;if(t===1&&i&dt.COLUMNVECTOR){i=i-dt.COLUMNVECTOR+dt.MATRIX;o=new Array(e[0].value.length);for(let t=0;t<e[0].value.length;t++){o[t]=[];for(let r=0;r<n;r++){o[t][r]=e[r].value[t]}}for(let t=0;t<n;t++){e.pop()}}else{o=new Array(n);i+=t===1?dt.ROWVECTOR:dt.COLUMNVECTOR;for(let t=n-1;t>=0;t--){o[t]=e.pop().value}}Object.freeze(o);return Object.freeze({value:o,unit:i&dt.RATIONAL?{expos:allZeros}:null,dtype:i})}else{const n=new Array(t);const o=e[e.length-1].dtype+dt.MATRIX;for(let e=0;e<t;e++){n[e]=new Array(r)}for(let o=t-1;o>=0;o--){for(let t=r-1;t>=0;t--){n[o][t]=e.pop().value}}Object.freeze(n);return Object.freeze({value:n,unit:o&dt.RATIONAL?{expos:allZeros}:null,dtype:o})}};const zeros=(e,t)=>{if(e===1){return{value:new Array(t).fill(Rnl.zero),unit:allZeros,dtype:dt.RATIONAL+dt.ROWVECTOR}}else if(t===1){return{value:new Array(e).fill(Rnl.zero),unit:allZeros,dtype:dt.RATIONAL+dt.COLUMNVECTOR}}else{const r=[];for(let n=0;n<e;n++){r.push(new Array(t).fill(Rnl.zero))}Object.freeze(r);return Object.freeze({value:r,unit:{expos:allZeros},dtype:dt.RATIONAL+dt.MATRIX})}};const Matrix=Object.freeze({convertFromBaseUnits:convertFromBaseUnits,convertToBaseUnits:convertToBaseUnits,display:display$1,displayAlt:displayAlt,displayMapOfVectors:displayMapOfVectors,displayAltMapOfVectors:displayAltMapOfVectors,identity:identity,invert:invert,isVector:isVector,multResultType:multResultType,operandFromRange:operandFromRange,operandFromTokenStack:operandFromTokenStack,submatrix:submatrix,zeros:zeros});const columnListFromRange=(e,t)=>{const r=[];for(let n=e;n<=t;n++){r.push(n)}return r};const valueFromDatum=e=>e==="true"?true:e==="false"?false:numberRegEx$1.test(e)?Rnl.fromString(e):e===""?undefined:e;const datumFromValue=(e,t)=>e===true?"true":e===false?"false":e=t===dt.RATIONAL?"0 "+String(e[0])+"/"+String(e[1]):e;const range=(e,t,r,n)=>{let o;let i;const a=[];let s=[];let l=Object.create(null);if(e.value.data[0].length===1){o=0;i=0;for(let r=0;r<t.length;r++){if(t[r].dtype===dt.STRING){s.push(e.value.columnMap[t[r].value])}else if(t[r].dtype===dt.RATIONAL){s.push(Rnl.toNumber(t[r].value))}else if(t[r].dtype===dt.RANGE){const e=Rnl.toNumber(t[r].value[0]);const n=Rnl.toNumber(t[r].value[1]);for(let t=e;t<=n;t++){s.push(t)}}}}else if(t.length===1&&t[0].dtype===dt.RATIONAL){o=Rnl.toNumber(t[0].value)-1;i=o;s=columnListFromRange(0,e.value.data.length-1)}else if(t.length===1&&t[0].dtype===dt.RANGE){o=Rnl.toNumber(t[0].value[0])-1;i=Rnl.toNumber(t[0].value[1])-1;s=columnListFromRange(0,e.value.data.length-1)}else if(t.length===1&&t[0].dtype===dt.STRING){if(e.value.rowMap&&t[0].value in e.value.rowMap){o=e.value.rowMap[t[0].value];i=o;s=columnListFromRange(0,e.value.data.length-1)}else if(e.value.columnMap&&t[0].value in e.value.columnMap){o=0;i=e.value.data[0].length-1;s.push(e.value.columnMap[t[0].value])}else{return errorOprnd("BAD_ROW_NAME",t[0].value)}}else if(t.length===1&&t[0].dtype===dt.STRING+dt.COLUMNVECTOR){for(const e of t[0].value){a.push(e)}s=columnListFromRange(0,e.value.data.length-1)}else if(t.length===1&&t[0].dtype===dt.STRING+dt.ROWVECTOR){o=0;i=e.value.data[0].length;for(const r of t[0].value){s.push(e.columnIndicator[r])}}else if(t.length===2&&t[0].dtype===dt.STRING&&e.value.rowMap&&t[0].value in e.value.rowMap&&t[1].dtype===dt.STRING&&e.value.columnMap&&t[0].value in e.value.columnMap){o=e.value.rowMap[t[0].value];i=o;s.push(e.value.columnMap[t[0].value])}if(a.length===0&&o===i&&s.length===1){let t=e.value.dtype[s[0]];if(t&dt.QUANTITY){t-=dt.QUANTITY}const i=s[0];let a=valueFromDatum(e.value.data[i][o]);l.expos=t&dt.RATIONAL?allZeros:null;if(n&&e.value.units[i]){const t=e.value.units[i]?e.value.units[i]:undefined;const n=unitFromUnitName(t,r);a=Rnl.multiply(Rnl.add(a,n.gauge),n.factor);l.expos=n.expos}return{value:a,unit:l,dtype:t}}else if(s.length===1){const t=s[0];const r=e.value.units[t]?e.value.units[t]:{};l=e.unit&&e.unit[r]?e.unit[r]:{expos:null};const a=e.value.data[t].slice(o,i+1).map((e=>valueFromDatum(e)));const c=e.value.dtype[t]+dt.COLUMNVECTOR;const u={value:a,name:e.value.headings[t],unit:l,dtype:c};if(n&&l.gauge){return{value:Matrix.convertToBaseUnits(u,l.gauge,l.factor),name:e.value.headings[t],unit:{expos:clone(l.expos)},dtype:dt.RATIONAL+dt.COLUMNVECTOR}}else{return u}}else{const t=[];const r=[];const n=[];const l=[];const c=Object.create(null);const u=Object.create(null);const p=a.length===0?false:Object.create(null);for(let f=0;f<s.length;f++){t.push(e.value.headings[s[f]]);const d=e.value.units[s[f]];r.push(d);if(d&&!u[d]){u[d]=e.unit[d]}n.push(e.value.dtype[s[f]]);c[e.value.headings[f]]=f;if(a.length>0){const t=[];for(let r=0;r<a.length;r++){const n=a[r];t.push(e.value.data[s[f]][e.value.rowMap[n]]);p[n]=r}l.push(t)}else{l.push(e.value.data[s[f]].slice(o,i+1))}}return{value:{data:l,headings:t,columnMap:c,rowMap:false,units:r,dtype:n},unit:clone(u),dtype:dt.DATAFRAME}}};const numberRegEx$1=new RegExp("^(?:=|"+Rnl.numberPattern.slice(1)+"$)");const mixedFractionRegEx=/^-?(?:[0-9]+(?: [0-9]+\/[0-9]+))$/;const dataFrameFromCSV=(e,t)=>{const r=[];const n=[];const o=Object.create(null);let i=false;const a=[];const s=[];const l=Object.create(null);let c=false;const u=e.indexOf("\t")>-1?"\t":"|";if(e.charAt(0)==="`"){e=e.slice(1)}let p=0;let f=0;const d=e=>{let n=false;for(let e=0;e<r.length;e++){if(numberRegEx$1.test(r[e][0])){n=true;break}}if(!n){for(let e=0;e<r.length;e++){if(numberRegEx$1.test(r[e][1])){c=true;break}}}if(c){for(let e=0;e<r.length;e++){const n=r[e].shift();a.push(n);if(n.length>0){if(!l[n]){const e=unitFromUnitName(n,t);if(e){l[n]=e}else{return errorOprnd("DF_UNIT",n)}}}}if(i){Object.entries(i).forEach((([e,t])=>{i[e]=t-1}))}}};const h=/^(?:[Nn]ame|[Ii]tem|[Ll]able)$/;const m=e=>{e=e.trim();if(p===3&&f===0){d()}if(p===0){n.push(e);o[e]=f;if(f===0&&(e.length===0||h.test(e))){i=Object.create(null)}}else{if(p===1){r.push([])}if(e==="sumAbove()"){let t=Rnl.zero;for(const e of r[f]){if(!isNaN(e)){t=Rnl.add(t,Rnl.fromString(e))}}e=String(Rnl.toNumber(t))}r[f].push(e);if(i&&f===0){i[e]=p-1-(c?1:0)}}};if(e.indexOf('"')===-1){const t=e.split(/\r?\n/g);for(const e of t){if(e.length>0){f=0;const t=e.split(u);for(const e of t){m(e.trim());f++}p+=1}}if(p===3){d()}}else{let t="";let r=false;for(let n=0;n<e.length;n++){const o=e[n];const i=e[n+1];if(o==='"'&&r&&i==='"'){t+=o;++n;continue}if(o==='"'){r=!r;continue}if(o===u&&!r){m(t);t="";++f;continue}if(o==="\r"&&i==="\n"&&!r){m(t);t="";++p;f=0;++n;continue}if(o==="\n"&&!r){m(t);t="";++p;f=0;++n;continue}if(o==="\r"&&!r){m(t);t="";++p;f=0;++n;continue}t+=o}if(t.length>0){m(t)}if(p===2){d()}}for(let e=0;e<r.length;e++){for(let t=0;t<r[0].length;t++){const n=r[e][t];if(n===""){continue}s.push(numberRegEx$1.test(n)?dt.RATIONAL+(a.length>0&&a[e].length>0?dt.QUANTITY:0):n==="true"||n==="false"?dt.BOOLEAN:dt.STRING);break}}let v=false;if(r[0].length===1&&Object.keys(l).length===0){v=true;for(let e=1;e<s.length;e++){if(s[e]!==s[0]){v=false;break}}}if(v){const e=new Map;const t=Object.keys(o);for(let n=0;n<t.length;n++){e.set(t[n],valueFromDatum(r[n][0]))}return{value:e,unit:s[0]===dt.RATIONAL?allZeros:null,dtype:dt.MAP+s[0]}}else{return{value:{data:r,headings:n,columnMap:o,rowMap:i,units:a,dtype:s},unit:l,dtype:dt.DATAFRAME}}};const dataFrameFromVectors=(e,t)=>{const r=[];const n=[];const o=Object.create(null);const i=[];const a=[];const s=Object.create(null);const l=e[0].name&&e[0].name==="name"?Object.create(null):false;for(let c=0;c<e.length;c++){const u=e[c];const p=u.dtype&dt.ROWVECTOR?dt.ROWVECTOR:u.dtype&dt.COLUMNVECTOR?dt.COLUMNVECTOR:dt.ERROR;if(p===dt.ERROR){return errorOprnd("NOT_VECTOR")}n.push(u.name);o[u.name]=c;const f=u.dtype-p;r.push(u.value.map((e=>datumFromValue(e,f))));a.push(f);if(u.unit.name){i.push(u.unit.name);if(!s[u.unit.name]){const e=unitFromUnitName(u.unit.name,t);s[u.unit.name]=e}}else{i.push(null)}if(l){const t=e[0].value;for(let e=0;e<t.length;e++){l[t[e]]=e}}}return{value:{data:r,headings:n,columnMap:o,rowMap:l,units:i,dtype:a},unit:s,dtype:dt.DATAFRAME}};const matrix2table=(e,t,r,n)=>{const o=[];for(let t=0;t<=e.value[0].length;t++){o.push([])}const i=r.value;i.unshift("");const a=Object.create(null);for(let e=1;e<r.value[0].length;e++){a[i[e]]=e}const s=dt.RATIONAL+(e.unit?dt.QUANTITY:0);const l=Array(e.value[0].length).fill(s);l.unshift(null);let c=[];const u=Object.create(null);if(e.unit.name){c=Array(e.value[0].length).fill(e.unit.name);c.unshift("");u[e.unit.name]=unitFromUnitName(e.unit.name,n)}const p=Object.create(null);o[0]=t.value;const f=n.format?n.format.value:"h15";for(let e=0;e<t.value.length;e++){p[o[0][e]]=e}for(let t=0;t<e.value.length;t++){for(let r=0;r<e.value[0].length;r++){const n=e.value[t][r];o[r+1].push(format(n,f,"1000000."))}}return{value:{data:o,headings:i,columnMap:a,rowMap:p,units:c,dtype:l},unit:u,dtype:dt.DATAFRAME}};const append=(e,t,r,n)=>{const o=clone(e);const i=e.value.data[0].length;if(i!==t.value.length){return errorOprnd("BAD_CONCAT")}o.value.headings.push(t.name);o.value.columnMap[t.name]=e.value.headings.length-1;const a=t.dtype&dt.COLUMNVECTOR?t.dtype-dt.COLUMNVECTOR:t.dtype-dt.ROWVECTOR;if(t.unit.name&&t.unit.name.length>0){o.value.units.push(t.unit.name);const e=unitFromUnitName(t.unit.name,r);if(!o.unit[t.unit.name]){o.unit[t.unit.name]=e}if(n){const r=Matrix.convertFromBaseUnits(t,e.gauge,e.factor);o.value.data.push(r.map((e=>datumFromValue(e,a))))}else{o.value.data.push(t.value.map((e=>datumFromValue(e,a))))}}else{o.value.units.push(null)}o.value.dtype.push(a);return o};const quickDisplay=e=>{if(e===""){return""}e=addTextEscapes(e.trim());const t=e.indexOf("\t")>-1?/ *\t */g:/ *\| */g;const r=e.split(/\r?\n/g);let n="";if(r.length<3){n="\\begin{matrix}\\text{";for(let e=0;e<r.length;e++){n+=tablessTrim(r[e]).replace(t,"} & \\text{")+"} \\\\ \\text{"}n=n.slice(0,-10)+"\\end{matrix}"}else{n="\\begin{array}{l|cccccccccccccccccccccccc}\\text{";const e=new Array(r.length);for(let n=0;n<r.length;n++){e[n]=tablessTrim(r[n]).split(t)}let o=false;let i=false;for(let t=0;t<e[1].length;t++){if(numberRegEx$1.test(e[1][t])){i=true;break}}if(!i){for(let t=0;t<e[2].length;t++){if(numberRegEx$1.test(e[2][t])){o=true;break}}}for(let e=0;e<r.length;e++){n+=tablessTrim(r[e]).replace(t,"} & \\text{");n+=o&&e===1||!o&&e===0?"} \\\\ \\hline \\text{":"} \\\\ \\text{"}n=n.slice(0,-10)+"\\end{array}"}n=n.replace(//g,"$$");return n};const isValidIdentifier=/^(?:[A-Za-z\u0391-\u03C9\u03D5\u210B\u210F\u2110\u2112\u2113\u211B\u212C\u2130\u2131\u2133]|(?:\uD835[\uDC00-\udc33\udc9c-\udcb5]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]**$/;const accentRegEx$1=/^([^\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]+)([\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1])(.+)?/;const subscriptRegEx=/([^_]+)(_[^']+)?(.*)?/;const accentFromChar=Object.freeze({"":"\\grave","":"\\acute","":"\\hat","":"\\tilde","":"\\bar","":"\\bar","":"\\dot","":"\\ddot","":"\\mathring","":"\\check","":"\\underline","":"\\overleftharpoon","":"\\overrightharpoon","":"\\overleftarrow","":"\\vec","":"\\overleftrightarrow"});const formatColumnName=e=>{if(!isValidIdentifier.test(e)){return"\\text{"+addTextEscapes(e)+"}"}else{e=e.replace(//g,"'");let t=e.match(accentRegEx$1);if(t){e=accentFromChar[t[2]]+"{"+t[1]+"}";return e+(t[3]?t[3]:"")}else{t=e.match(subscriptRegEx);let r=t[1].length>1?`\\text{${t[1]}}`:t[1];if(t[2]){r+="_"+`\\text{${t[2].slice(1)}}`}return r+(t[3]?t[3]:"")}}};const isNotEmpty=e=>{for(let t=0;t<e.length;t++){if(e[t]!==""&&e[t]!==null){return true}}return false};const getNumInfo=e=>{const t=e.data.length;const r=new Array(t);const n=new Array(t);for(let o=0;o<t;o++){if(e.dtype[o]&dt.RATIONAL){r[o]={hasAlignChar:false,maxLenAfterAlignChar:0};n[o]=[];for(let t=0;t<e.data[0].length;t++){const i=e.data[o][t];const a=i.indexOf(".");const s=a>-1;const l=s?i.length-a-1:0;n[o].push({hasAlignChar:s,lenAfterAlignChar:l});if(s){r[o].hasAlignChar=true;if(l>r[o].maxLenAfterAlignChar){r[o].maxLenAfterAlignChar=l}}}}}return[r,n]};const displayNum=(e,t,r,n)=>{let o=formattedDecimal(e,n);const i=t.maxLenAfterAlignChar-r.lenAfterAlignChar;if(t.hasAlignChar&&(i>0||!r.hasAlignChar)){o+="\\phantom{";if(t.hasAlignChar&&!r.hasAlignChar){o+=n.slice(-1)==="."?".":"{,}"}if(i>0){o+="0".repeat(i)}o+="}"}return o};const totalRegEx=/^(?:total|sum)/i;const display$2=(e,t="h3",r="1,000,000.",n=false)=>{if(e.data.length===0){return""}const o=e.data[0].length;const i=e.data.length;const a=o>5&&!e.rowMap;const s=i+(a?1:0);let l="\\begin{array}{";l+=e.rowMap?"l|":a?"r|":"";for(let t=1;t<s;t++){l+=e.dtype[t]&dt.RATIONAL?"r ":"l "}l=l.slice(0,-1)+"}";if(!n){if(a){l+="&"}for(let t=0;t<i;t++){l+="{"+formatColumnName(e.headings[t])+"}&"}l=l.slice(0,-1)+" \\\\ "}if(isNotEmpty(e.units)){if(a){l+="&"}for(let t=0;t<i;t++){let r="";if(e.units[t]&&e.units[t].length>0){const n=unitTeXFromString(e.units[t]);r=n.replace("\\;\\, ","")}else{r=""}l+=r+"&"}l=l.slice(0,-1)+" \\\\ "}l+="\\hline ";const[c,u]=getNumInfo(e);for(let n=0;n<o;n++){if(n===o-1&&totalRegEx.test(e.data[0][n])){l+="\\hline "}if(a){l+=String(n+1)+" & "}for(let o=0;o<i;o++){const i=e.data[o][n];l+=mixedFractionRegEx.test(i)?format(Rnl.fromString(i),t,r)+"&":numberRegEx$1.test(i)?displayNum(i,c[o],u[o][n],r)+"&":i===""?"&":"\\text{"+addTextEscapes(i)+"}&"}l=l.slice(0,-1)+" \\\\ "}l=l.slice(0,-3).trim();l+="\\end{array}";return l};const displayAlt$1=(e,t="h3",r=false)=>{if(e.data.length===0){return""}const n=e.data[0].length;const o=e.data.length;const i=n>5&&!e.rowMap;let a="``";if(!r){if(i){a+="|"}a+=(e.headings[0]==="name"||e.headings[0]==="item"?"":e.headings[0])+"|";for(let t=1;t<o;t++){a+=e.headings[t]+"|"}a=a.slice(0,-1)+"\n"}if(isNotEmpty(e.units)){if(i){a+="|"}for(let t=0;t<o;t++){a+=e.units[t]+"|"}a=a.slice(0,-1)+"\n"}for(let r=0;r<n;r++){if(i){a+=String(r+1)+"|"}for(let n=0;n<o;n++){const o=e.data[n][r];if(mixedFractionRegEx.test(o)){a+=format(Rnl.fromString(o),t,"100000.")+"|"}else{a+=o+"|"}}a=a.slice(0,-1)+"\n"}a=a.slice(0,-1).trim();a+="``";return a};const DataFrame=Object.freeze({append:append,dataFrameFromCSV:dataFrameFromCSV,dataFrameFromVectors:dataFrameFromVectors,matrix2table:matrix2table,display:display$2,displayAlt:displayAlt$1,quickDisplay:quickDisplay,range:range});const checkUnitEquality=(e,t)=>{let r;let n;if(e.expos&&t.expos){r=e.expos;n=t.expos}else{r=e;n=t}if(Array.isArray(r)){if(Array.isArray(n)){if(r.length!==n.length){return false}r.forEach(((e,t)=>{if(e!==n[t]){return false}}));return true}else{return false}}else{return r===n}};const append$1=(e,t,r,n)=>{let o;let i;if(e.dtype&dt.MAP){if(n!=="scalar"){return errorOprnd("BAD_APPEND",n)}o=e;i=t}else{if(r!=="scalar"){return errorOprnd("BAD_APPEND",r)}o=t;i=e}if(!(o.dtype&i.dtype)){errorOprnd("MAP_APPEND")}if(!checkUnitEquality(o.unit,i.unit)){errorOprnd("UNIT_APEND")}o.value.set(i.name,i.value);return o};const convertFromBaseUnits$1=(e,t,r)=>{e=mapMap(e,(e=>Rnl.divide(e,r)));if(!Rnl.isZero(t)){e=mapMap(e,(e=>Rnl.subtract(e,t)))}return e};const convertToBaseUnits$1=(e,t,r)=>{if(!Rnl.isZero(t)){e=mapMap(e,(e=>Rnl.add(e,t)))}return mapMap(e,(e=>Rnl.multiply(e,r)))};const display$3=(e,t,r,n=false)=>{const o=e.value.plain?e.value.plain:e.value;let i="";let a="";for(const[e,n]of o.entries()){i+=formatColumnName(e)+" & ";a+=format(n,t,r)+" & "}i=i.slice(0,-3);a=a.slice(0,-3);let s="\\begin{array}{c}";if(!n){s+=i+" \\\\ \\hline "}s+=a+"\\end{array}";if(e.unit&&e.unit.name){s+="\\;"+unitTeXFromString(e.unit.name)}return s};const displayAlt$2=(e,t,r,n=false)=>{const o=e.value.plain?e.value.plain:e.value;let i="";let a="";for(const[e,n]of o.entries()){i+=e+" | ";a+=format(n,t,r)+" | "}i=i.slice(0,-3);a=a.slice(0,-3);let s="``";if(!n){s+=i+"\n"}s+=a+"``";if(e.unit&&e.unit.name){s=`${s} '${e.unit.name}'`}return s};const singleValueFromMap=(e,t,r,n)=>{if(!e.value.has(t)){return errorOprnd("BAD_KEY",t)}const o=clone(e.value.get(t));if(!r){return{value:o,unit:e.unit,dtype:e.dtype-dt.MAP}}else if(n){return{value:o,unit:{expos:e.unit.expos},dtype:e.dtype-dt.MAP}}else{return{value:o,unit:allZeros,dtype:e.dtype-dt.MAP}}};const valueFromMap=(e,t,r)=>{for(let e=0;e<t.length;e++){if(t[e].dtype===dt.RATIONAL){return errorOprnd("NUM_KEY")}t[e]=t[e].value}if(t.length===1){const n=e.dtype&dt.RATIONAL;const o=t.length>1||r;return singleValueFromMap(e,t[0],n,o)}else{const r=new Map;for(let n=0;n<t.length;n++){r.set(t[n],e.value.get(t[n]))}return{value:r,unit:e.unit,dtype:e.dtype}}};const map=Object.freeze({append:append$1,convertFromBaseUnits:convertFromBaseUnits$1,convertToBaseUnits:convertToBaseUnits$1,display:display$3,displayAlt:displayAlt$2,valueFromMap:valueFromMap});const tt=Object.freeze({UNARY:0,BINARY:1,SUB:2,SUP:3,ACCENT:4,UNARYMINUS:5,DIV:6,PRIME:7,CURRENCY:8,ORD:9,VAR:10,NUM:11,SPACE:12,LONGVAR:13,LEFTBRACKET:14,RIGHTBRACKET:15,UNDEROVER:16,LEFTRIGHT:17,STRING:18,UNIT:19,BIN:20,ADD:21,MULT:22,REL:23,LOGIC:24,SEP:25,FUNCTION:26,ACCESSOR:28,ENVIRONMENT:29,FACTORIAL:30,SUPCHAR:31,ANGLE:32,ELLIPSIS:33,KEYWORD:34,PROPERTY:36,COMMENT:37,RETURN:38,TO:39,DATAFRAME:40,RICHTEXT:41});const minusRegEx=/^-(?![-=<>:])/;const numberRegEx$2=new RegExp(Rnl.numberPattern);const unitRegEx=/^(?:'[^']+'|[])/;const texFromNumStr=(e,t)=>{let r="";if(e[2]){r="\\mathrm{"+e[2]+"}"}else if(e[5]){return texFromMixedFraction(e)}else{r=e[3];if(e[6]){r+="."+e[6]}r=formattedDecimal(r,t);if(e[8]){r+="\\%"}else if(e[7]){if(e[7].charAt(0)==="-"){r+="\\text{e-}"+e[7].slice(1)}else{r+="\\text{e}"+e[7]}}}if(e[1]){r="\\text{-}"+r}return r};const isUnary=e=>{switch(e.ttype){case tt.NUM:case tt.ORD:case tt.VAR:case tt.RIGHTBRACKET:case tt.LONGVAR:case tt.CURRENCY:case tt.SUPCHAR:case tt.PRIME:case tt.FACTORIAL:return false;default:return true}};const wordRegEx=/^(?:(?:[A-Za-z\u0391-\u03C9\u03D5\u212C\u2130\u2131\u210B\u2110\u2112\u2133\u211B\u212F\u210A\u2113\u2134]|(?:\uD835[\uDC00-\udc33\udc9c-\udccf\udd38-\udd50]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]*|!in|-->|->|left\.|right\.|log10|log2)/;const words=Object.freeze({true:["true","\\mathord{\\text{true}}",tt.ORD,""],false:["false","\\mathord{\\text{false}}",tt.ORD,""],j:["j","j",tt.ORD,""],cos:["cos","\\cos",tt.FUNCTION,""],cosd:["cosd","\\operatorname{\\cos_d}",tt.FUNCTION,""],if:["if","\\mathrel{\\mathrm{if}}",tt.LOGIC,""],else:["else","\\mathrel{\\mathrm{else}}",tt.LOGIC,""],and:["and","\\mathrel{\\mathrm{and}}",tt.LOGIC,""],or:["or","\\mathrel{\\mathrm{or}}",tt.LOGIC,""],for:["for","\\mathrel{\\mathrm{for}}",tt.KEYWORD,""],while:["while","\\mathrel{\\mathrm{while}}",tt.KEYWORD,""],in:["in","\\mathrel{\\mathrm{in}}",tt.KEYWORD,""],break:["break","\\mathrel{\\mathrm{break}}",tt.KEYWORD,""],to:["to","\\mathbin{\\mathrm{to}}",tt.TO,""],raise:["raise","\\mathrel{\\mathrm{raise}}",tt.UNARY,""],echo:["echo","\\mathrel{\\mathrm{echo}}",tt.UNARY,""],return:["return","\\mathrel{\\mathrm{return}}",tt.RETURN,""],sqrt:["sqrt","\\sqrt",tt.UNARY,""],otherwise:["otherwise","\\mathrel{\\mathrm{otherwise}}",tt.LOGIC,""],root:["root","\\sqrt",tt.BINARY,""],sin:["sin","\\sin",tt.FUNCTION,""],sind:["sind","\\operatorname{\\sin_d}",tt.FUNCTION,""],tan:["tan","\\tan",tt.FUNCTION,""],tand:["tand","\\operatorname{\\tan_d}",tt.FUNCTION,""],cotd:["cotd","\\operatorname{\\cot_d}",tt.FUNCTION,""],secd:["secd","\\operatorname{\\sec_d}",tt.FUNCTION,""],cscd:["cscd","\\operatorname{\\csc_d}",tt.FUNCTION,""],log:["log","\\log",tt.FUNCTION,""],ln:["ln","\\ln",tt.FUNCTION,""],log10:["log10","\\log_{10}",tt.FUNCTION,""],log2:["log2","\\log_{2}",tt.FUNCTION,""],"log!":["log!","\\operatorname{log!}",tt.FUNCTION,""],"":["","",tt.ORD,""],"":["","",tt.VAR,""],modulo:["modulo","\\operatorname{modulo}",tt.MULT,""],"->":["->","",tt.REL,""],"--\x3e":["--\x3e","\\xrightarrow",tt.UNARY,""],"<--\x3e":["<--\x3e","\\xrightleftarrows",tt.UNARY,""]});const miscRegEx=/^([/\u2215_:,;^+\\\-*.%|><=!~#?&@([{}\])\u00A0\u20D7$]+)/;const miscSymbols=Object.freeze({"#":["#","#",tt.COMMENT,""],"/":["/","\\dfrac{",tt.DIV,""],"//":["//","\\tfrac{",tt.DIV,""],"///":["///","/",tt.MULT,""],"":["","",tt.MULT,""],"":["","",tt.MULT,""],_:["_","_",tt.SUB,""],"^":["^","^",tt.SUP,""],"+":["+","+",tt.ADD,""],"-":["-","-",tt.ADD,""],"":["-","-",tt.ADD,""],"":["-","-",tt.ADD,""],"*":["*","*",tt.MULT,""],"":["","",tt.MULT,""],"":["","\\circ",tt.MULT,""],"":["","",tt.MULT,""],"":["","\\sqrt",tt.UNARY,""],"":["","\\sqrt[3]",tt.UNARY,""],"":["","\\sqrt[4]",tt.UNARY,""],"+-":["+-","",tt.BIN,""],"**":["**","\\star",tt.BIN,""],"":["","",tt.MULT,""],"...":["...","\\dots",tt.ORD,""],"%":["%","\\%",tt.FACTORIAL,""],"^*":["^*","^*",tt.FACTORIAL,""],"-:":["-:","",tt.MULT,""],"=":["=","=",tt.REL,""],"":["","",tt.REL,""],"==":["==","==",tt.REL,""],"":["","",tt.REL,""],">":[">","\\gt",tt.REL,""],"<":["<","\\lt",tt.REL,""],"?=":["?=","",tt.REL,""],"":["","",tt.REL,""],"":["","",tt.REL,""],"!=":["!=","",tt.REL,""],"<>":["<>","",tt.REL,""],":=":[":=","",tt.REL,""],"<=":["<=","",tt.REL,""],"":["","",tt.REL,""],">=":[">=","",tt.REL,""],"":["","",tt.REL,""],"-=":["-=","",tt.REL,""],"~=":["~=","",tt.REL,""],"":["","",tt.REL,""],"~~":["~~","",tt.REL,""],"~":["~","\\sim",tt.REL,""],"=>":["=>","",tt.REL,""],"":["","\\xrightarrow",tt.UNARY,""],"":["","\\xleftarrow",tt.UNARY,""],"":["","",tt.REL,""],"<=>":["<=>","",tt.REL,""],"-<":["-<","",tt.REL,""],">-":[">-","",tt.REL,""],"-<=":["-<=","",tt.REL,""],">-=":[">-=","",tt.REL,""],"_|_":["_|_","\\bot",tt.REL,""],"|--":["|--","",tt.REL,""],"|==":["|==","\\models",tt.REL,""],"":["","",tt.REL,""],"":["","",tt.REL,""],"":["","",tt.REL,""],"":["","\\mathrel{}",tt.REL,""],"!":["!","!",tt.FACTORIAL,""],"":["","!!",tt.FACTORIAL,""],"!!":["!!","!!",tt.FACTORIAL,""],"":["","",tt.FACTORIAL,""],"&":["&","\\mathbin{\\&}",tt.ADD,""],"&_":["&_","\\mathbin{\\underline{\\&}}",tt.ADD,""],"":["","'",tt.PRIME,""],"":["","''",tt.PRIME,""],"":["","''",tt.PRIME,""],"":["","'''",tt.PRIME,""],"":["","",tt.LOGIC,""],"":["","",tt.LOGIC,""],"":["","",tt.LOGIC,""],"":["","",tt.LOGIC,""],"":["","",tt.LOGIC,""],"":["","",tt.UNARY,""],":":[":",":",tt.LOGIC,""],"":["","",tt.UNDEROVER,""],"":["","",tt.UNDEROVER,""],"":["","",tt.UNDEROVER,""],"":["","",tt.UNDEROVER,""],"(":["(","(",tt.LEFTBRACKET,")"],"[":["[","[",tt.LEFTBRACKET,"]"],"{":["{","\\{",tt.LEFTBRACKET,"\\}"],"{:":["{:","{",tt.LEFTBRACKET,"}"],"":["","",tt.LEFTBRACKET,""],")":[")",")",tt.RIGHTBRACKET,""],"]":["]","]",tt.RIGHTBRACKET,""],"}":["}","\\}",tt.RIGHTBRACKET,""],"":["","",tt.RIGHTBRACKET,""],":}":[":}","}",tt.RIGHTBRACKET,""],"|":["|","|",tt.LEFTRIGHT,""],"||":["||","\\Vert ",tt.LEFTRIGHT,""],"":["","\\Vert ",tt.LEFTRIGHT,""],"<<":["<<","",tt.LEFTBRACKET,""],">>":[">>","",tt.RIGHTBRACKET,""],"":["","\\lfloor ",tt.LEFTBRACKET,"\\rfloor "],"":["","\\rfloor ",tt.RIGHTBRACKET,""],"":["","\\rfloor ",tt.RIGHTBRACKET,""],"":["","\\lceil ",tt.LEFTBRACKET,"\\rceil "],"":["","\\lceil ",tt.LEFTBRACKET,"\\rceil "],"":["","\\rceil ",tt.RIGHTBRACKET,""],"":["","\\rceil ",tt.RIGHTBRACKET,""],"":["","{",tt.LEFTBRACKET,"}"],"":["","}",tt.RIGHTBRACKET,""],"":["","\\mid ",tt.REL,""],"":["","",tt.ORD,""],"":["","",tt.ORD,""],"":["","",tt.ORD,""],"":["","",tt.ORD,""],"":["","",tt.ORD,""],"":["","",tt.ORD,""],"":["","",tt.REL,""],"":["","",tt.REL,""],">->":[">->","",tt.REL,""],"->>":["->>","",tt.REL,""],"|->":["|->","",tt.REL,""],"<--":["<--","\\xleftarrow",tt.UNARY,""],"==>":["==>","\\xRightarrow",tt.UNARY,""],"<==":["<==","\\xLeftarrow",tt.UNARY,""],"<--\x3e":["<--\x3e","\\xleftrightarrow",tt.UNARY,""],"<==>":["<==>","\\xLeftrightarrow",tt.UNARY,""],"":["","",tt.ANGLE,""],"":["","",tt.ORD,""],"":["","~",tt.SPACE,""],"\\,":["\\,",",\\:",tt.SEP,""],"\\;":["\\;",";\\:",tt.SEP,""],"":["","",tt.ORD,""],"..":["..","..",tt.RANGE,""],",":[",",",\\:",tt.SEP,""],";":[";",";\\:",tt.SEP,""],$:["$","\\$",tt.CURRENCY,""],"":["","",tt.CURRENCY,""],"":["","",tt.CURRENCY,""],"":["","",tt.CURRENCY,""],"":["","",tt.CURRENCY,""],"":["","",tt.CURRENCY,""],"":["","",tt.CURRENCY,""]});const texFunctionRegEx=/^(\\[A-Za-z]+\.?|\\([:.!\u0020]|'+))/;const texFunctions=Object.freeze({"\\aleph":["\\aleph","",tt.VAR,""],"\\beth":["\\beth","",tt.VAR,""],"\\gimel":["gimel","",tt.VAR,""],"\\daleth":["daleth","",tt.VAR,""],"\\atop":["\\atop","\\atop{",tt.DIV,""],"\\cdots":["\\cdots","",tt.BIN,""],"\\vdots":["\\vdots","",tt.BIN,""],"\\ddots":["\\ddots","",tt.BIN,""],"\\iff":["\\iff","\\iff",tt.LOGIC,""],"\\land":["\\land","\\land",tt.BIN,""],"\\lor":["\\lor","\\lor",tt.BIN,""],"\\in":["\\in","",tt.REL,""],"\\notin":["\\notin","",tt.REL,""],"\\Subset":["\\Subset","",tt.REL,""],"\\left.":["\\left.","\\left.",tt.LEFTBRACKET,"\\right."],"\\right.":["\\right.","\\right.",tt.RIGHTBRACKET,""],"\\mod":["\\mod","\\mod",tt.BIN,""],"\\diamond":["\\diamond","\\diamond",tt.ORD,""],"\\square":["\\square","\\square",tt.ORD,""],"\\int":["\\int","\\int",tt.UNDEROVER,""],"\\iint":["\\iint","\\iint",tt.UNDEROVER,""],"\\iiint":["\\iiint","\\iiint",tt.UNDEROVER,""],"\\oint":["\\oint","\\oint",tt.UNDEROVER,""],"\\oiint":["\\oiint","\\oiint",tt.UNDEROVER,""],"\\oiiint":["\\oiiint","\\oiiint",tt.UNDEROVER,""],"\\over":["\\over","\\dfrac{",tt.DIV],"\\sum":["\\sum","\\sum",tt.UNDEROVER,""],"\\prod":["\\prod","\\prod",tt.UNDEROVER,""],"\\quad":["\\quad","\\quad",tt.SPACE,""],"\\qquad":["\\qquad","\\qquad",tt.SPACE,""]});const accents=Object.freeze(["Bbb","Overrightarrow","acute","bar","bm","bold","boldsymbol","breve","check","ddot","dot","frak","grave","hat","mathbb","mathbf","mathcal","mathfrak","mathit","mathnormal","mathring","mathrm","mathscr","mathsf","mathtt","overbrace","overgroup","overleftarrow","overleftharpoon","overleftrightarrow","overline","overrightarrow","overrightharpoon","tilde","underbrace","undergroup","underleftarrow","underleftrightarrow","underline","underrightarrow","utilde","vec","widecheck","widehat","widetilde"]);const mathOperators=Object.freeze(["arccos","arcsin","arctan","arctg","arcctg","cos","cosec","cosh","cot","cotg","coth","csc","ctg","cth","det","dim","exp","gcd","lg","lim","ln","log","max","min","sec","sin","sinh","sh","sqrt","sup","tan","tanh","tg","th"]);const colors=Object.freeze(["blue","gray","green","orange","pink","purple","red"]);const unaries=Object.freeze(["bcancel","boxed","cancel","clap","color","llap","mathclap","not","operatorname","phantom","pu","rlap","sout","sqrt","tag","textbf","textit","textmd","textnormal","textrm","textsc","textsf","texttt","textup","xLeftarrow","xLeftrightarrow","xRightarrow","xcancel","xleftarrow","xleftrightarrow","xleftharpoondown","xleftharpoons","xleftharpoonup","xlongequal","xmapsto","xrightarrow","xrightharpoondown","xrightharpoonup","xrightleftarrows","xrightleftharpoons","xtofrom","xtwoheadleftarrow","xtwoheadrightarrow"]);const binaries=Object.freeze(["dfrac","frac","lower","overset","raisebox","stackrel","tag","tfrac","underset"]);const texREL=Object.freeze(["Bumpeq","Colonapprox","Coloneq","Coloneqq","Colonsim","Darr","Doteq","Downarrow","Eqcolon","Eqqcolon","Harr","Larr","Leftarrow","Leftrightarrow","Lleftarrow","Longleftarrow","Longleftrightarrow","Longrightarrow","Lrarr","Lsh","Rarr","Rightarrow","Rrightarrow","Rsh","Supset","Subset","Uarr","Uparrow","Updownarrow","Vdash","Vvdash","approx","approxeq","asymp","backepsilon","backsim","backsimeq","between","bowtie","bumpeq","circeq","circlearrowleft","circlearrowright","colonapprox","coloneq","coloneqq","colonsim","cong","curlyeqprec","curlyeqsucc","curvearrowleft","curvearrowright","dArr","darr","dashleftarrow","dashrightarrow","dashv","dblcolon","doteq","doteqdot","downarrow","downdownarrows","downharpoonleft","downharpoonright","eqcirc","eqcolon","eqqcolon","eqsim","eqslantgtr","eqslantless","equiv","fallingdotseq","frown","ge","geq","geqq","geqslant","gets","gg","ggg","gggtr","gnapprox","gneq","gneqq","gnsim","gt","gtrapprox","gtreqless","gtreqqless","gtrless","gtrsim","gvertneqq","hArr","harr","hookleftarrow","hookrightarrow","iff","impliedby","implies","in","isin","Join","gets","impliedby","implies","in","isin","lArr","larr","le","leadsto","leftarrow","leftarrowtail","leftharpoondown","leftharpoonup","leftleftarrows","leftrightarrow","leftrightarrows","leftrightharpoons","leftrightsquigarrow","leq","leqq","leqslant","lessapprox","lesseqgtr","lesseqqgtr","lessgtr","lesssim","ll","lll","llless","lnapprox","lneq","lneqq","lnsim","longleftarrow","longleftrightarrow","longmapsto","longrightarrow","looparrowleft","looparrowright","lrArr","lrarr","lt","lvertneqq","mapsto","mid","models","multimap","nLeftarrow","nLeftrightarrow","nRightarrow","nVDash","nVdash","ncong","ne","nearrow","neq","nexists","ngeq","ngeqq","ngeqslant","ngtr","ni","nleftarrow","nleftrightarrow","nleq","nleqq","nleqslant","nless","nmid","notin","notni","nparallel","nprec","npreceq","nrightarrow","nshortmid","nshortparallel","nsim","nsubseteq","nsubseteqq","nsucc","nsucceq","nsupseteq","nsupseteqq","ntriangleleft","ntrianglelefteq","ntriangleright","ntrianglerighteq","nvDash","nvdash","nwarrow","owns","parallel","perp","pitchfork","prec","precapprox","preccurlyeq","preceq","precnapprox","precneqq","precnsim","precsim","propto","rArr","rarr","restriction","rightarrow","rightarrowtail","rightharpoondown","rightharpoonup","rightleftarrows","rightleftharpoons","rightrightarrows","rightsquigarrow","risingdotseq","searrow","shortmid","shortparallel","sim","simeq","smallfrown","smallsmile","smile","sqsubset","sqsubseteq","sqsupset","sqsupseteq","sub","sube","subset","subseteq","subseteqq","subsetneq","subsetneqq","succ","succapprox","succcurlyeq","succeq","succnapprox","succneqq","succnsim","succsim","supe","supset","supseteq","supseteqq","supsetneq","supsetneqq","swarrow","thickapprox","thicksim","to","trianglelefteq","triangleq","trianglerighteq","twoheadleftarrow","twoheadrightarrow","uArr","uarr","uparrow","updownarrow","upharpoonleft","upharpoonright","upuparrows","varpropto","varsubsetneq","varsubsetneqq","varsupsetneq","varsupsetneqq","vartriangle","vartriangleleft","vartriangleright","vcentcolon","vdash","vDash"]);const superRegEx=/^?[]+/;const cloneToken=e=>[e[0],e[1],e[2],e[3]];const accentFromChar$1=Object.freeze({"":"\\grave","":"\\acute","":"\\hat","":"\\tilde","":"\\bar","":"\\bar","":"\\dot","":"\\ddot","":"\\mathring","":"\\check","":"\\underline","":"\\overleftharpoon","":"\\overrightharpoon","":"\\overleftarrow","":"\\vec","":"\\overleftrightarrow"});const wideAccentFromChar=Object.freeze({"":"\\grave","":"\\acute","":"\\widehat","":"\\widetilde","":"\\overline","":"\\overline","":"\\dot","":"\\ddot","":"\\mathring","":"\\check","":"\\underline","":"\\overleftharpoon","":"\\overrightharpoon","":"\\overleftarrow","":"\\overrightarrow","":"\\overleftrightarrow"});const groupSubscript=e=>{const t=e.indexOf("_");return t===-1?e:e.slice(0,t+1)+"{"+e.slice(t+1)+"}"};const checkForTrailingAccent=e=>{const t=e.slice(-1);if(/[\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]/.test(t)){e=e.slice(0,-1);return e==="i"?accentFromChar$1[t]+"{}":e==="j"?accentFromChar$1[t]+"{}":e.length===1?accentFromChar$1[t]+"{"+e+"}":wideAccentFromChar[t]+"{"+e+"}"}else{return e}};const lexOneWord=(e,t)=>{const r=wordRegEx.exec(e);if(r){let n=r[0].replace(/_*$/,"");const o=e.charAt(n.length);const i=words[n];if(i&&o!==""){return i}else if(/^\(/.test(o)){return t.ttype===tt.ACCENT?[n,n+"}{",tt.FUNCTION,""]:n==="sqrt"?[n,"\\sqrt",tt.UNARY,""]:n==="f"?[n,n,tt.FUNCTION,""]:isIn(n,mathOperators)?[n,"\\"+n,tt.FUNCTION,""]:[n,"\\operatorname{"+groupSubscript(n)+"}",tt.FUNCTION,""]}else if(t.ttype===tt.ACCESSOR){return[n,n,tt.PROPERTY,""]}else if(/[_\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]/.test(n)){let t="";if(n.indexOf("_")===-1){t=checkForTrailingAccent(n);return[n,t,n.length>2?tt.LONGVAR:tt.VAR,""]}else{const r=n.split("_");for(let e=r.length-1;e>=0;e--){r[e]=checkForTrailingAccent(r[e]);if(e>0){r[e]="_\\text{"+r[e]+"}"}}t=r.join("");const o=/^*/.exec(e.slice(n.length));if(o){n+=o[0];t+="'".repeat(o[0].length)}const i=t.indexOf("_");if(i>-1){t=t.slice(0,i)+"{"+t.slice(i)+"}"}return[n,t,r[0].length>1?tt.LONGVAR:tt.VAR,""]}}else if(n.length===2&n.charAt(0)==="\ud835"){return[n,n,tt.VAR,""]}else if(n.length>1){return[n,n,tt.LONGVAR,""]}else{if(n.charAt(0)==="\ud835"){return[n.substring(0,2),n.substring(0,2),tt.VAR,""]}else{return[n.charAt(0),n.charAt(0),tt.VAR,""]}}}};const lex=(e,t,r,n=false)=>{let o=0;let i="";let a;if(e.charAt(0)==='"'){o=e.indexOf('"',1);if(o>0){i=e.substring(1,o).replace(/\r?\n.*/,"");return['"'+i+'"',i,tt.STRING,""]}else{return[e,e.replace(/\r?\n.*/,""),tt.STRING,""]}}if(/^#/.test(e)){i=e.slice(2);o=i.indexOf("\n");if(o>-1){const e=i.indexOf("\n");if(e>-1&&e<o){o=e}}if(o>-1){i=i.slice(0,o)}return[`#${i}`,`\\text{\\texttt{ \\#${i}}}`,tt.COMMENT,""]}if(/^``/.test(e)){o=e.indexOf("`",e.charAt(2)==="`"?3:2);const r=o>0?e.slice(2,o):e.slice(2);const i=tablessTrim(r);let a="";if(n){a=DataFrame.quickDisplay(i)}else{const e=DataFrame.dataFrameFromCSV(i,{});if(e.dtype===dt.DATAFRAME){a=DataFrame.display(e.value,"h3",t)}else{a=map.display(e,"h3",t)}}return["``"+r+"``",a,tt.DATAFRAME,""]}if(e.charAt(0)==="`"){o=e.indexOf("`",1);if(o>0){i=e.substring(1,o).replace(/\r?\n.*/,"");return["`"+i+"`",i,tt.RICHTEXT,""]}else{return[e,e.replace(/\r?\n.*/,""),tt.RICHTEXT,""]}}if(unitRegEx.test(e)){o=e.indexOf("'",1);if(o>0){i=e.substring(1,o);return["'"+i+"'",unitTeXFromString(i),tt.UNIT,""]}else{return[e.charAt(0),e.charAt(0),tt.UNIT,""]}}a=texFunctionRegEx.exec(e);if(a){const e=a[0];i=e.substring(1);if(isIn(i,accents)){return[e,e,tt.ACCENT,""]}if(isIn(i,unaries)){return[e,e,tt.UNARY,""]}if(isIn(i,colors)){return[e,"\\textcolor{"+i+"}",tt.UNARY,""]}if(isIn(i,binaries)){return[e,e,tt.BINARY,""]}if(isIn(i,texREL)){return[e,e,tt.REL,""]}const t=texFunctions[e];if(t){return cloneToken(t)}return[e,e,tt.ORD,""]}if(minusRegEx.test(e)){if(isUnary(r)){const r=e.match(numberRegEx$2);if(r){i=texFromNumStr(r,t);return[r[0],i,tt.NUM,""]}}return["-","-",tt.ADD,""]}const s=e.match(numberRegEx$2);if(s){i=texFromNumStr(s,t);return[s[0],i,tt.NUM,""]}if(/^_[([{]/.test(e)){return["_","_",tt.SUB,""]}const l=lexOneWord(e,r);if(l){return cloneToken(l)}const c=superRegEx.exec(e);if(c){return[c[0],c[0],tt.SUPCHAR,""]}a=miscRegEx.exec(e);if(a){const e=a[0];for(let t=e.length;t>=1;t--){i=e.substr(0,t);if(miscSymbols[i]){return cloneToken(miscSymbols[i])}}}const u=e.charAt(0);if(u==="."&&(r.ttype===tt.VAR||r.ttype===tt.LONGVAR||r.ttype===tt.STRING||r.input==="]"||r.ttype===tt.PROPERTY)){return[".","{.}",tt.ACCESSOR,""]}return[u,addTextEscapes(u),tt.VAR,""]};const builtInFunctions=["Gamma","Im","Re","abs","acos","acosd","acosh","acot","acotd","acoth","acsc","acscd","acsch","argument","asec","asecd","asech","asin","asind","asinh","atan","atan2","atand","atanh","binomial","chr","cos","cosd","cosh","cosh","cot","cotd","coth","coth","count","csc","cscd","csch","csch","exp","fetch","format","gcd","hypot","isNaN","length","lerp","ln","log","log10","log2","logFactorial","logGamma","logn","log","matrix2table","random","rms","round","roundSig","roundn","sec","secd","sech","sech","sign","sin","sind","sinh","startSvg","string","tan","tand","tanh","tanh","trace","transpose","zeros",""];const builtInReducerFunctions=["accumulate","dataframe","max","mean","median","min","product","range","stddev","sum","variance"];const trigFunctions=["cos","cosd","cot","cotd","csc","cscd","sec","secd","sin","sind","tand","tan"];const rationalRPN=e=>{const t=Rnl.fromString(e);return""+String(t[0])+"/"+String(t[1])};const calligraphicRegEx=/^(:?\uD835[\uDC9C-\uDCCF]|[\udc9d\udca0\udca1\udca3\udca4\udca7\udca8\udcad\udcba\udcbc\udcc1\udcc4])/;const bmpCalligraphic={"":"B","":"E","":"F","":"H","":"I","":"L","":"M","":"R","":"e","":"g","":"l","":"o"};const assertCalligraphic=e=>{const t=calligraphicRegEx.exec(e);if(!t){return e}let r="";if(e.charAt(0)==="\ud835"){const t=e.charCodeAt(1);r=String.fromCharCode(t-(t<=56501?56411:56405))}else{r=bmpCalligraphic[e.charAt(0)]}return`\\mathcal{${r}}`+e.slice(t[0].length)};const checkForUnaryMinus=(e,t)=>{switch(t.ttype){case tt.NUM:case tt.ORD:case tt.VAR:case tt.RIGHTBRACKET:case tt.LONGVAR:case tt.PROPERTY:case tt.UNIT:case tt.SUPCHAR:case tt.PRIME:case tt.FACTORIAL:return e}if(e.output==="-"){return{input:"~",output:"\\text{-}",ttype:tt.UNARYMINUS}}else{return{input:"+",output:"~+",ttype:tt.UNARYMINUS}}};const numFromSuperChar={"":"-","":"2","":"3","":"1","":"0","":"4","":"5","":"6","":"7","":"8","":"9"};const numFromSupChars=e=>{let t="";for(const r of e){t+=numFromSuperChar[r]}return t};const colorSpecRegEx=/^(#([a-f0-9]{6}|[a-f0-9]{3})|[a-z]+|\([^)]+\))/i;const factors=/^[A-Za-z\u0391-\u03C9\u03D5\u210B\u210F\u2110\u2112\u2113\u211B\u212C\u2130\u2131\u2133\uD835[({]/;const setUpIf=(e,t,r,n)=>{const o=e.replace(/^.*\xa0/,"").replace(/$/,"");r.push(o);e=e.length===o.length?"":e.slice(0,e.length-o.length);n.numArgs+=1;if(t==="otherwise"){e+="true"}return e};const functionExpoRegEx=/^[\^\u2074-\u2079]/;const openParenRegEx=/^ *\(/;const exponentOfFunction=(e,t,r)=>{let n="";if(e.charAt(0)!=="^"){n=/^[\u2074-\u2079]+/.exec(e)[0];n=numeralFromSuperScript(n)}else if(!openParenRegEx.test(e.slice(1))){n=lex(e.slice(1),t,{input:"",output:"",ttype:50})[0]}else{n="(";let t=1;for(let r=2;r<e.length;r++){const o=e.charAt(r);n+=o;if("\"'`".indexOf(o)>-1){const t=e.indexOf(o,r+1);n+=e.slice(r+1,t+1);r=t}else if("([{".indexOf(o)>-1){t+=1}else if(")]}".indexOf(o)>-1){t-=1}if(t===0){break}}}const o=n.charAt(0)==="("?n.slice(1,-1).trim():n;if(r){const e=parse(o,t,true);return[n,"{"+e[0]+"}",e[1]]}else{const e=parse(o,t,false);return[n,"{"+e+"}",""]}};const testForImplicitMult=(e,t,r)=>{if(t.length>0){const e=t[t.length-1].ttype;if(e===tt.UNARY||e===tt.BINARY){return false}if(e===tt.SUB||e===tt.SUP){if(t[t.length-1].isOnFunction){return false}}}let n=false;if(e.output){const t=e.output.charAt(e.length-1);if(")]}".indexOf(t)>-1){if((t===")"||t==="]")&&/^[([]/.test(r)){return false}else{n=true}}else{switch(e.ttype){case tt.ORD:case tt.NUM:case tt.VAR:case tt.LONGVAR:case tt.PRIME:case tt.SUP:case tt.SUPCHAR:case tt.SUB:case tt.PROPERTY:case tt.UNIT:case tt.RIGHTBRACKET:case tt.FACTORIAL:n=true;break;default:n=false}}}if(n&&nextCharIsFactor(r,e.ttype)){return true}return false};const nextCharIsFactor=(e,t)=>{const r=e.replace(leadingLaTeXSpaceRegEx,"");const n=r.charAt(0);let o=false;if(r.length>0){if(n==="|"||n==="");else if(/^[({[0-9]/.test(r)&&isIn(t,[tt.ORD,tt.VAR,tt.NUM,tt.LONGVAR,tt.RIGHTBRACKET,tt.CURRENCY,tt.SUPCHAR])){return true}else{if(factors.test(n)){o=!/^(if|and|atop|or|else|modulo|otherwise|not|for|in|while|end)\b/.test(r)}}}return o};const cloneToken$1=e=>({input:e.input,output:e.output,ttype:e.ttype,closeDelim:e.closeDelim});const leadingSpaceRegEx$1=/^[ \f\r\t\v\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/;const leadingLaTeXSpaceRegEx=/^(|\\quad|\\qquad)+/;const rpnPrecFromType=[12,12,15,13,16,10,7,10,12,-1,-1,-1,1,-1,0,0,-1,0,-1,14,0,6,7,5,4,1,-1,16,15,-1,14,13,9,3,2,10,-1,-1,4,3,-1,-1];const texPrecFromType=[12,12,15,13,16,10,2,10,12,2,2,2,1,2,2,0,1,1,2,14,1,2,2,1,1,1,2,-1,15,2,14,13,9,-1,1,-1,15,-1,1,-1,2,2];const dNOTHING=0;const dPAREN=1;const dFUNCTION=2;const dACCESSOR=3;const dMATRIX=4;const dVECTORFROMRANGE=5;const dCASES=7;const dBINOMIAL=8;const dSUBSCRIPT=9;const dDISTRIB=10;const parse=(e,t="1,000,000.",r=false,n=false)=>{let o="";let i="";let a={};let s={input:"",output:"",ttype:50};let l=true;let c=false;let u=0;let p=false;let f=false;let d=false;let h=false;let m=false;let v;const g=[];const y=[];const b=[{delimType:dNOTHING,isTall:false}];let w=true;let S="";let C="";let R="";let M=-1;const x=[];const T=e=>{if(r&&e>=0){while(y.length>0){const t=y[y.length-1].prec;if(t<e||t===13&&e===13){break}i+=y.pop().symbol+R}}};const k=(t,n,l)=>{if(!n){return}if(g.length===0){if(s.ttype!==tt.RIGHTBRACKET&&s.ttype!==tt.LEFTRIGHT){v={pos:u,ttype:s.ttype,closeDelim:""}}return}const c=g[g.length-1];if((t===2||t===12||t===14||t===15)&&(s.ttype!==tt.RIGHTBRACKET&&s.ttype!==tt.LEFTRIGHT)&&c.prec<t){v={pos:u,ttype:s.ttype,closeDelim:""};return}let p={};while(g[g.length-1].prec>=t&&!(g[g.length-1].prec===13&&t===13)){v=g.pop();if(v.prec===0){p=b[b.length-1];if((v.ttype===tt.LEFTBRACKET||v.ttype===tt.LEFTRIGHT)&&v.closeDelim.length>0){if(g.length>0){if(v.ttype===tt.LEFTRIGHT&&a.output===")"&&g[g.length-1].closeDelim===")"){if(p.isTall){o=o.substring(0,v.pos)+"\\middle"+o.substring(v.pos);b[b.length-1].isTall=true}v=g.pop();b.pop();p=b[b.length-1]}}if(p.delimType===dMATRIX){const e=o.slice(v.pos,v.pos+1)==="\\"?2:1;o=o.slice(0,v.pos)+p.open+o.slice(v.pos+e);v.closeDelim=p.close}else if(p.delimType===dCASES){o=o.slice(0,v.pos)+p.open+o.slice(v.pos+2);v.closeDelim=p.close}else if(p.delimType===dPAREN&&p.name==="("&&/^(\/|\\atop\s)/.test(e)){o=o.substring(0,v.pos)+o.substring(v.pos+1);v.closeDelim=""}else if(p.isPrecededByDiv&&p.delimType===dPAREN&&p.name==="("&&(/^[^^_!%]/.test(e)||e.length===0)){o=o.substring(0,v.pos)+o.substring(v.pos+1);v.closeDelim=""}else if(p.isTall){if(/^\\left/.test(o.substring(v.pos))===false){o=o.substring(0,v.pos)+"\\left"+o.substring(v.pos)}if(/\\right/.test(v.closeDelim)===false){v.closeDelim="\\right"+a.output}}}}o=o.replace(/\\, *$/,"");o+=v.closeDelim;if(v.closeDelim.slice(-1)==="{"){if(v.ttype===tt.BINARY){g.push({prec:12,pos:v.pos,ttype:tt.UNARY,closeDelim:"}"});if(r){i+=R;if(y[y.length-1].symbol==="\\sqrt"){y[y.length-1].symbol="root"}}}v.ttype=tt.UNARY;s={input:"",output:"",ttype:tt.UNARY};return}if(g.length===0||v.prec===0){return}}};e=e.replace(leadingSpaceRegEx$1,"");e=e.replace(/\s+$/,"");while(e.length>0){if(e.charAt(0)==="\n"){e=e.slice(1);const t=s?s.input.slice(-1):"0";if(s.ttype===tt.COMMENT||"{[(,;+-".indexOf(t)===-1&&!/^ *[)}\]]/.test(e)){k(0,true);o+="\\\\ ";const t=/^ +/.exec(e);e=e.replace(/^ */,"");if(e.length>0&&e.charAt(0)==="="&o.indexOf("=")>-1){c=true;o+="&"}else if(t){o+="\\quad ".repeat(t[0].length-1)}}e=e.trim()}l=true;h=p&&w&&testForImplicitMult(s,g,e);if(h){const e=s.ttype;a={input:"",output:[tt.LONGVAR,tt.NUM,tt.UNIT].includes(e)?"\\,":"",ttype:tt.MULT};f=false;d=false;l=false}if(l){const r=lex(e,t,s,n);a={input:r[0],output:r[1],ttype:r[2],closeDelim:r[3]};e=e.substring(a.input.length);f=leadingSpaceRegEx$1.test(e)||/^(|\\quad|\\qquad)+/.test(e);d=/^[ \n]/.test(e);e=e.replace(leadingSpaceRegEx$1,"");m=nextCharIsFactor(e,a.ttype)}switch(a.ttype){case tt.SPACE:case tt.BIN:case tt.ADD:case tt.MULT:case tt.REL:case tt.UNDEROVER:{if(a.output.length>0&&"- +".indexOf(a.output)>-1){a=checkForUnaryMinus(a,s)}if(r&&a.ttype!==tt.SPACE){if(a.output!=="\\text{-}"){i+=R}M=rpnPrecFromType[a.ttype];T(M)}const e=texPrecFromType[a.ttype];k(e,w);o+=a.output+" ";u=o.length;if(a.ttype===tt.UNDEROVER&&b.length>1){b[b.length-1].isTall=true}else if(r){y.push({prec:M,symbol:a.input})}w=true;break}case tt.ACCESSOR:case tt.ANGLE:a=checkForUnaryMinus(a,s);if(r){i+=R;M=rpnPrecFromType[a.ttype];T(M);y.push({prec:M,symbol:a.input})}k(texPrecFromType[a.ttype],w);o+=r?a.input:a.output+" ";w=true;break;case tt.NUM:case tt.ORD:k(2,w);if(r){T(-1);i+=a.ttype===tt.NUM?rationalRPN(a.input):a.input}if(p){u=o.length}if(r&&(s.ttype===tt.MULT||m&&s.ttype!==tt.DIV)){a.output="("+a.output+")"}o+=a.output+" ";w=true;if(!f&&m){k(2,w);if(r){i+=R;T(7);y.push({prec:rpnPrecFromType[tt.MULT],symbol:""})}}break;case tt.STRING:{k(2,w);const e=a.input.charAt(0);if(r){i+=e+a.output+e}if(p){u=o.length}a.output=addTextEscapes(a.output);a.output=a.output.replace(/ +$/,"\\,");o+="\\text{"+a.output+"}";w=true;break}case tt.RICHTEXT:{k(2,w);const e=a.input.charAt(0);if(r){i+=e+a.output+e}if(p){u=o.length}a.output=a.output==="`"?"`":parse(a.output,t,false);o+="{"+a.output+"}";w=true;break}case tt.DATAFRAME:k(2,w);u=o.length;o+=a.output;w=true;break;case tt.VAR:case tt.LONGVAR:{if(a.ttype===tt.LONGVAR&&s.input===""){o+="\\,"}k(7,w);if(p){u=o.length}a.output=assertCalligraphic(a.output);if(!r){if(a.ttype===tt.LONGVAR){a.output="\\mathrm{"+a.output+"}"}}else if(s.input==="for"){i+='"'+a.input+'"'}else{if(/^(\.[^.]|\[)/.test(e)){a.output=a.ttype===tt.LONGVAR?"\\mathrm{"+a.output+"}":a.output}else{a.output=a.input;a.output=""+a.output}i+=""+a.input}o+=a.output+(e.charAt(0)==="."?"":" ");if(r){b[b.length-1].isTall=true}w=true;break}case tt.UNIT:{k(14,true);g.push({prec:14,pos:v.pos,ttype:tt.UNIT,closeDelim:""});if(r){T(14);i+=R+"applyUnit"+R+a.input.replace(/'/g,"")}if(!/^'?'?$/.test(a.input)){o+="\\;"}o+=a.output;w=true;break}case tt.PROPERTY:{k(15,w);const t=a.input.indexOf("_");if(r){i+='"'+a.output+'"';o+=`\\mathrm{${a.output}}`;if(e.charAt(0)!=="."){o+=" "}}else if(t>-1){o+=a.input.substring(0,t)+"_\\mathrm{"+a.input.substring(t+1)+"}"}else{a.output=addTextEscapes(a.output);a.output=a.output.replace(/ +$/,"\\,");o+="\\text{"+a.output+"}"}w=true;break}case tt.TO:{b[b.length-1].delimType=dDISTRIB;k(1,w);u=o.length;o+=a.output;if(r){i+=R;T(3);const e=b[b.length-1].symbol;const t=e==="("?"normal":e==="["?"uniform":"lognormal";y.push({prec:3,symbol:t})}break}case tt.RANGE:{k(1,w);u=o.length;if(r){i+=R;T(3);y.push({prec:3,symbol:".."});if(e.charAt(0)==="]"||e.length===0){i+='""'}}o+=a.output;break}case tt.DIV:if(r){i+=R}k(2,true);T(7);if(a.input==="//"){g.push({prec:2,pos:v.pos,ttype:tt.DIV,closeDelim:"}"});o=o.substring(0,v.pos)+"\\tfrac{"+o.substring(v.pos)+"}{"}else if(a.input==="/"||a.input==="\\over"){g.push({prec:2,pos:v.pos,ttype:tt.DIV,closeDelim:"}"});o=o.substring(0,v.pos)+"\\dfrac{"+o.substring(v.pos)+"}{"}else{g.push({prec:2,pos:v.pos,ttype:tt.DIV,closeDelim:"}}"});o=o.substring(0,v.pos)+"{{"+o.substring(v.pos)+"}\\atop{";if(b[b.length-1].name==="("){b[b.length-1].delimType=dBINOMIAL}}if(r){if(a.input==="\\atop"){if(b[b.length-1].delimType===dBINOMIAL){y.push({prec:7,symbol:"()"})}}else{y.push({prec:7,symbol:a.input})}}b[b.length-1].isTall=true;u=o.length;w=false;break;case tt.SUB:{k(15,true);const e=s.ttype===tt.FUNCTION?"}{":"}";g.push({prec:15,pos:v.pos,ttype:tt.SUB,closeDelim:e});o+="_{";if(r){i+="_"}w=false;break}case tt.SUP:if(r){if(/e$/.test(i)){i=i.slice(0,-2)+"27182818284590452353602874713527/10000000000000000000000000000000"}i+=R;T(13)}k(13,true);if(s.ttype===tt.RIGHTBRACKET){g.push({prec:13,pos:v.pos,ttype:tt.SUP,closeDelim:"}"})}else{g.push({prec:13,pos:u,ttype:tt.SUP,closeDelim:"}"})}if(r){y.push({prec:13,symbol:"^"})}o+="^{";w=false;break;case tt.SUPCHAR:{if(r){if(/e$/.test(i)){i=i.slice(0,-2)+"27182818284590452353602874713527/10000000000000000000000000000000"}i+=R;T(13)}k(13,true);const e=numFromSupChars(a.output);if(s.ttype===tt.RIGHTBRACKET){g.push({prec:13,pos:v.pos,ttype:tt.SUP,closeDelim:"}"})}else{g.push({prec:13,pos:u,ttype:tt.SUP,closeDelim:"}"})}o+="^{"+e;if(r){y.push({prec:13,symbol:"^"});i+=rationalRPN(e)}w=true;break}case tt.FUNCTION:{k(2,w);u=o.length;if(functionExpoRegEx.test(e)){const[n,o,i]=exponentOfFunction(e,t,r);if(r&&i===`1/1${R}~`&&isIn(a.input,trigFunctions)){a.input="a"+a.input;a.output="\\a"+a.output.slice(1)}else{if(r){a.input+=R+i+R+"^"}a.output+="^"+o}const s=n.length+(e.charAt(0)==="^"?1:0);e=e.slice(s).trim()}if(r){y.push({prec:12,symbol:a.input});if(s.input===""){o+=""}}S=e.charAt(0);g.push({prec:12,pos:o.length,ttype:tt.FUNCTION,closeDelim:S==="("?"":"}"});o+=a.output;o+=S==="("?"":"{";C=a.input;w=false;break}case tt.ACCENT:if(r){i+=R;T(16)}k(1,w);if(r){g.push({prec:16,pos:o.length,ttype:tt.ACCENT,closeDelim:""});o+=""+a.input;i+=""+a.input}else{g.push({prec:16,pos:o.length,ttype:tt.ACCENT,closeDelim:"}"});o+=a.output+"{"}b[b.length-1].isTall=true;w=false;break;case tt.PRIME:k(15,true);if(r){i+=a.input}o=o.trim()+a.output+" ";w=true;break;case tt.BINARY:{k(1,w);u=o.length;const e=a.input==="root"?"]{":"}{";g.push({prec:12,pos:o.length,ttype:tt.BINARY,closeDelim:e});if(r){y.push({prec:12,symbol:a.output})}o+=a.output+(a.input==="root"?"[":"{");b[b.length-1].isTall=true;w=false;break}case tt.CURRENCY:{k(1,w);u=o.length;g.push({prec:12,pos:o.length,ttype:tt.CURRENCY,closeDelim:""});if(r){y.push({prec:12,symbol:"applyUnit"+R+a.input});if(s.input===""){o+=""}}o+=a.output;w=false;break}case tt.UNARY:k(1,w);u=o.length;g.push({prec:12,pos:o.length,ttype:tt.UNARY,closeDelim:"}"});if(r){y.push({prec:12,symbol:a.input});if(s.input===""){o+=""}}o+=a.output;if(/det|inf/.test(a.input)&&e.charAt(0)==="_"){g.push({prec:15,pos:o.length,ttype:tt.SUB,closeDelim:"}"});a={input:"_",output:"_",ttype:tt.SUB};o+="_{";e=e.substring(1);e=e.replace(/^\s+/,"")}else if(a.input==="\\color"){const t=colorSpecRegEx.exec(e);if(t){o+="{"+t[0].replace(/[()]/g,"")+"}";g.pop();e=e.slice(t[0].length).trim()}else{o+="{"}}else{o+="{"}b[b.length-1].isTall=true;w=false;break;case tt.FACTORIAL:k(14,true);g.push({prec:14,pos:v.pos,ttype:tt.FACTORIAL,closeDelim:""});if(r){T(14);i+=R+a.output}o+=a.output;w=true;break;case tt.RETURN:k(1,w);u=o.length;if(r){T(4);y.push({prec:4,symbol:"return"})}o+=a.output+" ";break;case tt.KEYWORD:k(1,true);u=o.length;if(r){T(2);if(a.input==="in"){i+=R;y.push({prec:M,symbol:"for"})}}o+=a.output+" ";break;case tt.LOGIC:{k(1,w);if(r){i+=R}T(4);const e=b[b.length-1];if(a.input==="if"||a.input==="otherwise"){if(e.delimType===dPAREN&&e.name==="{"){e.delimType=dCASES;e.close="\\end{cases}";e.open="\\begin{cases}";if(r&&R===""&&a.input==="if"){i=i.slice(0,e.rpnPos)+i.slice(e.rpnPos).replace(/\xa0/g,"")}}}if(e.delimType===dCASES&&isIn(a.input,["if","otherwise"])){o+="&"}if(a.input===":"&&e.delimType===dPAREN&&e.symbol==="{"){a.output="\\colon"}o+=a.output;if(r){if(e.delimType===dCASES&&(a.input==="if"||a.input==="otherwise")){i=setUpIf(i,a.input,x,e);R=""}else{y.push({prec:4,symbol:a.input})}}u=o.length;w=true;break}case tt.LEFTBRACKET:{k(2,w);const t=s.ttype===tt.DIV;let n=false;const l={prec:0,pos:o.length,ttype:tt.LEFTBRACKET,closeDelim:a.closeDelim};if((a.input==="("||a.input==="[")&&s.ttype<5){l.closeDelim=""}else if(a.input==="("&&v.ttype===tt.BINARY){l.closeDelim=""}else{l.closeDelim=a.closeDelim;n=(a.input==="("||a.input==="[")&&s.ttype===tt.FUNCTION;o+=a.output}g.push(l);if(r){while(y.length>0&&y[y.length-1].symbol==="."){i+=R+y.pop().symbol}y.push({prec:0,symbol:a.output.trim()})}const c=/^\s*[)}\]]/.test(e)?0:1;const p={name:a.input,isTall:false,open:a.output,close:l.closeDelim,numArgs:c,numRows:c,rpnPos:i.length,isPrecededByDiv:t,isFuncParen:n,isControlWordParen:s.ttype<5};if(n){p.delimType=dFUNCTION;p.name=C}else if(s.ttype===tt.SUB){p.delimType=dSUBSCRIPT;p.name="("}else if(a.input==="{"){p.delimType=dPAREN;p.rpnLength=i.length}else if(a.input==="["&&(isIn(s.ttype,[tt.VAR,tt.LONGVAR,tt.STRING,tt.PROPERTY])||s.input==="]")){i+=R;p.delimType=dACCESSOR}else{p.delimType=dPAREN;p.name=a.input}b.push(p);C="";u=o.length;w=false;break}case tt.SEP:{k(1,w);u=o.length;if(a.input==="\\,"||a.input==="\\;"){o+=a.output+" "}else{const t=b[b.length-1];if(t.delimType===dPAREN&&d){t.delimType=dMATRIX;const e=t.name==="["?"b":t.name==="("?"p":t.name==="{:"?"":"B";t.open=`\\begin{${e}matrix}`;t.close=`\\end{${e}matrix}`;t.isTall=true;a.output=a.input===","?"&":"\\\\"}else if(t.delimType===dMATRIX&&a.input===","){a.output="&"}else if(t.delimType>3&&a.input===";"){a.output="\\\\"}if(r){if(s.ttype===tt.LEFTBRACKET&&t.delimType===dACCESSOR){i+="0/1"}i+=R;T(1)}o+=a.output+" ";if(r){if(b.length===1){i+=a.output}else{if(a.input===";"){t.numRows+=1;if(b.length>0&&t.delimType===dCASES){R=""}}if(t.numRows===1){if(a.input===","||a.input===" "&&t.delimType===dMATRIX){if(e.charAt(0)==="]"){i+="0/1"}else if(a.input===","&&t.delimType===dFUNCTION&&t.numArgs===2&&t.name==="plot"){i=i.slice(0,t.rpnPos+5)+'"'+i.slice(t.rpnPos+5,-1).replace(/\u00a0/g,"")+'"'+R}}}t.numArgs+=1}}}w=true;break}case tt.RIGHTBRACKET:{k(0,true,a.output);const t=b.pop();if(t.delimType===dPAREN&&!t.isControlWordParen&&t.close!==a.output){o=o.slice(0,-1*t.close.length)+a.output}if(t.isTall&&b.length>1){b[b.length-1].isTall=true}if(r){while(y.length>0&&y[y.length-1].prec>0){i+=R+y.pop().symbol}if(t.delimType===dCASES&&s.input!=="otherwise"){i=setUpIf(i,"otherwise",x,t);R=""}const r=y.pop();const n=t.numArgs;const o=t.numRows;const l=t.numArgs/t.numRows;const c=n===0?"":R;switch(t.delimType){case dFUNCTION:{let e=y.pop().symbol;const t=new RegExp(R+"!$");if(n===2){if(e==="log"){e="logn"}if(e==="round"){e="roundn"}if(e==="atan"){e="atan2"}if(e==="plot"){i=i.slice(0,6)+'"'+i.slice(6).replace(/\u00a0/g,"")+'"'}}else if(e==="log"&&t.test(i)){i=i.slice(0,i.length-1)+"logFactorial";break}i+=e.slice(-1)==="^"?c+e:isIn(e,builtInFunctions)?c+e:isIn(e,builtInReducerFunctions)?c+e+R+n:c+"function"+R+e+R+n;break}case dACCESSOR:i+=c+"[]"+R+n;break;case dMATRIX:i+=c+"matrix"+R+o+R+l;break;case dCASES:R="";i+=R+"cases"+R+o+R;while(x.length>0){i+=x.shift()}i=i.slice(0,-1);break;case dVECTORFROMRANGE:i+=R+"matrix"+R+"1"+R+"1";break;case dDISTRIB:break;default:if(n===0&&t.open==="["){i+="matrix"+R+0+R+0}else if(n===1&&t.open==="["){i+=R+"matrix"+R+1+R+1}if(r.symbol==="\\lfloor"){i+=R+""}if(r.symbol==="\\lceil"){i+=R+""}}if(a.input===")"&&nextCharIsFactor(e,tt.RIGHTBRACKET)||a.input==="]"&&/^\(/.test(e)){i+=R;T(rpnPrecFromType[tt.MULT]);y.push({prec:rpnPrecFromType[tt.MULT],symbol:""});f=false}}u=o.length;w=v.ttype!==tt.BINARY;break}case tt.LEFTRIGHT:{k(1,w);const e=b[b.length-1];let t=false;if(g.length>0){t=g[g.length-1].ttype===tt.LEFTRIGHT||g[g.length-1].closeDelim===""||g[g.length-1].closeDelim==="\\right."||g[g.length-1].closeDelim==="\\end{vmatrix}"}if(t){e.close=a.input==="|"?"\\vert ":"\\Vert ";g[g.length-1].closeDelim=e.close;k(0,w);b.pop();if(r){while(y.length>0&&y[y.length-1].prec>0){i+=R+y.pop().symbol}i+=R+y.pop().symbol}w=v.ttype!==tt.BINARY}else if(e.delimType===dPAREN&&e.name==="{"){o+="\\mid ";u=o.length;w=true}else{g.push({prec:0,pos:o.length,ttype:tt.LEFTRIGHT,closeDelim:a.input==="|"?"\\vert ":"\\Vert "});b.push({delimType:dPAREN,name:a.input,isTall:false,open:a.input==="|"?"\\vert ":"\\Vert ",close:a.input==="|"?"\\vert ":"\\Vert ",numArgs:1,numRows:1,rpnPos:i.length,isPrecededByDiv:s.ttype===tt.DIV});if(r){y.push({prec:0,symbol:a.output})}o+=a.input==="|"?"\\vert ":"\\Vert ";u=o.length;w=false}break}case tt.COMMENT:k(0,true);o+=a.output+" ";break;default:if(r){i+=R;T(12)}k(1,w);g.push({prec:1,pos:o.length,ttype:tt.ORD,closeDelim:""});if(r){y.push({prec:12,symbol:a.output})}o+=a.output+" ";u=o.length;w=true}s=cloneToken$1(a);p=f||a.input===""}k(0,true);if(r){while(y.length>0){i+=R+y.pop().symbol}const e=/[^ ().]+/g;let t;while((t=e.exec(o))!==null){if("".indexOf(t[0][1])===-1){const e=t.index+t[0].length;if(o.length>e&&o.charAt(e)==="("){o=o.slice(0,t.index)+o.slice(t.index+1)}else{o=o.substring(0,e)+""+o.substring(e)}}}}o=o.replace(/ {2,}/g," ");o=o.replace(/\s+(?=[_^'!)}\]])/g,"");o=o.replace(/\s+$/,"");if(c){const e=o.indexOf("=");o="\\begin{aligned}"+o.slice(0,e)+"&"+o.slice(e)+"\\end{aligned}"}return r?[o,i]:o};class MarkdownSerializer{constructor(e,t){this.nodes=e;this.marks=t}serialize(e,t,r){let n=new MarkdownSerializerState(this.nodes,this.marks,t,r);n.renderContent(e);for(const[e,t]of n.paths.entries()){n.write("\n["+e+"]: "+t+"\n")}return n.out}}const hurmetNodes={blockquote(e,t){e.wrapBlock("> ",null,t,(()=>e.renderContent(t)))},indented_div(e,t){if(e.isGFM){e.renderContent(t)}else{e.wrapBlock("   ","i> ",t,(()=>e.renderContent(t)))}},centered_div(e,t){if(e.isGFM){e.renderContent(t)}else{e.wrapBlock("   ","C> ",t,(()=>e.renderContent(t)))}},header(e,t){if(e.isGFM){e.renderContent(t)}else{e.wrapBlock("   ","H> ",t,(()=>e.renderContent(t)))}},code_block(e,t){e.write("```"+(t.attrs.params||"")+"\n");e.text(t.textContent,false);e.ensureNewLine();e.write("```");e.closeBlock(t)},heading(e,t){e.write(e.repeat("#",t.attrs.level)+" ");e.renderInline(t);e.closeBlock(t)},toc(e,t){e.write(`{.toc start=${t.attrs.start} end=${t.attrs.end}}\n\n`)},horizontal_rule(e,t){e.write(t.attrs.markup||"------");e.closeBlock(t)},bullet_list(e,t){e.renderList(t,"  ",(()=>(t.attrs.bullet||"+")+" "))},ordered_list(e,t){let r=t.attrs.order||1;let n=String(r+t.childCount-1).length;let o=e.repeat(" ",n+2);e.renderList(t,o,(t=>{let o=String(r+t);return e.repeat(" ",n-o.length)+o+". "}))},list_item(e,t){e.renderContent(t)},paragraph(e,t){const r=e.out.length;e.renderInline(t);if(!e.isGFM){e.out=limitLineLength(e.out,r,e.delim,e.lineLimit)}e.closeBlock(t)},table(e,t){e.renderTable(t,e.delim,e.isGFM);e.closeBlock(t)},image(e,t){let r=e.esc(t.attrs.src);if(!e.isGFM&&(t.attrs.class||t.attrs.width||t.attrs.alt)){r+="\n{";if(t.attrs.class){r+="."+e.esc(t.attrs.class)}if(t.attrs.width&&!isNaN(t.attrs.width)){r+=" width="+t.attrs.width}if(t.attrs.alt){r+=' alt="'+e.esc(t.attrs.alt)+'"'}r+="}"}const n=getRef(t,e);e.paths.set(n,r);const o=t.attrs.caption||"";if(n===t.attrs.alt){e.write(`![${t.attrs.alt}][]`)}else{e.write(`![${t.attrs.alt}][${n}]`)}},hard_break(e,t,r,n){for(let o=n+1;o<r.childCount;o++)if(r.child(o).type!=t.type){e.write("\\\n");return}},text(e,t){e.text(t.text)},tex(e,t){const r=t.attrs.tex.trim();writeTex(e,t.displayMode,r)},comment(e,t){e.write(`${t.attrs.comment.trim()}`)},calculation(e,t){const r=t.attrs.entry.trim().replace(/\n(?: *\n)+/g,"\n").replace(/\n/gm,"\n"+e.delim);if(e.isGFM){const n=parse(r);writeTex(e,t.displayMode,n)}else{if(t.attrs.displayMode){e.write("\n"+r+"\n")}else{e.write(" "+r+" ")}}}};const hurmetMarks={em:{open:"_",close:"_",mixable:true,expelEnclosingWhitespace:true},strong:{open:"**",close:"**",mixable:true,expelEnclosingWhitespace:true},link:{open(e,t,r,n){return isPlainURL(t,r,n,1)?"<":"["},close(e,t,r,n){if(isPlainURL(t,r,n,-1)){return">"}else{const o=getRef(t,e);e.paths.set(o,e.esc(t.attrs.href));let i=r.child(n-1).text;return"]["+(i===o?"":o)+"]"}}},code:{open(e,t,r,n){return backticksFor(r.child(n),-1)},close(e,t,r,n){return backticksFor(r.child(n-1),1)},escape:false},superscript:{open:"<sup>",close:"</sup>",expelEnclosingWhitespace:true},subscript:{open(e){return e.isGFM?"<sub>":"~"},close(e){return e.isGFM?"</sub>":"~"},expelEnclosingWhitespace:true},strikethru:{open:"~~",close:"~~",mixable:true,expelEnclosingWhitespace:true},underline:{open:"<u>",close:"</u>",expelEnclosingWhitespace:true},highlight:{open:"<mark>",close:"</mark>",expelEnclosingWhitespace:true}};const hurmetMarkdownSerializer=new MarkdownSerializer(hurmetNodes,hurmetMarks,new Map);function backticksFor(e,t){let r=/`+/g,n,o=0;if(e.isText)while(n=r.exec(e.text))o=Math.max(o,n[0].length);let i=o>0&&t>0?" `":"`";for(let e=0;e<o;e++)i+="`";if(o>0&&t<0)i+=" ";return i}function isPlainURL(e,t,r,n){if(e.attrs.title||!/^\w+:/.test(e.attrs.href))return false;let o=t.child(r+(n<0?-1:0));if(!o.isText||o.text!=e.attrs.href||o.marks[o.marks.length-1]!=e)return false;if(r==(n<0?1:t.childCount-1))return true;let i=t.child(r+(n<0?-2:1));return!e.isInSet(i.marks)}const getRef=(e,t)=>{const r=e.type.name==="image"?e.attrs.alt:e.attrs.title;const n=isNaN(t.paths.size)?"1":String(t.paths.size+1);if(r){for(const e of t.paths.keys()){if(e===r){return n}}return r}else{return n}};const blockRegEx=/^(?:[>*+-] |#+ |\d+[.)] |[A-B]\. |\-\-\-|```|[iCFHhITWADE]> )/;function limitLineLength(e,t,r,n){let o=e.slice(t);if(o.length<=n){return e}if(/``| *(?:function|draw\()/.test(o)){return e}const i="\n"+r;let a="";let s=0;while(o.length>n){const e=o.indexOf("\n");const t=n-(s>0?i.length:0);if(e>-1){let r=o.slice(0,e+1);while(r.length>t&&r.lastIndexOf(" ",t)>-1){const e=r.lastIndexOf(" ",t);a+=r.slice(0,e)+"\n";r=r.slice(e+1)}a+=r;o=o.slice(e+1)}else{let e=o.lastIndexOf(" ",t);if(e===-1){break}while(blockRegEx.test(o.slice(e+1))){e=o.lastIndexOf(" ",e-1);if(e===-1){break}}if(e===-1||o.length-e<7&&n===80){break}a+=(s>0?i:"")+o.slice(0,e);o=o.slice(e+1);s+=1}}a+=(s>0?i:"")+o;return e.slice(0,t)+a}const writeTex=(e,t,r)=>{r=r.replace(/\n/gm,"\n"+e.delim).replace(/\\\\/gm,"\\\\\\\\").replace(/\$/gm,"\\$");if(t){e.write("$$\n"+r+"\n$$")}else{e.write("$ "+r+" $")}};const justifyRegEx=/c(\d)([cr])/g;class MarkdownSerializerState{constructor(e,t,r,n){this.nodes=e;this.marks=t;this.paths=r;this.isGFM=n;this.delim=this.out="";this.closed=false;this.lineLimit=80}flushClose(e){if(this.closed){if(!this.atBlank())this.out+="\n";if(e==null)e=2;if(e>1){let t=this.delim;let r=/\s+$/.exec(t);if(r)t=t.slice(0,t.length-r[0].length);for(let r=1;r<e;r++)this.out+=t+"\n"}this.closed=false}}wrapBlock(e,t,r,n){let o=this.delim;this.write(t||e);this.delim+=e;n();this.delim=o;this.closeBlock(r)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){if(!this.atBlank())this.out+="\n"}write(e){this.flushClose();if(this.delim&&this.atBlank())this.out+=this.delim;if(e)this.out+=e}closeBlock(e){this.closed=e}text(e,t){let r=e.split("\n");for(let e=0;e<r.length;e++){var n=this.atBlank()||this.closed;this.write();this.out+=t!==false?this.esc(r[e],n):r[e];if(e!=r.length-1)this.out+="\n"}}render(e,t,r){if(typeof t=="number")throw new Error("!");this.nodes[e.type.name](this,e,t,r)}renderContent(e){e.forEach(((t,r,n)=>this.render(t,e,n)))}renderInline(e){let t=[],r="";let n=(n,o,i)=>{let a=n?n.marks:[];if(n&&n.type.name==="hard_break")a=a.filter((t=>{if(i+1==e.childCount)return false;let r=e.child(i+1);return t.isInSet(r.marks)&&(!r.isText||/\S/.test(r.text))}));let s=r;r="";if(n&&n.isText&&a.some((e=>{let t=this.marks[e.type.name];return t&&t.expelEnclosingWhitespace}))){let[e,o,i,l]=/^(\s*)(.*?)(\s*)$/m.exec(n.text);s+=o;r=l;if(o||l){n=i?n.withText(i):null;if(!n)a=t}}let l=a.length&&a[a.length-1],c=l&&this.marks[l.type.name].escape===false;let u=a.length-(c?1:0);e:for(let e=0;e<u;e++){let r=a[e];if(!this.marks[r.type.name].mixable)break;for(let n=0;n<t.length;n++){let o=t[n];if(!this.marks[o.type.name].mixable)break;if(r.eq(o)){if(e>n)a=a.slice(0,n).concat(r).concat(a.slice(n,e)).concat(a.slice(e+1,u));else if(n>e)a=a.slice(0,e).concat(a.slice(e+1,n)).concat(r).concat(a.slice(n,u));continue e}}}let p=0;while(p<Math.min(t.length,u)&&a[p].eq(t[p]))++p;while(p<t.length)this.text(this.markString(t.pop(),false,e,i),false);if(s)this.text(s);if(n){while(t.length<u){let r=a[t.length];t.push(r);this.text(this.markString(r,true,e,i),false)}if(c&&n.isText)this.text(this.markString(l,true,e,i)+n.text+this.markString(l,false,e,i+1),false);else this.render(n,e,i)}};e.forEach(n);n(null,null,e.childCount)}renderList(e,t,r){if(this.closed&&this.closed.type==e.type)this.flushClose(3);let n=typeof e.attrs.tight!="undefined"?e.attrs.tight:false;e.forEach(((o,i,a)=>{if(a&&n)this.flushClose(1);this.wrapBlock(t,r(a),e,(()=>this.render(o,e,a)))}))}paddedCell(e,t,r){const n=" ".repeat(r-e.length);return t==="r"?n+e:e+n}renderTable(e,t,r){const n=e.content.content;let o=n[0].content.content.length;for(let e=1;e<n.length;e++){o=Math.max(o,n[e].content.content.length)}let i=0;for(let e=0;e<n.length;e++){if(n[e].content.content[0].type.name==="table_header"){i+=1}else{break}}const a=e.attrs.class;const s=new Array(o).fill("L");let l;while((l=justifyRegEx.exec(a))!==null){s[Number(l[1])-1]=l[2]}const c=new Array(n.length);const u=new Array(n.length);const p=new Array(n.length);for(let e=0;e<n.length;e++){c[e]=new Array(o).fill("");u[e]=new Array(o).fill(1);p[e]=new Array(o).fill(1)}const f=new Array(o).fill(0);const d=[];let h=!r&&i!==1;let m=new MarkdownSerializerState(hurmetNodes,hurmetMarks,this.paths,this.isGFM);m.lineLimit=25;let v=0;let g=0;let y=0;while(v<n.length){while(g<o){if(u[v][g]===0||p[v][g]===0){g+=1;continue}const e=n[v].content.content[y];if(!e){p[v][g]=0;g+=1;continue}if(e.attrs.rowspan>1){u[v][g]=e.attrs.rowspan;for(let t=v+1;t<v+e.attrs.rowspan;t++){u[t][g]=0;p[t][g]=0}}if(e.attrs.colspan>1){p[v][g]=e.attrs.colspan;for(let t=g+1;t<g+e.attrs.colspan;t++){p[v][t]=0}}if(e.content.content.length>0){if(e.attrs.colspan>1){d.push([v,g,y])}else{const t=m.out.length;m.renderContent(e);const n=m.out.slice(t).replace(/^\n+/,"").split("\n");c[v][g]=n;if(n.length>1&&!r){h=true}if(p[v][g]===1){for(let e of c[v][g]){if(e.length>f[g]){f[g]=e.length}}}}}g+=e.attrs.colspan;y+=1}v+=1;g=0;y=0}for(const e of d){const t=e[0];const r=e[1];const o=e[2];const i=n[t].content.content[o];let a=f[r];for(let e=1;e<p[t][r];e++){a+=f[r+e]+3}m.lineLimit=a;const s=m.out.length;m.renderContent(i);c[t][r]=m.out.slice(s).replace(/^\n+/,"").split("\n")}for(let e=0;e<c.length;e++){for(let t=0;t<o;t++){if(u[e][t]>0&&p[e][t]>0){let n=f[t];for(let r=1;r<p[e][t];r++){n+=f[t+r]+3}for(let o=0;o<c[e][t].length;o++){if(c[e][t][o].indexOf("|")>-1&&!r){h=true}c[e][t][o]+=" ".repeat(n-c[e][t][o].length)}}}}this.write(h?gridTable(c,o,i,u,p,f,s,t):pipeTable(c,o,f,s,t));let b="";for(let e=0;e<n.length;e++){if(n[e].content.content.length===o){for(const t of n[e].content.content){const e=t.attrs.colwidth?t.attrs.colwidth[0]:null;b+=" "+String(e)}break}}const w=e.attrs.class.replace(/ c\d+[cr]/g,"");if(!r){this.write(`\n${t}{.${w} colWidths="${b.trim()}"}\n`)}}esc(e,t){e=e.replace(/[`\\~\$\[\]]/g,"\\$&");e=e.replace(/(\*\*|\$\$||~~)/g,"\\$1");if(t){e=e.replace(/^(\#+|:|\-|\*|\+) /,"\\$1").replace(/^(\d+)\./,"$1\\.")}return e}quote(e){var t=e.indexOf('"')==-1?'""':e.indexOf("'")==-1?"''":"()";return t[0]+e+t[1]}repeat(e,t){let r="";for(let n=0;n<t;n++)r+=e;return r}markString(e,t,r,n){let o=this.marks[e.type.name];let i=t?o.open:o.close;return typeof i=="string"?i:i(this,e,r,n)}getEnclosingWhitespace(e){return{leading:(e.match(/^(\s+)/)||[])[0],trailing:(e.match(/(\s+)$/)||[])[0]}}}const pipeTable=(e,t,r,n,o)=>{let i="";for(let a=0;a<e.length;a++){i+="\n"+(a===0?"":o)+"|";for(let r=0;r<t;r++){i+=" "+e[a][r][0]+" |"}if(a===0){i+="\n|";for(let e=0;e<t;e++){let t=n[e]==="c"?":":"-";t+="-".repeat(r[e]);t+=("cr".indexOf(n[e])>-1?":":"-")+"|";i+=t}}}return i};const gridTable=(e,t,r,n,o,i,a,s)=>{let l="+";for(let e=0;e<t;e++){l+=a[e]==="c"?":":"-";l+="-".repeat(i[e]);l+=("cr".indexOf(a[e])>-1?":":"-")+"+"}const c=[];for(let e=0;e<t;e++){c.push({row:0,line:0})}const u=new Array(e.length).fill(false);let p=0;const f=new Array(e.length).fill(false);const d=[l];while(c[0].row<e.length){u[p]=true;let a=s+"|";for(let l=0;l<t;l++){if(n[c[l].row][l]===0){continue}if(o[c[l].row][l]===0){continue}const t=c[l].row+n[c[l].row][l]-1;if(e[c[l].row][l].length>c[l].line){a+=" "+e[c[l].row][l][c[l].line]+" |";c[l].line+=1;if(c[l].line<e[c[l].row][l].length){u[t]=false}else if(o[c[l].row][l]>1){let e=0;for(let r=0;r<l+o[c[l].row][l]-1;r++){e+=i[r]+3;if(r>=l&&a.charAt(e)==="|"){u[t]=false;break}}}}else if(f[t]){if(l===0){a=s+"+"}else if(a.charAt(s.length)==="|"){a=s+"+"+a.slice(s.length+1)}const e=r===t+1;let n="+";for(let t=0;t<o[c[l].row][l];t++){n+=(e?"=":"-").repeat(i[l+t]+2)+"+"}a=a.slice(0,-1)+n}else{for(let e=0;e<o[c[l].row][l];e++){const t=e===o[c[l].row][l]-1?"|":" ";a+=" ".repeat(i[l+e]+2)+t}}}if(f[p]){for(let e=0;e<t;e++){if(c[e].row+n[c[e].row][e]-1===p){c[e].line=0;c[e].row+=n[c[e].row][e]}}p+=1}else if(u[p]){f[p]=true}d.push(a)}return d.join("\n")};const handleContents=(e,t,r,n)=>{if(/^/.test(r)){r=r.substring(3)}let o;if(n==="hurmet"){o=JSON.parse(r)}else if(n==="markdown"){const e=hurmet.md2ast(r);o={type:"doc",attrs:{decimalFormat:"1,000,000.",inDraftMode:false,fontSize:12,fileHandle:null,pageSize:"letter"},content:e};o=JSON.parse(JSON.stringify(o))}const i=o.attrs.fontSize?o.attrs.fontSize:12;document.getElementById("editor").className=i===12?"pica":"long-primer";document.getElementById("print-div").className=i===12?"ProseMirror pica":"ProseMirror long-primer";const a=o.attrs.pageSize?o.attrs.pageSize:"letter";const s=document.getElementById("pageStyle");s.innerHTML=a==="letter"?`@media print {@page{size: letter; margin: 16mm 0.75in 16mm 0.75in;}}`:`@media print {@page{size: A4; margin: 16mm 16.1mm 16mm 16.1mm;}}`;e.dispatch(e.state.tr.replaceWith(0,e.state.doc.content.size,t.nodeFromJSON(o)));e.state.doc.attrs.fontSize=i;e.state.doc.attrs.pageSize=a;hurmet.updateCalculations(e,t.nodes.calculation,true)};async function getFile(e,t,r){const n={types:[{description:"Text",accept:{"text/*":[".hurmet"]}}],excludeAcceptAllOption:true,multiple:false};const[o]=await window.showOpenFilePicker(n);const i=await o.getFile();const a=await i.text();e.state.doc.attrs.fileHandle=o;handleContents(e,t,a,r)}function readFile(e,t,r,n,o){if(window.showOpenFilePicker&&!(o==="markdown")){getFile(r,n,o)}else{const e=document.createElement("input");e.type="file";e.accept=o==="hurmet"?".hurmet":".md";e.onchange=t=>{const i=e.files[0];const a=new FileReader;a.onload=function(e){const t=e.target.result;handleContents(r,n,t,o)};a.readAsText(i)};e.click()}}var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}var FileSaver=createCommonjsModule((function(e){
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var t=t||function(e){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var t=e.document,r=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,i=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),s=e.webkitRequestFileSystem,l=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},u="application/octet-stream",p=0,f=1e3*40,d=function(e){var t=function(){if(typeof e==="string"){r().revokeObjectURL(e)}else{e.remove()}};setTimeout(t,f)},h=function(e,t,r){t=[].concat(t);var n=t.length;while(n--){var o=e["on"+t[n]];if(typeof o==="function"){try{o.call(e,r||e)}catch(e){c(e)}}}},m=function(e){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)){return new Blob(["",e],{type:e.type})}return e},v=function(t,c,f){if(!f){t=m(t)}var v=this,g=t.type,y=false,b,w,S=function(){h(v,"writestart progress write writeend".split(" "))},C=function(){if(w&&a&&typeof FileReader!=="undefined"){var n=new FileReader;n.onloadend=function(){var e=n.result;w.location.href="data:attachment/file"+e.slice(e.search(/[,;]/));v.readyState=v.DONE;S()};n.readAsDataURL(t);v.readyState=v.INIT;return}if(y||!b){b=r().createObjectURL(t)}if(w){w.location.href=b}else{var o=e.open(b,"_blank");if(o===undefined&&a){e.location.href=b}}v.readyState=v.DONE;S();d(b)},R=function(e){return function(){if(v.readyState!==v.DONE){return e.apply(this,arguments)}}},M={create:true,exclusive:false},x;v.readyState=v.INIT;if(!c){c="download"}if(o){b=r().createObjectURL(t);setTimeout((function(){n.href=b;n.download=c;i(n);S();d(b);v.readyState=v.DONE}));return}if(e.chrome&&g&&g!==u){x=t.slice||t.webkitSlice;t=x.call(t,0,t.size,u);y=true}if(s&&c!=="download"){c+=".download"}if(g===u||s){w=e}if(!l){C();return}p+=t.size;l(e.TEMPORARY,p,R((function(e){e.root.getDirectory("saved",M,R((function(e){var r=function(){e.getFile(c,M,R((function(e){e.createWriter(R((function(r){r.onwriteend=function(t){w.location.href=e.toURL();v.readyState=v.DONE;h(v,"writeend",t);d(e)};r.onerror=function(){var e=r.error;if(e.code!==e.ABORT_ERR){C()}};"writestart progress write abort".split(" ").forEach((function(e){r["on"+e]=v["on"+e]}));r.write(t);v.abort=function(){r.abort();v.readyState=v.DONE};v.readyState=v.WRITING})),C)})),C)};e.getFile(c,{create:false},R((function(e){e.remove();r()})),R((function(e){if(e.code===e.NOT_FOUND_ERR){r()}else{C()}})))})),C)})),C)},g=v.prototype,y=function(e,t,r){return new v(e,t,r)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(e,t,r){if(!r){e=m(e)}return navigator.msSaveOrOpenBlob(e,t||"download")}}g.abort=function(){var e=this;e.readyState=e.DONE;h(e,"abort")};g.readyState=g.INIT=0;g.WRITING=1;g.DONE=2;g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null;return y}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||commonjsGlobal.content);if(e.exports){e.exports.saveAs=t}}));var FileSaver_1=FileSaver.saveAs;const diff_match_patch=function(){this.Diff_Timeout=1;this.Diff_EditCost=4;this.Match_Threshold=.5;this.Match_Distance=1e3;this.Patch_DeleteThreshold=.5;this.Patch_Margin=4;this.Match_MaxBits=32};var DIFF_DELETE=-1;var DIFF_INSERT=1;var DIFF_EQUAL=0;diff_match_patch.Diff=function(e,t){this[0]=e;this[1]=t};diff_match_patch.Diff.prototype.length=2;diff_match_patch.Diff.prototype.toString=function(){return this[0]+","+this[1]};diff_match_patch.prototype.diff_main=function(e,t,r,n){if(typeof n=="undefined"){if(this.Diff_Timeout<=0){n=Number.MAX_VALUE}else{n=(new Date).getTime()+this.Diff_Timeout*1e3}}var o=n;if(e==null||t==null){throw new Error("Null input. (diff_main)")}if(e==t){if(e){return[new diff_match_patch.Diff(DIFF_EQUAL,e)]}return[]}if(typeof r=="undefined"){r=true}var i=r;var a=this.diff_commonPrefix(e,t);var s=e.substring(0,a);e=e.substring(a);t=t.substring(a);a=this.diff_commonSuffix(e,t);var l=e.substring(e.length-a);e=e.substring(0,e.length-a);t=t.substring(0,t.length-a);var c=this.diff_compute_(e,t,i,o);if(s){c.unshift(new diff_match_patch.Diff(DIFF_EQUAL,s))}if(l){c.push(new diff_match_patch.Diff(DIFF_EQUAL,l))}this.diff_cleanupMerge(c);return c};diff_match_patch.prototype.diff_compute_=function(e,t,r,n){var o;if(!e){return[new diff_match_patch.Diff(DIFF_INSERT,t)]}if(!t){return[new diff_match_patch.Diff(DIFF_DELETE,e)]}var i=e.length>t.length?e:t;var a=e.length>t.length?t:e;var s=i.indexOf(a);if(s!=-1){o=[new diff_match_patch.Diff(DIFF_INSERT,i.substring(0,s)),new diff_match_patch.Diff(DIFF_EQUAL,a),new diff_match_patch.Diff(DIFF_INSERT,i.substring(s+a.length))];if(e.length>t.length){o[0][0]=o[2][0]=DIFF_DELETE}return o}if(a.length==1){return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]}var l=this.diff_halfMatch_(e,t);if(l){var c=l[0];var u=l[1];var p=l[2];var f=l[3];var d=l[4];var h=this.diff_main(c,p,r,n);var m=this.diff_main(u,f,r,n);return h.concat([new diff_match_patch.Diff(DIFF_EQUAL,d)],m)}if(r&&e.length>100&&t.length>100){return this.diff_lineMode_(e,t,n)}return this.diff_bisect_(e,t,n)};diff_match_patch.prototype.diff_lineMode_=function(e,t,r){var n=this.diff_linesToChars_(e,t);e=n.chars1;t=n.chars2;var o=n.lineArray;var i=this.diff_main(e,t,false,r);this.diff_charsToLines_(i,o);this.diff_cleanupSemantic(i);i.push(new diff_match_patch.Diff(DIFF_EQUAL,""));var a=0;var s=0;var l=0;var c="";var u="";while(a<i.length){switch(i[a][0]){case DIFF_INSERT:l++;u+=i[a][1];break;case DIFF_DELETE:s++;c+=i[a][1];break;case DIFF_EQUAL:if(s>=1&&l>=1){i.splice(a-s-l,s+l);a=a-s-l;var p=this.diff_main(c,u,false,r);for(var f=p.length-1;f>=0;f--){i.splice(a,0,p[f])}a=a+p.length}l=0;s=0;c="";u="";break}a++}i.pop();return i};diff_match_patch.prototype.diff_bisect_=function(e,t,r){var n=e.length;var o=t.length;var i=Math.ceil((n+o)/2);var a=i;var s=2*i;var l=new Array(s);var c=new Array(s);for(var u=0;u<s;u++){l[u]=-1;c[u]=-1}l[a+1]=0;c[a+1]=0;var p=n-o;var f=p%2!=0;var d=0;var h=0;var m=0;var v=0;for(var g=0;g<i;g++){if((new Date).getTime()>r){break}for(var y=-g+d;y<=g-h;y+=2){var b=a+y;var w;if(y==-g||y!=g&&l[b-1]<l[b+1]){w=l[b+1]}else{w=l[b-1]+1}var S=w-y;while(w<n&&S<o&&e.charAt(w)==t.charAt(S)){w++;S++}l[b]=w;if(w>n){h+=2}else if(S>o){d+=2}else if(f){var C=a+p-y;if(C>=0&&C<s&&c[C]!=-1){var R=n-c[C];if(w>=R){return this.diff_bisectSplit_(e,t,w,S,r)}}}}for(var M=-g+m;M<=g-v;M+=2){var C=a+M;var R;if(M==-g||M!=g&&c[C-1]<c[C+1]){R=c[C+1]}else{R=c[C-1]+1}var x=R-M;while(R<n&&x<o&&e.charAt(n-R-1)==t.charAt(o-x-1)){R++;x++}c[C]=R;if(R>n){v+=2}else if(x>o){m+=2}else if(!f){var b=a+p-M;if(b>=0&&b<s&&l[b]!=-1){var w=l[b];var S=a+w-b;R=n-R;if(w>=R){return this.diff_bisectSplit_(e,t,w,S,r)}}}}}return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]};diff_match_patch.prototype.diff_bisectSplit_=function(e,t,r,n,o){var i=e.substring(0,r);var a=t.substring(0,n);var s=e.substring(r);var l=t.substring(n);var c=this.diff_main(i,a,false,o);var u=this.diff_main(s,l,false,o);return c.concat(u)};diff_match_patch.prototype.diff_linesToChars_=function(e,t){var r=[];var n={};r[0]="";function o(e){var t="";var o=0;var a=-1;var s=r.length;while(a<e.length-1){a=e.indexOf("\n",o);if(a==-1){a=e.length-1}var l=e.substring(o,a+1);if(n.hasOwnProperty?n.hasOwnProperty(l):n[l]!==undefined){t+=String.fromCharCode(n[l])}else{if(s==i){l=e.substring(o);a=e.length}t+=String.fromCharCode(s);n[l]=s;r[s++]=l}o=a+1}return t}var i=4e4;var a=o(e);i=65535;var s=o(t);return{chars1:a,chars2:s,lineArray:r}};diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var r=0;r<e.length;r++){var n=e[r][1];var o=[];for(var i=0;i<n.length;i++){o[i]=t[n.charCodeAt(i)]}e[r][1]=o.join("")}};diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0)){return 0}var r=0;var n=Math.min(e.length,t.length);var o=n;var i=0;while(r<o){if(e.substring(i,o)==t.substring(i,o)){r=o;i=r}else{n=o}o=Math.floor((n-r)/2+r)}return o};diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1)){return 0}var r=0;var n=Math.min(e.length,t.length);var o=n;var i=0;while(r<o){if(e.substring(e.length-o,e.length-i)==t.substring(t.length-o,t.length-i)){r=o;i=r}else{n=o}o=Math.floor((n-r)/2+r)}return o};diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var r=e.length;var n=t.length;if(r==0||n==0){return 0}if(r>n){e=e.substring(r-n)}else if(r<n){t=t.substring(0,r)}var o=Math.min(r,n);if(e==t){return o}var i=0;var a=1;while(true){var s=e.substring(o-a);var l=t.indexOf(s);if(l==-1){return i}a+=l;if(l==0||e.substring(o-a)==t.substring(0,a)){i=a;a++}}};diff_match_patch.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0){return null}var r=e.length>t.length?e:t;var n=e.length>t.length?t:e;if(r.length<4||n.length*2<r.length){return null}var o=this;function i(e,t,r){var n=e.substring(r,r+Math.floor(e.length/4));var i=-1;var a="";var s,l,c,u;while((i=t.indexOf(n,i+1))!=-1){var p=o.diff_commonPrefix(e.substring(r),t.substring(i));var f=o.diff_commonSuffix(e.substring(0,r),t.substring(0,i));if(a.length<f+p){a=t.substring(i-f,i)+t.substring(i,i+p);s=e.substring(0,r-f);l=e.substring(r+p);c=t.substring(0,i-f);u=t.substring(i+p)}}if(a.length*2>=e.length){return[s,l,c,u,a]}else{return null}}var a=i(r,n,Math.ceil(r.length/4));var s=i(r,n,Math.ceil(r.length/2));var l;if(!a&&!s){return null}else if(!s){l=a}else if(!a){l=s}else{l=a[4].length>s[4].length?a:s}var c,u,p,f;if(e.length>t.length){c=l[0];u=l[1];p=l[2];f=l[3]}else{p=l[0];f=l[1];c=l[2];u=l[3]}var d=l[4];return[c,u,p,f,d]};diff_match_patch.prototype.diff_cleanupSemantic=function(e){var t=false;var r=[];var n=0;var o=null;var i=0;var a=0;var s=0;var l=0;var c=0;while(i<e.length){if(e[i][0]==DIFF_EQUAL){r[n++]=i;a=l;s=c;l=0;c=0;o=e[i][1]}else{if(e[i][0]==DIFF_INSERT){l+=e[i][1].length}else{c+=e[i][1].length}if(o&&o.length<=Math.max(a,s)&&o.length<=Math.max(l,c)){e.splice(r[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,o));e[r[n-1]+1][0]=DIFF_INSERT;n--;n--;i=n>0?r[n-1]:-1;a=0;s=0;l=0;c=0;o=null;t=true}}i++}if(t){this.diff_cleanupMerge(e)}this.diff_cleanupSemanticLossless(e);i=1;while(i<e.length){if(e[i-1][0]==DIFF_DELETE&&e[i][0]==DIFF_INSERT){var u=e[i-1][1];var p=e[i][1];var f=this.diff_commonOverlap_(u,p);var d=this.diff_commonOverlap_(p,u);if(f>=d){if(f>=u.length/2||f>=p.length/2){e.splice(i,0,new diff_match_patch.Diff(DIFF_EQUAL,p.substring(0,f)));e[i-1][1]=u.substring(0,u.length-f);e[i+1][1]=p.substring(f);i++}}else{if(d>=u.length/2||d>=p.length/2){e.splice(i,0,new diff_match_patch.Diff(DIFF_EQUAL,u.substring(0,d)));e[i-1][0]=DIFF_INSERT;e[i-1][1]=p.substring(0,p.length-d);e[i+1][0]=DIFF_DELETE;e[i+1][1]=u.substring(d);i++}}i++}i++}};diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t){return 6}var r=e.charAt(e.length-1);var n=t.charAt(0);var o=r.match(diff_match_patch.nonAlphaNumericRegex_);var i=n.match(diff_match_patch.nonAlphaNumericRegex_);var a=o&&r.match(diff_match_patch.whitespaceRegex_);var s=i&&n.match(diff_match_patch.whitespaceRegex_);var l=a&&r.match(diff_match_patch.linebreakRegex_);var c=s&&n.match(diff_match_patch.linebreakRegex_);var u=l&&e.match(diff_match_patch.blanklineEndRegex_);var p=c&&t.match(diff_match_patch.blanklineStartRegex_);if(u||p){return 5}else if(l||c){return 4}else if(o&&!a&&s){return 3}else if(a||s){return 2}else if(o||i){return 1}return 0}var r=1;while(r<e.length-1){if(e[r-1][0]==DIFF_EQUAL&&e[r+1][0]==DIFF_EQUAL){var n=e[r-1][1];var o=e[r][1];var i=e[r+1][1];var a=this.diff_commonSuffix(n,o);if(a){var s=o.substring(o.length-a);n=n.substring(0,n.length-a);o=s+o.substring(0,o.length-a);i=s+i}var l=n;var c=o;var u=i;var p=t(n,o)+t(o,i);while(o.charAt(0)===i.charAt(0)){n+=o.charAt(0);o=o.substring(1)+i.charAt(0);i=i.substring(1);var f=t(n,o)+t(o,i);if(f>=p){p=f;l=n;c=o;u=i}}if(e[r-1][1]!=l){if(l){e[r-1][1]=l}else{e.splice(r-1,1);r--}e[r][1]=c;if(u){e[r+1][1]=u}else{e.splice(r+1,1);r--}}}r++}};diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;diff_match_patch.whitespaceRegex_=/\s/;diff_match_patch.linebreakRegex_=/[\r\n]/;diff_match_patch.blanklineEndRegex_=/\n\r?\n$/;diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/;diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));var t=0;var r=0;var n=0;var o="";var i="";var a;while(t<e.length){switch(e[t][0]){case DIFF_INSERT:n++;i+=e[t][1];t++;break;case DIFF_DELETE:r++;o+=e[t][1];t++;break;case DIFF_EQUAL:if(r+n>1){if(r!==0&&n!==0){a=this.diff_commonPrefix(i,o);if(a!==0){if(t-r-n>0&&e[t-r-n-1][0]==DIFF_EQUAL){e[t-r-n-1][1]+=i.substring(0,a)}else{e.splice(0,0,new diff_match_patch.Diff(DIFF_EQUAL,i.substring(0,a)));t++}i=i.substring(a);o=o.substring(a)}a=this.diff_commonSuffix(i,o);if(a!==0){e[t][1]=i.substring(i.length-a)+e[t][1];i=i.substring(0,i.length-a);o=o.substring(0,o.length-a)}}t-=r+n;e.splice(t,r+n);if(o.length){e.splice(t,0,new diff_match_patch.Diff(DIFF_DELETE,o));t++}if(i.length){e.splice(t,0,new diff_match_patch.Diff(DIFF_INSERT,i));t++}t++}else if(t!==0&&e[t-1][0]==DIFF_EQUAL){e[t-1][1]+=e[t][1];e.splice(t,1)}else{t++}n=0;r=0;o="";i="";break}}if(e[e.length-1][1]===""){e.pop()}var s=false;t=1;while(t<e.length-1){if(e[t-1][0]==DIFF_EQUAL&&e[t+1][0]==DIFF_EQUAL){if(e[t][1].substring(e[t][1].length-e[t-1][1].length)==e[t-1][1]){e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length);e[t+1][1]=e[t-1][1]+e[t+1][1];e.splice(t-1,1);s=true}else if(e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]){e[t-1][1]+=e[t+1][1];e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1];e.splice(t+1,1);s=true}}t++}if(s){this.diff_cleanupMerge(e)}};diff_match_patch.prototype.diff_xIndex=function(e,t){var r=0;var n=0;var o=0;var i=0;var a;for(a=0;a<e.length;a++){if(e[a][0]!==DIFF_INSERT){r+=e[a][1].length}if(e[a][0]!==DIFF_DELETE){n+=e[a][1].length}if(r>t){break}o=r;i=n}if(e.length!=a&&e[a][0]===DIFF_DELETE){return i}return i+(t-o)};diff_match_patch.prototype.diff_prettyHtml=function(e){var t=[];var r=/&/g;var n=/</g;var o=/>/g;var i=/\n/g;if(e.length===1&&e[0][0]===DIFF_EQUAL){return"<span>There is no difference.</span><br>"}for(var a=0;a<e.length;a++){var s=e[a][0];var l=e[a][1];var c=l.replace(r,"&amp;").replace(n,"&lt;").replace(o,"&gt;").replace(i,"<br>");switch(s){case DIFF_INSERT:t[a]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case DIFF_DELETE:t[a]='<del style="background:#ffe6e6;">'+c+"</del>";break;case DIFF_EQUAL:let r=c.split("<br>");const n=r.length;if(a===0&&n>3){r=r.slice(n-3);r.unshift("")}else if(a===e.length-1&n>3){r=r.slice(0,3);r.push("")}else if(n>6){const e=r.slice(0,3);if(e[e.length-1].length>0){e.push("")}e.push("");if(r[n-3].length>0){e.push("")}r=r.slice(n-3);r=e.concat(r)}t[a]="<span>"+r.join("<br>")+"</span>";break}}return t.join("")+"<br>"};diff_match_patch.prototype.diff_text1=function(e){var t=[];for(var r=0;r<e.length;r++){if(e[r][0]!==DIFF_INSERT){t[r]=e[r][1]}}return t.join("")};diff_match_patch.prototype.diff_text2=function(e){var t=[];for(var r=0;r<e.length;r++){if(e[r][0]!==DIFF_DELETE){t[r]=e[r][1]}}return t.join("")};diff_match_patch.prototype.diff_levenshtein=function(e){var t=0;var r=0;var n=0;for(var o=0;o<e.length;o++){var i=e[o][0];var a=e[o][1];switch(i){case DIFF_INSERT:r+=a.length;break;case DIFF_DELETE:n+=a.length;break;case DIFF_EQUAL:t+=Math.max(r,n);r=0;n=0;break}}t+=Math.max(r,n);return t};diff_match_patch.prototype.diff_toDelta=function(e){var t=[];for(var r=0;r<e.length;r++){switch(e[r][0]){case DIFF_INSERT:t[r]="+"+encodeURI(e[r][1]);break;case DIFF_DELETE:t[r]="-"+e[r][1].length;break;case DIFF_EQUAL:t[r]="="+e[r][1].length;break}}return t.join("\t").replace(/%20/g," ")};diff_match_patch.prototype.diff_fromDelta=function(e,t){var r=[];var n=0;var o=0;var i=t.split(/\t/g);for(var a=0;a<i.length;a++){var s=i[a].substring(1);switch(i[a].charAt(0)){case"+":try{r[n++]=new diff_match_patch.Diff(DIFF_INSERT,decodeURI(s))}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var l=parseInt(s,10);if(isNaN(l)||l<0){throw new Error("Invalid number in diff_fromDelta: "+s)}var c=e.substring(o,o+=l);if(i[a].charAt(0)=="="){r[n++]=new diff_match_patch.Diff(DIFF_EQUAL,c)}else{r[n++]=new diff_match_patch.Diff(DIFF_DELETE,c)}break;default:if(i[a]){throw new Error("Invalid diff operation in diff_fromDelta: "+i[a])}}}if(o!=e.length){throw new Error("Delta length ("+o+") does not equal source text length ("+e.length+").")}return r};const hurmetIcons={navicon:{width:16,height:16,path:"M3 4h10v1.5h-20z M3 8h10v1.5h-20z M3 12h10v1.5h-20z"},recalc:{width:16,height:16,path:"M0 9c0 2.389 1.048 4.534 2.709 6l1.323-1.5c-1.246-1.099-2.031-2.708-2.031-4.5 0-3.314 2.686-6 6-6 1.657 0 3.157 0.672 4.243 1.757l-2.243 2.243h6v-6l-2.343 2.343c-1.448-1.448-3.448-2.343-5.657-2.343-4.418 0-8 3.582-8 8z"},subscript:{text:"X",css:"font-weight: bold"},superscript:{text:"X",css:"font-weight: bold"},strikethru:{width:1024,height:1024,path:"M1024 512v64h-234.506c27.504 38.51 42.506 82.692 42.506 128 0 70.878-36.66 139.026-100.58 186.964-59.358 44.518-137.284 69.036-219.42 69.036-82.138 0-160.062-24.518-219.42-69.036-63.92-47.938-100.58-116.086-100.58-186.964h128c0 69.382 87.926 128 192 128s192-58.618 192-128c0-69.382-87.926-128-192-128h-512v-64h299.518c-2.338-1.654-4.656-3.324-6.938-5.036-63.92-47.94-100.58-116.086-100.58-186.964s36.66-139.024 100.58-186.964c59.358-44.518 137.282-69.036 219.42-69.036 82.136 0 160.062 24.518 219.42 69.036 63.92 47.94 100.58 116.086 100.58 186.964h-128c0-69.382-87.926-128-192-128s-192 58.618-192 128c0 69.382 87.926 128 192 128 78.978 0 154.054 22.678 212.482 64h299.518z"},underline:{width:1024,height:1024,path:"M704 64h128v416c0 159.058-143.268 288-320 288-176.73 0-320-128.942-320-288v-416h128v416c0 40.166 18.238 78.704 51.354 108.506 36.896 33.204 86.846 51.494 140.646 51.494s103.75-18.29 140.646-51.494c33.116-29.802 51.354-68.34 51.354-108.506v-416zM192 832h640v128h-640z"},highlight:{text:""},paragraph:{width:24,height:24,path:"M22.5.248H7.228a6.977,6.977,0,1,0,0,13.954H9.546a.25.25,0,0,1,.25.25V22.5a1.25,1.25,0,0,0,2.5,0V3a.25.25,0,0,1,.25-.25h3.682a.25.25,0,0,1,.25.25V22.5a1.25,1.25,0,0,0,2.5,0V3a.249.249,0,0,1,.25-.25H22.5a1.25,1.25,0,0,0,0-2.5ZM9.8,11.452a.25.25,0,0,1-.25.25H7.228a4.477,4.477,0,1,1,0-8.954H9.546A.25.25,0,0,1,9.8,3Z"},upload:{width:16,height:16,path:"M7 9h2v-4h3l-4-4-4 4h3zM10 6.75v1.542l4.579 1.708-6.579 2.453-6.579-2.453 4.579-1.708v-1.542l-6 2.25v4l8 3 8-3v-4z"},image:{width:16,height:16,path:"M14.998 2c0.001 0.001 0.001 0.001 0.002 0.002v11.996c-0.001 0.001-0.001 0.001-0.002 0.002h-13.996c-0.001-0.001-0.001-0.001-0.002-0.002v-11.996c0.001-0.001 0.001-0.001 0.002-0.002h13.996zM15 1h-14c-0.55 0-1 0.45-1 1v12c0 0.55 0.45 1 1 1h14c0.55 0 1-0.45 1-1v-12c0-0.55-0.45-1-1-1v0z M13 4.5c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5 0.672-1.5 1.5-1.5 1.5 0.672 1.5 1.5z M14 13h-12v-2l3.5-6 4 5h1l3.5-3z"},indent:{width:16,height:16,path:"M0 1h16v2h-16zM6 4h10v2h-10zM6 7h10v2h-10zM6 10h10v2h-10zM0 13h16v2h-16zM0 11v-6l4 3z"},T:{width:16,height:16,path:"M.8 4.5V.3c.1-.5.6-.2 1-.3h12.8c.4.2.2.7.3 1v3.5c-.4.7-1.1-.1-1-.7a4 4 0 0 0-2.7-2.7C10.8 1 9.8.6 9.7 1v12.8c0 .8.3 1.5 1.2 1.3.6-.2 1.6.5.8.9H3.9c-.8-.6.4-1 1-.9 1 .2 1-.8 1-1.6V.8c-1.2.2-2.6.5-3.4 1.5-.7.7-.8 1.6-1 2.4-.2.2-.6.1-.7-.2ZM2.6 1c.4-.2.3-.2 0-.2h-1V2ZM9 7.8v-7H6.8l-.1 13.5c.1.4-.4 1 .2.9H9c-.3-.5.1-1.2 0-1.7Zm4.8-6.1c.1 0 .4.5.3 0V.9h-1.3l1 .9z"},C:{width:16,height:16,path:"M14.8 12.3c.9.2 0 1.1-.4 1.4-.7.6-1.4 1-2.2 1.5-1.8.8-3.8 1-5.8.5a7 7 0 0 1-4.3-2.9 8 8 0 0 1-1.2-5c-.1-2.2.8-4.6 2.6-6.1A8 8 0 0 1 8 0a6 6 0 0 1 2.7.4c.8.4 1.8.6 2.7.6.5-.2.4-1.4 1.1-.9.2.4 0 .8.1 1.1v3.7c-.4.8-1-.3-1.1-.8A6.3 6.3 0 0 0 9.6 1c-1-.2-2.3-.1-3 .7-1.4 1.4-1.7 3.4-1.9 5.2-.1 2.1.1 4.3 1 6.1.7 1.2 2 2 3.3 1.9 2 0 4-1 5.5-2.5l.3-.1ZM5.5 1.7c.4-.3.3-.5-.1-.2-1.5.7-2.7 1.9-3.3 3.4a8.5 8.5 0 0 0-.2 5.3 6 6 0 0 0 3.2 4.2c.4.2 1.3.7.7 0-1.2-1.2-1.6-3-1.8-4.6V6c.3-1.5.6-3 1.5-4.2Zm8 1c.2.3.4.3.3 0v-1c-.3.2-.7 0-1 .1.1.4.4.6.7.9z"},comment:{width:1024,height:1024,path:"M512 219q-116 0-218 39t-161 107-59 145q0 64 40 122t115 100l49 28-15 54q-13 52-40 98 86-36 157-97l24-21 32 3q39 4 74 4 116 0 218-39t161-107 59-145-59-145-161-107-218-39zM1024 512q0 99-68 183t-186 133-257 48q-40 0-82-4-113 100-262 138-28 8-65 12h-2q-8 0-15-6t-9-15v-0q-1-2-0-6t1-5 2-5l3-5t4-4 4-5q4-4 17-19t19-21 17-22 18-29 15-33 14-43q-89-50-141-125t-51-160q0-99 68-183t186-133 257-48 257 48 186 133 68 183z"},table:{width:24,height:24,path:"M17,17 L17,22 L19,22 C20.6568542,22 22,20.6568542 22,19 L22,17 L17,17 Z M15,17 L9,17 L9,22 L15,22 L15,17 Z M17,15 L22,15 L22,9 L17,9 L17,15 Z M15,15 L15,9 L9,9 L9,15 L15,15 Z M17,7 L22,7 L22,5 C22,3.34314575 20.6568542,2 19,2 L17,2 L17,7 Z M15,7 L15,2 L9,2 L9,7 L15,7 Z M24,16.1768671 L24,19 C24,21.7614237 21.7614237,24 19,24 L5,24 C2.23857625,24 2.11453371e-15,21.7614237 1.77635684e-15,19 L0,5 C-3.38176876e-16,2.23857625 2.23857625,2.28362215e-15 5,0 L19,0 C21.7614237,-5.07265313e-16 24,2.23857625 24,5 L24,7.82313285 C24.0122947,7.88054124 24.0187107,7.93964623 24.0187107,8 C24.0187107,8.06035377 24.0122947,8.11945876 24,8.17686715 L24,15.8231329 C24.0122947,15.8805412 24.0187107,15.9396462 24.0187107,16 C24.0187107,16.0603538 24.0122947,16.1194588 24,16.1768671 Z M7,2 L5,2 C3.34314575,2 2,3.34314575 2,5 L2,7 L7,7 L7,2 Z M2,9 L2,15 L7,15 L7,9 L2,9 Z M2,17 L2,19 C2,20.6568542 3.34314575,22 5,22 L7,22 L7,17 L2,17 Z"},delete_table:{width:24,height:24,path:"M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M16.5,19.9375 L21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 Z M12.2898787,17 L9,17 L9,22 L12.6736312,22 C13.0297295,22.7496048 13.515133,23.4258795 14.1010173,24 L5,24 C2.23857625,24 -1.43817996e-15,21.7614237 -1.77635684e-15,19 L-3.55271368e-15,5 C-3.89089055e-15,2.23857625 2.23857625,5.07265313e-16 5,-1.77635684e-15 L19,-1.77635684e-15 C21.7614237,-2.28362215e-15 24,2.23857625 24,5 L24,7.82313285 C24.0122947,7.88054124 24.0187107,7.93964623 24.0187107,8 C24.0187107,8.06035377 24.0122947,8.11945876 24,8.17686715 L24,14.1010173 C23.4258795,13.515133 22.7496048,13.0297295 22,12.6736312 L22,9 L17,9 L17,12.2898787 C16.2775651,12.5048858 15.6040072,12.8333806 15,13.2546893 L15,9 L9,9 L9,15 L13.2546893,15 C12.8333806,15.6040072 12.5048858,16.2775651 12.2898787,17 Z M17,7 L22,7 L22,5 C22,3.34314575 20.6568542,2 19,2 L17,2 L17,7 Z M15,7 L15,2 L9,2 L9,7 L15,7 Z M7,2 L5,2 C3.34314575,2 2,3.34314575 2,5 L2,7 L7,7 L7,2 Z M2,9 L2,15 L7,15 L7,9 L2,9 Z M2,17 L2,19 C2,20.6568542 3.34314575,22 5,22 L7,22 L7,17 L2,17 Z"},add_col_before:{width:24,height:24,path:"M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L20.25,18.0625 C20.077411,18.0625 19.9375,17.922589 19.9375,17.75 L19.9375,16.5 C19.9375,15.982233 19.517767,15.5625 19,15.5625 C18.482233,15.5625 18.0625,15.982233 18.0625,16.5 L18.0625,17.75 C18.0625,17.922589 17.922589,18.0625 17.75,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 L17.75,19.9375 C17.922589,19.9375 18.0625,20.077411 18.0625,20.25 L18.0625,21.5 C18.0625,22.017767 18.482233,22.4375 19,22.4375 C19.517767,22.4375 19.9375,22.017767 19.9375,21.5 L19.9375,20.25 C19.9375,20.077411 20.077411,19.9375 20.25,19.9375 L21.5,19.9375 Z M2,19 C2,20.6568542 3.34314575,22 5,22 C6.65685425,22 8,20.6568542 8,19 L8,5 C8,3.34314575 6.65685425,2 5,2 C3.34314575,2 2,3.34314575 2,5 L2,19 Z M-2.7585502e-16,19 L5.81397739e-16,5 C-1.37692243e-16,2.23857625 2.23857625,0 5,0 C7.76142375,0 10,2.23857625 10,5 L10,19 C10,21.7614237 7.76142375,24 5,24 C2.23857625,24 4.43234962e-16,21.7614237 -2.7585502e-16,19 Z"},add_col_after:{width:24,height:24,path:"M5,14 C7.76005315,14.0033061 9.99669388,16.2399468 10,19 C10,21.7614237 7.76142375,24 5,24 C2.23857625,24 1.77635684e-15,21.7614237 1.77635684e-15,19 C1.77635684e-15,16.2385763 2.23857625,14 5,14 Z M7.5,19.9375 C8.01776695,19.9375 8.4375,19.517767 8.4375,19 C8.4375,18.482233 8.01776695,18.0625 7.5,18.0625 L6.25,18.0625 C6.07741102,18.0625 5.9375,17.922589 5.9375,17.75 L5.9375,16.5 C5.9375,15.982233 5.51776695,15.5625 5,15.5625 C4.48223305,15.5625 4.0625,15.982233 4.0625,16.5 L4.0625,17.75 C4.0625,17.922589 3.92258898,18.0625 3.75,18.0625 L2.5,18.0625 C1.98223305,18.0625 1.5625,18.482233 1.5625,19 C1.5625,19.517767 1.98223305,19.9375 2.5,19.9375 L3.75,19.9375 C3.92258898,19.9375 4.0625,20.077411 4.0625,20.25 L4.0625,21.5 C4.0625,22.017767 4.48223305,22.4375 5,22.4375 C5.51776695,22.4375 5.9375,22.017767 5.9375,21.5 L5.9375,20.25 C5.9375,20.077411 6.07741102,19.9375 6.25,19.9375 L7.5,19.9375 Z M16,19 C16,20.6568542 17.3431458,22 19,22 C20.6568542,22 22,20.6568542 22,19 L22,5 C22,3.34314575 20.6568542,2 19,2 C17.3431458,2 16,3.34314575 16,5 L16,19 Z M14,19 L14,5 C14,2.23857625 16.2385763,0 19,0 C21.7614237,0 24,2.23857625 24,5 L24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 Z"},add_row_before:{width:24,height:24,path:"M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L20.25,18.0625 C20.077411,18.0625 19.9375,17.922589 19.9375,17.75 L19.9375,16.5 C19.9375,15.982233 19.517767,15.5625 19,15.5625 C18.482233,15.5625 18.0625,15.982233 18.0625,16.5 L18.0625,17.75 C18.0625,17.922589 17.922589,18.0625 17.75,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 L17.75,19.9375 C17.922589,19.9375 18.0625,20.077411 18.0625,20.25 L18.0625,21.5 C18.0625,22.017767 18.482233,22.4375 19,22.4375 C19.517767,22.4375 19.9375,22.017767 19.9375,21.5 L19.9375,20.25 C19.9375,20.077411 20.077411,19.9375 20.25,19.9375 L21.5,19.9375 Z M5,2 C3.34314575,2 2,3.34314575 2,5 C2,6.65685425 3.34314575,8 5,8 L19,8 C20.6568542,8 22,6.65685425 22,5 C22,3.34314575 20.6568542,2 19,2 L5,2 Z M5,0 L19,0 C21.7614237,-5.07265313e-16 24,2.23857625 24,5 C24,7.76142375 21.7614237,10 19,10 L5,10 C2.23857625,10 3.38176876e-16,7.76142375 0,5 C-1.2263553e-15,2.23857625 2.23857625,5.07265313e-16 5,0 Z"},add_row_after:{width:24,height:24,path:"M19,0 C21.7600532,0.00330611633 23.9966939,2.23994685 24,5 C24,7.76142375 21.7614237,10 19,10 C16.2385763,10 14,7.76142375 14,5 C14,2.23857625 16.2385763,0 19,0 Z M21.5,5.9375 C22.017767,5.9375 22.4375,5.51776695 22.4375,5 C22.4375,4.48223305 22.017767,4.0625 21.5,4.0625 L20.25,4.0625 C20.077411,4.0625 19.9375,3.92258898 19.9375,3.75 L19.9375,2.5 C19.9375,1.98223305 19.517767,1.5625 19,1.5625 C18.482233,1.5625 18.0625,1.98223305 18.0625,2.5 L18.0625,3.75 C18.0625,3.92258898 17.922589,4.0625 17.75,4.0625 L16.5,4.0625 C15.982233,4.0625 15.5625,4.48223305 15.5625,5 C15.5625,5.51776695 15.982233,5.9375 16.5,5.9375 L17.75,5.9375 C17.922589,5.9375 18.0625,6.07741102 18.0625,6.25 L18.0625,7.5 C18.0625,8.01776695 18.482233,8.4375 19,8.4375 C19.517767,8.4375 19.9375,8.01776695 19.9375,7.5 L19.9375,6.25 C19.9375,6.07741102 20.077411,5.9375 20.25,5.9375 L21.5,5.9375 Z M5,16 C3.34314575,16 2,17.3431458 2,19 C2,20.6568542 3.34314575,22 5,22 L19,22 C20.6568542,22 22,20.6568542 22,19 C22,17.3431458 20.6568542,16 19,16 L5,16 Z M5,14 L19,14 C21.7614237,14 24,16.2385763 24,19 C24,21.7614237 21.7614237,24 19,24 L5,24 C2.23857625,24 3.38176876e-16,21.7614237 0,19 C-1.2263553e-15,16.2385763 2.23857625,14 5,14 Z"},combine_cells:{width:24,height:24,path:"M2,19 C2,20.6568542 3.34314575,22 5,22 L19,22 C20.6568542,22 22,20.6568542 22,19 L22,5 C22,3.34314575 20.6568542,2 19,2 L5,2 C3.34314575,2 2,3.34314575 2,5 L2,19 Z M-1.16403344e-15,19 L-3.0678068e-16,5 C-6.44957556e-16,2.23857625 2.23857625,0 5,0 L19,0 C21.7614237,0 24,2.23857625 24,5 L24,19 C24,21.7614237 21.7614237,24 19,24 L5,24 C2.23857625,24 9.50500275e-16,21.7614237 -1.16403344e-15,19 Z M12,10 C12.5522847,10 13,10.4477153 13,11 L13,13 C13,13.5522847 12.5522847,14 12,14 C11.4477153,14 11,13.5522847 11,13 L11,11 C11,10.4477153 11.4477153,10 12,10 Z M12,16 C12.5522847,16 13,16.4477153 13,17 L13,20 C13,20.5522847 12.5522847,21 12,21 C11.4477153,21 11,20.5522847 11,20 L11,17 C11,16.4477153 11.4477153,16 12,16 Z M12,3 C12.5522847,3 13,3.44771525 13,4 L13,7 C13,7.55228475 12.5522847,8 12,8 C11.4477153,8 11,7.55228475 11,7 L11,4 C11,3.44771525 11.4477153,3 12,3 Z"},delete_col:{width:24,height:24,path:"M12.6414391,21.9312708 C12.9358807,22.5689168 13.3234155,23.1547532 13.7866134,23.6713497 C13.2317936,23.8836754 12.6294813,24 12,24 C9.23857625,24 7,21.7614237 7,19 L7,5 C7,2.23857625 9.23857625,0 12,0 C14.7614237,0 17,2.23857625 17,5 L17,12.2898787 C16.2775651,12.5048858 15.6040072,12.8333806 15,13.2546893 L15,5 C15,3.34314575 13.6568542,2 12,2 C10.3431458,2 9,3.34314575 9,5 L9,19 C9,20.6568542 10.3431458,22 12,22 C12.220157,22 12.4347751,21.9762852 12.6414391,21.9312708 Z M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M16.5,19.9375 L21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 Z"},delete_row:{width:24,height:24,path:"M13.2546893,15 C12.8333806,15.6040072 12.5048858,16.2775651 12.2898787,17 L5,17 C2.23857625,17 3.38176876e-16,14.7614237 0,12 C-1.2263553e-15,9.23857625 2.23857625,7 5,7 L19,7 C21.7614237,7 24,9.23857625 24,12 C24,12.6294813 23.8836754,13.2317936 23.6713497,13.7866134 C23.1547532,13.3234155 22.5689168,12.9358807 21.9312708,12.6414391 C21.9762852,12.4347751 22,12.220157 22,12 C22,10.3431458 20.6568542,9 19,9 L5,9 C3.34314575,9 2,10.3431458 2,12 C2,13.6568542 3.34314575,15 5,15 L13.2546893,15 Z M19,14 C21.7600532,14.0033061 23.9966939,16.2399468 24,19 C24,21.7614237 21.7614237,24 19,24 C16.2385763,24 14,21.7614237 14,19 C14,16.2385763 16.2385763,14 19,14 Z M16.5,19.9375 L21.5,19.9375 C22.017767,19.9375 22.4375,19.517767 22.4375,19 C22.4375,18.482233 22.017767,18.0625 21.5,18.0625 L16.5,18.0625 C15.982233,18.0625 15.5625,18.482233 15.5625,19 C15.5625,19.517767 15.982233,19.9375 16.5,19.9375 Z"},grid:{width:16,height:16,path:"M0 1v13h16v-13h-16zM6 9v-3h4v3h-4zM10 10v3h-4v-3h4zM10 2v3h-4v-3h4zM5 2v3h-4v-3h4zM1 6h4v3h-4v-3zM11 6h4v3h-4v-3zM11 5v-3h4v3h-4zM1 10h4v3h-4v-3zM11 13v-3h4v3h-4z"},nogrid:{text:"",css:"font-weight: bold"},oneRule:{width:16,height:16,path:"M0 2h16v-1.5h-16z"},twoRules:{width:16,height:16,path:"M0 2h16v-1h-16zM0 14h16v-1h-16z"},threeRules:{width:16,height:16,path:"M0 2h16v-2h-16zM0 5h16v-1h-16zM0 16h16v-2h-16z"},fourRules:{width:16,height:16,path:"M0 2h16v-2h-16zM0 5h16v-1h-16zM0 12h16v-1h-16zM0 16h16v-2h-16z"},rules:{width:16,height:16,path:"M0 1h16v1h-16zM0 5h16v1h-16zM0 9h16v1h-16zM0 13h16v1h-16z"},striped:{width:16,height:16,path:"M0 1h16v3h-16zM0 9h16v3h-16z"},cog:{width:16,height:16,path:"M14.59 9.535c-0.839-1.454-0.335-3.317 1.127-4.164l-1.572-2.723c-0.449 0.263-0.972 0.414-1.529 0.414-1.68 0-3.042-1.371-3.042-3.062h-3.145c0.004 0.522-0.126 1.051-0.406 1.535-0.839 1.454-2.706 1.948-4.17 1.106l-1.572 2.723c0.453 0.257 0.845 0.634 1.123 1.117 0.838 1.452 0.336 3.311-1.12 4.16l1.572 2.723c0.448-0.261 0.967-0.41 1.522-0.41 1.675 0 3.033 1.362 3.042 3.046h3.145c-0.001-0.517 0.129-1.040 0.406-1.519 0.838-1.452 2.7-1.947 4.163-1.11l1.572-2.723c-0.45-0.257-0.839-0.633-1.116-1.113zM8 11.24c-1.789 0-3.24-1.45-3.24-3.24s1.45-3.24 3.24-3.24c1.789 0 3.24 1.45 3.24 3.24s-1.45 3.24-3.24 3.24z"},"align-left":{width:16,height:16,path:"M0 1h16v2h-16zM0 4h10v2h-10zM0 10h10v2h-10zM0 7h16v2h-16zM0 13h16v2h-16"},"align-center":{width:16,height:16,path:"M0 1h16v2h-16zM3 4h10v2h-10zM3 10h10v2h-10zM0 7h16v2h-16zM0 13h16v2h-16z"},"align-right":{width:16,height:16,path:"M0 1h16v2h-16zM6 4h10v2h-10zM6 10h10v2h-10zM0 7h16v2h-16zM0 13h16v2h-16z"},info:{width:16,height:16,path:"M7 4.75c0-0.412 0.338-0.75 0.75-0.75h0.5c0.412 0 0.75 0.338 0.75 0.75v0.5c0 0.412-0.338 0.75-0.75 0.75h-0.5c-0.412 0-0.75-0.338-0.75-0.75v-0.5z M10 12h-4v-1h1v-3h-1v-1h3v4h1z M8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 14.5c-3.59 0-6.5-2.91-6.5-6.5s2.91-6.5 6.5-6.5 6.5 2.91 6.5 6.5-2.91 6.5-6.5 6.5z"}};function canInsert(e,t){let r=e.selection.$from;for(let e=r.depth;e>=0;e--){let n=r.index(e);if(r.node(e).canReplaceWith(n,n,t))return true}return false}function insertHeader(e,t){return new MenuItem({title:"Insert a print header",label:"Print header",enable(){return true},run(e,t){window.scrollTo(0,0);if(e.doc.nodeAt(0).type.name==="header"){return}t(e.tr.insert(0,schema.nodeFromJSON(JSON.parse(`{"type":"header","content":[{"type":"table","attrs":{"class":"one-rule c2c c3r"},\n"content":[{"type":"table_row","content":[{"type":"table_header","content":[\n{"type":"paragraph","content":[{"type":"text","text":"left"}]}]},\n{"type":"table_header","content":[{"type":"paragraph","content":[{"type":"text","text":"center"}]}]},\n{"type":"table_header","content":[{"type":"paragraph","content":[{"type":"text","text":"$PAGE"}]}]}]}]}]}`))))}})}const navigate=()=>new MenuItem({title:"Navigate",icon:hurmetIcons.navicon,run(e,t,r){const n=[{textContent:"Top",pos:0}];const o=r.dom.getBoundingClientRect().bottom-320;e.doc.nodesBetween(0,e.doc.content.size,(function(e,t){if(e.type.name==="heading"&&(e.attrs.level===1||e.attrs.level===2)){n.push({textContent:e.attrs.level===1?e.textContent:""+e.textContent,pos:t})}}));n.push({textContent:"Bottom",pos:o});const i=e=>{const t=r.coordsAtPos(e).top;const n=r.dom.getBoundingClientRect().top;window.scrollTo(0,t-n+180)};openSelectPrompt("Scroll to",n,i)}});const findParentNode=e=>t=>{const{$from:r}=t;for(let t=r.depth;t>0;t--){const n=r.node(t);if(e(n)){return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}};const print=()=>new MenuItem({title:"Print",label:"Print",run(e,t,r){findPageBreaks(r,e,forPrint,schema.nodes.toc);window.print()}});const findTable=e=>findParentNode((e=>e.type.spec.tableRole&&e.type.spec.tableRole==="table"))(e);const isCellSelection=e=>e instanceof CellSelection;const getSelectionRect=e=>{if(!isCellSelection(e)){return}const t=e.$anchorCell.start(-1);const r=TableMap.get(e.$anchorCell.node(-1));return r.rectBetween(e.$anchorCell.pos-t,e.$headCell.pos-t)};const pruneHurmet=e=>{for(const t in e){let r=e[t];if(r!==null&&typeof r==="object"){if(Array.isArray(r)){for(let e=r.length-1;e>=0;e-=1){if(r[e].hasOwnProperty("type")&&(r[e].type==="calculation"||r[e].type==="tex")){if(r[e].type==="calculation"&&r[e].attrs.entry.length===0||r[e].type==="tex"&&r[e].attrs.tex.length===0){r.splice(e,1)}}}if(r.length>0){pruneHurmet(r)}}else if(r.type){if(r.type==="calculation"){if(r.attrs.displayMode){r.attrs={entry:r.attrs.entry,displayMode:true}}else{r.attrs={entry:r.attrs.entry}}}else if(r.type==="tex");else{pruneHurmet(r)}}else{pruneHurmet(r)}}}return e};function deleteComments(e,t){return new MenuItem({title:"Delete all comments",label:"Delete all comments",enable(){return true},run(e,t){const r=[];e.doc.nodesBetween(0,e.doc.content.size,(function(e,t){if(e.type.name==="comment"){r.push(t)}}));const n=e.tr;for(let e=r.length-1;e>=0;e--){const t=r[e];n.delete(t,t+1)}t(n)}})}async function writeFile(e,t){const r=await e.createWritable();await r.write(t);await r.close()}function sleep(e){return new Promise((t=>setTimeout(t,e)))}function saveFileAsJSON(e){const t=e.doc.toJSON();const r=JSON.stringify(pruneHurmet(t));if(window.showOpenFilePicker&&e.doc.attrs.fileHandle){const t=document.getElementsByClassName("ProseMirror-menubar").item(0).children[1];t.classList.add("ProseMirror-menu-active");writeFile(e.doc.attrs.fileHandle,r);sleep(500).then((()=>{t.classList.remove("ProseMirror-menu-active")}))}else{const e=new Blob([r],{type:"text/plain;charset=utf-8"});FileSaver_1(e,"HurmetFile.hurmet")}}function saveFile(e){return new MenuItem({title:"Save file...   Ctrl-S",label:"Save",enable(e){return true},run(e){saveFileAsJSON(e)}})}function exportMarkdownFile(e){return new MenuItem({title:e?"Export GitHub Flavored Markdown":"Export Markdown",label:e?"Export GFM":"Export Markdown",enable(e){return true},run(t){const r=hurmetMarkdownSerializer.serialize(t.doc,new Map,e);const n=new Blob([r],{type:"text/plain;charset=utf-8"});FileSaver_1(n,"HurmetMarkdown.md",{autoBom:false})}})}function openFile(){return new MenuItem({title:"Open file...",label:"Open",enable(){return true},run(e,t,r){readFile(e,t,r,schema,"hurmet")}})}function importMarkdownFile(){return new MenuItem({title:"Import Markdown...",label:"Import Markdown...",enable(){return true},run(e,t,r){readFile(e,t,r,schema,"markdown")}})}function uploadImage(e){return new MenuItem({title:"Upload image file",icon:hurmetIcons.upload,enable(t){return canInsert(t,e)},run(e,t,r){const n=document.createElement("input");n.type="file";n.accept=".gif,.jpg,.jpeg,.png,.svg";n.onchange=e=>{const t=n.files[0];const o=t.name.replace(/\..+$/,"");const i=new FileReader;i.onload=function(e){const t=e.target.result;const n=r.state.selection.from;r.dispatch(r.state.tr.replaceWith(n,n,schema.nodes.image.create({src:t,alt:o})))};i.readAsDataURL(t)};n.click()}})}function insertImage(e){return new MenuItem({title:"Insert link to image or edit existing image",icon:hurmetIcons.image,enable(t){return canInsert(t,e)},run(t,r,n){let{from:o,to:i}=t.selection,a=null;if(t.selection instanceof NodeSelection&&t.selection.node.type==e)a=t.selection.node.attrs;openPrompt({title:"Insert image",fields:{src:new TextField({label:"Location",required:true,value:a&&a.src}),alt:new TextField({label:"Description",value:a?a.alt:t.doc.textBetween(o,i," ")}),width:new TextField({label:"Width",value:a&&a.width})},radioButtons:{name:"position",labels:["inline","left","center","right"],current:a?a.class:"inline"},callback(t){n.dispatch(n.state.tr.replaceSelectionWith(e.createAndFill(t)));n.focus()}})}})}function insertComment(e){return new MenuItem({title:"Insert or edit a comment",icon:hurmetIcons.comment,enable(t){return canInsert(t,e)},run(t,r,n){let o=null;if(t.selection instanceof NodeSelection&&t.selection.node.type.name=="comment")o=t.selection.node.attrs;openPrompt({title:"Insert comment",fields:{comment:new TextAreaField({label:"Enter your comment",required:true,value:o&&o.comment})},callback(r){const o=n.state.selection.from;const i=t.selection instanceof NodeSelection&&t.selection.node.type.name=="comment"?o+1:o;n.dispatch(n.state.tr.replaceWith(o,i,e.createAndFill(r)));n.focus()}})}})}function takeSnapshot(){return new MenuItem({title:"Take and save a snapshot of the current document",label:"Take a snapshot...",run(e,t,r){openPrompt({title:"Snapshot",fields:{message:new TextField({label:"Commit message",required:true})},callback(t){const r=(new Date).toISOString().replace(/T.+/,"");let n=hurmetMarkdownSerializer.serialize(e.doc,new Map);n=n.replace(/\n\n\[[^\]]+\\: .+/,"");e.doc.attrs.snapshots.push({message:t.message,date:r,content:n})}})}})}function showDiff(){return new MenuItem({label:"Show diff...",run(e,t,r){const n="Show the difference since:";const o=[];const i=e.doc.attrs.snapshots;if(e.doc.attrs.snapshots.length===0){alert("There are no snapshots to diff.");return}for(let t=0;t<e.doc.attrs.snapshots.length;t++){o.push({textContent:i[t].date+" "+i[t].message,pos:t})}const a=t=>{const r=new diff_match_patch;const n=e.doc.attrs.snapshots[t].content;let o=hurmetMarkdownSerializer.serialize(e.doc,new Map);o=o.replace(/\n\n\[[^\]]+\\: .+/,"");r.Diff_Timeout=2;r.Diff_EditCost=4;let i=r.diff_main(n,o);r.diff_cleanupSemantic(i);const a=r.diff_prettyHtml(i);const s=document.body.appendChild(document.createElement("div"));s.className="ProseMirror-prompt";s.style="width: 550px; max-height: 500px; overflow: scroll;";s.id="";s.innerHTML=a;const l=document.createElement("button");l.type="button";l.className="ProseMirror-prompt-cancel";l.textContent="Close";l.onclick=function(e){s.parentNode.removeChild(s)};s.appendChild(l);const c=s.getBoundingClientRect();s.style.top=(window.innerHeight-c.height)/2+"px";s.style.left=(window.innerWidth-c.width)/2+"px"};openSelectPrompt(n,o,a)}})}function deleteSnapshots(){return new MenuItem({label:"Delete all snapshots...",run(e,t,r){openPrompt({title:"Delete Snapshots",note:"This will delete all snapshots. It cannot be undone.",useOkButton:true,callback(){e.doc.attrs.snapshots=[]}})}})}function insertToC(e){return new MenuItem({title:"Insert or edit a Table of Contents",label:"ToC",enable(t){return canInsert(t,e)},run(t,r,n){let{from:o,to:i}=t.selection,a=null;if(t.selection instanceof NodeSelection&&t.selection.node.type==e)a=t.selection.node.attrs;if(!a){a={start:1,end:2,body:[]}}openPrompt({title:"Table of Contents",note:"Set a range of heading levels:",fields:{start:new TextField({label:"Start",required:true,value:a&&a.start,validate(e){if(!/^[1-6]$/.test(e)){return"Input must be an integer between 1 and 6."}}}),end:new TextField({label:"End",required:true,value:a&&a.end,validate(e){if(!/^[1-6]$/.test(e)){return"Input must be an integer between 1 and 6."}}})},callback(o){const{$from:i,to:a}=t.selection;const s=i.sharedDepth(a);const l=s!==0?i.before(s):i.pos;const c=s!==0?i.after(s):l+1;o.body=findPageBreaks(n,t,forToC,schema.nodes.toc,o.start,o.end);r(t.tr.replaceWith(l,c,e.createAndFill(o)))}})}})}function insertMath(e,t,r){const n=r==="calculation"?schema.nodes.calculation:schema.nodes.tex;let o=r==="calculation"?{entry:""}:{tex:""};if(e.selection instanceof NodeSelection&&e.selection.node.type==n){o=e.selection.node.attrs}const i=t.state.tr;const a=i.selection.from;const s=e.doc.resolve(a).parent;if(s.type.name==="centered_paragraph"){o.displayMode=true}i.replaceSelectionWith(n.createAndFill(o));i.setSelection(NodeSelection.create(i.doc,a));t.dispatch(i)}function mathMenuItem(e,t){return new MenuItem({title:"Insert "+(t==="calculation"?"a calculation cell  Alt-C":"a TeX cell"),icon:t==="calculation"?hurmetIcons.C:hurmetIcons.T,enable(t){return canInsert(t,e)},run(e,r,n){insertMath(e,n,t)}})}function convertWord(e,t){const r=e.doc;const n=e.tr;const o=schema.nodes.calculation;const i=/\$`[^`]+`/g;const a=[];r.nodesBetween(0,r.content.size,(function(e,t){if(e.type.name==="text"){const r=e.text;const n=r.matchAll(i);for(const e of n){const r=t+e.index;const n=r+e[0].length;const o=e[0].slice(2,-1).trim();a.push({start:r,end:n,entry:o})}}}));while(a.length>0){const{start:e,end:t,entry:r}=a.pop();n.replaceWith(e,t,o.createAndFill({entry:r}))}t.dispatch(n)}const createTable=(e,t=3,r=3,n=true)=>{const o=[];const i=[];for(let t=0;t<r;t++){o.push(e.nodes.table_cell.createAndFill());if(n){i.push(e.nodes.table_header.createAndFill())}}const a=[];for(let r=0;r<t;r++){a.push(e.nodes.table_row.createChecked(null,n&&r===0?i:o))}return e.nodes.table.create(null,a)};function cmdItem(e,t){let r={label:t.title,run:e};for(let e in t)r[e]=t[e];if(!t.enable||t.enable===true)r["enable"]=t=>e(t);return new MenuItem(r)}function markActive(e,t){let{from:r,$from:n,to:o,empty:i}=e.selection;if(i)return t.isInSet(e.storedMarks||n.marks());else return e.doc.rangeHasMark(r,o,t)}function markItem(e,t){let r={active(t){return markActive(t,e)},enable:true};for(let e in t)r[e]=t[e];return cmdItem(toggleMark(e),r)}function toggleDraftMode(){return new MenuItem({title:"Toggle draft mode",label:"Draft mode",enable(){return true},active(e){return e.doc.attrs.inDraftMode},run(e,t){draftMode(e,t,schema.nodes.calculation)}})}function tableItem(e,t,r,n){return new MenuItem({title:e,icon:hurmetIcons[t],select(e){return isInTable(e)},run(e,t){r(e,t)}})}function reCalcAll(){return new MenuItem({title:"Recalculate all",icon:hurmetIcons.recalc,run(e,t,r){hurmet.updateCalculations(r,schema.nodes.calculation,true)}})}function setDecimalFormat(e){return new MenuItem({label:e,run(t,r,n){t.doc.attrs.decimalFormat=e;hurmet.updateCalculations(n,schema.nodes.calculation,true)}})}function setFontSize(e){return new MenuItem({label:String(e)+" pt",run(t,r,n){t.doc.attrs.fontSize=e;document.getElementById("editor").className=e===12?"pica":"long-primer";document.getElementById("print-div").className=e===12?"ProseMirror pica":"ProseMirror long-primer"}})}function setPageSize(e){return new MenuItem({label:e,run(t,r,n){t.doc.attrs.pageSize=e;const o=document.getElementById("pageStyle");o.innerHTML=e==="letter"?`@media print {@page{size: letter; margin: 16mm 0.75in 16mm 0.75in;}}`:`@media print {@page{size: A4; margin: 16mm 16.1mm 16mm 16.1mm;}}`}})}function tableStyle(e,t,r){return new MenuItem({title:e,icon:hurmetIcons[r],select(e){return isInTable(e)},run(e,r){const n=findTable(e.selection);const o=n.node.attrs.class.split(" ");const i=e.tr;if(/^align/.test(t)){const r=t.slice(6,7);const n=getSelectionRect(e.selection);if(n){for(let e=n.left+1;e<n.right+1;e++){let t=false;for(let n=0;n<o.length;n++){const i=o[n].slice(1,2);if(!isNaN(i)){if(Number(i)===e){t=true;o[n]=r==="l"?"":"c"+i+r}}}if(!t)o.push("c"+e+r)}}}else{o[0]=t}const a=o.join(" ").replace(/ {2,}/g," ");const s={class:a};i.setNodeMarkup(n.pos,undefined,s);r(i)}})}const liftItem=new MenuItem({title:"Lift out of enclosing block",run:lift,enable:e=>lift(e),icon:icons.lift});const selectParentNodeItem=new MenuItem({title:"Select parent node",run:selectParentNode,enable:e=>selectParentNode(e),icon:icons.selectParentNode});function linkItem(e){return new MenuItem({title:"Add or remove link",icon:icons.link,active(t){return markActive(t,e)},enable(e){return!e.selection.empty},run(t,r,n){if(markActive(t,e)){toggleMark(e)(t,r);return true}openPrompt({title:"Create a link",fields:{href:new TextField({label:"Link target",required:true}),title:new TextField({label:"Title"})},callback(t){toggleMark(e,t)(n.state,n.dispatch);n.focus()}})}})}function wrapListItem(e,t){return cmdItem(wrapInList(e,t.attrs),t)}function buildMenuItems(e){const t={};let r;t.navigate=navigate();t.openFile=openFile();t.saveFile=saveFile();t.insertHeader=insertHeader();t.dot=setDecimalFormat("1000000.");t.commadot=setDecimalFormat("1,000,000.");t.lakh=setDecimalFormat("1,00,000.");t.cn=setDecimalFormat("1,0000,0000.");t.comma=setDecimalFormat("1000000,");t.spacecomma=setDecimalFormat("1 000 000,");t.apostrophecomma=setDecimalFormat("1000000,");t.dotcomma=setDecimalFormat("1.000.000,");t.exportMarkdown=exportMarkdownFile(false);t.exportGFM=exportMarkdownFile(true);t.importMarkdownFile=importMarkdownFile();t.pica=setFontSize(12);t.longprimer=setFontSize(10);t.letter=setPageSize("letter");t.A4=setPageSize("A4");t.toggleDraftMode=toggleDraftMode();t.recalcAll=reCalcAll();t.deleteComments=deleteComments();t.takeSnapshot=takeSnapshot();t.showDiff=showDiff();t.deleteSnapshots=deleteSnapshots();t.print=print();if(r=e.marks.strong)t.toggleStrong=markItem(r,{title:"Toggle strong style",icon:icons.strong});if(r=e.marks.em)t.toggleEm=markItem(r,{title:"Toggle emphasis",icon:icons.em});if(r=e.marks.code)t.toggleCode=markItem(r,{title:"Toggle code font  Ctrl-`",icon:icons.code});if(r=e.marks.subscript)t.toggleSubscript=markItem(r,{title:"Toggle subscript  Ctrl-,",icon:hurmetIcons.subscript});if(r=e.marks.superscript)t.toggleSuperscript=markItem(r,{title:"Toggle superscript  Ctrl-.",icon:hurmetIcons.superscript});if(r=e.marks.strikethru)t.toggleStrikethru=markItem(r,{title:"Toggle strikethrough",icon:hurmetIcons.strikethru});if(r=e.marks.underline)t.toggleUnderline=markItem(r,{title:"Toggle underline  Ctrl-u",icon:hurmetIcons.underline});if(r=e.marks.highlight)t.toggleHighlight=markItem(r,{title:"Toggle highlight",icon:hurmetIcons.highlight});if(r=e.marks.link)t.toggleLink=linkItem(r);if(r=e.nodes.image)t.imageUpload=uploadImage(r);if(r=e.nodes.image)t.imageLink=insertImage(r);if(r=e.nodes.toc)t.toc=insertToC(r);if(r=e.nodes.calculation)t.insertCalclation=mathMenuItem(r,"calculation");if(r=e.nodes.tex)t.insertTeX=mathMenuItem(r,"tex");if(r=e.nodes.comment)t.insertComment=insertComment(r);if(r=e.nodes.bullet_list)t.wrapBulletList=wrapListItem(r,{title:"Wrap in bullet list",icon:icons.bulletList});if(r=e.nodes.ordered_list)t.wrapOrderedList=wrapListItem(r,{title:"Wrap in ordered list",icon:icons.orderedList});if(r=e.nodes.blockquote)t.wrapBlockQuote=wrapItem(r,{title:"Wrap in block quote",icon:icons.blockquote});if(r=e.nodes.centered_div)t.wrapCentered=wrapItem(r,{title:"Center block",icon:hurmetIcons["align-center"]});if(r=e.nodes.indented_div)t.wrapIndent=wrapItem(r,{title:"Indent block",icon:hurmetIcons.indent});if(r=e.nodes.paragraph)t.makeParagraph=blockTypeItem(r,{title:"Change to plain paragraph",icon:hurmetIcons.paragraph});if(r=e.nodes.code_block)t.makeCodeBlock=blockTypeItem(r,{title:"Change to code block",icon:icons.code});if(r=e.nodes.heading)for(let e=1;e<=4;e++)t["makeHead"+e]=blockTypeItem(r,{title:"Change to heading "+e,label:"H"+e+"",attrs:{level:e}});if(r=e.nodes.horizontal_rule){let e=r;t.insertHorizontalRule=new MenuItem({title:"Insert horizontal rule",label:"",enable(t){return canInsert(t,e)},run(t,r){r(t.tr.replaceSelectionWith(e.create()))}})}if(r=e.nodes.table){let n=r;t.insertTable=new MenuItem({title:"Insert Table",icon:hurmetIcons.table,enable(e){return canInsert(e,n)},run(t,r){r(t.tr.replaceSelectionWith(createTable(e,3,3,true)))}})}t.deleteTable=tableItem("Delete table","delete_table",deleteTable);t.addRowBefore=tableItem("Insert row before","add_row_before",addRowBefore);t.deleteRow=tableItem("Delete row","delete_row",deleteRow);t.addColumnBefore=tableItem("Insert column before","add_col_before",addColumnBefore);t.deleteColumn=tableItem("Delete column","delete_col",deleteColumn);t.toggleCellMerge=new MenuItem({title:"Toggle cell merge",icon:hurmetIcons.combine_cells,select(e){return isInTable(e)},run(e,t){if(mergeCells(e,t)){return}splitCell(e,t)}});t.grid=tableStyle("Grid","grid","grid");t.nogrid=tableStyle("No borders","nogrid","nogrid");t.oneRule=tableStyle("Border below header","one-rule","oneRule");t.twoRules=tableStyle("Borders below header and above bottom line.","two-rules","twoRules");t.threeRules=tableStyle("Three rules","three-rules","threeRules");t.fourRules=tableStyle("Four rules","four-rules","fourRules");t.rules=tableStyle("All rules","rules","rules");t.striped=tableStyle("striped","striped","striped");t.alignColLeft=tableStyle("Align Column Left","align-left","align-left");t.alignColCenter=tableStyle("Align Column Center","align-center","align-center");t.alignColRight=tableStyle("Align Column Right","align-right","align-right");t.help=blockTypeItem(r,{title:"Help",icon:hurmetIcons.info,enable(){return true},run(){window.open("manual.html")}});t.hint=blockTypeItem(r,{title:"Math Quick Reference",label:"Q",enable(){return true},run(){const e=document.getElementsByTagName("body")[0];if(e.className==="show-hint"){e.className=""}else{e.className="show-hint";document.getElementById("hint").style.top=String(window.scrollY+40)+"px"}}});let n=e=>e.filter((e=>e));t.fontsize=new DropdownSubmenu([t.pica,t.longprimer],{label:"Font size"});t.pagesize=new DropdownSubmenu([t.letter,t.A4],{label:"Page size"});t.separators=new DropdownSubmenu([t.dot,t.commadot,t.lakh,t.cn,t.comma,t.spacecomma,t.apostrophecomma,t.dotcomma],{title:"Set decimal format",label:"Set Decimal"});t.fileDropDown=new Dropdown([t.openFile,t.saveFile,t.exportMarkdown,t.exportGFM,t.importMarkdownFile,t.takeSnapshot,t.showDiff,t.deleteSnapshots,t.pagesize,t.print],{label:"File"});t.documentDropDown=new Dropdown([t.separators,t.fontsize,t.toggleDraftMode,t.insertHeader,t.deleteComments],{label:"Doc"});t.fileMenu=[[t.navigate,t.fileDropDown,t.documentDropDown,t.recalcAll]];t.inlineMenu=[[t.toggleStrong,t.toggleEm,t.toggleCode,t.toggleSubscript,t.toggleSuperscript,t.toggleStrikethru,t.toggleUnderline,t.toggleHighlight]];t.insertMenu=[[t.toggleLink,t.insertHorizontalRule,t.imageUpload,t.imageLink,t.toc,t.insertCalclation,t.insertTeX,t.insertComment]];t.typeMenu=[n([t.makeParagraph,t.makeCodeBlock,t.makeHead1,t.makeHead2,t.makeHead3,t.makeHead4])];t.blockMenu=[[t.wrapBulletList,t.wrapOrderedList,t.wrapBlockQuote,t.wrapCentered,t.wrapIndent,joinUpItem,liftItem,selectParentNodeItem]];t.tableStyle=new Dropdown([t.grid,t.nogrid,t.oneRule,t.twoRules,t.threeRules,t.fourRules,t.rules,t.striped],{label:"Tbl Style"});t.tableMenu=[n([t.insertTable,t.addRowBefore,t.addColumnBefore,t.deleteTable,t.deleteRow,t.deleteColumn,t.toggleCellMerge,t.alignColLeft,t.alignColCenter,t.alignColRight,t.tableStyle])];t.fullMenu=t.fileMenu.concat([[undoItem,redoItem]],t.inlineMenu,t.insertMenu,t.typeMenu,t.blockMenu,t.tableMenu,[[t.help,t.hint]]);return t}function wrapInList$1(e,t){return function(r,n){var o=r.selection;var i=o.$from;var a=o.$to;var s=i.blockRange(a),l=false,c=s;if(!s){return false}if(s.depth>=2&&i.node(s.depth-1).type.compatibleContent(e)&&s.startIndex==0){if(i.index(s.depth-1)==0){return false}var u=r.doc.resolve(s.start-2);c=new NodeRange(u,u,s.depth);if(s.endIndex<s.parent.childCount){s=new NodeRange(i,r.doc.resolve(a.end(s.depth)),s.depth)}l=true}var p=findWrapping(c,e,t,s);if(!p){return false}if(n){n(doWrapInList$1(r.tr,s,p,l,e).scrollIntoView())}return true}}function doWrapInList$1(e,t,r,n,o){var i=Fragment.empty;for(var a=r.length-1;a>=0;a--){i=Fragment.from(r[a].type.create(r[a].attrs,i))}e.step(new ReplaceAroundStep(t.start-(n?2:0),t.end,t.start,t.end,new Slice(i,0,0),r.length,true));var s=0;for(var l=0;l<r.length;l++){if(r[l].type==o){s=l+1}}var c=r.length-s;var u=t.start+r.length-(n?2:0),p=t.parent;for(var f=t.startIndex,d=t.endIndex,h=true;f<d;f++,h=false){if(!h&&canSplit(e.doc,u,c)){e.split(u,c);u+=2*c}u+=p.child(f).nodeSize}return e}function splitListItem(e){return function(t,r){var n=t.selection;var o=n.$from;var i=n.$to;var a=n.node;if(a&&a.isBlock||o.depth<2||!o.sameParent(i)){return false}var s=o.node(-1);if(s.type!=e){return false}if(o.parent.content.size==0){if(o.depth==2||o.node(-3).type!=e||o.index(-2)!=o.node(-2).childCount-1){return false}if(r){var l=Fragment.empty,c=o.index(-1)>0;for(var u=o.depth-(c?1:2);u>=o.depth-3;u--){l=Fragment.from(o.node(u).copy(l))}l=l.append(Fragment.from(e.createAndFill()));var p=t.tr.replace(o.before(c?null:-1),o.after(-3),new Slice(l,c?3:2,2));p.setSelection(t.selection.constructor.near(p.doc.resolve(o.pos+(c?3:2))));r(p.scrollIntoView())}return true}var f=i.pos==o.end()?s.contentMatchAt(0).defaultType:null;var d=t.tr.delete(o.pos,i.pos);var h=f&&[null,{type:f}];if(!canSplit(d.doc,o.pos,2,h)){return false}if(r){r(d.split(o.pos,2,h).scrollIntoView())}return true}}function liftListItem(e){return function(t,r){var n=t.selection;var o=n.$from;var i=n.$to;var a=o.blockRange(i,(function(t){return t.childCount&&t.firstChild.type==e}));if(!a){return false}if(!r){return true}if(o.node(a.depth-1).type==e){return liftToOuterList(t,r,e,a)}else{return liftOutOfList(t,r,a)}}}function liftToOuterList(e,t,r,n){var o=e.tr,i=n.end,a=n.$to.end(n.depth);if(i<a){o.step(new ReplaceAroundStep(i-1,a,i,a,new Slice(Fragment.from(r.create(null,n.parent.copy())),1,0),1,true));n=new NodeRange(o.doc.resolve(n.$from.pos),o.doc.resolve(a),n.depth)}t(o.lift(n,liftTarget(n)).scrollIntoView());return true}function liftOutOfList(e,t,r){var n=e.tr,o=r.parent;for(var i=r.end,a=r.endIndex-1,s=r.startIndex;a>s;a--){i-=o.child(a).nodeSize;n.delete(i-1,i+1)}var l=n.doc.resolve(r.start),c=l.nodeAfter;var u=r.startIndex==0,p=r.endIndex==o.childCount;var f=l.node(-1),d=l.index(-1);if(!f.canReplace(d+(u?0:1),d+1,c.content.append(p?Fragment.empty:Fragment.from(o)))){return false}var h=l.pos,m=h+c.nodeSize;n.step(new ReplaceAroundStep(h-(u?1:0),m+(p?1:0),h+1,m-1,new Slice((u?Fragment.empty:Fragment.from(o.copy(Fragment.empty))).append(p?Fragment.empty:Fragment.from(o.copy(Fragment.empty))),u?0:1,p?0:1),u?0:1));t(n.scrollIntoView());return true}function sinkListItem(e){return function(t,r){var n=t.selection;var o=n.$from;var i=n.$to;var a=o.blockRange(i,(function(t){return t.childCount&&t.firstChild.type==e}));if(!a){return false}var s=a.startIndex;if(s==0){return false}var l=a.parent,c=l.child(s-1);if(c.type!=e){return false}if(r){var u=c.lastChild&&c.lastChild.type==l.type;var p=Fragment.from(u?e.create():null);var f=new Slice(Fragment.from(e.create(null,Fragment.from(l.type.create(null,p)))),u?3:1,0);var d=a.start,h=a.end;r(t.tr.step(new ReplaceAroundStep(d-(u?3:1),h,d,h,f,1,true)).scrollIntoView())}return true}}var InputRule=function e(t,r){this.match=t;this.handler=typeof r=="string"?stringHandler(r):r};function stringHandler(e){return function(t,r,n,o){var i=e;if(r[1]){var a=r[0].lastIndexOf(r[1]);i+=r[0].slice(a+r[1].length);n+=a;var s=n-o;if(s>0){i=r[0].slice(a-s,a)+i;n=o}}return t.tr.insertText(i,n,o)}}var MAX_MATCH=500;function inputRules(e){var t=e.rules;var r=new Plugin({state:{init:function e(){return null},apply:function e(t,r){var n=t.getMeta(this);if(n){return n}return t.selectionSet||t.docChanged?null:r}},props:{handleTextInput:function e(n,o,i,a){return run(n,o,i,a,t,r)},handleDOMEvents:{compositionend:function(e){setTimeout((function(){var n=e.state.selection;var o=n.$cursor;if(o){run(e,o.pos,o.pos,"",t,r)}}))}}},isInputRules:true});return r}function run(e,t,r,n,o,i){if(e.composing){return false}var a=e.state,s=a.doc.resolve(t);if(s.parent.type.spec.code){return false}var l=s.parent.textBetween(Math.max(0,s.parentOffset-MAX_MATCH),s.parentOffset,null,"")+n;for(var c=0;c<o.length;c++){var u=o[c].match.exec(l);var p=u&&o[c].handler(a,u,t-(u[0].length-n.length),r);if(!p){continue}e.dispatch(p.setMeta(i,{transform:p,from:t,to:r,text:n}));return true}return false}function undoInputRule(e,t){var r=e.plugins;for(var n=0;n<r.length;n++){var o=r[n],i=void 0;if(o.spec.isInputRules&&(i=o.getState(e))){if(t){var a=e.tr,s=i.transform;for(var l=s.steps.length-1;l>=0;l--){a.step(s.steps[l].invert(s.docs[l]))}if(i.text){var c=a.doc.resolve(i.from).marks();a.replaceWith(i.from,i.to,e.schema.text(i.text,c))}else{a.delete(i.from,i.to)}t(a)}return true}}return false}var emDash=new InputRule(/--$/,"");var ellipsis=new InputRule(/\.\.\.$/,"");var openDoubleQuote=new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"");var closeDoubleQuote=new InputRule(/"$/,"");var openSingleQuote=new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"");var closeSingleQuote=new InputRule(/'$/,"");var smartQuotes=[openDoubleQuote,closeDoubleQuote,openSingleQuote,closeSingleQuote];function wrappingInputRule(e,t,r,n){return new InputRule(e,(function(e,o,i,a){var s=r instanceof Function?r(o):r;var l=e.tr.delete(i,a);var c=l.doc.resolve(i),u=c.blockRange(),p=u&&findWrapping(u,t,s);if(!p){return null}l.wrap(u,p);var f=l.doc.resolve(i-1).nodeBefore;if(f&&f.type==t&&canJoin(l.doc,i-1)&&(!n||n(o,f))){l.join(i-1)}return l}))}function textblockTypeInputRule(e,t,r){return new InputRule(e,(function(e,n,o,i){var a=e.doc.resolve(o);var s=r instanceof Function?r(n):r;if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t)){return null}return e.tr.delete(o,i).setBlockType(o,o,t,s)}))}const mac$3=typeof navigator!="undefined"?/Mac/.test(navigator.platform):false;function buildKeymap(e,t){let r={},n;function o(e,n){if(t){let r=t[e];if(r===false)return;if(r)e=r}r[e]=n}o("Ctrl-s",((e,t,r)=>{saveFileAsJSON(e);return true}));o("Mod-z",undo);o("Shift-Mod-z",redo);o("Backspace",undoInputRule);if(!mac$3)o("Mod-y",redo);o("Tab",goToNextCell(1));o("Shift-Tab",goToNextCell(-1));o("Alt-ArrowUp",joinUp);o("Alt-ArrowDown",joinDown);o("Mod-BracketLeft",lift);if(n=e.marks.strong)o("Mod-b",toggleMark(n));if(n=e.marks.em)o("Mod-i",toggleMark(n));if(n=e.marks.code)o("Mod-`",toggleMark(n));if(n=e.marks.subscript)o("Mod-,",toggleMark(n));if(n=e.marks.superscript)o("Mod-.",toggleMark(n));if(n=e.marks.underline)o("Mod-u",toggleMark(n));if(n=e.nodes.calculation){o("Alt-c",((e,t,r)=>{insertMath(e,r,"calculation");return true}));o("Alt-h",((e,t,r)=>{convertWord(e,r);return true}))}if(n=e.nodes.bullet_list)o("Shift-Ctrl-8",wrapInList$1(n));if(n=e.nodes.ordered_list)o("Shift-Ctrl-9",wrapInList$1(n));if(n=e.nodes.blockquote)o("Ctrl->",wrapIn(n));if(n=e.nodes.hard_break){let e=n,t=chainCommands(exitCode,((t,r)=>{r(t.tr.replaceSelectionWith(e.create()).scrollIntoView());return true}));o("Mod-Enter",t);o("Shift-Enter",t);if(mac$3)o("Ctrl-Enter",t)}if(n=e.nodes.list_item){o("Enter",splitListItem(n));o("Mod-[",liftListItem(n));o("Mod-]",sinkListItem(n))}if(n=e.nodes.paragraph)o("Shift-Ctrl-0",setBlockType(n));if(n=e.nodes.code_block)o("Shift-Ctrl-\\",setBlockType(n));if(n=e.nodes.heading)for(let e=1;e<=6;e++)o("Shift-Ctrl-"+e,setBlockType(n,{level:e}));if(n=e.nodes.horizontal_rule){let e=n;o("Mod-_",((t,r)=>{r(t.tr.replaceSelectionWith(e.create()).scrollIntoView());return true}))}return r}function blockQuoteRule(e){return wrappingInputRule(/^\s*>\s$/,e)}function orderedListRule(e){return wrappingInputRule(/^(\d+)\.\s$/,e,(e=>({order:+e[1]})),((e,t)=>t.childCount+t.attrs.order==+e[1]))}function bulletListRule(e){return wrappingInputRule(/^\s*([-+*])\s$/,e)}function codeBlockRule(e){return textblockTypeInputRule(/^```$/,e)}function headingRule(e,t){return textblockTypeInputRule(new RegExp("^(#{1,"+t+"})\\s$"),e,(e=>({level:e[1].length})))}function buildInputRules(e){let t=smartQuotes.concat(ellipsis,emDash),r;if(r=e.nodes.blockquote)t.push(blockQuoteRule(r));if(r=e.nodes.ordered_list)t.push(orderedListRule(r));if(r=e.nodes.bullet_list)t.push(bulletListRule(r));if(r=e.nodes.code_block)t.push(codeBlockRule(r));if(r=e.nodes.heading)t.push(headingRule(r,6));return inputRules({rules:t})}const codeJar=(e,t)=>{const r={tab:"   ",indentOn:/{$/,catchTab:true,preserveIdent:true,addClosing:true};const n=window.document;const o=[];let i;e.setAttribute("contenteditable","plaintext-only");e.setAttribute("spellcheck","false");e.style.outline="none";e.style.overflowWrap="break-word";e.style.overflowY="auto";e.style.whiteSpace="pre-wrap";let a=false;if(e.contentEditable!=="plaintext-only")a=true;if(a)e.setAttribute("contenteditable","true");const s=(t,r)=>{o.push([t,r]);e.addEventListener(t,r)};s("keydown",(n=>{if(t&&n.keyCode===13&&!n.shiftKey)return;if(n.keyCode===65&&n.ctrlKey){window.getSelection().selectAllChildren(e);n.preventDefault()}if(n.defaultPrevented)return;if(r.preserveIdent)f(n);else d(n);if(r.catchTab)m(n);if(r.addClosing)h(n);if(a)c(l())}));s("keyup",(e=>{if(e.defaultPrevented)return;if(e.isComposing)return;if(i)i(w())}));s("paste",(e=>{v(e);if(i)i(w())}));function l(){const t=C();const r={start:0,end:0,dir:undefined};let{anchorNode:o,anchorOffset:i,focusNode:a,focusOffset:s}=t;if(!o||!a)throw"error1";if(o.nodeType===Node.ELEMENT_NODE){const e=n.createTextNode("");o.insertBefore(e,o.childNodes[i]);o=e;i=0}if(a.nodeType===Node.ELEMENT_NODE){const e=n.createTextNode("");a.insertBefore(e,a.childNodes[s]);a=e;s=0}g(e,(e=>{if(e===o&&e===a){r.start+=i;r.end+=s;r.dir=i<=s?"->":"<-";return"stop"}if(e===o){r.start+=i;if(!r.dir){r.dir="->"}else{return"stop"}}else if(e===a){r.end+=s;if(!r.dir){r.dir="<-"}else{return"stop"}}if(e.nodeType===Node.TEXT_NODE){if(r.dir!="->")r.start+=e.nodeValue.length;if(r.dir!="<-")r.end+=e.nodeValue.length}}));e.normalize();return r}function c(t){const r=C();let n,o=0;let i,a=0;if(!t.dir)t.dir="->";if(t.start<0)t.start=0;if(t.end<0)t.end=0;if(t.dir=="<-"){const{start:e,end:r}=t;t.start=r;t.end=e}let s=0;g(e,(e=>{if(e.nodeType!==Node.TEXT_NODE)return;const r=(e.nodeValue||"").length;if(s+r>t.start){if(!n){n=e;o=t.start-s}if(s+r>t.end){i=e;a=t.end-s;return"stop"}}s+=r}));if(!n)n=e,o=e.childNodes.length;if(!i)i=e,a=e.childNodes.length;if(t.dir=="<-"){[n,o,i,a]=[i,a,n,o]}r.setBaseAndExtent(n,o,i,a)}function u(){const t=C();const r=t.getRangeAt(0);const o=n.createRange();o.selectNodeContents(e);o.setEnd(r.startContainer,r.startOffset);return o.toString()}function p(){const t=C();const r=t.getRangeAt(0);const o=n.createRange();o.selectNodeContents(e);o.setStart(r.endContainer,r.endOffset);return o.toString()}function f(e){if(e.key==="Enter"){const t=u();const n=p();let[o]=b(t);let i=o;if(r.indentOn.test(t)){i+=r.tab}if(i.length>0){S(e);e.stopPropagation();y("\n"+i)}else{d(e)}if(i!==o&&n[0]==="}"){const e=l();y("\n"+o);c(e)}}}function d(e){if(a&&e.key==="Enter"){S(e);e.stopPropagation();if(p()==""){y("\n ");const e=l();e.start=--e.end;c(e)}else{y("\n")}}}function h(e){const t=`([{'"`;const r=`)]}'"`;const n=p();const o=u();const i=o.substr(o.length-1)==="\\";const a=n.substr(0,1);if(r.includes(e.key)&&!i&&a===e.key){const t=l();S(e);t.start=++t.end;c(t)}else if(t.includes(e.key)&&!i&&(`"'`.includes(e.key)||[""," ","\n"].includes(a))){S(e);const n=l();const o=n.start==n.end?"":C().toString();const i=e.key+o+r[t.indexOf(e.key)];y(i);n.start++;n.end++;c(n)}}function m(e){if(e.key==="Tab"){S(e);if(e.shiftKey){const e=u();let[t,o]=b(e);if(t.length>0){const e=l();const i=Math.min(r.tab.length,t.length);c({start:o,end:o+i});n.execCommand("delete");e.start-=i;e.end-=i;c(e)}}else{y(r.tab)}}}function v(e){S(e);const t=(e.originalEvent||e).clipboardData.getData("text/plain").replace(/\r/g,"");const r=l();y(t);c({start:r.start+t.length,end:r.start+t.length})}function g(e,t){const r=[];if(e.firstChild)r.push(e.firstChild);let n=r.pop();while(n){if(t(n)==="stop")break;if(n.nextSibling)r.push(n.nextSibling);if(n.firstChild)r.push(n.firstChild);n=r.pop()}}function y(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");n.execCommand("insertHTML",false,e)}function b(e){let t=e.length-1;while(t>=0&&e[t]!=="\n")t--;t++;let r=t;while(r<e.length&&/[ \t]/.test(e[r]))r++;return[e.substring(t,r)||"",t,r]}function w(){return e.textContent||""}function S(e){e.preventDefault()}function C(){if(e.parentNode&&e.parentNode.nodeType==Node.DOCUMENT_FRAGMENT_NODE){return e.parentNode.getSelection()}return window.getSelection()}return{updateOptions(e){Object.assign(r,e)},updateCode(t){e.textContent=t},onUpdate(e){i=e},toString:w,save:l,restore:c,destroy(){for(let[t,r]of o){e.removeEventListener(t,r)}}}};function selectedText(){const e=window.getSelection();if(e.rangeCount===0)return"";return e.getRangeAt(0).toString()}function textBeforeCursor(e){const t=window.getSelection();if(t.rangeCount===0)return"";const r=t.getRangeAt(0);const n=document.createRange();n.selectNodeContents(e);n.setEnd(r.startContainer,r.startOffset);return n.toString()}function textAfterCursor(e){const t=window.getSelection();if(t.rangeCount===0)return"";const r=t.getRangeAt(0);const n=document.createRange();n.selectNodeContents(e);n.setStart(r.endContainer,r.endOffset);return n.toString()}const commaRegEx=/"[^"]*"|[0-9]+,[0-9]+|[A-Za-z\u0391-\u03D5\uD835][A-Za-z0-9_\u0391-\u03D5\uD835\uDC00-\uDFFF]/g;const dotRegEx=/"[^"]*"|[0-9]+\.[0-9]+|[A-Za-z\u0391-\u03D5\uD835][A-Za-z0-9_\u0391-\u03D5\uD835\uDC00-\uDFFF]/g;const functionRegEx$1=/^(?:private +)?function (?:[A-Za-z\u0391-\u03C9\u03D5\u210B\u210F\u2110\u2112\u2113\u211B\u212C\u2130\u2131\u2133]|(?:\uD835[\uDC00-\udc33\udc9c-\udcb5]))[A-Za-z0-9_\u0391-\u03C9\u03D5\u0300-\u0308\u030A\u030C\u0332\u20d0\u20d1\u20d6\u20d7\u20e1]**\(/;const dotFromCommaForStorage=e=>{let t;while((t=commaRegEx.exec(e))!=null){if("0123456789".indexOf(t[0].charAt(0))>-1){const r=t.index+t[0].indexOf(",");e=e.slice(0,r)+"."+e.slice(r+1)}}return e};const commaFromDotForDisplay=e=>{let t;while((t=dotRegEx.exec(e))!==null){if("0123456789".indexOf(t[0].charAt(0))>-1){const r=t.index+t[0].indexOf(".");e=e.slice(0,r)+","+e.slice(r+1)}}return e};function openMathPrompt(e){const t=e.dom.appendChild(document.createElement("div"));t.className="math-code";t.parentNode.firstChild.style.display="none";const r=e=>{const r=e.target;if(!t.contains(r)&&r.getAttribute("role")!=="presentation"){const e=r.getAttribute("class");if(!e||e.slice(0,2)!=="cm"){n()}}};setTimeout((()=>window.addEventListener("mousedown",r)),500);const n=()=>{window.removeEventListener("mousedown",r);if(t.parentNode){t.parentNode.firstChild.style.display="inline-block";t.parentNode.removeChild(t)}};const o=e.encoding==="HurmetMath";const i=!o;const a=o?e.outerView.state.doc.attrs.decimalFormat.slice(-1):"";const s=t.appendChild(document.createElement("div"));const l=codeJar(s,true);if(e.attrs){if(o&&e.attrs.entry){let t=e.attrs.entry;if(a===","){t=commaFromDotForDisplay(t)}l.updateCode(t)}else if(e.attrs.tex){l.updateCode(e.attrs.tex)}}const c=l.toString().length;l.restore({start:c,end:c,dir:undefined});const u=t.appendChild(document.createElement("div"));u.setAttribute("class","math-display");const p=function(t){let r="";let n=false;if(o){const t=selectedText();if(t.length===0){hurmet.autoCorrect(l,textBeforeCursor(s),textAfterCursor(s))}r=l.toString();if(a===","){r=dotFromCommaForStorage(r)}n=functionRegEx$1.test(r);if(!n){r=hurmet.parse(r,e.decimalFormat,false,true)}}else{r=t}if(!n){try{const t="MozAppearance"in document.documentElement.style;katex.render(r,u,{displayMode:e.attrs.displayMode,strict:false,macros:{"\\class":"\\htmlClass"},trust:e=>e.command==="\\htmlClass"&&e.class==="special-fraction",output:t?"mathml":"htmlAndMathml"})}catch(e){while(u.lastChild){u.removeChild(u.lastChild)}u.textContent=r}}};if(l.toString().length>0){p(l.toString())}s.addEventListener("input",(e=>{p(l.toString())}));const f=t=>{let r=l.toString();r=r.replace(/^[\s\u200b]+/,"");r=r.replace(/[\s\u200b]+$/,"");r=r.replace(/\r?\n/g,"\n");if(o&&a===","){r=dotFromCommaForStorage(r)}const s=i?{tex:r}:hurmet.prepareStatement(r,e.decimalFormat);s.displayMode=e.attrs.displayMode;n();e.callback(s)};s.addEventListener("submit",(e=>{e.preventDefault();f()}));s.addEventListener("keydown",(e=>{if(e.keyCode===27){e.preventDefault();n()}else if(e.keyCode===13&&!e.shiftKey){e.preventDefault();f()}}))}class CalcView{constructor(e,t){this.node=e;this.outerView=t;this.dom=schema.nodes.calculation.spec.toDOM(e)}selectNode(){if(this.dom.children.length>1){return}this.dom.classList.add("ProseMirror-selectednode");const e=this.node.attrs;const t=this.outerView.state.selection.from;openMathPrompt({encoding:"HurmetMath",attrs:e,outerView:this.outerView,dom:this.dom,callback(e){hurmet.updateCalculations(this.outerView,schema.nodes.calculation,false,e,t)}})}deselectNode(){this.dom.classList.remove("ProseMirror-selectednode")}stopEvent(){return true}}class TexView{constructor(e,t){this.node=e;this.outerView=t;this.dom=schema.nodes.tex.spec.toDOM(e)}selectNode(){this.dom.classList.add("ProseMirror-selectednode");const e=this.node.attrs;openMathPrompt({encoding:"TeX",attrs:e,outerView:this.outerView,dom:this.dom,callback(e){const t=this.outerView;t.dispatch(t.state.tr.replaceSelectionWith(schema.nodes.tex.createAndFill(e)));t.focus()}})}deselectNode(){this.dom.classList.remove("ProseMirror-selectednode")}stopEvent(){return true}}function pmSetup(e){return[buildInputRules(e.schema),keymap(buildKeymap(e.schema,e.mapKeys)),keymap(baseKeymap),gapCursor(),menuBar({floating:true,content:buildMenuItems(e.schema).fullMenu}),history(),columnResizing(),tableEditing(),new Plugin({props:{attributes:{class:"ProseMirror-example-setup-style"}}})]}window.view=new EditorView(document.querySelector("#editor"),{state:EditorState.create({doc:DOMParser.fromSchema(schema).parse(document.querySelector("#content")),plugins:pmSetup({schema:schema})}),nodeViews:{calculation(e,t){return new CalcView(e,t)},tex(e,t){return new TexView(e,t)}}});const userLanguageTag=navigator.language||navigator.userLanguage;const parts=userLanguageTag.match(/([A-Za-z]{1,2})-(\w{1,3})(?:-(\w{2,3}))?/);const userLanguage=parts[1];const userRegion=parts[3]?parts[3]:parts[2];if(["BD","IN","LK","MV","MP","PK"].includes(userRegion)){window.view.state.doc.attrs.decimalFormat="1,00,000."}else if(userLanguage==="en"||["BN","BU","BW","DO","EG","ET","GH","GT","GY","HN","IE","IL","JO","JP","KE","KH","KP","KR","LB","LY","MM","MN","MT","MX","MY","NG","NI","PA","PH","PR","QA","PS","SG","SV","TH","TW","TZ","UG","ZW"].includes(userRegion)){window.view.state.doc.attrs.decimalFormat="1,000,000."}else if(userLanguage==="zh"){window.view.state.doc.attrs.decimalFormat="1,0000,0000."}const tidyUp=e=>{const t=fixTables(window.view.state);if(t){window.view.state=window.view.state.apply(t.setMeta("addToHistory",false))}hurmet.updateCalculations(window.view,schema.nodes.calculation,true);document.execCommand("enableObjectResizing",false,false);document.execCommand("enableInlineTableEditing",false,false)};const loadRemoteFile=e=>{const t=hurmet.md2ast(e);let r={type:"doc",attrs:{decimalFormat:"1,000,000.",inDraftMode:false,fontSize:12,fileHandle:null,pageSize:"letter"},content:t};r=JSON.parse(JSON.stringify(r));window.view.dispatch(window.view.state.tr.replaceWith(0,window.view.state.doc.content.size,schema.nodeFromJSON(r)));tidyUp()};const gistRegEx=/^https:\/\/gist\.githubusercontent\.com\/.+\.md$/;async function loadURL(e){const t=decodeURIComponent(e.slice(1));if(gistRegEx.test(t)){const e=await fetch(t);if(e.ok){const t=await e.text();loadRemoteFile(t)}}else{tidyUp()}}const hash=location.hash;if(hash&&hash.length>1){loadURL(hash)}else{tidyUp()}